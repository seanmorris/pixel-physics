!function(){"use strict";var t="undefined"==typeof global?self:global;if("function"!=typeof t.require){var e={},s={},i={},r={}.hasOwnProperty,a=/^\.\.?(\/|$)/,n=function(t,e){for(var s,i=[],r=(a.test(e)?t+"/"+e:e).split("/"),n=0,o=r.length;n<o;n++)".."===(s=r[n])?i.pop():"."!==s&&""!==s&&i.push(s);return i.join("/")},o=function(t){return t.split("/").slice(0,-1).join("/")},l=function(e,i){var r,a={id:e,exports:{},hot:u&&u.createHot(e)};return s[e]=a,i(a.exports,(r=e,function(e){var s=n(o(r),e);return t.require(s,r)}),a),a.exports},h=function(t){var e=i[t];return e&&t!==e?h(e):t},g=function(t,i){null==i&&(i="/");var a=h(t);if(r.call(s,a))return s[a].exports;if(r.call(e,a))return l(a,e[a]);throw new Error("Cannot find module '"+t+"' from '"+i+"'")};g.alias=function(t,e){i[e]=t};var c=/\.[^.\/]+$/,d=/\/index(\.[^\/]+)?$/;g.register=g.define=function(t,a){if(t&&"object"==typeof t)for(var n in t)r.call(t,n)&&g.register(n,t[n]);else e[t]=a,delete s[t],function(t){if(c.test(t)){var e=t.replace(c,"");r.call(i,e)&&i[e].replace(c,"")!==e+"/index"||(i[e]=t)}if(d.test(t)){var s=t.replace(d,"");r.call(i,s)||(i[s]=t)}}(t)},g.list=function(){var t=[];for(var s in e)r.call(e,s)&&t.push(s);return t};var u=t._hmr&&new t._hmr(function(t,e){return h(n(o(t),e))},g,e,s);g._cache=s,g.hmr=u&&u.wrap,g.brunch=!0,t.require=g}}(),function(){"undefined"==typeof window||window;var t=function(t,e,s){var i={},r=function(e,s){try{return t(s+"/node_modules/"+e)}catch(t){if(-1===t.toString().indexOf("Cannot find module"))throw t;if(-1!==s.indexOf("node_modules")){var a=s.split("/"),n=a.lastIndexOf("node_modules"),o=a.slice(0,n).join("/");return r(e,o)}}return i};return function(a){if(a in e&&(a=e[a]),a){if("."!==a[0]&&s){var n=r(a,s);if(n!==i)return n}return t(a)}}};require.register("curvature/animate/Ease.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Ease=void 0;var i=s("../base/Mixin"),r=s("../mixin/PromiseMixin");function a(e,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,void 0,"symbol"===t(n=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(a,"string"))?n:String(n)),r)}var a,n}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=l(e);if(s){var a=l(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,i)}}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}(g,i.Mixin.with(r.PromiseMixin));var e,s,l,h=o(g);function g(t,e={}){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g),(s=h.call(this)).interval=t,s.terminal=!1,s.initial=!1,s.timeout=!1,s.final=!1,s.canceled=!1,s.done=!1,s.calculate=!!(s.calculate||"calculate"in e)&&e.calculate,s.bounded=!("bounded"in e)||e.bounded,s.repeat="repeat"in e?e.repeat:1,s.reverse="reverse"in e&&e.reverse,s}return e=g,(s=[{key:"start",value:function(){this.done=!1,requestAnimationFrame(()=>{this.initial=Date.now(),this.terminal=this.initial+this.interval,this.repeat>=0&&(this.terminal=this.initial+this.interval*this.repeat,this.timeout=setTimeout(()=>{if(this.done)return this.reverse?0:1;this.done=!0,this[r.PromiseMixin.Accept](this.reverse?0:1)},this.interval*this.repeat))})}},{key:"cancel",value:function(){return this.done?this.final:(clearTimeout(this.timeout),this.final=this.current(),this.canceled=this.done=!0,this[r.PromiseMixin.Reject](this.final),this.final)}},{key:"fraction",value:function(){if(this.done)return this.reverse?0:1;if(!1===this.initial)return this.reverse?1:0;var t=Date.now()-this.initial;if(t/this.interval>=this.repeat)return this.reverse?0:1;var e=t%this.interval/this.interval;return this.reverse?1-e:e}},{key:"current",value:function(){var t=this.fraction();return this.calculate?this.calculate(t):t}}])&&a(e.prototype,s),l&&a(e,l),Object.defineProperty(e,"prototype",{writable:!1}),g}();e.Ease=h}()}),require.register("curvature/animate/ease/CubicInOut.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubicInOut=void 0;var t=s("../Ease");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,r=l(t);if(e){var a=l(this).constructor;s=Reflect.construct(r,arguments,a)}else s=r.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}(this,s)}}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}var g=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(c,t.Ease);var s,i,l,g=n(c);function c(...t){var e,s,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),e=g.call(this,...t),s=o(e),r=(t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),(i=h(i="calculate"))in s?Object.defineProperty(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,e}return s=c,i&&r(s.prototype,i),l&&r(s,l),Object.defineProperty(s,"prototype",{writable:!1}),s}();e.CubicInOut=g}()}),require.register("curvature/animate/ease/QuintInOut.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QuintInOut=void 0;var t=s("../Ease");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,r=l(t);if(e){var a=l(this).constructor;s=Reflect.construct(r,arguments,a)}else s=r.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}(this,s)}}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}var g=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(c,t.Ease);var s,i,l,g=n(c);function c(...t){var e,s,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),e=g.call(this,...t),s=o(e),r=(t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t),(i=h(i="calculate"))in s?Object.defineProperty(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,e}return s=c,i&&r(s.prototype,i),l&&r(s,l),Object.defineProperty(s,"prototype",{writable:!1}),s}();e.QuintInOut=g}()}),require.register("curvature/base/Bag.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Bag=void 0;var i=s("./Bindable"),r=s("./Mixin"),a=s("../mixin/EventTargetMixin");function n(e,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,void 0,"symbol"===t(n=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(a,"string"))?n:String(n)),r)}var a,n}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function l(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=h(e);if(s){var a=h(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,i)}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=Symbol("Mapped"),c=Symbol("Has"),d=Symbol("Add"),u=Symbol("Remove"),p=Symbol("Delete"),f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e)}(m,r.Mixin.with(a.EventTargetMixin));var e,s,h,f=l(m);function m(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,m),(e=f.call(this)).changeCallback=t,e.content=new Map,e.current=0,e.length=0,e.list=i.Bindable.makeBindable([]),e.meta=Symbol("meta"),e.type=void 0,e}return e=m,(s=[{key:"has",value:function(t){return this[g]?this[g].has(t):this[c](t)}},{key:c,value:function(t){return this.content.has(t)}},{key:"add",value:function(t){return this[g]?this[g].add(t):this[d](t)}},{key:d,value:function(t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error("Only objects of type ".concat(this.type," may be added to this Bag."));if(t=i.Bindable.make(t),!this.content.has(t)){var e=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(e)){var s=(t=>Number(t))(this.current++);this.content.set(t,s),this.list[s]=t,this.changeCallback&&this.changeCallback(t,this.meta,m.ITEM_ADDED,s);var r=new CustomEvent("added",{detail:{item:t,id:s}});return this.dispatchEvent(r),this.length=this.size,s}}}},{key:"remove",value:function(t){return this[g]?this[g].remove(t):this[u](t)}},{key:u,value:function(t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error("Only objects of type ".concat(this.type," may be removed from this Bag."));if(t=i.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var e=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(e)){var s=this.content.get(t);delete this.list[s],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,m.ITEM_REMOVED,s);var r=new CustomEvent("removed",{detail:{item:t,id:s}});return this.dispatchEvent(r),this.length=this.size,t}}},{key:"delete",value:function(t){if(this[g])return this[g].delete(t);this[p](t)}},{key:p,value:function(t){this.remove(t)}},{key:"map",value:function(t=(t=>t),e=(t=>t)){var s=new WeakMap,i=new m;return i[g]=this,this.addEventListener("added",r=>{var a=r.detail.item;if(e(a)&&!s.has(a)){var n=t(a);s.set(a,n),i[d](n)}}),this.addEventListener("removed",t=>{var e=t.detail.item;if(s.has(e)){var r=s.get(e);s.delete(e),i[u](r)}}),i}},{key:"size",get:function(){return this.content.size}},{key:"items",value:function(){return Array.from(this.content.entries()).map(t=>t[0])}}])&&n(e.prototype,s),h&&n(e,h),Object.defineProperty(e,"prototype",{writable:!1}),m}();e.Bag=f,Object.defineProperty(f,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(f,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function s(t,e,s){return(e=i(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function i(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Bindable=void 0;var a=Symbol("ref"),n=Symbol("original"),o=Symbol("deck"),l=Symbol("binding"),h=Symbol("subBinding"),g=Symbol("bindingAll"),c=Symbol("isBindable"),d=Symbol("wrapping"),u=Symbol("Names"),p=Symbol("executing"),f=Symbol("stack"),m=(Symbol("object"),Symbol("wrapped")),v=Symbol("unwrapped"),y=Symbol("getProto"),b=Symbol("onGet"),S=Symbol("onAllGet"),w=Symbol("bindChain"),x=Symbol("Descriptors"),k=Symbol("Before"),M=Symbol("After"),P=Symbol("NoGetters"),C=Object.getPrototypeOf(Int8Array),j=Set.prototype[Symbol.iterator],A=Map.prototype[Symbol.iterator],T="object"===("undefined"==typeof globalThis?"undefined":r(globalThis))?globalThis:"object"===("undefined"==typeof window?"undefined":r(window))?window:"object"===("undefined"==typeof self?"undefined":r(self))?self:void 0,O=t=>"function"==typeof T.Map&&t instanceof T.Map||"function"==typeof T.Set&&t instanceof T.Set||"function"==typeof T.Node&&t instanceof T.Node||"function"==typeof T.WeakMap&&t instanceof T.WeakMap||"function"==typeof T.WeakSet&&t instanceof T.WeakSet||"function"==typeof T.ArrayBuffer&&t instanceof T.ArrayBuffer||"function"==typeof T.Promise&&t instanceof T.Promise||"function"==typeof T.File&&t instanceof T.File||"function"==typeof T.Event&&t instanceof T.Event||"function"==typeof T.CustomEvent&&t instanceof T.CustomEvent||"function"==typeof T.Gamepad&&t instanceof T.Gamepad||"function"==typeof T.ResizeObserver&&t instanceof T.ResizeObserver||"function"==typeof T.MutationObserver&&t instanceof T.MutationObserver||"function"==typeof T.PerformanceObserver&&t instanceof T.PerformanceObserver||"function"==typeof T.IntersectionObserver&&t instanceof T.IntersectionObserver||"function"==typeof T.IDBCursor&&t instanceof T.IDBCursor||"function"==typeof T.IDBCursorWithValue&&t instanceof T.IDBCursorWithValue||"function"==typeof T.IDBDatabase&&t instanceof T.IDBDatabase||"function"==typeof T.IDBFactory&&t instanceof T.IDBFactory||"function"==typeof T.IDBIndex&&t instanceof T.IDBIndex||"function"==typeof T.IDBKeyRange&&t instanceof T.IDBKeyRange||"function"==typeof T.IDBObjectStore&&t instanceof T.IDBObjectStore||"function"==typeof T.IDBOpenDBRequest&&t instanceof T.IDBOpenDBRequest||"function"==typeof T.IDBRequest&&t instanceof T.IDBRequest||"function"==typeof T.IDBTransaction&&t instanceof T.IDBTransaction||"function"==typeof T.IDBVersionChangeEvent&&t instanceof T.IDBVersionChangeEvent||"function"==typeof T.FileSystemFileHandle&&t instanceof T.FileSystemFileHandle||"function"==typeof T.RTCPeerConnection&&t instanceof T.RTCPeerConnection,_=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var s,i,_;return s=e,_=[{key:"isBindable",value:function(t){return!(!t||!t[c])&&t[c]===e}},{key:"onDeck",value:function(t,e){return t[o].get(e)||!1}},{key:"ref",value:function(t){return t[a]||t||!1}},{key:"makeBindable",value:function(t){return this.make(t)}},{key:"shuck",value:function(t,s){s=s||new Map;var i=Object.create({});if(t instanceof C||t instanceof ArrayBuffer){var a=t.slice(0);return s.set(t,a),a}var o=Object.keys(t);for(var l in o){var h=o[l];if("___"!==h.substring(0,3)){var g=s.get(t[h]);if(g)i[h]=g;else if(t[h]!==t){if(t[h]&&"object"===r(t[h])){var c=t[h];e.isBindable(t[h])&&(c=t[h][n]),i[h]=this.shuck(c,s)}else i[h]=t[h];s.set(t[h],i[h])}else s.set(t[h],i),i[h]=i}}return e.isBindable(t)&&(delete i.bindTo,delete i.isBound),i}},{key:"make",value:function(t){if(!t||!["function","object"].includes(r(t)))return t;if(t[a])return t[a];if(t[c])return t;if(Object.isSealed(t)||Object.isFrozen(t)||!Object.isExtensible(t)||O(t))return t;Object.defineProperty(t,c,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(t,a,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(t,n,{configurable:!1,enumerable:!1,writable:!1,value:t}),Object.defineProperty(t,o,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(t,l,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(t,h,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(t,g,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(t,p,{enumerable:!1,writable:!0}),Object.defineProperty(t,d,{enumerable:!1,writable:!0}),Object.defineProperty(t,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(t,k,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(t,M,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(t,m,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(t,v,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(t,x,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var s=(i,a=null,n={})=>{var o=!1;if(Array.isArray(i)){var c=i.map(t=>s(t,a,n));return()=>c.forEach(t=>t())}if(i instanceof Function&&(n=a||{},a=i,o=!0),n.delay>=0&&(a=this.wrapDelayCallback(a,n.delay)),n.throttle>=0&&(a=this.wrapThrottleCallback(a,n.throttle)),n.wait>=0&&(a=this.wrapWaitCallback(a,n.wait)),n.frame&&(a=this.wrapFrameCallback(a,n.frame)),n.idle&&(a=this.wrapIdleCallback(a)),o){if(t[g].add(a),!("now"in n)||n.now)for(var d in t)a(t[d],d,t,!1);return()=>{t[g].delete(a)}}if(t[l][i]||(t[l][i]=new Set),n.children){var u=a;a=((...s)=>{var i=s[0],a=t[h].get(u);if(a&&(t[h].delete(u),a()),"object"===r(i)){var o=e.make(i);e.isBindable(o)&&t[h].set(u,o.bindTo((...t)=>u(...s,...t),Object.assign({},n,{children:!1}))),u(...s)}else u(...s)})}t[l][i].add(a),"now"in n&&!n.now||a(t[i],i,t,!1);var p=()=>{var e=t[h].get(a);e&&(t[h].delete(a),e()),t[l][i]&&t[l][i].has(a)&&t[l][i].delete(a)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>p),p};Object.defineProperty(t,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:s});Object.defineProperty(t,w,{configurable:!1,enumerable:!1,writable:!1,value:(e,s)=>{var i=e.split("."),r=i.shift(),a=i.slice(0),n=[];return n.push(t.bindTo(r,(t,e,i,r)=>{var o=a.join(".");0!==a.length?(void 0===t&&(t=i[e]=this.make({})),n=n.concat(t[w](o,s))):s(t,e,i,r)})),()=>n.forEach(t=>t())}}),Object.defineProperty(t,"___before",{configurable:!1,enumerable:!1,writable:!1,value:e=>(t[k].add(e),()=>t[k].delete(e))}),Object.defineProperty(t,"___after",{configurable:!1,enumerable:!1,writable:!1,value:e=>(t[M].add(e),()=>t[M].delete(e))});for(var i in Object.defineProperty(t,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(t[g].size)return!0;for(var e of Object.values(t[l]))if(e.size)return!0;return!1}}),t)t[i]&&"object"===r(t[i])&&(t[i][a]||t[i]instanceof Promise||Object.isExtensible(t[i])&&!Object.isSealed(t[i])&&(O(t[i])||(t[i]=e.make(t[i]))));var _=t[x],E=t[m],R=t[f],B=Object.create(null);return B.set=((s,i,a)=>{if(a&&"object"===r(a)&&(a=e.make(a),s[i]===a))return!0;E.has(i)&&E.delete(i);var n=t[o],h=n.has(i),c=h&&n.get(i);if(h&&c===a)return!0;if(i.slice&&"___"===i.slice(-3))return!0;if(s[i]===a||"number"==typeof a&&isNaN(c)&&isNaN(a))return!0;for(var d of(n.set(i,a),t[g]))d(a,i,s,!1);if(i in t[l])for(var u of t[l][i])u(a,i,s,!1,s[i]);if(n.delete(i),T.File&&s instanceof T.File&&"lastModifiedDate"==i||Reflect.set(s,i,a),Array.isArray(s)&&t[l].length)for(var p in t[l].length)(0,t[l].length[p])(s.length,"length",s,!1,s.length);return!0}),B.construct=((s,i)=>{var r="constructor";for(var a of s[k])a(s,r,t[f],void 0,i);var o=e.make(new s[n](...i));for(var l of s[M])l(s,r,t[f],o,i);return o}),B.deleteProperty=((e,s)=>{var i=t[o];if(i.has(s))return!0;if(!(s in e))return!0;if(_.has(s)){var r=_.get(s);if(r&&!r.configurable)return!1;_.delete(s)}for(var a of(i.set(s,null),E.has(s)&&E.delete(s),t[g]))a(void 0,s,e,!0,e[s]);if(s in t[l])for(var n of t[l][s])n(void 0,s,e,!0,e[s]);return Reflect.deleteProperty(e,s),i.delete(s),!0}),t[P]||(B.getPrototypeOf=(e=>y in t?t[y]:Reflect.getPrototypeOf(e)),B.get=((s,i)=>{if(E.has(i))return E.get(i);if(i===a||i===n||"apply"===i||"isBound"===i||"bindTo"===i||"__proto__"===i||"constructor"===i)return t[i];var r;if(_.has(i)?r=_.get(i):(r=Object.getOwnPropertyDescriptor(t,i),_.set(i,r)),r&&!r.configurable&&!r.writable)return t[i];if(S in t)return t[S](i);if(b in t&&!(i in t))return t[b](i);if(r&&!r.configurable&&!r.writable)return E.set(i,t[i]),t[i];if("function"==typeof t[i]){if(u in t[i])return t[i];t[v].set(i,t[i]);var o=Object.getPrototypeOf(t)[i]===t[i],l=O(t)||"function"==typeof t[Symbol.iterator]&&"next"===i||"function"==typeof C&&t instanceof C||"function"==typeof EventTarget&&t instanceof EventTarget||"function"==typeof Date&&t instanceof Date||"function"==typeof A&&t.prototype===A||"function"==typeof j&&t.prototype===j?t:t[a],h=function(...e){for(var s of(t[p]=i,R.unshift(i),t[k]))s(t,i,R,t,e);var r;if(new.target)r=new(t[v].get(i))(...e);else{var a=t[v].get(i);r=o?a.apply(l||t,e):a(...e)}for(var n of t[M])n(t,i,R,t,e);return t[p]=null,R.shift(),r};(h[u]=h[u]||new WeakMap).set(t,i),h[S]=(e=>{var s=h[u].get(t);return t[s][e]});var g=e.make(h);return E.set(i,g),g}return t[i]})),Object.defineProperty(t,a,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(t,B)}),t[a]}},{key:"clearBindings",value:function(t){var e=(t=>(...e)=>e.map(t))(t=>Object.keys(t).map(e=>delete t[e]));t[g].clear(),e(t[m],t[l],t[M],t[k])}},{key:"resolve",value:function(t,e,s=!1){for(var i,a=e.split("."),n=a[0];a.length;){if(s&&1===a.length)return[this.make(t),a.shift(),n];(i=a.shift())in t&&t[i]&&"object"===r(t[i])||(t[i]=Object.create(null)),t=this.make(t[i])}return[this.make(t),i,n]}},{key:"wrapDelayCallback",value:function(t,e){return(...s)=>setTimeout(()=>t(...s),e)}},{key:"wrapThrottleCallback",value:function(t,e){return this.throttles.set(t,!1),(...s)=>{this.throttles.get(t,!0)||(t(...s),this.throttles.set(t,!0),setTimeout(()=>{this.throttles.set(t,!1)},e))}}},{key:"wrapWaitCallback",value:function(t,e){return(...s)=>{var i;(i=this.waiters.get(t))&&(this.waiters.delete(t),clearTimeout(i)),i=setTimeout(()=>t(...s),e),this.waiters.set(t,i)}}},{key:"wrapFrameCallback",value:function(t,e){return(...e)=>{requestAnimationFrame(()=>t(...e))}}},{key:"wrapIdleCallback",value:function(t){return(...e)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>t(...e))}}}],(i=null)&&t(s.prototype,i),_&&t(s,_),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.Bindable=_,s(_,"waiters",new WeakMap),s(_,"throttles",new WeakMap),Object.defineProperty(_,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:b}),Object.defineProperty(_,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:P}),Object.defineProperty(_,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:y}),Object.defineProperty(_,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:S})}()}),require.register("curvature/base/Cache.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function s(e,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,void 0,"symbol"===t(n=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(a,"string"))?n:String(n)),r)}var a,n}Object.defineProperty(e,"__esModule",{value:!0}),e.Cache=void 0;var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,r=[{key:"store",value:function(t,e,s,i="standard"){var r=0;s&&(r=1e3*s+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(i)||this.buckets.set(i,new Map);var a=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:t,value:e,expiry:s,bucket:i}});document.dispatchEvent(a)&&this.buckets.get(i).set(t,{value:e,expiration:r})}},{key:"load",value:function(t,e=!1,s="standard"){var i=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:t,defaultvalue:e,bucket:s}});if(!document.dispatchEvent(i))return e;if(this.buckets&&this.buckets.has(s)&&this.buckets.get(s).has(t)){var r=this.buckets.get(s).get(t);if(0===r.expiration||r.expiration>(new Date).getTime())return this.buckets.get(s).get(t).value}return e}}],(i=null)&&s(e.prototype,i),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.Cache=i}()}),require.register("curvature/base/Config.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,void 0,"symbol"===i(n=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?n:String(n)),r)}var a,n}function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0;var r={},a=s,n="object"===("undefined"==typeof globalThis?"undefined":i(globalThis))?globalThis:"object"===("undefined"==typeof window?"undefined":i(window))?window:"object"===("undefined"==typeof self?"undefined":i(self))?self:void 0;try{r=a("/Config").Config}catch(t){!0===n.devMode&&console.error(t),r={}}var o=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var s,i,r;return s=e,r=[{key:"get",value:function(t){return this.configs[t]}},{key:"set",value:function(t,e){return this.configs[t]=e,this}},{key:"dump",value:function(){return this.configs}},{key:"init",value:function(...t){for(var e in t){var s=t[e];for(var i in"string"==typeof s&&(s=JSON.parse(s)),s){var r=s[i];return this.configs[i]=r}}return this}}],(i=null)&&t(s.prototype,i),r&&t(s,r),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:r})}()}),require.register("curvature/base/Dom.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function s(e,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,void 0,"symbol"===t(n=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(a,"string"))?n:String(n)),r)}var a,n}Object.defineProperty(e,"__esModule",{value:!0}),e.Dom=void 0;var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,r=[{key:"mapTags",value:function(t,e,s,i,r){var a=[],n=!0;i&&(n=!1);var o=!1,l=globalThis.window,h=(l.Node,l.Element),g=l.NodeFilter,c=l.document.createTreeWalker(t,g.SHOW_ELEMENT|g.SHOW_TEXT,{acceptNode:(t,s)=>{if(!n){if(t!==i)return g.FILTER_SKIP;n=!0}return r&&t===r&&(o=!0),o?g.FILTER_SKIP:e?t instanceof h&&t.matches(e)?g.FILTER_ACCEPT:g.FILTER_SKIP:g.FILTER_ACCEPT}},!1);for(0;c.nextNode();)a.push(s(c.currentNode,c));return a}},{key:"dispatchEvent",value:function(t,e){t.dispatchEvent(e),this.mapTags(t,!1,t=>{t.dispatchEvent(e)})}}],(i=null)&&s(e.prototype,i),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.Dom=i}()}),require.register("curvature/base/Mixin.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mixin=void 0;var t=s("./Bindable");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,i=l(t);if(e){var r=l(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return n(this,s)}}function n(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,void 0,"symbol"===i(n=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?n:String(n)),r)}var a,n}function c(t,e,s){return e&&g(t.prototype,e),s&&g(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}var d=Symbol("constructor"),u=(Symbol("mixinList"),function(){function e(){h(this,e)}return c(e,null,[{key:"from",value:function(t,...s){return function(l){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}(d,t);var g=a(d);function d(...r){var a;h(this,d);var l=t.constructor?a=g.call(this,...r):null;for(var c of s)switch(c[e.Constructor]&&c[e.Constructor].apply(o(a)),i(c)){case"function":e.mixClass(c,d);break;case"object":e.mixObject(c,o(a))}return n(a,l)}return c(d)}()}},{key:"make",value:function(...t){var s=t.pop();return e.to(s,...t)}},{key:"to",value:function(t,...e){var s={};e.map(e=>{switch(i(e)){case"object":Object.assign(s,Object.getOwnPropertyDescriptors(e));break;case"function":Object.assign(s,Object.getOwnPropertyDescriptors(e.prototype))}delete s.constructor,Object.defineProperties(t.prototype,s)})}},{key:"with",value:function(...t){return this.from(function(){return c(function t(){h(this,t)})}(),...t)}},{key:"mixObject",value:function(t,e){for(var s of Object.getOwnPropertyNames(t))"function"!=typeof t[s]?e[s]=t[s]:e[s]=t[s].bind(e);for(var i of Object.getOwnPropertySymbols(t))"function"!=typeof t[i]?e[i]=t[i]:e[i]=t[i].bind(e)}},{key:"mixClass",value:function(t,e){for(var s of Object.getOwnPropertyNames(t.prototype))if(!["name","prototype","length"].includes(s)){var i=Object.getOwnPropertyDescriptor(e,s);i&&!i.writable||("function"==typeof t[s]?e.prototype[s]=t.prototype[s].bind(e.prototype):e.prototype[s]=t.prototype[s])}for(var r of Object.getOwnPropertySymbols(t.prototype))"function"==typeof t[r]?e.prototype[r]=t.prototype[r].bind(e.prototype):e.prototype[r]=t.prototype[r];var a=function(){if(["name","prototype","length"].includes(n))return"continue";var s=Object.getOwnPropertyDescriptor(e,n);if(s&&!s.writable)return"continue";if("function"!=typeof t[n])return e[n]=t[n],"continue";var i=e[n]||!1,r=t[n].bind(e);e[n]=((...t)=>(i&&i(...t),r(...t)))};for(var n of Object.getOwnPropertyNames(t))a();var o=function(){if("function"!=typeof t[l])return e.prototype[l]=t[l],"continue";var s=e[l]||!1,i=t[l].bind(e);e[l]=((...t)=>(s&&s(...t),i(...t)))};for(var l of Object.getOwnPropertySymbols(t))o()}},{key:"mix",value:function(e){for(var s={},i={},r=t.Bindable.makeBindable(e),a=function(t){var e=Object.getOwnPropertyNames(t.prototype),a=Object.getOwnPropertyNames(t),n=/^(before|after)__(.+)/,o=function(e){var i=e.match(n);if(i){switch(i[1]){case"before":r.___before((s,r,a,n,o)=>{if(r===i[2])return t[e].bind(n)(...o)});break;case"after":r.___after((s,r,a,n,o)=>{if(r===i[2])return t[e].bind(n)(...o)})}return"continue"}return s[e]?"continue":"function"!=typeof t[e]?"continue":void(s[e]=t[e])};for(var l of a)o(l);var h=function(e){var s=e.match(n);if(s){switch(s[1]){case"before":r.___before((i,r,a,n,o)=>{if(r===s[2])return t.prototype[e].bind(n)(...o)});break;case"after":r.___after((i,r,a,n,o)=>{if(r===s[2])return t.prototype[e].bind(n)(...o)})}return"continue"}return i[e]?"continue":"function"!=typeof t.prototype[e]?"continue":void(i[e]=t.prototype[e])};for(var g of e)h(g)},n=this;n&&n.prototype;n=Object.getPrototypeOf(n))a(n);for(var o in s)e[o]=s[o].bind(e);var l=function(t){e.prototype[t]=function(...e){return i[t].apply(this,e)}};for(var h in i)l(h);return r}}]),e}());e.Mixin=u,u.Constructor=d}()}),require.register("curvature/base/Pool.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function s(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function i(t,e,s){return(e=r(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function r(e){var s=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"===t(s)?s:String(s)}Object.defineProperty(e,"__esModule",{value:!0}),e.Pool=void 0;var a=function(){function t({max:e,init:s}){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"backlog",[]),i(this,"running",new Set),i(this,"max",1),i(this,"init",t=>new Promise(t)),this.init=s||this.init,this.max=e||this.max}var e,r,a;return e=t,(r=[{key:"add",value:function(t){var e=()=>{if(this.running.delete(t),this.backlog.length){var s=this.backlog.shift();this.init(s).finally(e),this.running.add(s)}};this.running.size<this.max?(this.init(t).finally(e),this.running.add(t)):this.backlog.push(t)}}])&&s(e.prototype,r),a&&s(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.Pool=a}()}),require.register("curvature/base/Router.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Router=void 0;var t,i=s("./View"),r=(s("./Cache"),s("./Config")),a=s("./Routes");function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var i,r,a,n,o=[],l=!0,h=!1;try{if(a=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;l=!1}else for(;!(l=(i=a.call(s)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(h)throw r}}return o}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function l(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,void 0,"symbol"===h(a=function(t,e){if("object"!==h(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==h(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"))?a:String(a)),i)}var r,a}function h(t){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var g=Symbol("NotFound"),c=Symbol("Internal"),d="object"===("undefined"==typeof globalThis?"undefined":h(globalThis))?globalThis:"object"===("undefined"==typeof window?"undefined":h(window))?window:"object"===("undefined"==typeof self?"undefined":h(self))?self:void 0;d.CustomEvent=null!==(t=d.CustomEvent)&&void 0!==t?t:d.Event;var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,s,o;return e=t,o=[{key:"wait",value:function(t,e="DOMContentLoaded",s=document){s.addEventListener(e,()=>{this.listen(t)})}},{key:"listen",value:function(t,e=!1){this.listener=t||this.listener,this.routes=e||t.routes,Object.assign(this.query,this.queryOver({}));var s=e=>{e.preventDefault(),e.state&&"routedId"in e.state?(e.state.routedId<=this.routeCount?(this.history.splice(e.state.routedId),this.routeCount=e.state.routedId):e.state.routedId>this.routeCount&&(this.history.push(e.state.prev),this.routeCount=e.state.routedId),this.state=e.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,t):this.match(location.pathname,t)};window.addEventListener("cvUrlChanged",s),window.addEventListener("popstate",s);var i=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(i+=location.hash);var r={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(r,null,location.pathname),this.go(!1!==i?i:"/")}},{key:"go",value:function(t,e=!1){var s=r.Config.get("title");s&&(document.title=s);var i={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===e?this.match(t,this.listener,!0):this.isOriginLimited(location)?this.nextPath=t:2===e&&location.pathname!==t?history.replaceState(i,null,t):location.pathname!==t&&history.pushState(i,null,t),(!e||e<0)&&(!1===e&&(this.path=null),e||("#"===t.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=t}},{key:"processRoute",value:function(t,e,s){return"function"==typeof t[e]?t[e].prototype instanceof i.View?new t[e](s):t[e](s):t[e]}},{key:"handleError",value:function(t,e,s,i,r,a,n,o){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:t,path:a,prev:n,view:r,routes:e,selected:s}}));var l=d.devMode?"Unexpected error: "+String(t):"Unexpected error.";e[c]&&(i[c]=t,l=this.processRoute(e,c,i)),this.update(r,a,l,e,s,i,o)}},{key:"match",value:function(t,e,s=!1){var i=null,r=!1;if(!0===s&&(r=s),s&&"object"===h(s)&&(r=s.forceRefresh,i=s.event),"undefined"==typeof document||this.path!==t||r){var o="http://example.com";"undefined"!=typeof document&&(o=this.isOriginLimited(location)?o:location.origin,this.queryString=location.search);var l=new URL(t,o);t=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var c=this.prevPath,d=e&&e.args?e.args.content:null,u=this.routes||e&&e.routes||a.Routes.dump(),p=new URLSearchParams(this.queryString);for(var f in i&&i.request&&(this.request=i.request),Object.keys(this.query))delete this.query[f];for(var m of p){var v=n(m,2),y=v[0],b=v[1];this.query[y]=b}var S={},w=!1,x="";for(var k in"/"===t.substring(0,1)&&(t=t.substring(1)),t=t.split("/"),this.query)S[k]=this.query[k];t:for(var M in u){var P=M.split("/");if(!(P.length<t.length&&"*"!==P[P.length-1])){for(var C in P)if("%"==P[C].substr(0,1)){var j=null,A=/^%(\w+)\??/.exec(P[C]);if(A&&A[1]&&(j=A[1]),!j)throw new Error("".concat(P[C],' is not a valid argument segment in route "').concat(M,'"'));if(t[C])S[j]=t[C];else{if("?"!=P[C].substr(P[C].length-1,1))continue t;S[j]=""}}else if("*"!==P[C]&&t[C]!==P[C])continue t;w=M,x=u[M],"*"===P[P.length-1]&&(S.pathparts=t.slice(P.length-1));break}}var T=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:t,prev:c,root:e,selected:w,routes:u}});if("undefined"==typeof document||document.dispatchEvent(T)){if(!r&&e&&d&&x instanceof Object&&d instanceof x&&!(x instanceof Promise)&&d.update(S))return e.args.content=d,!0;w in u||(u[w]=u[g]);try{return!1===(x=this.processRoute(u,w,S))&&(x=this.processRoute(u,g,S)),"undefined"==typeof document?x instanceof Promise?x:Promise.resolve(x):x instanceof Promise?x.then(s=>this.update(e,t,s,u,w,S,r)).catch(s=>{this.handleError(s,u,w,S,e,t,c,r)}):this.update(e,t,x,u,w,S,r)}catch(s){this.handleError(s,u,w,S,e,t,c,r)}}}}},{key:"update",value:function(t,e,s,r,a,n,o){if(t){var l=this.prevPath,h=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:s,path:e,prev:l,view:t,routes:r,selected:a}});!1!==s&&(t.args.content instanceof i.View&&(t.args.content.pause(!0),t.args.content.remove()),document.dispatchEvent(h)&&(t.args.content=s),s instanceof i.View&&(s.pause(!1),s.update(n,o)));var g=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:s,path:e,prev:l,view:t,routes:r,selected:a}});document.dispatchEvent(g)}}},{key:"isOriginLimited",value:function({origin:t}){return"null"===t||"file://"===t}},{key:"queryOver",value:function(t={}){var e=new URLSearchParams(location.search),s={},i={};for(var r of e)i[r[0]]=r[1];return delete(s=Object.assign(s,i,t)).api,s}},{key:"queryToString",value:function(t={},e=!1){var s=[],i=t;for(var r in e||(i=this.queryOver(t)),i)""!==i[r]&&s.push(r+"="+encodeURIComponent(i[r]));return s.join("&")}},{key:"setQuery",value:function(t,e,s){var i=this.queryOver();i[t]=e,void 0===e&&delete i[t];var r=this.queryToString(i,!0);this.go(location.pathname+(r?"?"+r:"?"),s)}}],(s=null)&&l(e.prototype,s),o&&l(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:c}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:g})}()}),require.register("curvature/base/Routes.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function i(e,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,void 0,"symbol"===t(n=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(a,"string"))?n:String(n)),r)}var a,n}Object.defineProperty(e,"__esModule",{value:!0}),e.Routes=void 0;var r={},a=s,n=!1,o=()=>{if(!n){try{Object.assign(r,a("Routes").Routes||{})}catch(t){!0===globalThis.devMode&&console.warn(t)}n=!0}},l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,s,r;return e=t,r=[{key:"get",value:function(t){return o(),this.routes[t]}},{key:"dump",value:function(){return o(),this.routes}}],(s=null)&&i(e.prototype,s),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.Routes=l,Object.defineProperty(l,"routes",{configurable:!1,enumerable:!1,writable:!1,value:r})}()}),require.register("curvature/base/RuleSet.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RuleSet=void 0;s("./Dom");var t=s("./Tag"),i=s("./View");function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var i,r,a,n,o=[],l=!0,h=!1;try{if(a=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;l=!1}else for(;!(l=(i=a.call(s)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(h)throw r}}return o}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function o(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=i.key,void 0,"symbol"===r(n=function(t,e){if("object"!==r(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?n:String(n)),i)}var a,n}var l=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var s,r,n;return s=e,n=[{key:"add",value:function(t,e){return this.globalRules=this.globalRules||{},this.globalRules[t]=this.globalRules[t]||[],this.globalRules[t].push(e),this}},{key:"apply",value:function(t=document,e=null){for(var s in this.globalRules)for(var i in this.globalRules[s]){var r=this.globalRules[s][i],a=this.wrap(t,r,e),n=t.querySelectorAll(s);for(var o of n)a(o)}}},{key:"wait",value:function(t="DOMContentLoaded",e=document){var s=((t,e)=>()=>(e.removeEventListener(t,s),this.apply()))(t,e);e.addEventListener(t,s)}},{key:"wrap",value:function(e,s,r=null){var a=s;return(s instanceof i.View||s&&s.prototype&&s.prototype instanceof i.View)&&(a=(()=>s)),e=>{if(void 0===e.___cvApplied___&&Object.defineProperty(e,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!e.___cvApplied___.has(s)){var n,o;r&&(n=o=r,r.viewList&&(o=r.viewList.parent));var l=new t.Tag(e,o,null,void 0,n),h=l.element.parentNode,g=l.element.nextSibling,c=a(l);if(!1!==c&&e.___cvApplied___.add(s),c instanceof HTMLElement&&(c=new t.Tag(c)),c instanceof t.Tag){if(!c.element.contains(l.element)){for(;l.element.firstChild;)c.element.appendChild(l.element.firstChild);l.remove()}g?h.insertBefore(c.element,g):h.appendChild(c.element)}c&&c.prototype&&c.prototype instanceof i.View&&(c=new c({},r)),c instanceof i.View&&(r&&(r.cleanup.push(()=>c.remove()),r.cleanup.push(r.args.bindTo((t,e,s)=>{s[e]=t,c.args[e]=t})),r.cleanup.push(c.args.bindTo((t,e,s,i)=>{s[e]=t,r.args[e]=t}))),l.clear(),c.render(l.element))}}}}],(r=[{key:"add",value:function(t,e){return this.rules=this.rules||{},this.rules[t]=this.rules[t]||[],this.rules[t].push(e),this}},{key:"apply",value:function(t=document,s=null){for(var i in e.apply(t,s),this.rules)for(var r in this.rules[i]){var a=this.rules[i][r],n=e.wrap(t,a,s),o=t.querySelectorAll(i);for(var l of o)n(l)}}},{key:"purge",value:function(){if(this.rules)for(var t of Object.entries(this.rules)){var e=a(t,2),s=e[0];e[1];if(this.rules[s])for(var i in this.rules[s])delete this.rules[s][i]}}}])&&o(s.prototype,r),n&&o(s,n),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.RuleSet=l}()}),require.register("curvature/base/SetMap.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function s(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function i(e){var s=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"===t(s)?s:String(s)}Object.defineProperty(e,"__esModule",{value:!0}),e.SetMap=void 0;var r=function(){function t(){var e,s,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,s="_map",r=new Map,(s=i(s))in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r}var e,r,a;return e=t,(r=[{key:"has",value:function(t){return this._map.has(t)}},{key:"get",value:function(t){return this._map.get(t)}},{key:"getOne",value:function(t){var e=this.get(t);for(var s of e)return s}},{key:"add",value:function(t,e){var s=this._map.get(t);return s||this._map.set(t,s=new Set),s.add(e)}},{key:"remove",value:function(t,e){var s=this._map.get(t);if(s){var i=s.delete(e);return s.size||this._map.delete(t),i}}},{key:"values",value:function(){return new Set(...[...this._map.values()].map(t=>[...t.values()]))}}])&&s(e.prototype,r),a&&s(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.SetMap=r}()}),require.register("curvature/base/Tag.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tag=void 0;var t=s("./Bindable");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,void 0,"symbol"===i(n=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?n:String(n)),r)}var a,n}var a=Symbol("CurrentStyle"),n=function(t){if(this.node)for(var e in t){var s=String(t[e]);this[a].has(e)&&this[a].get(e)===t[e]||("-"===e[0]?this.node.style.setProperty(e,s):this.node.style[e]=s,void 0!==t[e]?this[a].set(e,t[e]):this[a].delete(e))}},o=function(t){return"function"==typeof this[t]?this[t]:this.node&&"function"==typeof this.node[t]?(...e)=>this.node[t](...e):"style"===t?this.proxy.style:this.node&&t in this.node?this.node[t]:this[t]},l=function(){function e(s,i,r,l,h){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof s){var g=document.createRange().createContextualFragment(s);s=g.firstChild}this.element=t.Bindable.makeBindable(s),this.node=this.element,this.parent=i,this.direct=h,this.ref=r,this.index=l,this.cleanup=[],this[t.Bindable.OnAllGet]=o.bind(this),this[a]=new Map;var c=t.Bindable.make(n.bind(this));return Object.defineProperty(this,"style",{value:c}),this.proxy=t.Bindable.make(this),this.proxy.style.bindTo((t,e,s,i)=>{this[a].has(e)&&this[a].get(e)===t||(this.node.style[e]=t,i||void 0===t?this[a].delete(e):this[a].set(e,t))}),this.proxy.bindTo((t,e)=>{if("index"!==e)return e in s&&s[e]!==t&&(s[e]=t),!1}),this.proxy}var s,i,l;return s=e,(i=[{key:"attr",value:function(t){for(var e in t)void 0===t[e]?this.node.removeAttribute(e):null===t[e]?this.node.setAttribute(e,""):this.node.setAttribute(e,t[e]);return this}},{key:"remove",value:function(){var e;for(this.node&&this.node.remove(),t.Bindable.clearBindings(this);e=this.cleanup.shift();)e();if(this.clear(),this.node){var s=new Event("cvDomDetached");this.node.dispatchEvent(s),this.node=this.element=this.ref=this.parent=void 0}}},{key:"clear",value:function(){if(this.node)for(var t=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(t),this.node.removeChild(this.node.firstChild)}},{key:"pause",value:function(t=!0){}},{key:"listen",value:function(t,e,s){var i=this.node;i.addEventListener(t,e,s);var r=()=>{i.removeEventListener(t,e,s)},a=()=>{r(),r=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>a()),a}}])&&r(s.prototype,i),l&&r(s,l),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.Tag=l}()}),require.register("curvature/base/Uuid.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";var t;function s(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function i(t,e,s){return(e=r(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function r(t){var e=function(t,e){if("object"!==a(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===a(e)?e:String(e)}function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Uuid=void 0;var n=("object"===("undefined"==typeof globalThis?"undefined":a(globalThis))?globalThis:"object"===("undefined"==typeof window?"undefined":a(window))?window:"object"===("undefined"==typeof self?"undefined":a(self))?self:void 0).crypto;t=Symbol.toPrimitive;var o=function(){function e(t=null,s=4){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"uuid",null),i(this,"version",4),t){if("string"!=typeof t&&!(t instanceof e)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error('Invalid input for Uuid: "'.concat(t,'"'));this.version=s,this.uuid=t}else if(n&&"function"==typeof n.randomUUID)this.uuid=n.randomUUID();else{var r=n&&"function"==typeof n.randomUUID?()=>n.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^r()&15>>t/4).toString(16))}Object.freeze(this)}var r,a,o;return r=e,(a=[{key:t,value:function(){return this.toString()}},{key:"toString",value:function(){return this.uuid}},{key:"toJson",value:function(){return{version:this.version,uuid:this.uuid}}}])&&s(r.prototype,a),o&&s(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}();e.Uuid=o}()}),require.register("curvature/base/View.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var t=s("./Bindable"),i=s("./ViewList"),r=s("./Router"),a=s("./Uuid"),n=s("./Dom"),o=s("./Tag"),l=s("./Bag"),h=s("./RuleSet"),g=s("./Mixin"),c=s("../mixin/EventTargetMixin");function d(t){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var i,r,a,n,o=[],l=!0,h=!1;try{if(a=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;l=!1}else for(;!(l=(i=a.call(s)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(h)throw r}}return o}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function f(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,void 0,"symbol"===d(a=function(t,e){if("object"!==d(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"))?a:String(a)),i)}var r,a}function m(t,e){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,i=b(t);if(e){var r=b(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return function(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}(this,s)}}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=Symbol("dontParse"),w=Symbol("expandBind"),x=Symbol("uuid"),k=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(P,g.Mixin.with(c.EventTargetMixin));var p,b,k,M=v(P);function P(e={},s=null){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,P),(i=M.call(this,e,s))[c.EventTargetMixin.Parent]=s,Object.defineProperty(y(i),"args",{value:t.Bindable.make(e)}),Object.defineProperty(y(i),x,{value:i.constructor.uuid()}),Object.defineProperty(y(i),"nodesAttached",{value:new l.Bag((t,e,s)=>{})}),Object.defineProperty(y(i),"nodesDetached",{value:new l.Bag((t,e,s)=>{})}),Object.defineProperty(y(i),"_onRemove",{value:new l.Bag((t,e,s)=>{})}),Object.defineProperty(y(i),"cleanup",{value:[]}),Object.defineProperty(y(i),"parent",{value:s,writable:!0}),Object.defineProperty(y(i),"views",{value:new Map}),Object.defineProperty(y(i),"viewLists",{value:new Map}),Object.defineProperty(y(i),"withViews",{value:new Map}),Object.defineProperty(y(i),"tags",{value:t.Bindable.make({})}),Object.defineProperty(y(i),"nodes",{value:t.Bindable.make([])}),Object.defineProperty(y(i),"timeouts",{value:new Map}),Object.defineProperty(y(i),"intervals",{value:new Map}),Object.defineProperty(y(i),"frames",{value:[]}),Object.defineProperty(y(i),"ruleSet",{value:new h.RuleSet}),Object.defineProperty(y(i),"preRuleSet",{value:new h.RuleSet}),Object.defineProperty(y(i),"subBindings",{value:{}}),Object.defineProperty(y(i),"templates",{value:{}}),Object.defineProperty(y(i),"postMapping",{value:new Set}),Object.defineProperty(y(i),"eventCleanup",{value:[]}),Object.defineProperty(y(i),"unpauseCallbacks",{value:new Map}),Object.defineProperty(y(i),"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(y(i),"rendered",{value:new Promise((t,e)=>Object.defineProperty(y(i),"renderComplete",{value:t}))}),i.onRemove(()=>{i[c.EventTargetMixin.Parent]&&(i[c.EventTargetMixin.Parent]=null)}),i.controller=y(i),i.template="",i.firstNode=null,i.lastNode=null,i.viewList=null,i.mainView=null,i.preserve=!1,i.removed=!1,i.loaded=Promise.resolve(y(i)),i}return p=P,b=[{key:"_id",get:function(){return this[x]}},{key:"onFrame",value:function(t){var e=!1,s=()=>{e=!0},i=s=>{this.removed||e||(this.paused||t(Date.now()),requestAnimationFrame(i))};return requestAnimationFrame(()=>i(Date.now())),this.frames.push(s),s}},{key:"onNextFrame",value:function(t){return requestAnimationFrame(()=>t(Date.now()))}},{key:"onIdle",value:function(t){return requestIdleCallback(()=>t(Date.now()))}},{key:"onTimeout",value:function(t,e){var s={timeout:null,callback:null,time:t,fired:!1,created:(new Date).getTime(),paused:!1},i=()=>{e(),s.fired=!0,this.timeouts.delete(s.timeout)},r=setTimeout(i,t);return s.callback=i,s.timeout=r,this.timeouts.set(s.timeout,s),r}},{key:"clearTimeout",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){if(this.timeouts.has(t)){var e=this.timeouts.get(t);clearTimeout(e.timeout),this.timeouts.delete(e.timeout)}})},{key:"onInterval",value:function(t,e){var s=setInterval(e,t);return this.intervals.set(s,{timeout:s,callback:e,time:t,paused:!1}),s}},{key:"clearInterval",value:function(t){if(this.intervals.has(t)){var e=this.intervals.get(t);clearTimeout(e.timeout),this.intervals.delete(e.timeout)}}},{key:"pause",value:function(t){if(void 0===t&&(this.paused=!this.paused),this.paused=t,this.paused){for(var e of this.timeouts){var s=u(e,2),i=(s[0],s[1]);i.fired?this.timeouts.delete(i.timeout):(clearTimeout(i.timeout),i.paused=!0,i.time=Math.max(0,i.time-(Date.now()-i.created)))}for(var r of this.intervals){var a=u(r,2),n=(a[0],a[1]);clearInterval(n.timeout),n.paused=!0}}else{for(var o of this.timeouts){var l=u(o,2),h=(l[0],l[1]);h.paused&&(h.fired?this.timeouts.delete(h.timeout):(h.timeout=setTimeout(h.callback,h.time),h.paused=!1))}for(var g of this.intervals){var c=u(g,2),d=(c[0],c[1]);d.paused&&(d.timeout=setInterval(d.callback,d.time),d.paused=!1)}for(var p of this.unpauseCallbacks){(0,u(p,2)[1])()}this.unpauseCallbacks.clear()}for(var f of this.viewLists){var m=u(f,2);m[0];m[1].pause(!!t)}for(var v in this.tags)if(Array.isArray(this.tags[v]))for(var y in this.tags[v])this.tags[v][y].pause(!!t);else this.tags[v].pause(!!t)}},{key:"render",value:function(t=null,e=null,s=null){var i=globalThis.window.document;if(t instanceof P&&(t=t.firstNode.parentNode),e instanceof P&&(e=e.firstNode),this.firstNode)return this.reRender(t,e,s);this.dispatchEvent(new CustomEvent("render"));var r,a="object"===d(this.template)&&"function"==typeof this.template.cloneNode,n=a||P.templates.has(this.template);if(r=n?a?this.template.cloneNode(!0):P.templates.get(this.template).cloneNode(!0):i.createRange().createContextualFragment(this.template),n||a||P.templates.set(this.template,r.cloneNode(!0)),this.mainView||this.preRuleSet.apply(r,this),this.mapTags(r),this.mainView||this.ruleSet.apply(r,this),!0===globalThis.devMode?(this.firstNode=i.createComment("Template ".concat(this._id," Start")),this.lastNode=i.createComment("Template ".concat(this._id," End"))):(this.firstNode=i.createTextNode(""),this.lastNode=i.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(r.childNodes),this.lastNode),this.postRender(t),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(t){e?(t.insertBefore(this.firstNode,e),t.insertBefore(this.lastNode,e)):(t.appendChild(this.firstNode),t.appendChild(this.lastNode)),t.insertBefore(r,this.lastNode);var o=t.getRootNode();if(o.isConnected)this.attached(o,t),this.dispatchAttached(o,t,s);else if(s){var l=e=>{var i=t.getRootNode();this.attached(i,t),this.dispatchAttached(i,t,s),s.removeEventListener("attached",l)};s.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}},{key:"dispatchAttach",value:function(){var t=globalThis.window.CustomEvent;return this.dispatchEvent(new t("attach",{cancelable:!0,target:this}))}},{key:"dispatchAttached",value:function(t,e,s){var i=globalThis.window.CustomEvent;for(var r of(this.dispatchEvent(new i("attached",{detail:{view:s||this,node:e,root:t,mainView:this}})),this.dispatchDomAttached(s),this.nodesAttached.items()))r(t,e)}},{key:"dispatchDomAttached",value:function(t){var e=globalThis.window,s=e.Node,i=e.CustomEvent;this.nodes.filter(t=>t.nodeType!==s.COMMENT_NODE).forEach(e=>{e.matches&&(e.dispatchEvent(new i("cvDomAttached",{target:e,detail:{view:t||this,mainView:this}})),n.Dom.mapTags(e,!1,(e,s)=>{e.matches&&e.dispatchEvent(new i("cvDomAttached",{target:e,detail:{view:t||this,mainView:this}}))}))})}},{key:"reRender",value:function(t,e,s){var i=globalThis.window.CustomEvent;if(this.dispatchEvent(new i("reRender"),{cancelable:!0,target:this,view:s})){var r=new DocumentFragment;if(this.firstNode.isConnected){var a=this.nodesDetached.items();for(var n in a)a[n]()}if(r.append(...this.nodes),t){e?(t.insertBefore(this.firstNode,e),t.insertBefore(this.lastNode,e)):(t.appendChild(this.firstNode),t.appendChild(this.lastNode)),t.insertBefore(r,this.lastNode),this.dispatchEvent(new i("reRendered"),{cancelable:!0,target:this,view:s});var o=t.getRootNode();o.isConnected&&(this.attached(o,t),this.dispatchAttached(o,t))}return this.nodes}}},{key:"mapTags",value:function(t){n.Dom.mapTags(t,!1,(t,e)=>{t[S]||(t=t.matches?(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=this.mapInterpolatableTag(t)).matches("[cv-template]")&&this.mapTemplateTag(t)||t).matches("[cv-slot]")&&this.mapSlotTag(t)||t).matches("[cv-prerender]")&&this.mapPrendererTag(t)||t).matches("[cv-link]")&&this.mapLinkTag(t)||t).matches("[cv-attr]")&&this.mapAttrTag(t)||t).matches("[cv-expand]")&&this.mapExpandableTag(t)||t).matches("[cv-ref]")&&this.mapRefTag(t)||t).matches("[cv-on]")&&this.mapOnTag(t)||t).matches("[cv-each]")&&this.mapEachTag(t)||t).matches("[cv-bind]")&&this.mapBindTag(t)||t).matches("[cv-with]")&&this.mapWithTag(t)||t).matches("[cv-if]")&&this.mapIfTag(t)||t).matches("[cv-view]")&&this.mapViewTag(t)||t:this.mapInterpolatableTag(t))!==e.currentNode&&(e.currentNode=t)}),this.postMapping.forEach(t=>t())}},{key:"mapExpandableTag",value:function(e){var s=e[w];s&&(s(),e[w]=!1);var i=u(t.Bindable.resolve(this.args,e.getAttribute("cv-expand"),!0),2),r=i[0],a=i[1];return e.removeAttribute("cv-expand"),r[a]||(r[a]={}),r[a]=t.Bindable.make(r[a]),this.onRemove(e[w]=r[a].bindTo((t,s,i,r,a)=>{r||void 0===t?e.removeAttribute(s,t):null!==t?e.setAttribute(s,t):e.setAttribute(s,"")})),e}},{key:"mapAttrTag",value:function(t){var e=this.compileAttrTag(t)(this);return t.replaceWith(e),e}},{key:"compileAttrTag",value:function(e){var s=e.getAttribute("cv-attr").split(/[,;]/).map(t=>t.split(":"));return e.removeAttribute("cv-attr"),i=>{var r=e.cloneNode(!0),a=function(){var e=s[n][1]||s[n][0],a=u(t.Bindable.resolve(i.args,e,!0),2),o=a[0],l=a[1],h=s[n][0];i.onRemove(o.bindTo(l,(t,e,s,i)=>{i||void 0===t?r.removeAttribute(h,t):null!==t?r.setAttribute(h,t):r.setAttribute(h,"")}))};for(var n in s)a();return r}}},{key:"mapInterpolatableTag",value:function(e){var s=this,i=this.interpolateRegex,r=globalThis.window,a=r.Node,n=r.document;if(e.nodeType===a.TEXT_NODE){var l=e.nodeValue;if(!this.interpolatable(l))return e;for(var h,g=0,p=function(){var i=h[2],r=!1,p=!1,f=i.split("|"),m=!1;if(f.length>1&&(m=s.stringTransformer(f.slice(1)),i=f[0]),"$$"===i.substr(0,2)&&(r=!0,p=!0,i=i.substr(2)),"$"===i.substr(0,1)&&(r=!0,i=i.substr(1)),"000"===i.substr(0,3))return expand=!0,i=i.substr(3),"continue";var v=l.substring(g,h.index);g=h.index+h[1].length;var y,b=n.createTextNode(v);b[S]=!0,e.parentNode.insertBefore(b,e),(y=r?n.createElement("div"):n.createTextNode(""))[S]=!0;var w=s.args,x=i;if(i.match(/\./)){var k=u(t.Bindable.resolve(s.args,i,!0),2);w=k[0],x=k[1]}if(e.parentNode.insertBefore(y,e),"object"!==d(w))return"break";var M=(w=t.Bindable.make(w)).bindTo(x,(t,i,n)=>{if(n[i]!==t&&(n[i]instanceof P||n[i]instanceof a||n[i]instanceof o.Tag)&&(n[i].preserve||n[i].remove()),y.nodeValue="",p&&!(t instanceof P)){var l,h=null!==(l=t)&&void 0!==l?l:"";(t=new P(s.args,s)).template=h}if(m&&(t=m(t)),t instanceof P){t[c.EventTargetMixin.Parent]=s,t.render(e.parentNode,y,s);var g=()=>{t.preserve||t.remove()};s.onRemove(g),t.onRemove(()=>s._onRemove.remove(g))}else t instanceof a?(e.parentNode.insertBefore(t,y),s.onRemove(()=>t.remove())):t instanceof o.Tag?t.node?(e.parentNode.insertBefore(t.node,y),s.onRemove(()=>t.remove())):t.remove():(t instanceof Object&&t.__toString instanceof Function&&(t=t.__toString()),r?y.innerHTML=t:y.nodeValue=t);y[S]=!0});s.onRemove(M)};h=i.exec(l);){var f=p();if("continue"!==f&&"break"===f)break}var m=l.substring(g),v=n.createTextNode(m);v[S]=!0,e.parentNode.insertBefore(v,e),e.nodeValue=""}else if(e.nodeType===a.ELEMENT_NODE)for(var y=function(){if(!s.interpolatable(e.attributes[b].value))return"continue";for(var r,a=0,n=e.attributes[b].value,o=e.attributes[b],l={},h=[];r=i.exec(n);)h.push(n.substring(a,r.index)),l[r[2]]||(l[r[2]]=[]),l[r[2]].push(h.length),h.push(r[1]),a=r.index+r[1].length;h.push(n.substring(a));var g=function(){var i=s.args,r=c,a=c.split("|"),n=!1,g=c;if(a.length>1&&(n=s.stringTransformer(a.slice(1)),r=a[0]),r.match(/\./)){var d=u(t.Bindable.resolve(s.args,r,!0),2);i=d[0],r=d[1]}l[g];s.onRemove(i.bindTo(r,(t,i,a,c)=>{for(var d in n&&(t=n(t)),l)for(var u in l[g])h[l[g][u]]=a[d],i===r&&(h[l[g][u]]=t);s.paused?s.unpauseCallbacks.set(o,()=>e.setAttribute(o.name,h.join(""))):e.setAttribute(o.name,h.join(""))}))};for(var c in l)g()},b=0;b<e.attributes.length;b++)y();return e}},{key:"mapRefTag",value:function(t){var e=u(t.getAttribute("cv-ref").split(":"),3),s=e[0],i=e[1],r=void 0===i?null:i,a=e[2],n=void 0===a?null:a,l=o.Tag;r&&(l=this.stringToClass(r)),t.removeAttribute("cv-ref"),Object.defineProperty(t,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{t.___tag___=null,t.remove()});var h=this;this.viewList&&(h=this.viewList.parent);var g=new l(t,this,s,void 0,this);for(t.___tag___=g,this.tags[s]=g;h;){var c=this.args[n];if(void 0!==c?(h.tags[s]||(h.tags[s]=[]),h.tags[s][c]=g):h.tags[s]=g,!h.parent)break;h=h.parent}return t}},{key:"mapBindTag",value:function(e){var s=e.getAttribute("cv-bind"),i=this.args,r=s,a=null;if(s.match(/\./)){var l=u(t.Bindable.resolve(this.args,s,!0),3);i=l[0],r=l[1],a=l[2]}i!==this.args&&(this.subBindings[s]=this.subBindings[s]||[],this.onRemove(this.args.bindTo(a,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var h=!1;"$"===r.substr(0,1)&&(r=r.substr(1),h=!0);var g=!1,d=i.bindTo(r,(t,s,i,r,a)=>{if((a instanceof P||a instanceof Node||a instanceof o.Tag)&&a!==t&&a.remove(),["INPUT","SELECT","TEXTAREA"].includes(e.tagName)){var l=e.getAttribute("type");if(l&&"checkbox"===l.toLowerCase())e.checked=!!t;else if(l&&"radio"===l.toLowerCase())e.checked=t==e.value;else if("file"!==l)if("SELECT"===e.tagName){var d=()=>{for(var s=0;s<e.options.length;s++){e.options[s].value==t&&(e.selectedIndex=s)}};d(),this.nodesAttached.add(d)}else e.value=null==t?"":t;g&&e.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),g=!0}else if(t instanceof P){for(var u of e.childNodes)u.remove();t[c.EventTargetMixin.Parent]=this,t.render(e,null,this)}else if(t instanceof Node)e.insert(t);else if(t instanceof o.Tag)e.append(t.node);else if(h){if(e.innerHTML!==t){if(t=String(t),e.innerHTML===t.substring(0,e.innerHTML.length))e.innerHTML+=t.substring(e.innerHTML.length);else{for(var p of e.childNodes)p.remove();e.innerHTML=t}n.Dom.mapTags(e,!1,t=>t[S]=!0)}}else if(e.textContent!==t){for(var f of e.childNodes)f.remove();e.textContent=t}});i!==this.args&&this.subBindings[s].push(d),this.onRemove(d);var p=e.getAttribute("type"),f=e.getAttribute("multiple"),m=s=>{if(s.target===e)if(p&&"checkbox"===p.toLowerCase())e.checked?i[r]=s.target.getAttribute("value"):i[r]=!1;else if(s.target.matches("[contenteditable=true]"))i[r]=s.target.innerHTML;else if("file"===p&&f){var a=Array.from(s.target.files),n=i[r]||t.Bindable.onDeck(i,r);if(n&&a.length){var o=function(t){if(a[t]!==n[t])return a[t].toJSON=(()=>({name:file[t].name,size:file[t].size,type:file[t].type,date:file[t].lastModified})),n[t]=a[t],"break"};for(var l in a){if("break"===o(l))break}}else i[r]=a}else if("file"===p&&!f&&s.target.files.length){var h=s.target.files.item(0);h.toJSON=(()=>({name:h.name,size:h.size,type:h.type,date:h.lastModified})),i[r]=h}else i[r]=s.target.value};return"file"===p||"radio"===p?e.addEventListener("change",m):(e.addEventListener("input",m),e.addEventListener("change",m),e.addEventListener("value-changed",m)),this.onRemove(()=>{"file"===p||"radio"===p?e.removeEventListener("change",m):(e.removeEventListener("input",m),e.removeEventListener("change",m),e.removeEventListener("value-changed",m))}),e.removeAttribute("cv-bind"),e}},{key:"mapOnTag",value:function(t){return String(t.getAttribute("cv-on")).split(";").map(t=>t.split(":")).forEach(e=>{var s,i=(e=e.map(t=>t.trim())).length,r=String(e.shift()).trim(),a=String(e.shift()||r).trim(),n=String(e.shift()||"").trim(),o=[],l=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(a);l&&(a=l[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),l[2]&&(o=l[2].split(",").map(t=>t.trim()))),o.length||o.push("$event"),r&&1!==i||(r=a);for(var h=this,g=function(){var t=h.controller;return"function"==typeof t[a]?(s=((...e)=>{t[a](...e)}),"break"):"function"==typeof h[a]?(s=((...t)=>{h[a](...t)}),"break"):h.parent?void(h=h.parent):"break"};h;){if("break"===g())break}var c=e=>{var i=o.map(s=>{var i;return Number(s)==s?s:"event"===s||"$event"===s?e:"$view"===s?h:"$controller"===s?controller:"$tag"===s?t:"$parent"===s?this.parent:"$subview"===s?this:s in this.args?this.args[s]:(i=/^['"]([\w-]+?)["']$/.exec(s))?i[1]:void 0});if("function"!=typeof s)throw new Error("".concat(a," is not defined on View object.")+"\nTag:\n"+"".concat(t.outerHTML));s(...i)},d={};switch(n.includes("p")?d.passive=!0:n.includes("P")&&(d.passive=!1),n.includes("c")?d.capture=!0:n.includes("C")&&(d.capture=!1),n.includes("o")?d.once=!0:n.includes("O")&&(d.once=!1),r){case"_init":c();break;case"_attach":this.nodesAttached.add(c);break;case"_detach":this.nodesDetached.add(c);break;default:t.addEventListener(r,c,d),this.onRemove(()=>{t.removeEventListener(r,c,d)})}return[r,a,o]}),t.removeAttribute("cv-on"),t}},{key:"mapLinkTag",value:function(t){var e=t.getAttribute("cv-link");t.setAttribute("href",e);var s=s=>{s.preventDefault(),"http"!==e.substring(0,4)&&"//"!==e.substring(0,2)?r.Router.go(t.getAttribute("href")):globalThis.open(t.getAttribute("href",e))};return t.addEventListener("click",s),this.onRemove(((t,e)=>()=>{t.removeEventListener("click",e),t=void 0,e=void 0})(t,s)),t.removeAttribute("cv-link"),t}},{key:"mapPrendererTag",value:function(t){var e=t.getAttribute("cv-prerender"),s=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return t.removeAttribute("cv-prerender"),s&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===e&&s||"only"===e&&!s)&&this.postMapping.add(()=>t.parentNode.removeChild(t)),t}},{key:"mapWithTag",value:function(e){var s=this,i=e.getAttribute("cv-with"),r=e.getAttribute("cv-carry"),a=e.getAttribute("cv-view");e.removeAttribute("cv-with"),e.removeAttribute("cv-carry"),e.removeAttribute("cv-view");var n=a?this.stringToClass(a):P,o=new DocumentFragment;[...e.childNodes].forEach(t=>o.appendChild(t));var l=[];r&&(l=r.split(",").map(t=>t.trim()));var h=this.args.bindTo(i,(i,r,a,h)=>{for(this.withViews.has(e)&&this.withViews.delete(e);e.firstChild;)e.removeChild(e.firstChild);var g=new n({},this);this.onRemove((t=>()=>{t.remove()})(g)),g.template=o;var c=function(){var t=s.args.bindTo(l[u],(t,e)=>{g.args[e]=t});g.onRemove(t),s.onRemove(()=>{t(),g.remove()})};for(var u in l)c();var p=function(){if("object"!==d(i))return"continue";var e=(i=t.Bindable.make(i)).bindTo(f,(t,e,s,i)=>{i?e in g.args&&delete g.args[e]:g.args[e]=t});g.args.bindTo(f,(t,e,s,r)=>{r?e in i&&delete i[e]:i[e]=t});s.onRemove(()=>{e(),i.isBound()||t.Bindable.clearBindings(i),g.remove()}),g.onRemove(()=>{e(),i.isBound()||t.Bindable.clearBindings(i)})};for(var f in i)p();g.render(e,null,this),this.withViews.set(e,g)});return this.onRemove(()=>{this.withViews.delete(e),h()}),e}},{key:"mapViewTag",value:function(t){var e=t.getAttribute("cv-view");t.removeAttribute("cv-view");var s=new DocumentFragment;[...t.childNodes].forEach(t=>s.appendChild(t));var i=e.split(":"),r=i.shift(),a=new(i.length?this.stringToClass(i[0]):P)(this.args,this);return this.views.set(t,a),this.views.set(r,a),this.onRemove(()=>{a.remove(),this.views.delete(t),this.views.delete(r)}),a.template=s,a.render(t,null,this),t}},{key:"mapEachTag",value:function(e){var s=e.getAttribute("cv-each"),r=e.getAttribute("cv-view");e.removeAttribute("cv-each"),e.removeAttribute("cv-view");var a=r?this.stringToClass(r):P,n=new DocumentFragment;[...e.childNodes].forEach(t=>n.appendChild(t));var o=u(s.split(":"),3),h=o[0],g=o[1],c=o[2],d=this.args,p=h;if(h.match(/\./)){var f=u(t.Bindable.resolve(this.args,h,!0),2);d=f[0],p=f[1]}var m=d.bindTo(p,(t,s,r,o,h)=>{t instanceof l.Bag&&(t=t.list),this.viewLists.has(e)&&this.viewLists.get(e).remove();var d=new i.ViewList(n,g,t,this,c,a),u=()=>d.remove();this.onRemove(u),d.onRemove(()=>this._onRemove.remove(u));var p=this.args.bindTo((t,e,s,i)=>{"_id"!==e&&(i?e in d.subArgs&&delete d.subArgs[e]:d.subArgs[e]=t)}),f=d.args.bindTo((t,e,s,i,r)=>{"_id"!==e&&"value"!==e&&"___"!==String(e).substring(0,3)&&(i?delete this.args[e]:e in this.args&&(this.args[e]=t))});for(d.onRemove(p),d.onRemove(f),this.onRemove(p),this.onRemove(f);e.firstChild;)e.removeChild(e.firstChild);this.viewLists.set(e,d),d.render(e,null,this)});return this.onRemove(m),e}},{key:"mapIfTag",value:function(e){var s=e,i=s.getAttribute("cv-view"),r=s.getAttribute("cv-if"),a=s.getAttribute("cv-is"),o=!1,h=!1;s.removeAttribute("cv-view"),s.removeAttribute("cv-if"),s.removeAttribute("cv-is");var g=i?this.stringToClass(i):P;"!"===r.substr(0,1)&&(r=r.substr(1),o=!0),"?"===r.substr(0,1)&&(r=r.substr(1),h=!0);var c=new DocumentFragment;[...s.childNodes].forEach(t=>c.appendChild(t));var d=this,p=new DocumentFragment,f=new g(this.args,d);f.tags.bindTo((t,e)=>this.tags[e]=t,{removeWith:this}),f.template=c;var m=d.args,v=r;if(r.match(/\./)){var y=u(t.Bindable.resolve(d.args,r,!0),2);m=y[0],v=y[1]}f.render(p,null,this);var b=m.bindTo(v,(t,s)=>{var i=t;h&&(t=null!==t&&void 0!==t),t instanceof l.Bag&&(t=t.list),Array.isArray(t)&&(t=!!t.length),null!==a&&(t=i==a),o&&(t=!t),t?(e.appendChild(p),[...p.childNodes].forEach(t=>n.Dom.mapTags(t,!1,(t,e)=>{t.matches&&t.dispatchEvent(new CustomEvent("cvDomAttached",{target:t,detail:{view:f||this,mainView:this}}))}))):(f.nodes.forEach(t=>p.appendChild(t)),n.Dom.mapTags(p,!1,(t,e)=>{t.matches&&new CustomEvent("cvDomDetached",{target:t,detail:{view:f||this,mainView:this}})}))},{children:Array.isArray(m[v])});d.onRemove(b);return d.onRemove(()=>{b(),d._onRemove.remove(b)}),this.onRemove(()=>{f.remove(),d!==this&&d.remove()}),e}},{key:"mapTemplateTag",value:function(t){var e=t.getAttribute("cv-template");t.removeAttribute("cv-template");var s=t.innerHTML;return P.templates.has(s)||P.templates.set(s,document.createRange().createContextualFragment(t.innerHTML)),this.templates[e]=P.templates.get(s),this.postMapping.add(()=>t.remove()),t}},{key:"mapSlotTag",value:function(t){var e=t.getAttribute("cv-slot"),s=this.templates[e];if(!s){for(var i=this;i&&!(s=i.templates[e]);)i=this.parent;if(!s)return void console.error("Template ".concat(e," not found."))}for(t.removeAttribute("cv-slot");t.firstChild;)t.firstChild.remove();return t.appendChild(s.cloneNode(!0)),t}},{key:"postRender",value:function(t){}},{key:"attached",value:function(t){}},{key:"interpolatable",value:function(t){return!!String(t).match(this.interpolateRegex)}},{key:"remove",value:function(t=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var e=()=>{for(var t in this.tags)Array.isArray(this.tags[t])?(this.tags[t]&&this.tags[t].forEach(t=>t.remove()),this.tags[t].splice(0)):(this.tags[t]&&this.tags[t].remove(),this.tags[t]=void 0);for(var e in this.nodes)this.nodes[e]&&this.nodes[e].dispatchEvent(new Event("cvDomDetached")),this.nodes[e]&&this.nodes[e].remove(),this.nodes[e]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};t?e():requestAnimationFrame(e);var s=this._onRemove.items();for(var i of s)i(),this._onRemove.remove(i);for(var r of this.cleanup)r&&r();for(var a of(this.cleanup.length=0,this.viewLists)){var n=u(a,2);n[0];n[1].remove()}for(var o of(this.viewLists.clear(),this.timeouts)){var l=u(o,2),h=(l[0],l[1]);clearTimeout(h.timeout),this.timeouts.delete(h.timeout)}for(var g of this.intervals)clearInterval(g);for(var c of(this.intervals.length=0,this.frames))c();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}},{key:"findTag",value:function(t){for(var e in this.nodes){var s;if(this.nodes[e].querySelector){if(this.nodes[e].matches(t))return new o.Tag(this.nodes[e],this,void 0,void 0,this);if(s=this.nodes[e].querySelector(t))return new o.Tag(s,this,void 0,void 0,this)}}}},{key:"findTags",value:function(t){var e=this.nodes.filter(e=>e.matches&&e.matches(t)),s=this.nodes.filter(t=>t.querySelectorAll).map(e=>[...e.querySelectorAll(t)]).flat().map(t=>new o.Tag(t,this,void 0,void 0,this))||[];return e.concat(s)}},{key:"onRemove",value:function(t){t instanceof Event||this._onRemove.add(t)}},{key:"update",value:function(){}},{key:"beforeUpdate",value:function(t){}},{key:"afterUpdate",value:function(t){}},{key:"stringTransformer",value:function(t){return e=>{for(var s in t){for(var i=this,r=t[s];i&&!i[r];)i=i.parent;if(!i)return;e=i[t[s]](e)}return e}}},{key:"stringToClass",value:function(t){if(P.refClasses.has(t))return P.refClasses.get(t);var e=t.split("/"),i=e[e.length-1],r=s(t);return P.refClasses.set(t,r[i]),r[i]}},{key:"preventParsing",value:function(t){t[S]=!0}},{key:"toString",value:function(){return this.nodes.map(t=>t.outerHTML).join(" ")}},{key:"listen",value:function(t,e,s,i){if("string"==typeof t&&(i=s,s=e,e=t,t=this),t instanceof P)return this.listen(t.nodes,e,s,i);if(Array.isArray(t))return t.map(t=>this.listen(t,e,s,i));if(t instanceof o.Tag)return this.listen(t.element,e,s,i);t.addEventListener(e,s,i);var r=()=>t.removeEventListener(e,s,i),a=()=>{r(),r=(()=>{})};return this.onRemove(()=>a()),a}},{key:"detach",value:function(){for(var t in this.nodes)this.nodes[t].remove();return this.nodes}}],k=[{key:"from",value:function(t,e={},s=null){var i=new this(e,s);return i.template=t,i}},{key:"isView",value:function(){return P}},{key:"uuid",value:function(){return new a.Uuid}}],b&&f(p.prototype,b),k&&f(p,k),Object.defineProperty(p,"prototype",{writable:!1}),P}();e.View=k,Object.defineProperty(k,"templates",{value:new Map}),Object.defineProperty(k,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ViewList=void 0;var t=s("./Bindable"),i=s("./SetMap"),r=s("./Bag");function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,void 0,"symbol"===a(n=function(t,e){if("object"!==a(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"))?n:String(n)),i)}var r,n}var o=function(){function e(s,i,n,o,l=null,h=null){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.removed=!1,this.args=t.Bindable.makeBindable(Object.create(null)),this.args.value=t.Bindable.makeBindable(n||Object.create(null)),this.subArgs=t.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=h,this._onRemove=new r.Bag,this.template=s,this.subProperty=i,this.keyProperty=l,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((t,e)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:t})}),this.willReRender=!1,this.args.___before((t,e,s,i,r)=>{"bindTo"!=e&&(this.paused=!0)}),this.args.___after((t,e,s,i,r)=>{"bindTo"!=e&&(this.paused=s.length>1,this.reRender())});var g=this.args.value.bindTo((t,e,s,i)=>{if(!this.paused){var r=e;if("symbol"!==a(e))if(isNaN(e)&&(r="_"+e),i)for(var n in this.views[r]&&this.views[r].remove(!0),delete this.views[r],this.views)this.views[n]&&(isNaN(n)?this.views[n].args[this.keyProperty]=n.substr(1):this.views[n].args[this.keyProperty]=n);else this.views[r]?this.views[r]&&this.views[r].args&&(this.views[r].args[this.keyProperty]=e,this.views[r].args[this.subProperty]=t):!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()}))}});this._onRemove.add(g),Object.preventExtensions(this)}var s,o,l;return s=e,(o=[{key:"render",value:function(t){var e=this,s=[],i=function(i){i.viewList=e,i.render(t,null,e.parent),s.push(i.rendered.then(()=>i))};for(var r of this.views)i(r);this.tag=t,Promise.all(s).then(t=>this.renderComplete(t)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}},{key:"reRender",value:function(){var t=this;if(!this.paused&&this.tag){var e=[],s=new i.SetMap;for(var r in this.views){var a=this.views[r];if(void 0!==a){var n=a.args[this.subProperty];s.add(n,a),e[r]=a}else e[r]=a}var o=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(t=>t&&t()),this.upDebind.length&&this.upDebind.forEach(t=>t&&t()),this.upDebind.length=0,this.downDebind.length=0;var h=1/0,g=1/0,c=function(){var e=!1,i=d;if(isNaN(i)?i="_"+d:String(i).length&&(i=Number(i)),void 0!==t.args.value[d]&&s.has(t.args.value[d])){var r=s.getOne(t.args.value[d]);r&&(r.args[t.keyProperty]=d,o[i]=r,l.add(r),e=!0,isNaN(i)||(h=Math.min(h,i),i>0&&(g=Math.min(g,i))),s.remove(t.args.value[d],r))}if(!e){var a=Object.create(null),n=o[i]=new t.viewClass(a,t.parent);isNaN(i)||(h=Math.min(h,i),i>0&&(g=Math.min(g,i))),o[i].template=t.template,o[i].viewList=t,o[i].args[t.keyProperty]=d,o[i].args[t.subProperty]=t.args.value[d],t.upDebind[i]=a.bindTo(t.subProperty,(e,s,i,r)=>{var n=a[t.keyProperty];r?delete t.args.value[n]:t.args.value[n]=e}),t.downDebind[i]=t.subArgs.bindTo((t,e,s,i)=>{i?delete a[e]:a[e]=t});var c=()=>{t.upDebind.filter(t=>t).forEach(t=>t()),t.upDebind.length=0},u=()=>{t.downDebind.filter(t=>t).forEach(t=>t()),t.downDebind.length=0};n.onRemove(()=>{t._onRemove.remove(c),t._onRemove.remove(u),t.upDebind[i]&&t.upDebind[i](),t.downDebind[i]&&t.downDebind[i](),delete t.upDebind[i],delete t.downDebind[i]}),t._onRemove.add(c),t._onRemove.add(u),a[t.subProperty]=t.args.value[d]}};for(var d in this.args.value)c();for(var u in e)e[u]&&!l.has(e[u])&&e[u].remove(!0);if(Array.isArray(this.args.value)){var p=0===h&&void 0!==o[1]&&o.length>1||g===1/0?h:g,f=(t=0)=>{for(var e=o.length-t-1;e>p&&void 0===o[e];)e--;if(e<p)return Promise.resolve();if(o[e]===this.views[e]){if(o[e]&&!o[e].firstNode)return o[e].render(this.tag,o[e+1],this.parent),o[e].rendered.then(()=>f(Number(t)+1));return 0===t||t%500?f(Number(t)+1):new Promise(e=>requestAnimationFrame(()=>e(f(Number(t)+1))))}return o[e].render(this.tag,o[e+1],this.parent),this.views.splice(e,0,o[e]),o[e].rendered.then(()=>f(t+1))};this.rendered=f()}else{var m=[],v=Object.assign(Object.create(null),o),y=t=>parseInt(t)===t-0,b=Object.keys(o).sort((t,e)=>y(t)&&y(e)?Math.sign(t-e):y(t)||y(e)?!y(t)&&y(e)?-1:y(t)&&!y(e)?1:void 0:0),S=function(e){if(delete v[e],o[e].firstNode&&o[e]===t.views[e])return"continue";o[e].render(t.tag,null,t.parent),m.push(o[e].rendered.then(()=>o[e]))};for(var w of b)S(w);for(var x in v)delete this.args.views[x],v.remove(!0);this.rendered=Promise.all(m)}for(var k in o)isNaN(k)?o[k].args[this.keyProperty]=k.substr(1):o[k].args[this.keyProperty]=k;return this.views=Array.isArray(this.args.value)?[...o]:o,this.viewCount=l.size,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}},{key:"pause",value:function(t=!0){for(var e in this.views)this.views[e].pause(t)}},{key:"onRemove",value:function(t){this._onRemove.add(t)}},{key:"remove",value:function(){for(var e in this.views)this.views[e]&&this.views[e].remove(!0);var s=this._onRemove.items();for(var i in s)this._onRemove.remove(s[i]),s[i]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&t.Bindable.clearBindings(this.subArgs),t.Bindable.clearBindings(this.args),this.removed=!0}}])&&n(s.prototype,o),l&&n(s,l),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.ViewList=o}()}),require.register("curvature/input/Keyboard.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Keyboard=void 0;var t=s("../base/Bindable");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,void 0,"symbol"===i(n=function(t,e){if("object"!==i(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?n:String(n)),r)}var a,n}var a=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[t.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:t.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:t.Bindable.make({})}),Object.defineProperty(this,"codes",{value:t.Bindable.make({})}),Object.defineProperty(this,"keys",{value:t.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:t.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:t.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:t.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:t.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:t.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:t.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:t.Bindable.make({})}),document.addEventListener("keyup",t=>{this.listening&&(this.keys[t.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(t.preventDefault(),this.releasedWhich[t.which]=Date.now(),this.releasedCode[t.code]=Date.now(),this.releasedKey[t.key]=Date.now(),this.whichs[t.which]=-1,this.codes[t.code]=-1,this.keys[t.key]=-1)}),document.addEventListener("keydown",t=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(t.preventDefault(),t.repeat||(this.combo.push(t.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[t.which]=Date.now(),this.pressedCode[t.code]=Date.now(),this.pressedKey[t.key]=Date.now(),this.keys[t.key]>0||(this.whichs[t.which]=1,this.codes[t.code]=1,this.keys[t.key]=1)))});var s=t=>{for(var e in this.keys)this.keys[e]<0||(this.releasedKey[e]=Date.now(),this.keys[e]=-1);for(var s in this.codes)this.codes[s]<0||(this.releasedCode[s]=Date.now(),this.codes[s]=-1);for(var i in this.whichs)this.whichs[i]<0||(this.releasedWhich[i]=Date.now(),this.whichs[i]=-1)};window.addEventListener("blur",s),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&s()})}var s,i,a;return s=e,a=[{key:"get",value:function(){return this.instance=this.instance||t.Bindable.make(new this)}}],(i=[{key:"getKeyRef",value:function(e){return this.keyRefs[e]=this.keyRefs[e]||t.Bindable.make({})}},{key:"getKeyTime",value:function(t){var e=this.releasedKey[t],s=this.pressedKey[t];return s?!e||e<s?Date.now()-s:-1*(Date.now()-e):0}},{key:"getCodeTime",value:function(t){var e=this.releasedCode[t],s=this.pressedCode[t];return s?!e||e<s?Date.now()-s:-1*(Date.now()-e):0}},{key:"getWhichTime",value:function(t){var e=this.releasedWhich[t],s=this.pressedWhich[t];return s?!e||e<s?Date.now()-s:-1*(Date.now()-e):0}},{key:"getKey",value:function(t){return this.keys[t]?this.keys[t]:0}},{key:"getKeyCode",value:function(t){return this.codes[t]?this.codes[t]:0}},{key:"reset",value:function(){for(var t in this.keys)delete this.keys[t];for(var t in this.codes)delete this.codes[t];for(var t in this.whichs)delete this.whichs[t]}},{key:"update",value:function(){for(var t in this.keys)this.keys[t]>0?this.keys[t]++:this.keys[t]>-this.maxDecay?this.keys[t]--:delete this.keys[t];for(var t in this.codes){var e=this.releasedCode[t],s=this.pressedCode[t],i=this.getKeyRef(t);if(this.codes[t]>0){if(i.frames=this.codes[t]++,i.time=s?Date.now()-s:0,i.down=!0,!e||e<s)return;return-1*(Date.now()-e)}this.codes[t]>-this.maxDecay?(i.frames=this.codes[t]--,i.time=e-Date.now(),i.down=!1):(i.frames=0,i.time=0,i.down=!1,delete this.codes[t])}for(var t in this.whichs)this.whichs[t]>0?this.whichs[t]++:this.whichs[t]>-this.maxDecay?this.whichs[t]--:delete this.whichs[t]}}])&&r(s.prototype,i),a&&r(s,a),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.Keyboard=a}()}),require.register("curvature/input/Sequence.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Sequence=void 0;var i,r=s("../base/Bindable"),a=s("../base/Mixin"),n=s("../mixin/EventTargetMixin");function o(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,u(i.key),i)}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=c(e);if(s){var a=c(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}(this,i)}}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e,s){return(e=u(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function u(e){var s=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"===t(s)?s:String(s)}i=r.Bindable.NoGetters;var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(u,a.Mixin.with(n.EventTargetMixin));var e,s,r,c=h(u);function u({callback:t,keys:e,timing:s,gamepad:r}){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),d(g(a=c.call(this)),i,!0),d(g(a),"lastTap",!1),d(g(a),"recent",[]),d(g(a),"callback",()=>{}),d(g(a),"timing",500),d(g(a),"keys","");var n=[t,s,e,r];return a.callback=n[0],a.timing=n[1],a.keys=n[2],a.gamepad=n[3],a}return e=u,(s=[{key:"check",value:function(t){var e=this.recent,s=Date.now();s+-this.lastTap>this.timing&&e.splice(0),e.push({code:t,time:Date.now()});var i=e.map(t=>t.code).join(","),r=this.keys.join(",");this.lastTap=s;var a=[];for(var n in e){e[n];var o=e.slice(n),l=o.map(t=>t.code).join(",");if(l===r.substr(0,l.length)){a.push(...o),this.dispatchEvent(new CustomEvent("advance",{detail:{matched:a,recent:e,keys:this.keys,length:o.length}}));break}}a.length?r===i.substr(-r.length)&&this.dispatchEvent(new CustomEvent("complete",{detail:{matched:a,recent:e,keys:this.keys,length:a.length}})):this.dispatchEvent(new CustomEvent("cancel",{detail:{matched:a,recent:e,keys:this.keys,length:a.length}}))}}])&&o(e.prototype,s),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}();e.Sequence=p}()}),require.register("curvature/mixin/EventTargetMixin.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.EventTargetMixin=void 0;var i,r=s("../base/Mixin");function a(e,s,i){return(s=function(e){var s=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"===t(s)?s:String(s)}(s))in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i,e}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var i,r,a,n,o=[],l=!0,h=!1;try{if(a=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;l=!1}else for(;!(l=(i=a.call(s)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(h)throw r}}return o}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}var l=Symbol("EventTargetParent"),h=Symbol("CallHandler"),g=Symbol("Capture"),c=Symbol("Bubble"),d=(Symbol("Target"),Symbol("HandlersBubble")),u=Symbol("HandlersCapture"),p=(a(i={},r.Mixin.Constructor,function(){this[u]=new Map,this[d]=new Map}),a(i,"dispatchEvent",function(...t){var e=t[0];"string"==typeof e&&(e=new CustomEvent(e),t[0]=e),e.cvPath=e.cvPath||[],e.cvTarget=e.cvCurrentTarget=this;var s=this[g](...t);if(e.cancelable&&(!1===s||e.cancelBubble))return s;var i=[];if(this[u].has(e.type)){var r=this[u].get(e.type),a=[...r];a.forEach(t=>t.push(r)),i.push(...a)}if(this[d].has(e.type)){var o=this[d].get(e.type),p=[...o];p.forEach(t=>t.push(o)),i.push(...p)}for(var f of(i.push([()=>this[h](...t),{},null]),i)){var m=n(f,3),v=m[0],y=m[1],b=m[2];if(y.once&&b.delete(v),s=v(e),e.cancelable&&!1===s)break}return e.cancelable&&(e.cancelBubble||!1===s)||this[c](...t),this[l]||Object.freeze(e.cvPath),e.returnValue}),a(i,"addEventListener",function(t,e,s={}){!0===s&&(s={useCapture:!0});var i=d;s.useCapture&&(i=u),this[i].has(t)||this[i].set(t,new Map),this[i].get(t).set(e,s),s.signal&&s.signal.addEventListener("abort",i=>this.removeEventListener(t,e,s),{once:!0})}),a(i,"removeEventListener",function(t,e,s={}){!0===s&&(s={useCapture:!0});var i=d;s.useCapture&&(i=u),this[i].has(t)&&this[i].get(t).delete(e)}),a(i,g,function(...t){var e=t[0];if(e.cvPath.push(this),this[l]){var s=this[l][g](...t);if((!e.cancelable||!1!==s&&!e.cancelBubble)&&this[l][u].has(e.type)){e.cvCurrentTarget=this[l];var i=e.type,r=this[l][u].get(i);for(var a of r){var o=n(a,2),h=o[0];if(o[1].once&&r.delete(h),s=h(e),e.cancelable&&(!1===s||e.cancelBubble))break}return s}}}),a(i,c,function(...t){var e=t[0];if(e.bubbles&&this[l]&&!e.cancelBubble){if(!this[l][d].has(e.type))return this[l][c](...t);var s;e.cvCurrentTarget=this[l];e.type;var i=this[l][d].get(e.type);for(var r of i){var a=n(r,2),o=a[0];if(a[1].once&&i.delete(o),s=o(e),e.cancelable&&!1===s)return s}return s=this[l][h](...t),e.cancelable&&(!1===s||e.cancelBubble)?s:this[l][c](...t)}}),a(i,h,function(...t){var e=t[0];if(!e.defaultPrevented){var s="on".concat(e.type[0].toUpperCase()+e.type.slice(1));return"function"==typeof this[s]?this[s](e):void 0}}),i);e.EventTargetMixin=p,Object.defineProperty(p,"Parent",{value:l})}()}),require.register("curvature/mixin/PromiseMixin.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PromiseMixin=void 0;var t,i=s("../base/Mixin");function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var n=Symbol("Promise"),o=Symbol("Accept"),l=Symbol("Reject"),h=(a(t={},i.Mixin.Constructor,function(){this[n]=new Promise((t,e)=>{this[o]=t,this[l]=e})}),a(t,"then",function(...t){return this[n].then(...t)}),a(t,"catch",function(...t){return this[n].catch(...t)}),a(t,"finally",function(...t){return this[n].finally(...t)}),t);e.PromiseMixin=h,Object.defineProperty(h,"Reject",{value:l}),Object.defineProperty(h,"Accept",{value:o})}()}),require.register("curvature/model/Database.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Database=void 0;var i=s("../base/Bindable"),r=s("../base/Mixin"),a=s("../mixin/EventTargetMixin");function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=s){var i,r,a,n,o=[],l=!0,h=!1;try{if(a=(s=s.call(t)).next,0===e){if(Object(s)!==s)return;l=!1}else for(;!(l=(i=a.call(s)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(h)throw r}}return o}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function l(t,e,s){return(e=g(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function h(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,g(i.key),i)}}function g(e){var s=function(e,s){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,s||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"===t(s)?s:String(s)}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=p(e);if(s){var a=p(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,i)}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=Symbol("BeforeWrite"),m=Symbol("AfterWrite"),v=Symbol("BeforeDelete"),y=Symbol("AfterDelete"),b=Symbol("BeforeInsert"),S=Symbol("AfterInsert"),w=Symbol("BeforeUpdate"),x=Symbol("AfterUpdate"),k=Symbol("BeforeRead"),M=Symbol("AfterRead"),P=Symbol("PrimaryKey"),C=Symbol("Connection"),j=Symbol("Instances"),A=(Symbol("HighWater"),Symbol("Metadata")),T=Symbol("Timers"),O=Symbol("Target"),_=(Symbol("Store"),Symbol("Each")),E=Symbol("Name"),R=Symbol("Bank"),B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(p,r.Mixin.with(a.EventTargetMixin));var e,s,o,g=d(p);function p(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),e=g.call(this),Object.defineProperty(u(e),C,{value:t}),Object.defineProperty(u(e),E,{value:t.name}),Object.defineProperty(u(e),T,{value:{}}),Object.defineProperty(u(e),A,{value:{}}),Object.defineProperty(u(e),R,{value:{}}),e}return e=p,o=[{key:"open",value:function(t,e=0){return this[j][t]?this[j][t]:this[j][t]=new Promise((s,i)=>{var r=indexedDB.open(t,e);r.onerror=(t=>{p.dispatchEvent(new CustomEvent("error",{detail:{database:this[E],error:t,store:void 0,type:"read",subType:"select"}})),i(t)}),r.onsuccess=(t=>{var e=new this(t.target.result);s(e)}),r.onupgradeneeded=(t=>{var s=t.target.result;s.addEventListener("error",t=>console.error(t));for(var i=new this(s),r=t.oldVersion+1;r<=e;r+=1)i["_version_"+r](s,i,t)})})}},{key:"getPrimaryKey",value:function(t){return t[P]?t[P]:null}},{key:"destroyDatabase",value:function(){return new Promise((t,e)=>{var s=indexedDB.delete(dbName);s.onerror=(t=>{p.dispatchEvent(new CustomEvent("error",{detail:{database:dbName,error:t,type:"destroy"}})),e(t)}),s.onsuccess=(e=>{delete this[j][dbName],t(dbName)})})}}],(s=[{key:"select",value:function({store:t,index:e,range:s,ranges:i=[],direction:r="next",limit:a=0,offset:n=0,type:o=!1,origin:l,map:h}){var g=this[C].transaction(t,"readonly").objectStore(t),c=e?g.index(e):g;void 0===s||i&&i.length||(i=[s]);var d=[o,c,r,i,a,n,l,h],u=null;return{finally:t=>(u||(u=this[_](...d)(t=>t))).finally(t),catch:t=>(u||(u=this[_](...d)(t=>t))).catch(t),then:t=>(u||(u=this[_](...d)(t=>t))).then(t),each:t=>u||(u=this[_](...d)(t)),one:t=>u||(u=this[_](...Object.assign(d,[,,,,1]))(t))}}},{key:"insert",value:function(t,e,s={}){return this.inserts(l({},t,e),s)[0]}},{key:"inserts",value:function(t,e={}){var s=this,r=Object.keys(t),a=this[C].transaction(r,"readwrite"),o=[],l=function(){var t=(g=n(h,2))[0],r=g[1],l=a.objectStore(t),c=s[R][t]=s[R][t]||{},d=!0;Array.isArray(r)||(r=[r],d=!1);var u,f=r.map(r=>new Promise((n,o)=>{r=i.Bindable.make(r);var h={database:s,record:r,store:t,type:"write",subType:"insert",origin:e};h.key=p.getPrimaryKey(r);var g=new CustomEvent("write",{cancelable:!0,detail:h});if(s.dispatchEvent(g)){var d=r[p.BeforeWrite]?r[p.BeforeWrite](h):null,u=r[p.BeforeInsert]?r[p.BeforeInsert](h):null,f=l.add(Object.assign({},i.Bindable.shuck(r)));!1!==d&&!1!==u?(f.onerror=(t=>{s.dispatchEvent(new CustomEvent("writeError",{detail:h})),a.abort&&a.abort(),o(t)}),f.onsuccess=(i=>{var o=i.target.result;a.addEventListener("complete",i=>{if(l.autoIncrement&&(r.id=o),r[p.AfterInsert]&&r[p.AfterInsert](h),r[p.AfterWrite]&&r[p.AfterWrite](h),c[o]=r,r[P]=Symbol.for(o),n(r),s[A][t]||(s[A][t]=s.getStoreMeta(t,"store",{})),s[A][t]){var a=s.checkHighWaterMark(t,r),g=s.checkLowWaterMark(t,r),d=s[A][t],u=r[d.highWater];e.setHighWater&&a<u&&s.setHighWaterMark(t,r,e,"insert"),e.setLowWater&&g>u&&s.setLowWaterMark(t,r,e,"insert")}})})):a.abort&&a.abort()}else a.abort&&a.abort()}));u=d?Promise.all(f):f[0],o.push(u)};for(var h of Object.entries(t)){var g;l()}return o}},{key:"update",value:function(t,e,s={}){return this.updates(l({},t,[e]),s)[0]}},{key:"updates",value:function(t,e={}){var s=this,r=Object.keys(t),a=this[C].transaction(r,"readwrite"),o=[],l=function(){var t=(g=n(h,2))[0],r=g[1],l=a.objectStore(t),c=function(r){if(!r[P])throw Error("Value provided is not a DB record!");o.push(new Promise((n,o)=>{var h={database:s,key:p.getPrimaryKey(r),record:r,store:t,type:"write",subType:"update",origin:e},g=new CustomEvent("write",{cancelable:!0,detail:h});if(s.dispatchEvent(g)){var c=r[p.BeforeWrite]?r[p.BeforeWrite](h):null,d=r[p.BeforeUpdate]?r[p.BeforeUpdate](h):null;if(!1!==c&&!1!==d){var u=l.delete(r.id);u.onerror=(t=>{s.dispatchEvent(new CustomEvent("writeError",{detail:h})),o(t)}),u.onsuccess=(c=>{var d=l.put(Object.assign({},i.Bindable.shuck(r)));d.onerror=(t=>{s.dispatchEvent(new CustomEvent("writeError",{detail:h})),o(t)}),d.onsuccess=(i=>{n(g),a.oncomplete=(i=>{if(r[p.AfterInsert]&&r[p.AfterInsert](h),r[p.AfterWrite]&&r[p.AfterWrite](h),s[A][t]||(s[A][t]=s.getStoreMeta(t,"store",{})),s[A][t]){var a=s.checkHighWaterMark(t,r),n=s.checkLowWaterMark(t,r),o=s[A][t],l=r[o.highWater];e.setHighWater&&a<l&&s.setHighWaterMark(t,r,e,"insert"),e.setLowWater&&n>l&&s.setLowWaterMark(t,r,e,"insert")}})})})}else a.abort&&a.abort()}else a.abort&&a.abort()}))};for(var d of r)c(d)};for(var h of Object.entries(t)){var g;l()}return Promise.all(o).then(()=>a.commit&&a.commit()),o}},{key:"delete",value:function(t,e,s={}){return this.deletes(l({},t,[e]),s)[0]}},{key:"deletes",value:function(t,e={}){var s=this,i=Object.keys(t),r=this[C].transaction(i,"readwrite"),a=[],o=function(){var t=(h=n(l,2))[0],i=h[1],o=r.objectStore(t),g=function(i){if(!i[P])throw Error("Value provided is not a DB record!");a.push(new Promise((a,n)=>{var l={database:s,record:i,key:p.getPrimaryKey(i),store:t,type:"write",subType:"delete",origin:e},h=new CustomEvent("write",{cancelable:!0,detail:l});if(s.dispatchEvent(h))if(!1!==(i[p.BeforeDelete]?i[p.BeforeDelete](l):null)){var g=o.delete(i.id);g.onerror=(t=>{l.original=t;var e=new CustomEvent("writeError",{detail:l});s.dispatchEvent(e),n(t)}),g.onsuccess=(t=>{a(h),r.oncomplete=(t=>{i[P]=void 0,i[p.AfterDelete]&&i[p.AfterDelete](l),l.original=t})})}else r.abort&&r.abort();else r.abort&&r.abort()}))};for(var c of i)g(c)};for(var l of Object.entries(t)){var h;o()}return Promise.all(a).then(()=>r.commit&&r.commit()),a}},{key:"clear",value:function(t){return new Promise((e,s)=>{var i=this[C].transaction([t],"readwrite"),r=i.objectStore(t).clear(),a={database:this[E],store:t,type:"write",subType:"clear",origin:origin};r.onerror=(t=>{a.original=t;var e=new CustomEvent("writeError",{detail:a});this.dispatchEvent(e),s(t)}),r.onsuccess=(t=>{a.original=t;var s=new CustomEvent("write",{detail:a});this.dispatchEvent(s),i.commit&&i.commit(),e(s)})})}},{key:"listStores",value:function(){return[...this[C].objectStoreNames]}},{key:"listIndexes",value:function(t){return[...this[C].transaction([t]).objectStore(t).indexNames]}},{key:_,value:function(t,e,s,r,a,n,o,l){var h=(r,h)=>new Promise((g,c)=>{if(r instanceof IDBKeyRange);else if(Array.isArray(r))if(0===r.length)r=void 0;else if(1===r.length)r=IDBKeyRange.only(r[0]);else if(void 0===r[0]&&void 0===r[1])r=void 0;else if(void 0===r[0]){var d;r=IDBKeyRange.upperBound(r[1],null===(d=r[2])||void 0===d||d)}else if(void 0===r[1]){var u;r=IDBKeyRange.lowerBound(r[0],null!==(u=r[2])&&void 0!==u&&u)}else{var f,m;r=IDBKeyRange.bound(r[0],r[1],null!==(f=r[2])&&void 0!==f&&f,null===(m=r[3])||void 0===m||m)}else void 0!==r&&null!==r&&(r=IDBKeyRange.only(r));var v=0;e.openCursor(r,s).addEventListener("success",s=>{var r=s.target.result;if(!r)return g({record:null,result:null,index:v});var c=r.source,d=c.objectStore?c.objectStore.name:e.name;this[R][d]=this[R][d]||{};var u=this[R][d],f=r.primaryKey,m=t?t.from(r.value):r.value,y=i.Bindable.makeBindable(m),b={database:this[E],key:p.getPrimaryKey(y),record:m,store:e.name,type:"read",subType:"select",origin:o},S=m[p.BeforeRead]?m[p.BeforeRead](b):null;if(n>v++||!1===S)return r.continue();u[f]?Object.assign(u[f],m):(m[P]=Symbol.for(f),u[f]=m),b.record=m,u[f][p.AfterRead]&&u[f][p.AfterRead](b);if(this.dispatchEvent(new CustomEvent("read",{detail:b,cancelable:!0}))){var w=t?t.from(u[f]):u[f];w[P]=Symbol.for(f);var x=l?l(w):w,k=h?h(x,v):x;if(a&&v-n>=a)return n+=a,g({mapped:x,result:k,index:v})}r.continue()})}),g=[];r=r&&r.length?r.slice():[[]];var c=(t,e)=>(g.push(t),r.length?h(r.shift(),e).then(t=>c(t,e)):1===g.length?g[0]:g);return t=>h(r.shift(),t).then(e=>c(e,t))}},{key:"getObjectStores",value:function(t){return[...this[C].objectStoreNames]}},{key:"getStoreIndexes",value:function(t){var e=this[C].transaction([t],"readonly"),s=[...e.objectStore(t).indexNames];return e.abort(),s}},{key:"setStoreMeta",value:function(t,e,s){localStorage.setItem("::::cvdb::".concat(t,"::").concat(e),JSON.stringify(s))}},{key:"getStoreMeta",value:function(t,e,s=null){var i=localStorage.getItem("::::cvdb::".concat(t,"::").concat(e)),r=null!==i?JSON.parse(i):s;return null===r?s:r}},{key:"createObjectStore",value:function(t,e){var s=this[C].createObjectStore(t,e);return this.setStoreMeta(t,"store",e),s}},{key:"deleteObjectStore",value:function(t){return this[C].deleteObjectStore(t)}},{key:"checkHighWaterMark",value:function(t,e,s){return this.getStoreMeta(t,"highWater",0)}},{key:"setHighWaterMark",value:function(t,e,s,i){var r=e[this[A][t].highWater],a=this.getStoreMeta(t,"highWater",0);this.setStoreMeta(t,"highWater",r),this.dispatchEvent(new CustomEvent("highWaterMoved",{detail:{database:this[E],record:e,store:t,type:"highWaterMoved",subType:i,origin:s,oldValue:a,value:r}}))}},{key:"checkLowWaterMark",value:function(t,e,s){return this.getStoreMeta(t,"lowWater",1/0)}},{key:"setLowWaterMark",value:function(t,e,s,i){var r=e[this[A][t].highWater],a=this.getStoreMeta(t,"lowWater",null);this.setStoreMeta(t,"lowWater",r),this.dispatchEvent(new CustomEvent("lowWaterMoved",{detail:{database:this[E],record:e,store:t,type:"lowWaterMoved",subType:i,origin:s,oldValue:a,value:r}}))}}])&&h(e.prototype,s),o&&h(e,o),Object.defineProperty(e,"prototype",{writable:!1}),p}();e.Database=B,Object.defineProperty(B,j,{value:[]}),Object.defineProperty(B,"BeforeDelete",{value:v}),Object.defineProperty(B,"AfterDelete",{value:y}),Object.defineProperty(B,"BeforeWrite",{value:f}),Object.defineProperty(B,"AfterWrite",{value:m}),Object.defineProperty(B,"BeforeInsert",{value:b}),Object.defineProperty(B,"AfterInsert",{value:S}),Object.defineProperty(B,"BeforeUpdate",{value:w}),Object.defineProperty(B,"AfterUpdate",{value:x}),Object.defineProperty(B,"BeforeRead",{value:k}),Object.defineProperty(B,"AfterRead",{value:M}),Object.defineProperty(B,"PKSymbol",{value:P}),Object.defineProperty(B,"PrimaryKey",{value:P});try{Object.defineProperty(B,O,{value:new EventTarget})}catch(t){Object.defineProperty(B,O,{value:document.createDocumentFragment()})}var I=function(t){Object.defineProperty(B,t,{value:(...e)=>B[O][t](...e)})};for(var F of["addEventListener","removeEventListener","dispatchEvent"])I(F)}()}),require.register("curvature/model/Model.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;var t=s("../base/Cache"),i=s("../base/Bindable"),r=s("./Database");function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,l(i.key),i)}}function o(t,e,s){return(e=l(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t){var e=function(t,e){if("object"!==a(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===a(e)?e:String(e)}var h=Symbol("Changed"),g=Symbol("Deleted"),c=Symbol("Saved"),d=Symbol("Keys"),u=function(){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"id",void 0),o(this,"class",void 0),Object.defineProperty(this,h,{value:i.Bindable.make({})}),Object.defineProperty(this,g,{writable:!0,value:!1}),Object.defineProperty(this,c,{writable:!0,value:!1}),Object.defineProperty(this,d,{writable:!0,value:new Set}),i.Bindable.make(this)}var s,l,u;return s=e,u=[{key:"keyProps",get:function(){return["id","class"]}},{key:"from",value:function(e,s=!1){var i=this.keyProps,r=i.map(t=>e[t]);r.unshift(this.name);var n=r.join("::"),o="models-by-type-and-publicId",l=t.Cache.load(n,!1,o),g=l||new this;for(var d of i){var u,p;g[d]=null!==(u=null!==(p=g[d])&&void 0!==p?p:e[d])&&void 0!==u?u:null}if(g.consume(e),!l){t.Cache.store(n,g,0,o);var f=!1;g.bindTo((t,e,s,i)=>{"symbol"!==a(e)&&t!==s[e]&&(g[h][e]=f,g[c]=!(f||!g[c]))}),0===Object.keys(g[h]).length&&(g[c]=s),f=!0}return g}}],(l=[{key:"consume",value:function(s,i=!1){var n=e.keyProps,o=(e,s)=>{if(s&&"object"===a(s)&&s.constructor.keyProps){var r=s.constructor.keyProps.map(t=>s[t]).join("::"),n=t.Cache.load(r,!1,"models-by-type-and-publicId");n&&(n.consume(s),s=n)}!i&&this[h][e]||(this[e]=s)};for(var l of(r.Database.PKSymbol in s&&o(r.Database.PKSymbol,s[r.Database.PKSymbol]),this[d]=new Set([...this[d],...Object.keys(this),...Object.keys(s)]),this[d]))!i&&this[h][l]||n.includes(l)||l in s&&o(l,s[l])}},{key:"changed",value:function(){this[c]=!1}},{key:"markDeleted",value:function(){for(var t in this[h])this[h][t]=!1;this[g]=!0,this[c]=!1}},{key:"markStored",value:function(){for(var t in this)this[h][t]=!1;this[g]=!1,this[c]=!0}},{key:"isSaved",value:function(){return this[c]}}])&&n(s.prototype,l),u&&n(s,u),Object.defineProperty(s,"prototype",{writable:!1}),e}();e.Model=u,Object.defineProperty(u,"Changed",{value:h}),Object.defineProperty(u,"Deleted",{value:g}),Object.defineProperty(u,"Saved",{value:c})}()}),require.register("curvature/net/Elicit.js",function(e,s,i){s=t(s,{},"curvature"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Elicit=void 0;var t=s("curvature/base/Mixin"),i=s("curvature/mixin/EventTargetMixin"),r=s("curvature/mixin/PromiseMixin");function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,c(i.key),i)}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,i=h(t);if(e){var r=h(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return function(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,s)}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e,s){return(e=c(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function c(t){var e=function(t,e){if("object"!==a(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===a(e)?e:String(e)}var d=Symbol("IterateDownload"),u=Symbol("Retry"),p=Symbol("HandleFirstByte"),f=Symbol("HandleProgress"),m=Symbol("HandleComplete"),v=Symbol("HandleHeaders"),y=Symbol("HandleClose"),b=Symbol("HandleError"),S=Symbol("HandleOpen"),w=Symbol("HandleFail"),x=Symbol("FetchDeferrer"),k=Symbol("LastChunkSize"),M=Symbol("LastChunkTime"),P=Symbol("Options"),C=Symbol("Fetch"),j=Symbol("Type"),A=Symbol("Url"),T=Symbol("RetriesLeft"),O=Symbol("TimeoutLeft"),_=Symbol("Timeout"),E=Symbol("Timer"),R=Symbol("Canecller"),B=Symbol("Caneclled"),I=Symbol("Paused"),F=Symbol("Received"),L=Symbol("Length"),D=Symbol("Opened"),N=Symbol("Closed"),z=Symbol("Start"),q=Symbol("First"),U=Symbol("End"),H=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e)}(c,t.Mixin.with(i.EventTargetMixin,r.PromiseMixin));var s,a,h,g=l(c);function c(t,e={}){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(s=g.call(this))[T]=e.retries||5,s[_]=e.timeout||4500,s[O]=e.maxTimeout||s[_]*s[T],s[x]=null,s[M]=0,s[k]=0,s[B]=!1,s[F]=0,s[I]=!1,s[N]=0,s[P]=Object.assign({},e),s[A]=t,e.defer?s[C]=new Promise(t=>s[x]=t):s.open(),s}return s=c,h=[{key:"pool",value:function(t){t.finally(()=>{if(this.running.delete(t),this.backlog.length){var e=this.backlog.shift();this.running.add(e),e.open()}}),this.running.size<5?(this.running.add(t),t.open()):this.backlog.push(t)}}],(a=[{key:"open",value:function(){if(!this[D]||this[N]){this[z]||(this[z]=Date.now()),this[R]=new AbortController,this[P].signal=this[R].signal,this[D]=Date.now(),this[N]=0,this[q]=0,this[C]=fetch(this[A],this[P]).then(t=>this[S](t)).catch(t=>this[b](t));this[E]=setTimeout(()=>{if(!this[q]){if(this[R].abort(),this[y](),this[O]=Math.max(0,this[O]-this[_]),this[O])return;this[w](new Error("Timed out."))}},this[_])}}},{key:"headers",value:function(){return this[C].then(({response:t,stream:e})=>t.headers)}},{key:"json",value:function(){return this[C].then(({response:t,stream:e})=>{return new Response(e,{headers:{"Content-Type":"application/json"}}).json()})}},{key:"text",value:function(){return this[C].then(({response:t,stream:e})=>{return new Response(e,{headers:{"Content-Type":this.type}}).text()})}},{key:"css",value:function(){return this.text().then(t=>{var e=new CSSStyleSheet;return e.replace(t),e})}},{key:"blob",value:function(){return this[C].then(({response:t,stream:e})=>{return new Response(e,{headers:{"Content-Type":t.headers.get("Content-Type")}}).blob()})}},{key:"objectUrl",value:function(){return this.blob().then(t=>URL.createObjectURL(t))}},{key:"dataUri",value:function(){return this.blob().then(t=>new Promise((e,s)=>{var i=new FileReader;i.onload=(t=>e(i.result)),i.onerror=(t=>s(i.error)),i.onabort=(t=>s(new Error("Read aborted"))),i.readAsDataURL(t)}))}},{key:"buffer",value:function(){return this[C].then(({response:t,stream:e})=>{return new Response(e,{headers:{"Content-Type":t.headers.get("Content-Type")}}).arrayBuffer()})}},{key:"bytes",value:function(){return this.buffer().then(t=>new Uint8Array(t))}},{key:"cancel",value:function(){this.emitCancelEvent()&&(this[R].abort(),this[B]=!0,this.emitCancelledEvent())}},{key:"pause",value:function(){this[U]||this[I]||this[N]||this.emitPauseEvent()&&(this[I]=!0,this.emitPausedEvent())}},{key:"unpause",value:function(){!this[U]&&this[I]&&this.emitUnpauseEvent()&&(this[I]=!1,this.emitUnpausedEvent())}},{key:"done",get:function(){return!!this[U]}},{key:"type",get:function(){return this[j]}},{key:"totalTime",get:function(){return this[U]?this[U]-this[z]:Date.now()-this[z]}},{key:"waitTime",get:function(){return this[q]?this[q]-this[D]:Date.now()-this[D]}},{key:"loadTime",get:function(){return this[D]?this[N]?this[N]-this[q]:Date.now()-this[q]:0}},{key:"speed",get:function(){return this[D]?((t=this[U]?this[U]-this[M]:Date.now()-this[M])||(t=.01),this[k]/t):0;var t}},{key:"received",get:function(){return this[F]}},{key:"length",get:function(){return this[L]}},{key:"isPaused",get:function(){return this[I]}},{key:d,value:function(t,e,s){this[f](s,0,null);var i=Date.now(),r=1,a=({done:t,value:a})=>t?(e.close(),this[m]()):(e.enqueue(a),this[F]+=a.length,this[q]||this[p](a),this[f](s,this[F],a),this[M]=i,this[k]=r,i=Date.now(),r=a.length,n()),n=()=>this[B]?t.cancel():this[I]?new Promise(t=>{setTimeout(()=>t(n()),100)}):t.read().then(t=>a(t)).catch(t=>this[b](t));return n()}},{key:u,value:function(){if(this.emitRetryEvent()&&!(this[T]<=0))return this[R].abort(),this[y](),this[F]=0,this[T]--,this.open()}},{key:S,value:function(t){var e=t.body.getReader(),s=this[L]||Number(t.headers.get("Content-Length")),i=this[i]||t.headers.get("Content-Type");this[L]=s,this[j]=i,this[v](t.headers),this[x]&&this[x](this[C]);var r=this;return{response:t,stream:new ReadableStream({start:function(t){r[d](e,t,s)}})}}},{key:y,value:function(){this[N]=Date.now(),this.emitCloseEvent()}},{key:v,value:function(t){this.emitHeadersEvent(t)}},{key:f,value:function(t,e,s){this.emitProgressEvent(t,e,s)}},{key:m,value:function(){this[U]=Date.now(),this[y](),this.emitCompleteEvent(),this[r.PromiseMixin.Accept]()}},{key:b,value:function(t){return console.warn("[".concat(t.constructor.name,"] ").concat(t.code,": ").concat(t.message),t),this.emitErrorEvent(t)?this[w](t):this[u]()}},{key:w,value:function(t){return this[U]=Date.now(),this[y](),this.emitFailEvent(t),this[r.PromiseMixin.Reject](t)}},{key:p,value:function(t){clearInterval(this[E]),this[q]=Date.now(),this.emitFirstByteEvent(t)}},{key:"emitProgressEvent",value:function(t,e,s){var i=t?e/t:0,r=this.totalTime,a=this.loadTime,n=this.waitTime,o=this.speed;return this.dispatchEvent(new CustomEvent("progress",{detail:{length:t,received:e,done:i,speed:o,loadTime:a,waitTime:n,totalTime:r,value:s}}))}},{key:"emitOpenEvent",value:function(){return this.dispatchEvent(new CustomEvent("open"))}},{key:"emitCloseEvent",value:function(){return this.dispatchEvent(new CustomEvent("close"))}},{key:"emitFirstByteEvent",value:function(t){return this.dispatchEvent(new CustomEvent("firstByte",{detail:{received:t}}))}},{key:"emitHeadersEvent",value:function(t){return this.dispatchEvent(new CustomEvent("headers",{detail:{headers:t}}))}},{key:"emitCompleteEvent",value:function(){return this.dispatchEvent(new CustomEvent("complete"))}},{key:"emitErrorEvent",value:function(){return this.dispatchEvent(new CustomEvent("error",{cancelable:this[T]>0}))}},{key:"emitRetryEvent",value:function(){return this.dispatchEvent(new CustomEvent("retry",{cancelable:!0}))}},{key:"emitFailEvent",value:function(){return this.dispatchEvent(new CustomEvent("fail"))}},{key:"emitPauseEvent",value:function(){return this.dispatchEvent(new CustomEvent("pause",{cancelable:!0}))}},{key:"emitPausedEvent",value:function(){this.dispatchEvent(new CustomEvent("paused"))}},{key:"emitUnpauseEvent",value:function(){return this.dispatchEvent(new CustomEvent("unpause",{cancelable:!0}))}},{key:"emitUnpausedEvent",value:function(){this.dispatchEvent(new CustomEvent("unpaused"))}},{key:"emitCancelEvent",value:function(){return this.dispatchEvent(new CustomEvent("cancel",{cancelable:!0}))}},{key:"emitCancelledEvent",value:function(){return this.dispatchEvent(new CustomEvent("cancelled"))}}])&&n(s.prototype,a),h&&n(s,h),Object.defineProperty(s,"prototype",{writable:!1}),c}();e.Elicit=H,g(H,"backlog",[]),g(H,"running",new Set)}()}),require.register("matrix-api/Matrix.js",function(e,s,i){s=t(s,{},"matrix-api"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;var i=s("curvature/base/Uuid"),r=s("curvature/base/Mixin"),a=s("curvature/mixin/EventTargetMixin");function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==s)return;var i,r,a=[],n=!0,o=!1;try{for(s=s.call(t);!(n=(i=s.next()).done)&&(a.push(i.value),!e||a.length!==e);n=!0);}catch(t){o=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}return a}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return l(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function h(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=u(e);if(s){var a=u(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,i)}}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}(f,r.Mixin["with"](a.EventTargetMixin));var e,s,l,u=c(f);function f(t){var e,s,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),p(d(r=u.call(this)),"ssoUuid",String(new i.Uuid)),p(d(r),"isLoggedIn",!1),p(d(r),"loggingIn",null),r.baseUrl=t||"https://matrix.org/_matrix",r.clientUrl="".concat(r.baseUrl,"/client/v3"),r.mediaUrl="".concat(r.baseUrl,"/media/v3"),r.profileCache=new Map,r.mediaCache=new Map,r.storage=null!==(e=a.storage)&&void 0!==e?e:globalThis.sessionStorage,r.interval=null!==(s=a.interval)&&void 0!==s&&s,r}return e=f,(s=[{key:"isLoggedIn",get:function(){this.isLoggedIn&&this.dispatchEvent(new CustomEvent("logged-in"));var t=this.storage.getItem("matrix:access-token")||"false";JSON.parse(t);return this.storage.getItem("matrix:access-token")}},{key:"initSso",value:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;if(this.storage.getItem("matrix:access-token"))return this.isLoggedIn=!0,void this.dispatchEvent(new CustomEvent("logged-in"));var i=new URLSearchParams({redirectUrl:t}),r="login/sso/redirect?".concat(i),a=window.screenX+window.outerWidth/2+200,n=window.screenY+window.outerHeight/2-300,o="width=".concat(400,",height=").concat(600,",screenX=").concat(a,",screenY=").concat(n);s.open("".concat(this.clientUrl,"/").concat(r),"matrix-login-".concat(this.ssoUuid),o);s.addEventListener("message",function t(i){if(i.origin===location.origin&&i.source!==window&&"string"==typeof i.data){var r=JSON.parse(i.data);"s.sso.complete"===r.type&&(e.storage.setItem("matrix:access-token",JSON.stringify(r.data)),e.isLoggedIn=!0,e.dispatchEvent(new CustomEvent("logged-in")),s.removeEventListener("message",t))}})}},{key:"completeSso",value:function(t){var e={type:"m.login.token",token:t,txn_id:(1/Math.random()).toString(36)};fetch("".concat(this.clientUrl,"/").concat("login"),{method:"POST",body:JSON.stringify(e)}).then(function(t){return t.json()}).then(function(t){window.opener.postMessage(JSON.stringify({type:"s.sso.complete",data:t}),location.origin),window.close()})}},{key:"logIn",value:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return this.loggingIn||(this.loggingIn=new Promise(function(t){e.loggingIn=null,e.addEventListener("logged-in",function(e){t(e)},{once:!0})})),this.initSso(t,s),this.loggingIn}},{key:"logOut",value:function(){this.storage.removeItem("matrix:access-token"),this.isLoggedIn=!1,this.loggingIn=null,this.dispatchEvent(new CustomEvent("logged-out"))}},{key:"getGuestToken",value:function(){var t=this,e=this.storage.getItem("matrix:access-token")||"false",s=JSON.parse(e);if(s&&s.isGuest)return Promise.resolve(s);var i=new URLSearchParams({kind:"guest"}),r=fetch("".concat(this.clientUrl,"/register?").concat(i),{method:"POST",body:"{}"}).then(function(t){return t.json()});return r.then(function(e){e.isGuest=!0,t.isLoggedIn=!0,t.storage.setItem("matrix:access-token",JSON.stringify(e))}),r}},{key:"getToken",value:function(){var t=this.storage.getItem("matrix:access-token")||"false",e=JSON.parse(t);return e?Promise.resolve(e):matrix.getGuestToken()}},{key:"listenForServerEvents",value:function(){var t=this,e=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!e)return Promise.reject("No access token found.");var s=new URLSearchParams({access_token:e.access_token}),i="".concat(this.clientUrl,"/events?").concat(s);fetch(i).then(function(t){return t.json()}).then(function(e){return t.streamServerEvents(e)})}},{key:"listenForRoomEvents",value:function(t,e){var s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!e||!e.cancelled){var r=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!r)return Promise.reject("No access token found.");var a=new URLSearchParams({access_token:r.access_token,room_id:t,from:i}),n="".concat(this.clientUrl,"/events?").concat(a);return e=e||{cancelled:!1},fetch(n).then(function(t){return t.json()}).then(function(i){return s.streamServerEvents(i,t,e)}),e}}},{key:"streamServerEvents",value:function(t,e,s){var r=this;s&&s.cancelled||(this.interval?setTimeout(function(){e?r.listenForRoomEvents(e,s,t.end):r.listenForServerEvents()},this.interval):e?this.listenForRoomEvents(e,s,t.end):this.listenForServerEvents(),t.chunk&&t.chunk.forEach(function(t){var e={};t.event_id||(t.event_id="local:".concat(new i.Uuid)),Object.assign(e,t),r.dispatchEvent(new CustomEvent("matrix-event",{detail:e})),r.dispatchEvent(new CustomEvent(e.type,{detail:e}))}))}},{key:"getUserProfile",value:function(t){if(this.profileCache.has(t))return this.profileCache.get(t);var e=fetch("".concat(this.clientUrl,"/profile/").concat(t)).then(function(t){return t.json()});return this.profileCache.set(t,e),e}},{key:"getUserData",value:function(t){var e=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!e)return Promise.reject("No access token found.");var s=new URLSearchParams({access_token:e.access_token});return fetch("".concat(this.clientUrl,"/user/").concat(e.user_id,"/account_data/").concat(t,"?").concat(s)).then(function(t){return t.json()})}},{key:"putUserData",value:function(t,e){var s=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(s){var i=new URLSearchParams({access_token:s.access_token}),r="".concat(this.clientUrl,"/user/").concat(s.user_id,"/account_data/").concat(t,"?").concat(i);return fetch(r,{method:"PUT",body:e}).then(function(t){if(!t.ok){var e=new Error("HTTP status code: "+t.status);throw e.status=t.status,e.response=t,e}return t}).then(function(t){return t.json()})}}},{key:"getMediaUrl",value:function(t){var e=new URL(t);return"".concat(this.mediaUrl,"/download/").concat(e.pathname.substr(2))}},{key:"getMedia",value:function(t){if(this.mediaCache.has(t))return this.mediaCache.get(t);var e=fetch(this.getMediaUrl(t)).then(function(t){return Promise.all([t.arrayBuffer(),t.headers.get("Content-type")])}).then(function(t){var e=n(t,2),s=e[0],i=e[1];return URL.createObjectURL(new Blob([s],{type:i}))});return this.mediaCache.set(t,e),e}},{key:"postMedia",value:function(t,e){var s=this.storage.getItem("matrix:access-token")||"false",i=JSON.parse(s);if(i){var r=new URLSearchParams({access_token:i.access_token}),a="".concat(this.mediaUrl,"/upload?").concat(r),n=new Headers({"Content-Type":t.type});return fetch(a,{method:"POST",headers:n,body:t}).then(function(t){return t.json()})}}},{key:"putEvent",value:function(t,e,s){var i=this.storage.getItem("matrix:access-token")||"false",r=JSON.parse(i);if(r){var a=new URLSearchParams({access_token:r.access_token}),n="".concat(this.clientUrl,"/rooms/").concat(t,"/send/").concat(e,"/").concat(Math.random().toString(36),"?").concat(a),o=p({method:"PUT",headers:new Headers({"Content-Type":"application/json"}),keepalive:!0,body:JSON.stringify(s)},"keepalive",!0);return fetch(n,o).then(function(t){return t.json()})}}},{key:"getEvent",value:function(t,e){var s=this.storage.getItem("matrix:access-token")||"false",i=JSON.parse(s);if(i){var r=new URLSearchParams({access_token:i.access_token}),a="".concat(this.clientUrl,"/rooms/").concat(t,"/event/").concat(e,"?").concat(r),n=new Headers({"Content-Type":"application/json"});return fetch(a,{method:"GET",headers:n}).then(function(t){return t.json()})}}},{key:"sync",value:function(){var t=this.storage.getItem("matrix:access-token")||"false",e=JSON.parse(t);if(!e)return Promise.resolve();var s=new URLSearchParams({full_state:!0,access_token:e.access_token}),i="".concat(this.clientUrl,"/sync?").concat(s);return fetch(i).then(function(t){return t.json()})}},{key:"getRoomState",value:function(t){var e=this.storage.getItem("matrix:access-token")||"false",s=JSON.parse(e);if(!s)return Promise.resolve();var i=new URLSearchParams({access_token:s.access_token}),r="".concat(this.clientUrl,"/rooms/").concat(t,"/state?").concat(i);return fetch(r).then(function(t){return t.json()})}},{key:"syncRoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isLoggedIn)return Promise.reject("Logged out.");var i=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!i)return Promise.reject("No access token found.");var r=new URLSearchParams({access_token:i.access_token,room_id:t,dir:"b",from:e||"",filter:s?JSON.stringify(s):""}),a="".concat(this.clientUrl,"/rooms/").concat(t,"/messages?").concat(r),n=new AbortController,o=n.signal,l=function(){return n.abort()};this.addEventListener("logged-out",l,{once:!0});var h=fetch(a,{signal:o}).then(function(t){return t.json()});return h.finally(this.removeEventListener("logged-out",l)),h}},{key:"syncRoomHistory",value:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this.syncRoom(t,r,a).then(function(r){if(!e.isLoggedIn)return Promise.reject("Logged out.");var n=new CustomEvent("roomSyncFrame",{detail:{frame:r},cancelable:!0});if(e.dispatchEvent(n)){if(s&&r.chunk){var l,h=function(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=o(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n=!0,l=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return n=t.done,t},e:function(t){l=!0,a=t},f:function(){try{n||null==s.return||s.return()}finally{if(l)throw a}}}}(r.chunk);try{for(h.s();!(l=h.n()).done;){var g=l.value;if(!e.isLoggedIn)return Promise.reject("Logged out.");if(i&&g.origin_server_ts<=i)return Promise.resolve();if(!1===s(g))return Promise.resolve()}}catch(t){h.e(t)}finally{h.f()}}return new Promise(function(n){var o;return setTimeout(function(){return n(r.chunk.length&&e.syncRoomHistory(t,s,i,r.end,a))},null!==(o=e.interval)&&void 0!==o?o:0)})}})}},{key:"getCurrentUserId",value:function(){var t=this.storage.getItem("matrix:access-token")||"false",e=JSON.parse(t);if(e)return e.user_id}},{key:"createRoom",value:function(t,e,s){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=JSON.stringify({name:t,topic:e,visibility:s,initial_state:i}),a=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!a)return Promise.resolve();var n=new URLSearchParams({access_token:a.access_token}),o="".concat(this.clientUrl,"/createRoom?").concat(n);return fetch(o,{body:r,method:"POST"}).then(function(t){return t.json()})}},{key:"joinRoom",value:function(t){var e=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!e)return Promise.reject("No access token found.");var s=new URLSearchParams({access_token:e.access_token});fetch("".concat(this.clientUrl,"/rooms/").concat(t,"/join?").concat(s),{method:"POST"}).then(function(t){return t.json()})}},{key:"leaveRoom",value:function(t){var e=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!e)return Promise.reject("No access token found.");var s=new URLSearchParams({access_token:e.access_token});fetch("".concat(this.clientUrl,"/rooms/").concat(t,"/leave?").concat(s),{method:"POST"}).then(function(t){return t.json()})}},{key:"whoAmI",value:function(){var t=JSON.parse(this.storage.getItem("matrix:access-token")||"false");if(!t)return Promise.reject("No access token found.");var e=new URLSearchParams({access_token:t.access_token});return fetch("".concat(this.clientUrl,"/account/whoami?").concat(e)).then(function(t){return t.json()})}}])&&h(e.prototype,s),l&&h(e,l),Object.defineProperty(e,"prototype",{writable:!1}),f}();e.Matrix=f}()}),require.register("sixgram/Actions.js",function(e,s,i){s=t(s,{},"sixgram"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HOME=e.LEAVE=e.ENTER=e.INSERT=e.IGNORE=void 0;e.IGNORE=0;e.INSERT=1;e.ENTER=2;e.LEAVE=3;e.HOME=4}()}),require.register("sixgram/Chunk.js",function(e,s,i){s=t(s,{},"sixgram"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Chunk=void 0;e.Chunk=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.depth=0,this.match=null,this.type="normal",this.list=[]}}()}),require.register("sixgram/Parser.js",function(e,s,i){s=t(s,{},"sixgram"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var t=s("./Chunk"),i=s("./Actions");function r(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return a(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function e(t,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.tokens=t||{},this.modes=s||{}}var s,a,l;return s=e,(a=[{key:"parse",value:function(e){if(this.index=0,this.mode="normal",this.stack=[],!(this.mode in this.modes))throw new Error("Mode ".concat(this.mode," does not exist on parser."),this);var s=new t.Chunk,a=this.modes[this.mode];for(s.type=this.mode;this.index<e.length;){var o=!1;for(var l in a){var h=this.tokens[l],g=h.exec(e.substr(this.index));if(g&&!(g.index>0)){if(!a[l])throw new Error('Invalid token type "'.concat(l,'" found in mode "').concat(this.mode,'".'));var c=g[0],d="object"===n(a[l])?a[l]:[a[l]];o=!0,this.index+=c.length;var u="normal";for(var p in d){var f=d[p];if("string"!=typeof f)switch(f){case i.INSERT:s.list.push(c);break;case i.ENTER:var m=new t.Chunk;m.depth=s.depth+1,m.match=c,m.groups=r(c.match(h)).slice(1),m.mode=u,m.type=l,s.list.push(m),this.stack.push(s),s=m;break;case i.LEAVE:this.stack.length&&(s=this.stack.pop(),this.mode=s.type,a=this.modes[this.mode]);break;case i.HOME:this.stack.splice(0),a=this.modes.normal}else{if(!(f in this.modes))throw new Error('Mode "'.concat(f,'" does not exist.'));this.mode=f,a=this.modes[this.mode],u=f}}break}}if(!o)break}if(this.stack.length)throw new Error("Did not return to top of stack!");return this.stack.shift()||s}}])&&o(s.prototype,a),l&&o(s,l),e}();e.Parser=l}()}),require.register("sixgram/Renderer.js",function(e,s,i){s=t(s,{},"sixgram"),function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var s=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.ops=t||{}}var s,i,r;return s=e,(i=[{key:"process",value:function(t){var e="";for(var s in t.list){var i=t.list[s];if(this.ops[t.type]){var r=this.ops[t.type](i,t);!1!==r&&(e+=r)}else!1!==i&&(e+=i)}return e}}])&&t(s.prototype,i),r&&t(s,r),e}();e.Renderer=s}()}),require.register("subspace-client/Channel.js",function(e,s,i){s=t(s,{},"subspace-client"),function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.Channel=void 0;var s=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var s,i,r;return s=e,r=[{key:"scalar",value:function(t,e){var s=new Uint8Array(t).buffer;return"float"==e?new Float64Array(s)[0]:"Int32"==e?new Int32Array(s)[0]:void 0}},{key:"namePart",value:function(t,e){return t.split(":")[e]||null}},{key:"isWildcard",value:function(t){return/\*/.exec(t)}},{key:"isRange",value:function(t){}},{key:"containsRange",value:function(t){}},{key:"compareNames",value:function(t,e){var s,i,r=/^(\d+)\-?(\d+)?$/,a=[],n=t.toString().split(":"),o=e.toString().split(":"),l=n.length;l<o.length&&(l=o.length);for(var h=0;h<l;h++){if(n.length>h)s=n[h];else{if("*"!=n[n.length-1])return!1;s=n[n.length-1]}if(o.length>h)i=o[h];else{if("*"!=o[o.length-1])return!1;i=o[o.length-1]}var g="*"!==s?s:i;if(s!==i&&"*"!==s&&"*"!==i){var c=r.exec(s),d=r.exec(i);if(!c||!d)return!1;var u=c[1],p=c[1],f=d[1],m=d[1];if(c[2]&&(p=c[2]),d[2]&&(m=d[2]),u>=f&&p<=m?g="".concat(u,"-").concat(p):u<=f&&p>m?g="".concat(f,"-").concat(m):p<=m&&p>=f?g="".concat(f,"-").concat(p):u<=m&&u>=f&&(g="".concat(u,"-").concat(m)),m<=p&&m>=u)g="".concat(u,"-").concat(m);else{if(!(f<=p&&f>=u))return!1;g="".concat(f,"-").concat(p)}}a.push(g)}return a.join(":")}}],(i=null)&&t(s.prototype,i),r&&t(s,r),e}();e.Channel=s}()}),require.register("subspace-client/Socket.js",function(e,s,i){s=t(s,{},"subspace-client"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Socket=void 0;var t=s("./Channel");function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,s){return e&&r(t.prototype,e),s&&r(t,s),t}var n=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=t,t.binaryType="arraybuffer",this.data={},this.listenerCount={},this.openQueue=[],this._onSend=[]}return a(e,null,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.sockets||(this.sockets={}),!e&&this.sockets[t]||(this.sockets[t]=new this(new WebSocket(t))),this.sockets[t]}}]),a(e,[{key:"subscribe",value:function(e,s,r){var a=e.split(":"),n=a.shift(),o=a.join(":");s instanceof Function&&(r=s,s=o),o&&(o in this.listenerCount||(this.listenerCount[o]=0),this.listenerCount[o]++,this.send("sub ".concat(o)));var l=function(e,s,r,a){return function(n){var o={};try{if("string"==typeof n.data)o=JSON.parse(n.data);else if(n.data instanceof ArrayBuffer){var l=new Uint16Array(n.data,4,1)[0];if(!s||t.Channel.compareNames(s,l))return void a(n,n.data.slice(6),l,new Uint16Array(n.data,0,1)[0]?"user":"server",new Uint16Array(n.data,2,1)[0],null,{})}else if("message"!==e)return void a(n)}catch(t){return void("message"!==e&&a(n))}"object"===i(o)?(s||a(n,o.message,null,o.origin,o.originId,null,o),s&&"channel"in o&&t.Channel.compareNames(s,o.channel)&&a(n,o.message,o.channel,o.origin,o.originId,o.originalChannel,o)):""===r&&a(n,n.data,null,"server",0,null,o)}}(n,s,o,r);return this.socket.addEventListener(n,l),l}},{key:"unsubscribe",value:function(t,e){var s=t.split(":"),i=s.shift(),r=s.join(":");r&&(this.listenerCount[r]--,r in this.listenerCount&&this.listenerCount[r]>0||(this.socket.removeEventListener(i,e),this.send("unsub ".concat(r))))}},{key:"publish",value:function(t,e){if(t==parseInt(t)){e instanceof ArrayBuffer?e=new Uint8Array(e):e.byteLength?e=new Uint8Array(e.buffer):Array.isArray(e)||(e=[e]);var s=new Uint8Array(new Uint16Array([t]).buffer),i=new Uint8Array(s.byteLength+e.byteLength);return i.set(s,0),i.set(e,s.byteLength),void this.send(i)}this.send("pub ".concat(t," ").concat(e))}},{key:"say",value:function(t,e,s){var i=[],r=[];if(Array.isArray(e)?Object.assign(i,e):(e.cc||e.bcc)&&(Array.isArray(e.cc)&&Object.assign(i,e.cc),Array.isArray(e.bcc)&&Object.assign(r,e.bcc)),!i&&!r){var a="CANNOT STRINGIFY USERLIST";try{a=JSON.stringify(e)}catch(t){userlistString+=" "+t.message}throw error("Invalid userlist provided:"+a)}var n=i.length?"".concat(i.length," ").concat(i.join(" ")):"0",o=r.length?"".concat(r.length," ").concat(r.join(" ")):"0";this.send("say ".concat(t," ").concat(n," ").concat(o," ").concat(s))}},{key:"send",value:function(t){var e=this;if(this.socket.readyState!==this.socket.OPEN)return new Promise(function(s,i){var r,a=(r=a,function(t){for(;e.openQueue.length;){var i=e.openQueue.shift();e.send(i)}e.socket.removeEventListener("open",r),s()});e.socket.addEventListener("open",a),e.openQueue.unshift(t)});for(var s in this._onSend)this._onSend[s](t);return this.socket.send(t),Promise.resolve()}},{key:"onSend",value:function(t){this._onSend.push(t)}},{key:"close",value:function(t){this.socket.close()}},{key:"ping",value:function(){}},{key:"pong",value:function(){}}]),e}();e.Socket=n}()}),require.register("subspace-console/Console.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Console=void 0;var t=s("curvature/base/View"),i=s("curvature/base/Bag"),r=s("./view/MeltingText"),a=s("./view/EchoMessage"),n=s("./Task"),o=s("./Path"),l=s("./ansi/Renderer"),h=s("./ansi/Parser");function g(t,e,s){return(g=y()?Reflect.construct:function(t,e,s){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return s&&m(r,s.prototype),r}).apply(null,arguments)}function c(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(t){if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function f(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=y();return function(){var s,i=b(t);if(e){var r=b(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return function(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,s)}}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(S,t.View);var s,p,y,b=v(S);function S(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,S),t=b.call(this,s);var r={init:!1,path:o.Path},a=Object.assign({},r,e);return t.template='<div class = "terminal [[inverted]]" cv-on = "click:focus(event)">\n\t<div class = "output" cv-each = "output:line:l" cv-ref = "output:curvature/base/Tag">\n\t\t<p>[[line]]</p>\n\t</div>\n\t<div class = "bottom">\n\t\t<div>[[prompt]]&nbsp;</div>\n\t\t<div>\n\t\t\t<form cv-on = "submit:cancel(event)">\n\t\t\t\t<textarea\n\t\t\t\t\tcv-bind = "input"\n\t\t\t\t\tcv-on   = ":keydown(event);:keyup(event)"\n\t\t\t\t\tcv-ref  = "input:curvature/base/Tag"\n\t\t\t\t\trow     = "1"\n\t\t\t\t></textarea>\n\t\t\t</form>\n\n\t\t\t<form cv-on = "submit:cancel(event)">\n\t\t\t\t<input\n\t\t\t\t\tautocomplete = "one-time-code"\n\t\t\t\t\tname    = "pw-input"\n\t\t\t\t\ttype    = "password"\n\t\t\t\t\tcv-bind = "input"\n\t\t\t\t\tcv-ref  = "password:curvature/base/Tag"\n\t\t\t\t\tcv-on   = ":keydown(event,false);:keyup(event,false)"\n\t\t\t\t/>\n\t\t\t</form>\n\n\t\t\t<input\n\t\t\t\tcv-on  = "input:fileLoaded(event)"\n\t\t\t\tcv-ref = "file:curvature/base/Tag"\n\t\t\t\tname   = "file-input"\n\t\t\t\ttype   = "file"\n\t\t\t\tstyle  = "display: none"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</div>\n\n<div class = "scanlines"></div>\n',t.args.input="",t.args.output=[],t.args.inverted="",t.localEcho=!0,t.postToken=null,t.args.prompt="::",t.routes={},t.args.passwordMode=!1,t.tasks=[],t.external=e.external||[],t.taskList=new i.Bag,t.taskList.type=n.Task,t.max=10,t.historyCursor=-1,t.history=[],t.env=new Map,t.args.output.___after(function(e,s,i,r){"push"===s&&t.onNextFrame(function(){return t.scrollToBottom()})}),a.init&&t.runScript(a.init),t.scroller=a.scroller||document.body,t.path=a.path||{},t.originalInput="",t}return s=S,(p=[{key:"runCommand",value:function(t){var e=this;return 0!=this.historyCursor&&this.history.unshift(t),new Promise(function(s){var i;if("/"===t.substring(0,1)){if(!e.args.passwordMode){var r=new a.EchoMessage({message:t});e.args.output.push(r)}var o=e.unescape(t.substr(1));i=e.interpret(o)}else if(e.tasks.length){if(!e.args.passwordMode){var l=new a.EchoMessage({message:t,prompt:e.tasks[0].prompt});e.args.output.push(l)}var h=e.unescape(t);i=e.tasks[0].write(h)||Promise.resolve()}else{e.args.passwordMode||e.args.output.push(":: ".concat(t));var g=e.unescape(t);i=e.interpret(g)}i instanceof n.Task||i instanceof Promise||(i=Promise.resolve(i)),e.historyCursor=-1,e.originalInput=e.args.input="",i.then(function(t){return s(t)})}).catch(function(t){e.args.output.push("Unexpected error: ".concat(t))})}},{key:"runScript",value:function(t){var e=this;fetch(t+"?api=txt").then(function(t){return t.text()}).then(function(t){!function t(s){if(s.length){var i=s.shift();i&&"!"==i[0]?(e.args.output.push(i.substring(1)),t(s)):i?e.runCommand(i).then(function(){return t(s)}):t(s)}}(t.split("\n"))})}},{key:"postRender",value:function(){var t=this,e=this.tags.input.element,s=this.tags.password.element;this.args.bindTo("input",function(t){e.style.height="auto",e.style.height=e.scrollHeight+"px"},{frame:1}),this.args.bindTo("passwordMode",function(t){t?(e.style.display="none",s.style.display="unset"):(e.style.display="unset",s.style.display="none")}),this.args.bindTo("passwordMode",function(e){t.focus(null,e)},{frame:1})}},{key:"focus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&t.preventDefault(),t&&t.target&&t.target.matches("input,textarea")||window.getSelection().toString()||(e||this.args.passwordMode?this.tags.password.element.focus():this.tags.input.element.focus())}},{key:"interpret",value:function(t){var e=this;this.historyCursor=-1;var s,i=null,r=function(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=u(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n=!0,o=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return n=t.done,t},e:function(t){o=!0,a=t},f:function(){try{n||null==s.return||s.return()}finally{if(o)throw a}}}}(t.split(/\s*\;\s*/));try{var a=function(){var t=s.value,r=e.pipe(t.split(/\s*\|\s*/));if(r){e.tasks.unshift(r);var a=function(t){var s=t.detail;if("object"===d(s))e.args.output.push(s);else{var i=r.outPrompt||r.prompt||e.args.prompt||"::",a=e.parseAnsi(s,i);e.args.output.push(a)}},n=function(t){console.error(t);var s=t.detail,i=r.errorPrompt||"!!",a=e.parseAnsi(s,i);e.args.output.push(a)};r.addEventListener("output",a),r.addEventListener("error",n),r.execute(),r.catch(function(t){return console.error(t)}),r.catch(function(t){return e.args.output.push("!! ".concat(t))}),e.args.prompt=r.prompt,r.finally(function(t){r.removeEventListener("error",n),r.removeEventListener("output",a),e.tasks.shift(),e.tasks.length?e.args.prompt=e.tasks[0].prompt:e.args.prompt="::"})}i=r};for(r.s();!(s=r.n()).done;)a()}catch(t){r.e(t)}finally{r.f()}return i}},{key:"pipe",value:function(t,e){var s=null,i=t.shift().trim().split(" "),a=i.shift().trim();if(!(a.length>1&&"?"==a.substr(-1))){if(a in this.path)s=g(this.path[a],[i,e,this].concat(c(this.external)));else switch(a){case"clear":this.args.output.splice(0);break;case"z":this.args.output.splice(0),this.args.output.push(new r.MeltingText({input:"!!!"}));break;case"commands":case"?":for(var n in this.args.output.push("   Subspace Console 0.29a 2018-2021 Sean Morris"),this.path)this.args.output.push(" * ".concat(n," - ").concat(this.path[n].helpText)),this.path[n].useText&&this.args.output.push("   ".concat(this.path[n].useText)),this.args.output.push("  ");break;default:this.args.output.push("!! Bad command: ".concat(a))}return t.length?this.pipe(t,s):s}(a=a.substr(0,a.length-1))in this.path&&(this.args.output.push("?? ".concat(this.path[a].helpText)),this.args.output.push("?? ".concat(this.path[a].useText)))}},{key:"keydown",value:function(t,e){switch(t.key){case"Tab":if(e)break;t.preventDefault();break;case"Enter":t.ctrlKey||t.preventDefault()}}},{key:"keyup",value:function(t,e){var s=this;switch(t.key){case"ArrowDown":if(this.historyCursor--,this.historyCursor<=-1)return this.historyCursor=-1,void(this.args.input=this.originalInput);this.args.input=this.history[this.historyCursor],this.onNextFrame(function(){var t=s.tags.input.element;t.selectionStart=t.value.length,t.selectionEnd=t.value.length});break;case"ArrowUp":if(-1==this.historyCursor&&(this.originalInput=this.args.input),this.historyCursor++,this.historyCursor>=this.history.length)return void this.historyCursor--;this.args.input=this.history[this.historyCursor],this.onNextFrame(function(){var t=s.tags.input.element;t.selectionStart=t.value.length,t.selectionEnd=t.value.length});break;case"Escape":this.tasks.length&&(this.tasks[0].finally(function(){return s.args.output.push(":: Killed.")}),this.tasks[0].signal(n.Task.KILL)),this.args.passwordMode=!1;break;case"Tab":if(t.preventDefault(),!this.args.input)break;var i=this.args.input,r="";if("/"===this.args.input[0]){i=this.args.input.substr(1),r=this.args.input.substr(0,1);break}for(var a in this.path)if(!(a.length<i.length)&&i===a.substr(0,i.length)){this.args.input=r+a;break}break;case"Enter":if(t.ctrlKey)return;t.preventDefault(),this.runCommand(this.args.input),this.args.input="";break;default:this.historyCursor=-1,this.scrollToBottom()}}},{key:"cancel",value:function(t){t.preventDefault(),t.stopPropagation()}},{key:"scrollToBottom",value:function(){var t=(this.scroller===document.body?window:this.scroller)||window,e=this.scroller.scrollHeight;this.onNextFrame(function(){t.scrollTo({behavior:"smooth",left:0,top:e})})}},{key:"parseAnsi",value:function(e,s){e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var i=new l.Renderer,r=h.Parser.parse(e),a=i.process(r);if(!s)return t.View.from('<span class ="ansi">'.concat(a,"</span>"));var n=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");return t.View.from("".concat(n,' <span class ="ansi">').concat(a,"</span>"))}},{key:"unescape",value:function(t){return t.replace(/\\n/gm,"\n").replace(/\\r/gm,"\r").replace(/\\t/gm,"\t").replace(/\\e/gm,"").replace(/\\u001b/gm,"")}},{key:"write",value:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];for(var i=0,r=e;i<r.length;i++){var a=r[i];if("string"!=typeof a)this.args.output.push(a);else{var n=this.unescape(a),o=this.parseAnsi(n);this.args.output.push(o)}}}}])&&f(s.prototype,p),y&&f(s,y),S}();e.Console=S}()}),require.register("subspace-console/Path.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Path=void 0;s("subspace-console/Task");e.Path={}}()}),require.register("subspace-console/Task.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Task=void 0;s("curvature/base/Bindable");var i=s("curvature/base/Mixin"),a=s("./mixin/Target"),n=s("./mixin/TaskSignals");function o(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function h(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,i=p(t);if(e){var r=p(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return d(this,s)}}function d(e,s){return!s||"object"!==t(s)&&"function"!=typeof s?u(e):s}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var m=0,v=(Symbol("target"),Symbol("accept")),y=Symbol("reject"),b=Symbol("execute"),S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(S,i.Mixin["with"](a.Target,n.TaskSignals));var e,s,l,p=c(S);function S(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,S),f(u(t=p.call(this)),"title","Generic Task"),f(u(t),"prompt","::"),t.args=e,t.prev=s,t.term=i,t.status=-1,t.thread=new Promise(function(e,s){t[v]=e,t[y]=s}),t.id=m++,d(t,u(t))}return e=S,(s=[{key:"then",value:function(t){return this.thread.then(t)}},{key:"catch",value:function(t){return this.thread.catch(t)}},{key:"finally",value:function(t){return this.thread.finally(t)}},{key:"print",value:function(t){this.dispatchEvent(new CustomEvent("output",{detail:t}))}},{key:"printErr",value:function(t){this.dispatchEvent(new CustomEvent("error",{detail:t}))}},{key:"write",value:function(t){return this.main(t)}},{key:"signal",value:function(t){switch(this["signal::".concat(t)]&&this["signal::".concat(t)](),t){case"close":this.dispatchEvent(new CustomEvent("close"))&&(this.status>0?this[y]():this[v]());break;case"kill":this.status>0?this[y]():this[v]()}}},{key:"execute",value:function(){return this[b](this.prev)}},{key:b,value:function(){var t=this,e=function(e){var s=e.detail;return t.write(s)},s=this.init.apply(this,o(this.args)),i=this.prev;return i&&i.addEventListener("output",e),s instanceof Promise||(s=Promise.resolve(s)),i?(i[b](),Promise.allSettled([i,s]).finally(function(){return i.then(function(e){return t[v](e)}),i.catch(function(e){return t[y](r)}),i.removeEventListener("output",e),t.done()})):Promise.allSettled([s]).then(function(e){try{t.main(void 0),t[v]()}catch(e){t[y]()}t.done()})}},{key:"init",value:function(){}},{key:"main",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"done",value:function(t){return this.status}}])&&h(e.prototype,s),l&&h(e,l),S}();e.Task=S}()}),require.register("subspace-console/ansi/Colors255.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Colors255=void 0;e.Colors255={0:{r:0,g:0,b:0},1:{r:128,g:0,b:0},2:{r:0,g:128,b:0},3:{r:128,g:128,b:0},4:{r:0,g:0,b:128},5:{r:128,g:0,b:128},6:{r:0,g:128,b:128},7:{r:192,g:192,b:192},8:{r:128,g:128,b:128},9:{r:255,g:0,b:0},10:{r:0,g:255,b:0},11:{r:255,g:255,b:0},12:{r:0,g:0,b:255},13:{r:255,g:0,b:255},14:{r:0,g:255,b:255},15:{r:255,g:255,b:255},16:{r:0,g:0,b:0},17:{r:0,g:0,b:95},18:{r:0,g:0,b:135},19:{r:0,g:0,b:175},20:{r:0,g:0,b:215},21:{r:0,g:0,b:255},22:{r:0,g:95,b:0},23:{r:0,g:95,b:95},24:{r:0,g:95,b:135},25:{r:0,g:95,b:175},26:{r:0,g:95,b:215},27:{r:0,g:95,b:255},28:{r:0,g:135,b:0},29:{r:0,g:135,b:95},30:{r:0,g:135,b:135},31:{r:0,g:135,b:175},32:{r:0,g:135,b:215},33:{r:0,g:135,b:255},34:{r:0,g:175,b:0},35:{r:0,g:175,b:95},36:{r:0,g:175,b:135},37:{r:0,g:175,b:175},38:{r:0,g:175,b:215},39:{r:0,g:175,b:255},40:{r:0,g:215,b:0},41:{r:0,g:215,b:95},42:{r:0,g:215,b:135},43:{r:0,g:215,b:175},44:{r:0,g:215,b:215},45:{r:0,g:215,b:255},46:{r:0,g:255,b:0},47:{r:0,g:255,b:95},48:{r:0,g:255,b:135},49:{r:0,g:255,b:175},50:{r:0,g:255,b:215},51:{r:0,g:255,b:255},52:{r:95,g:0,b:0},53:{r:95,g:0,b:95},54:{r:95,g:0,b:135},55:{r:95,g:0,b:175},56:{r:95,g:0,b:215},57:{r:95,g:0,b:255},58:{r:95,g:95,b:0},59:{r:95,g:95,b:95},60:{r:95,g:95,b:135},61:{r:95,g:95,b:175},62:{r:95,g:95,b:215},63:{r:95,g:95,b:255},64:{r:95,g:135,b:0},65:{r:95,g:135,b:95},66:{r:95,g:135,b:135},67:{r:95,g:135,b:175},68:{r:95,g:135,b:215},69:{r:95,g:135,b:255},70:{r:95,g:175,b:0},71:{r:95,g:175,b:95},72:{r:95,g:175,b:135},73:{r:95,g:175,b:175},74:{r:95,g:175,b:215},75:{r:95,g:175,b:255},76:{r:95,g:215,b:0},77:{r:95,g:215,b:95},78:{r:95,g:215,b:135},79:{r:95,g:215,b:175},80:{r:95,g:215,b:215},81:{r:95,g:215,b:255},82:{r:95,g:255,b:0},83:{r:95,g:255,b:95},84:{r:95,g:255,b:135},85:{r:95,g:255,b:175},86:{r:95,g:255,b:215},87:{r:95,g:255,b:255},88:{r:135,g:0,b:0},89:{r:135,g:0,b:95},90:{r:135,g:0,b:135},91:{r:135,g:0,b:175},92:{r:135,g:0,b:215},93:{r:135,g:0,b:255},94:{r:135,g:95,b:0},95:{r:135,g:95,b:95},96:{r:135,g:95,b:135},97:{r:135,g:95,b:175},98:{r:135,g:95,b:215},99:{r:135,g:95,b:255},100:{r:135,g:135,b:0},101:{r:135,g:135,b:95},102:{r:135,g:135,b:135},103:{r:135,g:135,b:175},104:{r:135,g:135,b:215},105:{r:135,g:135,b:255},106:{r:135,g:175,b:0},107:{r:135,g:175,b:95},108:{r:135,g:175,b:135},109:{r:135,g:175,b:175},110:{r:135,g:175,b:215},111:{r:135,g:175,b:255},112:{r:135,g:215,b:0},113:{r:135,g:215,b:95},114:{r:135,g:215,b:135},115:{r:135,g:215,b:175},116:{r:135,g:215,b:215},117:{r:135,g:215,b:255},118:{r:135,g:255,b:0},119:{r:135,g:255,b:95},120:{r:135,g:255,b:135},121:{r:135,g:255,b:175},122:{r:135,g:255,b:215},123:{r:135,g:255,b:255},124:{r:175,g:0,b:0},125:{r:175,g:0,b:95},126:{r:175,g:0,b:135},127:{r:175,g:0,b:175},128:{r:175,g:0,b:215},129:{r:175,g:0,b:255},130:{r:175,g:95,b:0},131:{r:175,g:95,b:95},132:{r:175,g:95,b:135},133:{r:175,g:95,b:175},134:{r:175,g:95,b:215},135:{r:175,g:95,b:255},136:{r:175,g:135,b:0},137:{r:175,g:135,b:95},138:{r:175,g:135,b:135},139:{r:175,g:135,b:175},140:{r:175,g:135,b:215},141:{r:175,g:135,b:255},142:{r:175,g:175,b:0},143:{r:175,g:175,b:95},144:{r:175,g:175,b:135},145:{r:175,g:175,b:175},146:{r:175,g:175,b:215},147:{r:175,g:175,b:255},148:{r:175,g:215,b:0},149:{r:175,g:215,b:95},150:{r:175,g:215,b:135},151:{r:175,g:215,b:175},152:{r:175,g:215,b:215},153:{r:175,g:215,b:255},154:{r:175,g:255,b:0},155:{r:175,g:255,b:95},156:{r:175,g:255,b:135},157:{r:175,g:255,b:175},158:{r:175,g:255,b:215},159:{r:175,g:255,b:255},160:{r:215,g:0,b:0},161:{r:215,g:0,b:95},162:{r:215,g:0,b:135},163:{r:215,g:0,b:175},164:{r:215,g:0,b:215},165:{r:215,g:0,b:255},166:{r:215,g:95,b:0},167:{r:215,g:95,b:95},168:{r:215,g:95,b:135},169:{r:215,g:95,b:175},170:{r:215,g:95,b:215},171:{r:215,g:95,b:255},172:{r:215,g:135,b:0},173:{r:215,g:135,b:95},174:{r:215,g:135,b:135},175:{r:215,g:135,b:175},176:{r:215,g:135,b:215},177:{r:215,g:135,b:255},178:{r:215,g:175,b:0},179:{r:215,g:175,b:95},180:{r:215,g:175,b:135},181:{r:215,g:175,b:175},182:{r:215,g:175,b:215},183:{r:215,g:175,b:255},184:{r:215,g:215,b:0},185:{r:215,g:215,b:95},186:{r:215,g:215,b:135},187:{r:215,g:215,b:175},188:{r:215,g:215,b:215},189:{r:215,g:215,b:255},190:{r:215,g:255,b:0},191:{r:215,g:255,b:95},192:{r:215,g:255,b:135},193:{r:215,g:255,b:175},194:{r:215,g:255,b:215},195:{r:215,g:255,b:255},196:{r:255,g:0,b:0},197:{r:255,g:0,b:95},198:{r:255,g:0,b:135},199:{r:255,g:0,b:175},200:{r:255,g:0,b:215},201:{r:255,g:0,b:255},202:{r:255,g:95,b:0},203:{r:255,g:95,b:95},204:{r:255,g:95,b:135},205:{r:255,g:95,b:175},206:{r:255,g:95,b:215},207:{r:255,g:95,b:255},208:{r:255,g:135,b:0},209:{r:255,g:135,b:95},210:{r:255,g:135,b:135},211:{r:255,g:135,b:175},212:{r:255,g:135,b:215},213:{r:255,g:135,b:255},214:{r:255,g:175,b:0},215:{r:255,g:175,b:95},216:{r:255,g:175,b:135},217:{r:255,g:175,b:175},218:{r:255,g:175,b:215},219:{r:255,g:175,b:255},220:{r:255,g:215,b:0},221:{r:255,g:215,b:95},222:{r:255,g:215,b:135},223:{r:255,g:215,b:175},224:{r:255,g:215,b:215},225:{r:255,g:215,b:255},226:{r:255,g:255,b:0},227:{r:255,g:255,b:95},228:{r:255,g:255,b:135},229:{r:255,g:255,b:175},230:{r:255,g:255,b:215},231:{r:255,g:255,b:255},232:{r:8,g:8,b:8},233:{r:18,g:18,b:18},234:{r:28,g:28,b:28},235:{r:38,g:38,b:38},236:{r:48,g:48,b:48},237:{r:58,g:58,b:58},238:{r:68,g:68,b:68},239:{r:78,g:78,b:78},240:{r:88,g:88,b:88},241:{r:98,g:98,b:98},242:{r:108,g:108,b:108},243:{r:118,g:118,b:118},244:{r:128,g:128,b:128},245:{r:138,g:138,b:138},246:{r:148,g:148,b:148},247:{r:158,g:158,b:158},248:{r:168,g:168,b:168},249:{r:178,g:178,b:178},250:{r:188,g:188,b:188},251:{r:198,g:198,b:198},252:{r:208,g:208,b:208},253:{r:218,g:218,b:218},254:{r:228,g:228,b:228},255:{r:238,g:238,b:238}}}()}),require.register("subspace-console/ansi/Parser.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var t=s("sixgram/Actions"),i=s("sixgram/Parser"),r={normal:{reset:[t.IGNORE,t.ENTER,t.LEAVE],escaped:[t.IGNORE,t.ENTER,t.LEAVE],graphics:[t.IGNORE,t.ENTER,t.LEAVE],characters:[t.INSERT]}},a=new i.Parser({reset:/\u001b\[(0);?m/,graphics:/\u001b\[(\d+);?(\d+)?;?([\d;]*)?./,escaped:/\\([^e])/,characters:/[\s\S]+?(?=\x1B|$)/},r);e.Parser=a}()}),require.register("subspace-console/ansi/Renderer.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var t=s("sixgram/Renderer"),i=s("./pallete"),r=s("./Colors255");function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==s)return;var i,r,a=[],n=!0,o=!1;try{for(s=s.call(t);!(n=(i=s.next()).done)&&(a.push(i.value),!e||a.length!==e);n=!0);}catch(t){o=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}return a}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function l(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var s,i=d(t);if(e){var r=d(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return function(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;return c(t)}(this,s)}}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u="function"==typeof window.AudioContext&&new window.AudioContext;if(u){var p=u.createGain();p.connect(u.destination),p.gain.value=.1}var f=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(f,t.Renderer);var s,o,d,p=g(f);function f(){var t,e,s,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),t=p.call(this,{normal:function(e,s){return t.setGraphicsMode(e,s)}}),e=c(t),i={},(s="style")in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i,t}return s=f,(o=[{key:"reset",value:function(){for(var t=0,e=Object.entries(this.style);t<e.length;t++){var s=n(e[t],1)[0];delete this.style[s]}}},{key:"beep",value:function(){if(u){var t=u.createOscillator();t.connect(gainNode),t.frequency.value=840,t.type="square",t.start(u.currentTime),t.stop(u.currentTime+.2)}}},{key:"setGraphicsMode",value:function(t,e){if("string"==typeof t){if(""===t)return!1;for(var s="",o=0,l=Object.entries(this.style);o<l.length;o++){var h=n(l[o],2),g=h[0],c=h[1];s+="".concat(g,": ").concat(c,"; ")}return'<span class = "ansi" style = "'.concat(s,'">').concat(t,"</span>")}if("object"===a(t)){if("escaped"===t.type&&"a"===t.groups[0]&&this.beep(),"graphics"===t.type||"reset"===t.type)for(var d=0;d<t.groups.length;d++){var u=Number(t.groups[d]);if(""===t.groups[d])return!1;switch(u){case 0:for(var p in this.style)delete this.style[p];break;case 1:this.style.filter="contrast(1.25)",this.style["font-weight"]="bold",this.style.opacity=1;break;case 2:this.style.filter="brightness(0.85)",this.style["font-weight"]="light",this.style.opacity=.75;break;case 3:this.style["font-style"]="italic";break;case 4:this.style["text-decoration"]="underline";break;case 5:this.style.animation="var(--ansiBlink)";break;case 7:this.style.filter="invert(1)";break;case 8:this.style.filter="contrast(0.5)",this.style.opacity=.1;break;case 9:this.style["text-decoration"]="line-through";break;case 10:this.style["font-family"]="var(--base-font))";break;case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:this.style["font-family"]="var(--alt-font-no-".concat(u,")");break;case 20:this.style["font-family"]="var(--alt-font-fraktur)",this.style["font-size"]="1.1rem";break;case 21:case 22:this.style["font-weight"]="initial";break;case 23:this.style["font-weight"]="initial",this.style["font-style"]="initial";break;case 24:this.style["text-decoration"]="none",this.style["font-family"]="sans-serif",this.style["font-size"]="12pt";break;case 25:this.style.animation="none";break;case 26:this.style["text-transform"]="full-width";break;case 27:this.style.filter="initial";break;case 28:this.style.opacity="initial";break;case 29:this.style["text-decoration"]="initial";break;case 30:this.style.color=i.pallete.black;break;case 31:this.style.color=i.pallete.red;break;case 32:this.style.color=i.pallete.green;break;case 33:this.style.color=i.pallete.yellow;break;case 34:this.style.color=i.pallete.blue;break;case 35:this.style.color=i.pallete.magenta;break;case 36:this.style.color=i.pallete.cyan;break;case 37:this.style.color=i.pallete.white;break;case 38:if(2==t.groups[1+d]){var f=n(t.groups[2+d].split(";"),3),m=f[0],v=f[1],y=f[2];this.style.color="rgb(".concat(m,",").concat(v,",").concat(y,")")}if(5==t.groups[1+d]){var b=r.Colors255[Number(t.groups[2+d])],S=b.r,w=b.g,x=b.b;this.style.color="rgb(".concat(S,",").concat(w,",").concat(x,")")}d+=2;break;case 39:this.style.color="var(--fgColor)";break;case 40:this.style["background-color"]=i.pallete.black;break;case 41:this.style["background-color"]=i.pallete.red;break;case 42:this.style["background-color"]=i.pallete.green;break;case 43:this.style["background-color"]=i.pallete.yellow;break;case 44:this.style["background-color"]=i.pallete.blue;break;case 45:this.style["background-color"]=i.pallete.magenta;break;case 46:this.style["background-color"]=i.pallete.cyan;break;case 47:this.style["background-color"]=i.pallete.white;break;case 48:if(2==t.groups[1+d]){var k=n(t.groups[2+d].split(";"),3),M=k[0],P=k[1],C=k[2];this.style["background-color"]="rgb(".concat(M,",").concat(P,",").concat(C,")")}if(5==t.groups[1+d]){var j=r.Colors255[Number(t.groups[2+d])],A=j.r,T=j.g,O=j.b;this.style["background-color"]="rgb(".concat(A,",").concat(T,",").concat(O,")")}d+=2;break;case 49:this.style["background-color"]="var(--bgColor)";break;case 50:this.style["text-transform"]="initial";break;case 51:this.style.border="1px solid currentColor";break;case 52:this.style.border="1px solid currentColor",this.style["border-radius"]="1em";break;case 53:this.style["text-decoration"]="overline";break;case 54:case 55:this.style.border="initial"}}return!1}}}])&&l(s.prototype,o),d&&l(s,d),f}();e.Renderer=f}()}),require.register("subspace-console/ansi/pallete.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pallete=void 0;e.pallete={black:"var(--ansi-black, #000000)",dBlack:"var(--ansi-black-dark, #343434)",bBlack:"var(--ansi-black-light, #888888)",red:"var(--ansi-red, #c0002c)",dRed:"var(--ansi-red-dark, #4a132b)",bRed:"var(--ansi-red-light, #ff7869)",green:"var(--ansi-green, #80a763)",dGreen:"var(--ansi-green-dark, #326f38)",bGreen:"var(--ansi-green-light, #93d393)",yellow:"var(--ansi-yellow, #e3c651)",dYellow:"var(--ansi-yellow-dark, #baa447)",bYellow:"var(--ansi-yellow-light, #fdc253)",blue:"var(--ansi-blue, #5485c0)",dBlue:"var(--ansi-blue-dark, #38577d)",bBlue:"var(--ansi-blue-light, #77aff2)",magenta:"var(--ansi-magenta, #C61B6E)",dMagenta:"var(--ansi-magenta-dark, #935894)",bMagenta:"var(--ansi-magenta-light, #bf83c0)",cyan:"var(--ansi-cyan, #57c2c0)",dCyan:"var(--ansi-cyan-dark, #2d5695)",bCyan:"var(--ansi-cyan-light, #cef6f5)",white:"var(--ansi-cyan, #e0e0e0)",dWhite:"var(--ansi-cyan-dark, #b0b0b0)",bWhite:"var(--ansi-cyan-light, #ffffff)"}}()}),require.register("subspace-console/mixin/Target.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var t,i=s("curvature/base/Mixin");function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var a=Symbol("target"),n=0,o=(r(t={},i.Mixin.Constructor,function(){try{this[a]=new EventTarget}catch(t){this[a]=document.createDocumentFragment()}this[a].x=n++}),r(t,"dispatchEvent",function(){var t;(t=this[a]).dispatchEvent.apply(t,arguments)}),r(t,"addEventListener",function(){var t;(t=this[a]).addEventListener.apply(t,arguments)}),r(t,"removeEventListener",function(){var t;(t=this[a]).removeEventListener.apply(t,arguments)}),t);e.Target=o}()}),require.register("subspace-console/mixin/TaskSignals.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(e,"__esModule",{value:!0}),e.TaskSignals=void 0;var i=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var s,i,r;return s=e,(i=[{key:"signal::kill",value:function(){console.log("KILL!"),this.status>0?this[Reject]():this[Accept]()}},{key:"signal::close",value:function(){this.dispatchEvent(new CustomEvent("error",{detail:detail}))&&(this.status>0?this[Reject]():this[Accept]())}}])&&t(s.prototype,i),r&&t(s,r),e}();e.TaskSignals=i,s(i,"KILL","kill"),s(i,"CLOSE","close")}()}),require.register("subspace-console/view/EchoMessage.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.EchoMessage=void 0;var i=s("curvature/base/View");function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=n(e);if(s){var a=n(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,i)}}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}(s,i.View);var e=a(s);function s(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=e.call(this,i)).args.prompt=t.args.prompt||"<<",t.template='<span>[[prompt]]&nbsp;</span><span class = "text">[[message]]</span>',t}return s}();e.EchoMessage=o}()}),require.register("subspace-console/view/MeltingText.js",function(e,s,i){s=t(s,{},"subspace-console"),function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.MeltingText=void 0;var i=s("curvature/base/View");function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function n(e){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,r=o(e);if(s){var a=o(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return function(e,s){if(s&&("object"===t(s)||"function"==typeof s))return s;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,i)}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(h,i.View);var e,s,o,l=n(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=l.call(this,t)).last=e.init=Date.now(),e.charUp=["","",""],e.charMid=["","","","","","","","","","","","","","","","","","","","",""],e.charDown=["","","",""],e.template='\n\t\t\t<div cv-bind = "output" class = "melting"></div>\n\t\t',e.args.input="Magic is no more than the art of employing consciously invisible means to produce visible effects. Will, love, and imagination are magic powers that everyone possesses; and whoever knows how to develop them to their fullest extent is a magician. Magic has but one dogma, namely, that the seen is the measure of the unseen\n",e.args.output="uh.",e.corruptors=[],e.maxMaxCorrupt=25,e.maxCorrupt=0,e.type="",e.onFrame(function(){e.typewriter(e.args.input)}),e.onInterval(64,function(){var t=window.getSelection();t.anchorOffset===t.focusOffset&&t.anchorNode===t.focusNode&&(e.args.output=e.corrupt(e.type))}),e.args.bindTo("input",function(t){e.type="",e.corruptors=[]}),e}return e=h,(s=[{key:"age",value:function(){return this.init-Date.now()}},{key:"lastFrame",value:function(){return this.last-Date.now()}},{key:"corrupt",value:function(t){if(1.15*t.length<this.args.input.length)return this.type;var e=t.split(""),s=function(t){return parseInt(Math.random()*t)};for(var i in s(1024)<256&&this.maxCorrupt<this.maxMaxCorrupt&&(this.maxCorrupt+=5),e)if(this.corruptors[i]=this.corruptors[i]||[],!e[i].match(/\W/)){var r=[this.charDown,this.charMid],a=r[s(r.length)];s(8192)<1&&this.corruptors[i].unshift(a[s(a.length)]),this.corruptors[i].length<this.maxCorrupt&&this.corruptors[i].unshift(a[s(a.length)]),s(2048)<1&&this.maxCorrupt>25&&this.corruptors[i].splice(5*s(5)),this.corruptors[i].push(this.corruptors[i].shift())}for(var n in e)this.corruptors[n]&&(e[n]+=this.corruptors[n].join(""));return e.join("")}},{key:"typewriter",value:function(t){return this.type=this.type||"",this.type===t||(this.type+=t.substr(this.type.length,1),this.onTimeout(150,function(){var t=window.scrollY+window.innerHeight;document.body.scrollHeight>t&&window.scrollTo({top:document.body.scrollHeight,left:0,behavior:"smooth"})}),!1)}}])&&r(e.prototype,s),o&&r(e,o),h}();e.MeltingText=l}()}),require.register("BackdropPalette.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackdropPalette=void 0;var i=e("backdrop/MarbleGarden"),r=e("backdrop/ProtoLabrynth"),a=e("backdrop/Industrial"),n=e("backdrop/MysticCave"),o=e("backdrop/WestSideCloudy"),l=e("backdrop/WestSideDay"),h=e("backdrop/WestSide"),g=e("backdrop/AngelIsland"),c=e("backdrop/Wood"),d=e("backdrop/Underground"),u=e("backdrop/Moon"),p=e("backdrop/SouthRidge"),f=e("backdrop/MushroomHill"),m=e("backdrop/IceCap"),v=e("backdrop/City"),y=e("backdrop/DarkClouds"),b=e("backdrop/Overcast"),S=e("backdrop/ScrapBrainDark"),w=e("backdrop/PhazonMines"),x=e("backdrop/Desert");const k={"west-side-cloudy":o.WestSideCloudy,"west-side-day":l.WestSideDay,"west-side":h.WestSide,"angel-island":g.AngelIsland,wood:c.Wood,moon:u.Moon,"south-ridge":p.SouthRidge,"proto-labrynth":r.ProtoLabrynth,"marble-garden":i.MarbleGarden,industrial:a.Industrial,"mystic-cave":n.MysticCave,underground:d.Underground,"mushroom-hill":f.MushroomHill,"ice-cap":m.IceCap,city:v.City,"dark-clouds":y.DarkClouds,overcast:b.Overcast,"scrap-brain-dark":S.ScrapBrainDark,"phazon-mines":w.PhazonMines,desert:x.Desert};t.BackdropPalette=k}),require.register("Classifier.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Classifier=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/mixin/EventTargetMixin");t.Classifier=class extends(i.Mixin.with(r.EventTargetMixin)){constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>e instanceof t;super(),this.compare=e,this.index=new Map,this.reverseIndex=new Map;for(const e in t)this.index.set(t[e],new Set)}add(t){const e=new CustomEvent("adding",{detail:{object:t}});if(!this.dispatchEvent(e))return;this.reverseIndex.has(t)||this.reverseIndex.set(t,new Set);const s=this.reverseIndex.get(t),i=new Set;for(const[e,r]of this.index.entries())this.compare(e,t)&&(i.add(e),s.add(e),r.add(t));const r=new CustomEvent("added",{detail:{object:t,indexes:i}});this.dispatchEvent(r)}remove(t){if(!this.reverseIndex.has(t))return;const e=new CustomEvent("removing",{detail:{object:t}});if(!this.dispatchEvent(e))return;const s=this.reverseIndex.get(t);for(const e of s)this.index.get(e).delete(t),s.delete(e);const i=new CustomEvent("added",{detail:{object:t,reverseIndex:s}});this.dispatchEvent(i)}clear(){this.reverseIndex.clear(),this.index.clear()}get(t){return this.index.get(t)}count(t){return this.index.has(t)&&this.get(t).size}has(t){return!!this.count(t)}}}),require.register("Menu/ButtonSelect.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonSelect=void 0;var i=e("curvature/base/View"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ButtonSelect=class extends i.View{constructor(){super(...arguments),a(this,"template",'<div class = "button-select">[[prompt]] [[_button]] <button cv-on = "click:remove">exit</button></div>'),a(this,"buttons",["","","","","","","","","","","",null,"","","",""])}onRendered(t){this.args.prompt=new r.CharacterString({value:"Select a button!",font:"small-menu-font"}),this.args._button=new r.CharacterString({value:"",font:"small-menu-font"})}input(t){for(const e in t.buttons)e>100||t.buttons[e].pressure&&(this.args._button.args.value=this.buttons[e],this.args.button=e)}}}),require.register("Menu/CharacterPreview.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterPreview=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.CharacterPreview=class extends i.View{constructor(){super(...arguments),r(this,"preserve",!0),r(this,"template",'<div class = "character-preview" data-character = "[[setting]]">\n\t<div class = "character"></div>\n\t<div class = "emeralds" cv-each = "emeralds:emerald">\n\t\t<img style = "--x:[[emerald.x]];--y:[[emerald.y]];" src = "/Sonic/emerald-[[emerald.type|suffix]][[emerald.color]]-mini.png" />\n\t</div>\n\t<div class = "rings"></div>\n\t<div class = "score"></div>\n</div>')}onAttached(){const t="super",e=this.args.emeralds=[{x:0,y:0,type:t,color:"red-alt"},{x:0,y:0,type:t,color:"yellow"},{x:0,y:0,type:t,color:"green"},{x:0,y:0,type:t,color:"cyan"},{x:0,y:0,type:t,color:"white"},{x:0,y:0,type:t,color:"purple"},{x:0,y:0,type:t,color:"pink"}],s=e.length;this.onFrame(()=>{let t=0;if(s)for(const i of e){const e=Date.now()/400,r=t++*(2*Math.PI)/s+e;i.x=Math.cos(r),i.y=Math.sin(r)}})}suffix(t){return t?`${t}-`:""}}}),require.register("Menu/DemoMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DemoMenu=void 0;var i=e("../replay/ReplayDatabase"),r=e("../replay/Replay"),a=e("curvature/base/Router");const n=function(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t.reset(),t.replayFrames=s.getIndexedFrames(),t.replayStart=t.replayFrames.get(i||s.firstFrame)||{},t.replay=s,t.maxReplayFrame=s.lastFrame,t.replayOffset=-1+s.firstFrame+i,a.Router.setQuery("demo",s.uuid),t.loadMap({mapUrl:s.map}).then(()=>{t.args.paused=!0,t.playback()})},o=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i.ReplayDatabase.open("replays",3).then(i=>{const a=r.Replay;let l="id",h=[];t.baseMap&&(l="map-id",h=[[t.baseMap,0],[t.baseMap,1/0]]);const g={store:"replays",index:l,direction:"prev",limit:10,offset:s,type:a,range:h},c={};return s||(c.Import={callback:()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.click(),t.addEventListener("change",t=>{const e=t.target.files;for(const t of e)t.text().then(t=>{const e=JSON.parse(t);delete e.id,delete e.uuid;const s=r.Replay.from(e);delete s.id,i.insert("replays",s)})},{once:!0})}}),i.select(g).each(s=>{const r=s.lastFrame-s.firstFrame,a=`${String(Math.trunc(r/3600)).padStart(1,"0")}:${String(Math.trunc(r/60)%60).padStart(2,"0")}`;let o=`${a}] ${new Date(s.created).toLocaleString("en-US")}`,l=s.map;s.name&&(o=a+"] "+s.name,l=new Date(s.created).toLocaleString("en-US")+" "+s.map),c[o]={subtext:l,color:s.color,children:{Replay:{callback:()=>n(t,e,s)},"Skip to":{children:()=>{const i={};for(const r of s.keyFrames){i[`${String(Math.trunc(r/3600)).padStart(2,"0")}:${String(Math.trunc(r/60)%60).padStart(2,"0")}`]={callback:()=>n(t,e,s,r)}}return console.log(i),i}},Options:{children:{Banners:{input:"boolean",revert:()=>t.args.replayBanners=!0,set:e=>t.args.replayBanners=e,get:()=>t.args.replayBanners},"Quick Exit":{input:"boolean",revert:()=>t.args.replayQuickExit=!1,set:e=>t.args.replayQuickExit=e,get:()=>t.args.replayQuickExit}}},Export:{callback:()=>{const t=new Blob([JSON.stringify(s)],{type:"text/json"}),e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`${s.name||s.uuid}.json`,i.click()}},Rename:{children:{name:{input:"string",set:t=>{s.name=t,i.update("replays",s)},get:()=>s.name},color:{input:"string",set:t=>{s.color=t,i.update("replays",s)},get:()=>s.color}}},Delete:{children:{No:{callback:()=>{e.back(1)}},Yes:{callback:()=>{delete c[o],i.delete("replays",s),e.back(2)}}}}}}}).then(i=>(i.mapped&&(c["Next 10"]={children:()=>o(t,e,s+10)}),c))})},l={subtext:"View error log.",children:o};t.DemoMenu=l}),require.register("Menu/MainMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MainMenu=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/Router"),a=e("../audio/Bgm"),n=(e("../intro/Card"),e("../effects/Cylinder"),e("../effects/Pinch"),e("../effects/Twist"),e("./Menu")),o=(e("./SavestateMenu"),e("./SettingsMenu")),l=(e("../tileMap/TileMap"),e("../ui/CharacterString")),h=e("./CharacterPreview"),g=e("./ZoneSuffix"),c=e("../network/Lobby");function d(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.MainMenu=class extends n.Menu{constructor(t,s){super(t,s),d(this,"template",e("./main-menu.html")),!this.args.initialPath.length&&r.Router.query.menuPath&&(this.args.initialPath=JSON.parse(r.Router.query.menuPath)),this.loggingIn=null,this.args.cardName="main-menu",this.args.haveToken=!1,this.args.listening=!1,this.args.joinGame=!1,this.args.hostGame=!1,this.args.copy="copy",this.font="small-menu-font",this.args.title=new l.CharacterString({font:this.font,value:"Sonic 3000"}),this.args.ok=new l.CharacterString({font:this.font,value:" ok"}),this.args.back=new l.CharacterString({font:this.font,value:" back"}),this.args.revert=new l.CharacterString({font:this.font,value:" default (hold)"}),this.args.select=new l.CharacterString({font:this.font,value:" select"}),this.actsCleared={};const a={input:"select",options:["Sonic","Tails","Knuckles"],locked:["Robotnik","EggRobo","Mecha-Sonic","Seymour","Chalmers","Sean"],default:"Sonic",set:t=>this.parent.args.selectedChar=t,get:()=>this.parent.args.selectedChar||"Sonic"},n=i.Bindable.make({input:"select",tags:"inline",options:[],set:t=>this.parent.args.mainPallet=t,get:()=>{var t;return null!==(t=this.parent.args.mainPallet)&&void 0!==t?t:null}});n.set(this.parent.args.mainPallet||"Normal");const u=i.Bindable.make({Hue:{input:"number",tags:"inline",min:-180,max:180,subtext:"Rotate the color wheel.",revert:()=>s.customColor.h=0,set:t=>s.customColor.h=Number(t).toFixed(2),get:()=>s.customColor.h},Saturation:{input:"number",tags:"inline",min:0,max:2,step:.01,subtext:"Change the amount of color.",revert:()=>s.customColor.s=1,set:t=>s.customColor.s=Number(t).toFixed(2),get:()=>s.customColor.s},Value:{input:"number",tags:"inline",min:0,max:2,step:.01,subtext:"change the brightness.",revert:()=>s.customColor.v=1,set:t=>s.customColor.v=Number(t).toFixed(2),get:()=>s.customColor.v}});this.onRemove(s.args.bindTo("selectedChar",t=>{s.loadSaves().then(()=>{switch(t){case"Sonic":n.options=["Normal","Santiago","Sequel","RedHot","White","Custom"];break;case"Tails":n.options=["SkyCamo","Copper","Patina","Arctic","Custom"];break;case"Knuckles":n.options=["Tails","Enerjak","Pink","Wechnia","Custom"];break;default:n.options=[]}if(t){const e=s.getCharacterState(t);n.options.length=n.options.length?1+Math.min(n.options.length,Object.keys(e.cleared).length):0}else n.options=[];n.options.length?n.available="available":n.available="hidden"})})),this.onRemove(s.args.bindTo("mainPallet",t=>{u.Hue.available=u.Saturation.available=u.Value.available="Custom"!==t?"hidden":"available"})),a.prefix=new h.CharacterPreview(a,this.parent),this.onRemove(()=>a.prefix.remove()),this.items=this.args.items={"Single Player":{available:"available",children:{Character:a,"Brooklyn Breakout Zone Act 1":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/brooklyn-zone.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/brooklyn-zone.json"}),this.accept()}},"Brooklyn Breakout Zone Act 2":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/brooklyn-zone-2.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/brooklyn-zone-2.json"}),this.accept()}},"Manic Harbor Zone Act 1":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/manic-harbor-zone.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/manic-harbor-zone.json"}),this.accept()}},"Manic Harbor Zone Act 2":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/manic-harbor-zone-2.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/manic-harbor-zone-2.json"}),this.accept()}},"Agorapolis Zone Act 1 Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],tags:"new",suffix:new g.ZoneSuffix({map:"/map/emerald-isle.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/emerald-isle.json"}),this.accept()}},"Agorapolis Zone Act 2 Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],tags:"new",suffix:new g.ZoneSuffix({map:"/map/emerald-isle-2.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/emerald-isle-2.json"}),this.accept()}},"Radical City Zone Act 1":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/empty-zone.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/empty-zone.json"}),this.accept()}},"Radical City Zone Act 2":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/empty-zone-2.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/empty-zone-2.json"}),this.accept()}},"Seaview Park Zone Act 1":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/west-side-zone.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/west-side-zone.json"}),this.accept()}},"Seaview Park Zone Act 2":{characters:["Sonic","Tails","Knuckles","Robotnik"],suffix:new g.ZoneSuffix({map:"/map/west-side-zone-2.json"},this.parent),callback:()=>{this.parent.loadMap({mapUrl:"/map/west-side-zone-2.json"}),this.accept()}},"Misty Ruins Zone Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],subtext:"Testing art, layout and physics for Misty Ruins Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/ruins-test.json"}),this.accept()}},"StratoRail Zone Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],subtext:"Testing art for Moon Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/pumpkin-test.json"}),this.accept()}},"Toxin Refinery Zone Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],tags:"new",subtext:"Testing art for Moon Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/chemical-test.json"}),this.accept()}},"Underground Zone Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],subtext:"Testing art, layout and physics for Underground Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/underground-test.json"}),this.accept()}},"Phazon Crater Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],tags:"new",subtext:"Testing art for Phazon Crater Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/phazon-test.json"}),this.accept()}},"Moon Zone Preview":{characters:["Sonic","Tails","Knuckles","Robotnik"],subtext:"Testing art for Moon Zone",callback:()=>{this.parent.loadMap({mapUrl:"/map/moon-test.json"}),this.accept()}}}},Multiplayer:{tags:"",children:{"Matrix Lobby":{tags:"new",callback:()=>{this.refreshConnection(),this.loggingIn?this.parent.matrixConnect():(this.loggingIn=this.parent.matrixConnect(!0),this.loggingIn.finally(()=>this.loggingIn=null),this.loggingIn.then(t=>{const e=new c.Lobby({roomId:this.parent.settings.matrixRoom},this.parent);this.args.override=e,this.args.override.onRemove(()=>{this.args.override=null,this.onNextFrame(()=>this.focusFirst())}),this.onRemove(()=>e.remove())}))}},"Peer to Peer":{children:{"Host a game":{callback:()=>{this.refreshConnection(),this.args.hostOutput="",this.args.hostGame=!0,this.args.copy="copy"}},"Join a game":{callback:()=>{this.refreshConnection(),this.args.joinOutput="",this.args.joinGame=!0,this.args.copy="copy",this.client.fullOffer().then(t=>{const e=JSON.stringify(t),s=`s3ktp://request/${btoa(e)}`;this.args.joinOutput=s,this.args.haveToken=!0})}}}}}},Settings:(0,o.SettingsMenu)(s),Graphics:{input:"select",tags:"inline",options:["High","Medium","Low","Very Low"],set:t=>s.settings.graphicsLevel=t,get:()=>s.settings.graphicsLevel},About:{callback:()=>{window.open("/about.html")}}}}clear(){this.args.input="",this.args.joinOutput="",this.args.hostOutput=""}input(t){super.input(t)}disconnect(){this.server&&this.server.close(),this.client&&this.client.close(),this.server=null,this.client=null,this.parent.args.networked=!1,this.parent.args.chatBox=null,this.args.connected=!1,this.args.hostGame=!1,this.args.joinGame=!1,this.clear()}back(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super.back(t),this.disconnect()}answer(){let t=this.args.input;const e=/^s3ktp:\/\/request\/(.+)/.exec(t);e&&(t=atob(e[1]));const s=JSON.parse(t),i=this.server.fullAnswer(s);return i.then(t=>{const e=JSON.stringify(t),s=`s3ktp://accept/${btoa(e)}`;this.args.hostOutput=s,this.args.haveToken=!0}),i}acceptRtp(){let t=this.args.input;const e=/^s3ktp:\/\/accept\/(.+)/.exec(t);e&&(t=atob(e[1]));const s=JSON.parse(t);this.client.fullAccept(s)}select(){this.args.hostGame?this.tags.hostOutput.select():this.args.joinGame&&this.tags.joinOutput.select()}copy(){if(this.args.hostGame){if(!this.args.input)return;this.tags.hostOutput.select()}else if(this.args.joinGame){if(!this.args.joinOutput)return;this.tags.joinOutput.select()}document.execCommand("copy"),this.args.copy="copied!"}paste(t){navigator.clipboard.readText().then(t=>{this.args.hostGame&&t.match(/^s3ktp:\/\/request\//)&&(this.args.input=t,this.answer().then(t=>{this.copy()})),this.args.joinGame&&t.match(/^s3ktp:\/\/accept\//)&&(this.args.input=t,this.acceptRtp())})}refreshConnection(){this.server=this.parent.getServer(!0),this.client=this.parent.getClient(!0);const t=this.server,e=this.client,s=t=>{console.log("Peer connection opened!"),this.parent.loadMap({mapUrl:"/map/emerald-isle.json",networked:!0}).then(()=>console.log("Level started!"))},i=t=>{this.disconnect(t),this.server&&this.server.peerServer&&"closed"===this.server.peerServer.connectionState&&(console.log({server:this.server}),this.server=null),this.client&&this.client.peerClient&&"closed"===this.client.peerClient.connectionState&&(console.log({client:this.client}),this.client=null)};this.listen(t,"open",s,{once:!0}),this.listen(e,"open",s,{once:!0}),this.listen(t,"close",i,{once:!0}),this.listen(e,"close",i,{once:!0})}play(){super.play(),a.Bgm.play("MENU_THEME",{loop:!0,interlude:!0});const t=this.done;return t.then(()=>this.onTimeout(250,()=>this.remove())),t}}}),require.register("Menu/Menu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=void 0;var i=e("curvature/base/Bindable"),r=e("../intro/Card"),a=(e("../effects/Cylinder"),e("../effects/Pinch"),e("../ui/CharacterString")),n=e("../audio/Sfx");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const l=Symbol("bindings");t.Menu=class extends r.Card{constructor(t,s){t[i.Bindable.NoGetters]=!0,super(t,s),o(this,"template",e("./main-menu.html")),this[i.Bindable.NoGetters]=!0,this.font="small-menu-font",this.args.initialPath=[],this.args.cardName="menu",this.args.items={},this.args.pageLoop=!1,this.args.pageJump=7,this.currentItem=null,this.include="a, button, input, textarea, select, details, [tabindex]",this.exclude='[tabindex="-1"], .hidden',this.elements=new Map,this.onRemove(()=>s.focus())}onRendered(t){this.listen(window,"focus",t=>this.refocus(t)),this.args.bindTo("items",t=>{for(const t in this.args.items){const e=this.args.items[t];e[l]&&[...e[l]].forEach(t=>t())}let e=0;for(const r in t){var s;const o=t[r];o[l]=null!==(s=o[l])&&void 0!==s?s:new Set,o.color=o.color||"var(--default-color)",o._index=e++,o._key=r,o._title=new a.CharacterString({value:r,font:this.font}),o._value=new a.CharacterString({value:"default",font:this.font});const h=t=>{if("boolean"===t.input)t._value.args.value=t.setting?"ON":"OFF",t._boolValue=t._value;else if("number"===t.input){var e;const s=i.Bindable.make(t);t.subType=null!==(e=t.subType)&&void 0!==e?e:"number",t[l].add(s.bindTo("setting",e=>t._value.args.value=e))}else if("string"===t.input);else if("select"===t.input)t._value.args.value=t.setting,t._selectValue=t._value;else if("output"===t.input){const e=i.Bindable.make(t);t[l].add(e.bindTo("setting",e=>t._value.args.value=e)),t[l].add(e.bindTo("setting",console.trace))}const s=i.Bindable.make(t);t[l].add(s.bindTo("setting",e=>t.set&&t.set(e)))};o.watch?o[l].add(o.watch[0].bindTo(o.watch[1],t=>{o.setting=o.watch[2]?o.watch[2](t):t,"number"===o.input&&n.Sfx.play("SWITCH_HIT"),h(o)})):o.get&&(o.setting=o.get(),h(o))}}),this.args.bindTo("items",t=>{if(t&&Object.keys(t).length&&(this.args.items&&(this.currentItem=null),this.tags.bound)){const t=this.findNext(this.currentItem,this.tags.bound.node);t&&this.focus(t)}},{wait:0})}onAttached(t){const e=()=>{if(this.args.initialPath.length){const t=this.args.initialPath.shift();t in this.args.items&&(this.onTimeout(0,()=>this.run(this.args.items[t])),this.args.initialPath.length&&this.onTimeout(0,()=>e()))}else this.onNextFrame(()=>this.focusFirst())};this.onTimeout(0,()=>e())}focusFirst(){if(!this.tags.bound)return;const t=this.findNext(null,this.tags.bound);t&&this.focus(t)}refocus(t){this.onNextFrame(()=>{this.currentItem||this.focusFirst(),this.focus(this.currentItem,!0)})}findNext(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=e.querySelectorAll(this.include);if(!i.length)return;const r=[];let a=0,n=0;for(const e of i)e.matches(this.exclude)||(r.push(e),e===t&&(a=n),n++);if(!t)return r[0];if(Math.abs(s)>1&&!this.args.pageLoop){if(s+a<0)return r[0];if(s+a>=r.length)return r[r.length+-1]}if(s===-1/0)return r[0];if(s===1/0)return r[r.length+-1];let o=(a+s)%r.length;for(;o<0;)o+=r.length;return r[o]}handleFocus(t){this.focus(t.target,!0)}focus(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentItem&&this.currentItem.contains(t)&&this.currentItem!==t||document.activeElement===t&&this.currentItem===t||(this.currentItem&&this.blur(this.currentItem),t&&(this.currentItem=t,t.focus({preventScroll:!0}),t.scrollIntoView({behavior:e?"instant":"smooth",block:"center"}),t.classList.add("focused"),t.addEventListener("blur",()=>this.blur(t),{once:!0})))}blur(t){t.classList.remove("focused"),t.blur()}input(t){if(this.zeroMe=t,!this.tags.bound)return;if(this.args.override)return void this.args.override.input(t);let e,s=!1;t.buttons[0]&&1===t.buttons[0].time?(this.currentItem&&this.currentItem.click(),this.args.last="A",this.currentItem&&!this.currentItem.contains(document.activeElement)&&(e=this.currentItem),this.beep()):t.buttons[1]&&1===t.buttons[1].time?(document.activeElement&&"INPUT"===document.activeElement.tagName?document.activeElement.closest("li").focus():this.back(),this.args.last="B",this.beep()):t.buttons[3]&&30===t.buttons[3].time&&(this.currentItem&&this.currentItem.dispatchEvent(new MouseEvent("auxclick",{button:1})),this.args.last="Y",this.beep());const i=e=>t.buttons[e]&&(1===t.buttons[e].time||t.buttons[e].time>=90&&t.buttons[e].time%3==1||t.buttons[e].time>30&&t.buttons[e].time<90&&t.buttons[e].time%15==1);i(12)||t.axes[7]&&t.axes[7].magnitude<0&&t.axes[7].delta?(this.currentItem&&this.currentItem.previousElementSibling&&(s=!0),e=this.findNext(this.currentItem,this.tags.bound.node,-1),this.beep()):(i(13)||t.axes[7]&&t.axes[7].magnitude>0&&t.axes[7].delta)&&(this.currentItem&&this.currentItem.nextElementSibling&&(s=!0),e=this.findNext(this.currentItem,this.tags.bound.node,1),this.beep()),i(1022)?(e=this.findNext(this.currentItem,this.tags.bound.node,-this.args.pageJump),this.beep()):i(1023)&&(e=this.findNext(this.currentItem,this.tags.bound.node,this.args.pageJump),this.beep()),i(1024)?(e=this.findNext(this.currentItem,this.tags.bound.node,-1/0),this.beep()):i(1025)?(e=this.findNext(this.currentItem,this.tags.bound.node,1/0),this.beep()):i(14)||t.axes[6]&&t.axes[6].magnitude<0&&t.axes[6].delta?(this.currentItem&&this.contract(this.currentItem),this.beep()):(i(15)||t.axes[6]&&t.axes[6].magnitude>0&&t.axes[6].delta)&&(this.currentItem&&this.expand(this.currentItem),this.beep()),e&&this.focus(e,s)}beep(){this.parent.args.audio&&n.Sfx.play("SWITCH_HIT")}run(t,e){let s;if(e&&e.target)for(s=e.target;s&&s.matches;){if(s.matches("[data-click-barrier]"))return;if(s.matches("li"))break;s=s.parentNode}if(this.zeroMe&&this.zeroMe.zero(),"unavailable"!==t.available&&"hidden"!==t.available){if(e&&t.input){const i=e.target.closest("li");if("boolean"===t.input)return void this.toggle(e,t);if("string"===t.input){this.subFocusing=!0;const t=s.querySelector("input");return void(document.activeElement!==t?t.focus():i.focus())}this.onNextFrame(()=>this.focus(i))}if(t.callback&&t.callback(t,this),t.children){let e=t.children;this.args.classes=t.classes||"","function"==typeof t.children&&(e=t.children(this.parent,this)),e instanceof Promise||(e=Promise.resolve(e));const s=t._key,i=this.args.items,r={_title:new a.CharacterString({value:"back",font:"small-menu-font"}),callback:()=>{this.args.items=i,this.args.classes=i.classes||"",this.args.currentKey=i._title?i._title.args.value:"";const t=Object.keys(i).indexOf(s);this.onNextFrame(()=>{this.focusFirst(),this.onNextFrame(()=>{if(this.tags.bound){const e=this.findNext(this.currentItem,this.tags.bound.node,t>0?t:0);this.focus(e)}})})},_prev:i.back,color:"var(--back-color, var(--default-color))"};this.args.items={},e.catch(t=>{this.args.items.back=this.args.items.back||r}),e.then(e=>{this.args.items=e,this.args.currentKey=t._title.args.value,this.args.items.back=this.args.items.back||r,this.onNextFrame(()=>this.focusFirst())})}}}altRun(t,e){e&&1===e.button&&t.revert&&(t.revert(t,this),t.get&&(t.setting=t.get()),"boolean"===t.input&&(t._value.args.value=t.setting?"ON":"OFF"),t.set&&t.set(t.setting))}back(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.args.items.back;for(let s=1;s<t&&(console.log(e),e._prev);s++)e=e._prev;e&&e.callback&&e.callback()}expand(t){const e=t.querySelector("input"),s=t.getAttribute("data-title"),i=this.args.items[s];if(i)if("number"===i.input){let t=Number(i.setting)+(i.step||1);void 0!==i.max&&t>i.max&&(t=i.max),void 0!==i.min&&t<i.min&&(t=i.min),i.setting=t}else"boolean"===i.input?(i.setting=!i.setting,i._value.args.value=i.setting?"ON":"OFF"):i&&"select"===i.input?this.cycleSelect(i,s,1):e&&e.focus()}contract(t){const e=t.getAttribute("data-title"),s=this.args.items[e];s&&("number"===s.input?(s.setting=Number(s.setting)-(s.step||1),s.setting<s.min&&(s.setting=s.min)):"boolean"===s.input?(s.setting=!s.setting,s._value.args.value=s.setting?"ON":"OFF"):s&&"select"===s.input?this.cycleSelect(s,e,-1):this.focus(t))}keyup(t,e){if("Enter"===t.key||"Escape"===t.key)return this.subFocusing||this.currentItem.focus(),void(this.subFocusing=!1);if(["ArrowUp","ArrowDown"].includes(t.key)){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const e={ArrowUp:-1,ArrowDown:1}[t.key];if("INPUT"===t.target.tagName){const t=this.findNext(this.currentItem,this.tags.bound.node,e);if(t)return void this.focus(t)}}}change(t,e){const s=this.args.items[e];s&&(s.setting=t.target.value,this.selectListChanged(s,e),s.set(s.setting))}toggle(t,e){t&&t.preventDefault(),e.setting=!e.setting,e._value.args.value=e.setting?"ON":"OFF"}cancel(t){t.preventDefault()}cycleSelect(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=!1,r=void 0,a=void 0;const n=[];if(Object.assign(n,t.options),-1===s)n.reverse();else if(1!==s)return;for(const e of n){var o;if(r=null!==(o=r)&&void 0!==o?o:e,e!==t.setting){if(i){t.setting=e,a=void 0;break}a=e}else i=!0}void 0!==a&&(t.setting=r),this.selectListChanged(t,e),t.set(t.setting)}selectListRendered(t,e,s,i,r,a){if("select"===e.input){var n;e.setting=null!==(n=e.get?e.get():e.default)&&void 0!==n?n:void 0;let t=0;for(const s in e.options)e.options[s]===e.setting&&(t=s);void 0===e.setting&&e.options.length&&(t=0,e.setting=e.options[0]);const i=r.findTag("select");r.findTag("option"),i.selectedIndex=t,e._value.args.value=e.setting,this.selectListChanged(e,s,!0)}else"boolean"===e.input&&e.element&&(e.element.selectedIndex=e.setting?0:1,e._value.args.value=e.setting?"ON":"OFF")}selectListChanged(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("boolean"===t.input?(t._value.args.value=t.setting?"ON":"OFF",this.selectListChanged(t,e,!0)):"select"===t.input&&t._value&&(t.locked&&t.locked.includes(t.setting)?t._value.args.value="Locked":t._value.args.value=t.setting),"Character"===e)for(const e of Object.values(this.args.items)){var i,r;e._available=null!==(i=null!==(r=e._available)&&void 0!==r?r:e.available)&&void 0!==i?i:"available",e.characters&&!e.characters.includes(t.setting)?e.available="unavailable":e.available=e._available}this.parent.args.audio&&!s&&this.beep()}}}),require.register("Menu/PauseMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PauseMenu=void 0;e("../intro/Card"),e("../effects/Cylinder"),e("../effects/Pinch");var i=e("./Menu"),r=e("./SettingsMenu"),a=e("../ui/CharacterString");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.PauseMenu=class extends i.Menu{constructor(t,s){super(t,s),n(this,"template",e("./pause-menu.html")),this.args.cardName="pause-menu",this.args.animation="",this.args.title=new a.CharacterString({value:"Sonic 3000",font:"small-menu-font"}),this.items=this.args.items={Continue:{subtext:"Return to gameplay.",callback:()=>s.unpauseGame()},Mute:{input:"boolean",subtext:"Mute all audio",revert:()=>s.args.audio=!0,watch:[s.args,"audio",t=>!t],set:t=>s.args.audio=!t},Settings:(0,r.SettingsMenu)(s),Graphics:{input:"select",options:["High","Medium","Low","Very Low"],set:t=>s.settings.graphicsLevel=t,get:()=>s.settings.graphicsLevel},Reset:{subtext:"Reset the run.",children:{"Last Checkpoint":{subtext:"Restart from the last checkpoint.",children:{No:{callback:()=>this.args.items.back.callback()},Yes:{callback:()=>{s.unpauseGame(),s.reset(),s.startLevel()}}}},"Level Start":{subtext:"Restart from the beginning of the act.",children:{No:{callback:()=>this.args.items.back.callback()},Yes:{callback:()=>{s.clearCheckpoints(),s.unpauseGame(),s.reset(),s.startLevel()}}}}}},Quit:{subtext:"Quit to the title screen.",children:{No:{callback:()=>this.args.items.back.callback()},Yes:{callback:()=>{this.args.items.back.callback(),s.clearCheckpoints(),s.unpauseGame(),s.quit()}}}}}}run(t,e){e.stopPropagation(),e.stopImmediatePropagation(),super.run(t,e)}input(t){if(t.buttons[1011]&&t.buttons[1011].active){const e=t.buttons[1011].time;(1===e||e>30&&e%15==1)&&(this.parent.focus(),this.parent.args.paused=1,this.args.hideMenu="pause-menu-hide")}this.args.hideMenu?t.buttons[9]&&t.buttons[9].active&&(this.args.hideMenu=""):super.input(t),t.buttons[1012]&&t.buttons[1012].time>0?(this.parent.focus(),this.args.hideMenu="pause-menu-hide"):t.buttons[1020]&&t.buttons[1020].time>0&&(this.args.hideMenu="")}reset(){this.args.items=this.items}}}),require.register("Menu/SaveMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SaveMenu=void 0;e("../save/SaveDatabase");t.SaveMenu=(t=>({children:{Save:{callback:()=>{if(!t.controlActor)return;const e=t.controlActor,s={currentMap:t.currentMap,character:e.args.canonical,checkpoint:t.getCheckpoint(e.args.id)};console.log(s),SavestateDatabase.open("savestates",1).then(t=>{t.insert("savestates",s).then(e=>{console.log(e);const s={store:"savestates",index:"id"};t.select(s).each(t=>console.log(t)).then(t=>console.log(t))})})}}}}))}),require.register("Menu/SavestateMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SavestateMenu=void 0;var i=e("../save/SaveDatabase");t.SavestateMenu=(t=>{const e={};return i.SaveDatabase.open("saves",1).then(s=>{const i={store:"saves",index:"created"};s.select(i).each(s=>{const i=s.id,r=s.character;e[`${i} ${r}`]={callback:()=>{console.log(s),t.setCheckpoint(s.currentMap,{[r]:s.checkpoint}),t.loadMap({mapUrl:s.currentMap})}}}).then(t=>console.log(t))}),{children:e}})}),require.register("Menu/SettingsMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMenu=void 0;var i=e("./TraceMenu"),r=(e("../controller/GamepadConfig"),e("../intro/Series"),e("./ButtonSelect"),e("./DemoMenu"));t.SettingsMenu=(t=>({subtext:"Edit your configuration.",children:()=>{const e={Video:(t=>({classes:"right-align",subtext:"Video settings.",children:{"Motion Blur Effects":{input:"boolean",subtext:"Enable/Disable Motion Blur Effects",available:"firefox"===t.args.agent?"unavailable hidden":"available",revert:()=>t.settings.blur=!0,set:e=>t.settings.blur=e,get:()=>t.settings.blur},"Displacement Effects":{input:"boolean",subtext:"Enable/Disable Displacement Effects",available:"firefox"===t.args.agent?"unavailable hidden":"available",revert:()=>t.settings.displace=!0,set:e=>t.settings.displace=e,get:()=>t.settings.displace},Scaling:{input:"boolean",subtext:"Enable/Disable Scaling",revert:e=>t.settings.scaling=!0,set:e=>t.settings.scaling=e,get:()=>t.settings.scaling},Smoothing:{input:"boolean",subtext:"Enable/Disable Smoothing",revert:e=>t.settings.smoothing=!1,set:e=>t.settings.smoothing=e,get:()=>t.settings.smoothing},"Outline Thickness":{input:"number",subtext:"Change the Outline Thickness",revert:e=>t.settings.outline=1,set:e=>t.settings.outline=e,get:()=>t.settings.outline,step:.5,max:15,min:0},"Display HUD":{input:"boolean",subtext:"Enable/Disable the HUD",revert:e=>t.settings.showHud=!0,set:e=>t.settings.showHud=e,get:()=>t.settings.showHud},"FPS Meter":{input:"boolean",subtext:"Enable/Disable the FPS Meter",revert:e=>t.settings.showFps=!0,set:e=>t.settings.showFps=e,get:()=>t.settings.showFps},"Mute/Fullscreen":{input:"boolean",subtext:"Show the mute & fullscreen controls in the bottom right.",revert:e=>t.settings.shortcuts=!0,set:e=>t.settings.shortcuts=e,get:()=>t.settings.shortcuts}}}))(t),Audio:(t=>({subtext:"Audio settings.",children:{Mute:{input:"boolean",subtext:"Mute all audio",revert:()=>t.args.audio=!0,watch:[t.args,"audio",t=>!t],set:e=>t.args.audio=!e},"Music Volume":{input:"number",subType:"range",subtext:"Background music volume - 0% - 100%",revert:()=>t.settings.musicVol=t.defaults.musicVol,set:e=>t.settings.musicVol=e,get:()=>t.settings.musicVol,max:100,min:0},SFX:{input:"number",subType:"range",subtext:"Sound effect music volume - 0% - 100%",revert:()=>t.settings.sfxVol=t.defaults.sfxVol,set:e=>t.settings.sfxVol=e,get:()=>t.settings.sfxVol,max:100,min:0}}}))(t),Input:(t=>({subtext:"Input settings.",children:{"Output test":{input:"output",watch:[t.settings,"buttonTest"],set:e=>t.settings.buttonTest=e},"Button Font Test":{input:"select",options:["","","","","","","","","","","","","","","","","","","","","","","","","","","",""],set:e=>t.settings.buttonTest=e,get:()=>t.settings.buttonTest},Rumble:{input:"boolean",subtext:"Enable/Disable controller vibration",set:e=>t.settings.rumble=e,get:()=>t.settings.rumble}}}))(t),Network:(t=>({subtext:"Network settings.",children:{"Matrix Settings":{children:{"Matrix URL":{input:"string",subtext:"Matrix Server URL for lobby.",revert:()=>t.settings.matrixUrl=t.defaults.matrixUrl,set:e=>t.settings.matrixUrl=e,get:()=>t.settings.matrixUrl},Lobby:{input:"string",subtext:"Matrix Room for lobby.",revert:()=>t.settings.matrixRoom=t.defaults.matrixRoom,set:e=>t.settings.matrixRoom=e,get:()=>t.settings.matrixRoom}}},"ICE Servers":{children:{"ICE Server #1":{input:"string",subtext:"ICE candidate server.",revert:()=>t.settings.iceServer1=t.defaults.iceServer1,set:e=>t.settings.iceServer1=e,get:()=>t.settings.iceServer1},"ICE Server #2":{input:"string",subtext:"ICE candidate server.",revert:()=>t.settings.iceServer2=t.defaults.iceServer2,set:e=>t.settings.iceServer2=e,get:()=>t.settings.iceServer2}}}}}))(t),Traces:i.TraceMenu};return t.args.debugEnabled&&(e.Demos=r.DemoMenu,e.Costume={children:{Hue:{input:"number",min:-180,max:180,subtext:"Rotate the color wheel.",subType:"range",revert:()=>t.customColor.h=0,set:e=>t.customColor.h=Number(e).toFixed(2),get:()=>Number(t.customColor.h).toFixed(2)},Saturation:{input:"number",min:0,max:2,step:.01,subType:"range",subtext:"Rotate the color wheel.",revert:()=>t.customColor.s=1,set:e=>t.customColor.s=Number(e).toFixed(2),get:()=>Number(t.customColor.s).toFixed(2)},Value:{input:"number",min:0,max:2,step:.01,subType:"range",subtext:"Rotate the color wheel.",revert:()=>t.customColor.v=1,set:e=>t.customColor.v=Number(e).toFixed(2),get:()=>Number(t.customColor.v).toFixed(2)}}}),e}}))}),require.register("Menu/TraceMenu.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TraceMenu=void 0;var i=e("../trace/TraceDatabase"),r=e("../replay/ReplayDatabase"),a=e("../replay/Replay");const n=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i.TraceDatabase.open("traces",1).then(i=>{const o={store:"traces",index:"id",direction:"prev",limit:10,offset:s},l={};return i.select(o).each(i=>{const n={"Export Trace":{callback:()=>{const t=window.open();t.document.write(`${i.uuid}\n`+`${i.message}\n${i.local}\n`+`${i.buildTime}\n`+`${i.created}\n\n`+`${i.stack}\n`),t.document.body.style.whiteSpace="pre",t.document.body.style.fontFamily="monospace"}},"Export Replay":{callback:()=>{r.ReplayDatabase.open("replays",3).then(t=>{const e=a.Replay,r=i.replay,n={store:"replays",index:"uuid",offset:s,type:e,range:r};t.select(n).one(t=>{const e=new Blob([JSON.stringify(t)],{type:"text/json"}),s=URL.createObjectURL(e),i=document.createElement("a");i.href=s,i.download=`${t.name||t.uuid}.json`,i.click()})})}}};t.args.debugEnabled&&(n["View Replay"]={callback:()=>{r.ReplayDatabase.open("replays",3).then(r=>{const n=a.Replay,o=i.replay,l={store:"replays",index:"uuid",offset:s,type:n,range:o};console.log(i.replay),t.replayStart=t.replayFrames.get(replay.firstFrame),r.select(l).one(s=>{t.loadMap({mapUrl:s.map}).then(()=>{t.replay=s,t.replayFrames=s.getIndexedFrames(),t.maxReplayFrame=s.lastFrame,t.args.paused=-1,t.args.frameId=-1,t.args.started=!1,t.args.running=!1,t.playback(),t.replayOffset=-1+s.firstFrame,loaded&&e.back()})})})}}),l[`${i.id})${new Date(i.created).toLocaleString("en-US")}`]={subtext:i.message,children:n}}).then(i=>(i.mapped&&(l["Next 10"]={children:()=>n(t,e,s+10)}),l))})},o={subtext:"View error log.",children:n};t.TraceMenu=o}),require.register("Menu/ZoneSuffix.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZoneSuffix=void 0;var i=e("curvature/base/View"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ZoneSuffix=class extends i.View{constructor(t,e){super(t,e),a(this,"preserve",!0),a(this,"template",'<div class = "zone-suffix">\n\t<div class = "row">\n\t\t\x3c!-- <div class = "checkpoint"></div> --\x3e\n\t\t<div class = "rings">[[rings]]</div>\n\t\t<div class = "time">[[time]]</div>\n\t\t<div class = "air">[[air]]</div>\n\t\t<div class = "score">[[score]]</div>\n\t</div>\n\t<div class = "row">\n\t\t<div class = "emblems" cv-each = "emblems:emblem">\n\t\t\t<img src = "/custom/hud-emblem.png" />\n\t\t</div>\n\t</div>\n</div>'),a(this,"font","small-menu-font"),e.loadSaves().then(t=>{const s=e.getZoneState(this.args.map),i=Math.floor(s.time/60),a=String(Math.ceil(s.time%60*1.67)).padEnd(2,"0"),n=String(s.time?i%60:0).padStart(2,"0"),o=s.time?Math.floor(i/60):0;this.args.emblems=s.emblems.slice(0,5),this.args.rings=new r.CharacterString({value:s.rings||0,font:this.font}),this.args.time=new r.CharacterString({value:`${o}:${n}.${a}`||"--",font:this.font}),this.args.air=new r.CharacterString({value:(100*Number(s.air||0)).toFixed(2)+"%",font:this.font}),this.args.score=new r.CharacterString({value:s.score||0,font:this.font}),console.log()})}}}),require.register("Menu/main-menu.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]]">\n\n\t<div class = "menu-scroller"></div>\n\n\t[[pinch]]\n\t[[twist]]\n\n\t<section class = "buttons">\n\t\t<span>[[select]]</span>\n\t\t<span>[[ok]]</span>\n\t\t<span>[[back]]</span>\n\t\t<span>[[revert]]</span>\n\t</section>\n\n\t<section class = "contents" cv-if = "!connected">\n\t\t<div class = "menu-container [[classes]]" data-current-menu = "[[currentKey]]">\n\t\t\t<div>[[title]]</div>\n\t\t\t<div>\n\t\t\t\t<ul cv-ref = "bound" cv-each = "items:item:title">\n\n\t\t\t\t\t<li data-title = "[[title]]" class = "[[item.available]]" cv-on = "click:run(item, event); auxclick:altRun(item, event); keyup(event, item):c" tabindex="0" data-tags = "[[item.tags]]">\n\t\t\t\t\t\t[[item.prefix]]\n\t\t\t\t\t\t<span class = "title">[[item._title]]</span>\n\t\t\t\t\t\t<span class = "subtext">[[item.subtext]]</span>\n\t\t\t\t\t\t<span cv-if = "item.input" cv-is = "output">\n\t\t\t\t\t\t\t<span data-wraps = "output">\n\t\t\t\t\t\t\t\t[[item._value]]\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span cv-if = "item.input" cv-is = "string" class = "field">\n\t\t\t\t\t\t\t<span data-wraps = "string" data-click-barrier><input cv-ref = "string" cv-bind = "item.setting" cv-on = "keyup(event, item);input:change(event, title)" tabindex="-1" /></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span cv-if = "item.input" cv-is = "number" class = "field">\n\t\t\t\t\t\t\t<span data-wraps = "number" data-click-barrier><input cv-ref = "number" cv-bind = "item.setting" type = "[[item.subType]]" cv-on = "keyup(event, item);change(event, title)" tabindex="-1" max = "[[item.max]]" min = "[[item.min]]" step = "[[item.step]]" title = "[[item.setting]]" /></span>\n\t\t\t\t\t\t\t<span cv-if = "item.subType" cv-is = "range">\n\t\t\t\t\t\t\t\t[[item._value]]\n\t\t\t\t\t\t\t\t\x3c!-- <span data-wraps = "number" data-click-barrier><input cv-ref = "number" cv-bind = "item.setting" type = "number" cv-on = "keyup(event, item);change(event, title)" tabindex="-1" max = "[[item.max]]" min = "[[item.min]]" step = "[[item.step]]" title = "[[item.setting]]" /></span> --\x3e\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span cv-if = "item.input" cv-is = "boolean" class = "field">\n\t\t\t\t\t\t\t<span data-wraps = "select">\n\t\t\t\t\t\t\t\t[[item._boolValue]]\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tcv-on    = "cvDomAttached:selectListRendered(event, item, title, $view, $subview, $parent);mousedown:cancel(event);input:change(event, title)" cv-ref = "boolean"\n\t\t\t\t\t\t\t\t\tcv-bind = "item.setting"\n\t\t\t\t\t\t\t\t\ttabindex="-1">\n\t\t\t\t\t\t\t\t<option value = "1">on</option>\n\t\t\t\t\t\t\t\t<option value = "0">off</option>\n\t\t\t\t\t\t\t</select></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span cv-if = "item.input" cv-is = "select" class = "field">\n\t\t\t\t\t\t\t<span data-wraps = "select">\n\t\t\t\t\t\t\t\t[[item._selectValue]]\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tcv-on    = "input:change(event, title); listRendered:selectListRendered(event, item, title, $view, $subview, $parent);"\n\t\t\t\t\t\t\t\t\tcv-ref   = "options"\n\t\t\t\t\t\t\t\t\tcv-bind  = "item.setting"\n\t\t\t\t\t\t\t\t\ttabindex = "-1"\n\t\t\t\t\t\t\t\t\tcv-each  = "item.options:option">\n\t\t\t\t\t\t\t\t\t<option value = "[[option]]">[[option]]</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t[[item.suffix]]\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t</section>\n\n\t<section class = "contents" cv-if = "!connected">\n\t\t<section class = "contents" cv-if = "lobby">[[lobby]]</section>\n\t\t<section class = "contents" cv-if = "hostGame">\n\t\t\t<div class = "token-exchange" data-have-token = "[[haveToken]]">\n\t\t\t\t<label>\n\t\t\t\t\t<p>Input the token from your friend here.</p>\n\t\t\t\t\t<textarea cv-bind = "input" cv-on = "click:paste(event)"></textarea>\n\t\t\t\t\t<button cv-on = "click:answer">go!</button>\n\t\t\t\t</label>\n\n\t\t\t\t<label>\n\t\t\t\t\t<p>Send this token to your friend to get started.</p>\n\t\t\t\t\t<textarea cv-on = "click:copy" cv-ref = "hostOutput" cv-bind = "hostOutput" readonly = "true"></textarea>\n\t\t\t\t\t<button cv-on = "click:copy">[[copy]]</button>\n\t\t\t\t\t<div class = "close" cv-on = "click:disconnect"></div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</section>\n\n\t\t<section class = "contents" cv-if = "joinGame">\n\t\t\t<div class = "token-exchange">\n\t\t\t\t<label cv-if = "haveToken">\n\t\t\t\t\t<p>Send this token to your friend to get started.</p>\n\t\t\t\t\t<textarea cv-on = "click:copy" cv-ref = "joinOutput" cv-bind = "joinOutput" readonly = "true"></textarea>\n\t\t\t\t\t<button cv-on = "click:copy">[[copy]]</button>\n\t\t\t\t</label>\n\n\t\t\t\t<label cv-if = "haveToken">\n\t\t\t\t\t<p>Input the token they send back here.</p>\n\t\t\t\t\t<textarea cv-bind = "input" cv-on = "click:paste(event)"></textarea>\n\t\t\t\t\t<button cv-on = "click:acceptRtp">go!</button>\n\t\t\t\t\t<div class = "close" cv-on = "click:disconnect"></div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</section>\n\t</section>\n\t<section class = "override">[[override]]</section>\n</div>\n'}),require.register("Menu/menu.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]]">\n\t<div class = "menu-scroller"></div>\n\t[[warp]]\n\t<div class = "menu-container" data-current-menu = "[[currentKey]]">\n\t\t<ul cv-ref = "bound" cv-each = "items:item:title">\n\t\t\t<li data-title = "[[title]]" class = "[[item.available]]" data-type = "[[item.input]]" data-sub-type = "[[item.subType]]" cv-on = "click:run(item, event);cvDomDetached:removeItem(item);focus:handleFocus(event)" tabindex="0">\n\t\t\t\t<span class = "title">[[item._title]]</span>\n\t\t\t\t<span class = "subtext">[[item.subtext]]</span>\n\t\t\t\t<span cv-if = "item.input" cv-is = "output">\n\t\t\t\t\t: <span data-wraps = "output"><span cv-ref = "output" cv-bind = "item.setting"></span></span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-if = "item.input" cv-is = "string">\n\t\t\t\t\t: <span data-wraps = "string"><input cv-ref = "string" cv-bind = "item.setting" cv-on = "keyup(event);input:change(event)" tabindex="-1" /></span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-if = "item.input" cv-is = "number">\n\t\t\t\t\t: <span data-wraps = "number"><input cv-ref = "number" cv-bind = "item.setting" type = "[[item.subType]]" cv-on = "keyup(event);change(event)" tabindex="-1" max = "[[item.max]]" min = "[[item.min]]" step = "[[item.step]]" title = "[[item.setting]]" /></span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-if = "item.input" cv-is = "boolean">\n\t\t\t\t\t: <span data-wraps = "select"><select cv-on = "mousedown:cancel(event);change(event)" cv-ref = "boolean" cv-bind = "item.setting" tabindex="-1">\n\t\t\t\t\t\t<option value = "1">on</option>\n\t\t\t\t\t\t<option value = "0">off</option>\n\t\t\t\t\t</select></span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-if = "item.input" cv-is = "select">\n\t\t\t\t\t: <span data-wraps = "select"><select cv-on = "change(event)" cv-ref = "select" cv-bind = "item.setting" tabindex="-1" cv-each = "options:option:o">\n\t\t\t\t\t\t<option value = "[[o]]">[[o]]</option>\n\t\t\t\t\t</select></span>\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n'}),require.register("Menu/pause-menu.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[hideMenu]]">\n\n\t<div class = "menu-scroller"></div>\n\n\t[[warp]]\n\n\t<section class = "contents" cv-if = "!connected">\n\n\t\t<div class = "menu-container [[classes]]" data-current-menu = "[[currentKey]]">\n\n\t\t\t<div>[[title]]</div>\n\n\t\t\t<ul cv-ref = "bound" cv-each = "items:item:title">\n\n\t\t\t\t<li data-title = "[[title]]" class = "[[item.available]]" data-type = "[[item.input]]" data-sub-type = "[[item.subType]]" style = "--color:[[item.color]];" cv-on = "click:run(item, event):c; auxclick:altRun(item, event); keyup(event, item):c; focus:handleFocus(event);" tabindex="0">\n\t\t\t\t\t[[item.prefix]]\n\t\t\t\t\t<span class = "title">[[item._title]]</span>\n\t\t\t\t\t<span class = "subtext">[[item.subtext]]</span>\n\t\t\t\t\t<span cv-if = "item.input" cv-is = "output">\n\t\t\t\t\t\t: <span data-wraps = "output"><span cv-ref = "output" cv-bind = "item.setting"></span></span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span cv-if = "item.input" cv-is = "string" data-click-barrier>\n\t\t\t\t\t\t: <input cv-ref = "string" cv-bind = "item.setting" cv-on = "keyup(event, item);input:change(event)" tabindex="-1" />\n\t\t\t\t\t</span>\n\t\t\t\t\t<span cv-if = "item.input" cv-is = "number">\n\t\t\t\t\t\t: <span data-wraps = "number" data-click-barrier>\n\t\t\t\t\t\t\t<input cv-ref = "number" cv-bind = "item.setting" type = "[[item.subType]]" cv-on = "keyup(event, item);change(event)" tabindex="-1" max = "[[item.max]]" min = "[[item.min]]" step = "[[item.step]]" title = "[[item.setting]]"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span cv-if = "item.input" cv-is = "boolean">\n\t\t\t\t\t\t:\n\t\t\t\t\t\t<span data-wraps = "select">\n\t\t\t\t\t\t\t[[item._boolValue]]\n\t\t\t\t\t\t\t<select cv-on = "click:mousedown:cancel(event);change(event)" cv-ref = "boolean" cv-bind = "item.setting" tabindex="-1">\n\t\t\t\t\t\t\t\t<option value = "1">on</option>\n\t\t\t\t\t\t\t\t<option value = "0">off</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span cv-if = "item.input" cv-is = "select" class = "field">\n\t\t\t\t\t\t:\n\t\t\t\t\t\t<span data-wraps = "select">\n\t\t\t\t\t\t\t[[item._selectValue]]\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tcv-on    = "input:change(event, title); listRendered:selectListRendered(event, item, title, $view, $subview, $parent);"\n\t\t\t\t\t\t\t\tcv-ref   = "options"\n\t\t\t\t\t\t\t\tcv-bind  = "item.setting"\n\t\t\t\t\t\t\t\ttabindex = "-1"\n\t\t\t\t\t\t\t\tcv-each  = "item.options:option">\n\t\t\t\t\t\t\t\t<option value = "[[option]]">[[option]]</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t[[item.suffix]]\n\t\t\t\t</li>\n\t\t</ul>\n\n\t\t</div>\n\n\t</section>\n\n\t<section class = "override">[[override]]</section>\n\n</div>\n'}),require.register("ObjectPalette.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectPalette=void 0;e("./actor/PointActor");var i=e("./actor/LayerSwitch"),r=e("./region/Region"),a=e("./region/ShadeRegion"),n=(e("./region/BgShadeRegion"),e("./region/FgShadeRegion"),e("./region/WaterRegion")),o=e("./region/DarkRegion"),l=e("./region/LavaRegion"),h=e("./region/ToxicRegion"),g=e("./region/PhazonRegion"),c=e("./region/RollingRegion"),d=e("./region/SlidingRegion"),u=e("./region/GrindingRegion"),p=e("./region/ForceRegion"),f=e("./region/FrictionRegion"),m=e("./region/CorkscrewRegion"),v=e("./region/BossRegion"),y=e("./region/ExitRegion"),b=e("./region/LoadingRegion"),S=e("./region/ExplodingRegion"),w=e("./region/SwitchRegion"),x=e("./region/RainRegion"),k=e("./region/DebrisRegion"),M=e("./region/WaterfallRegion"),P=e("./region/KillRegion"),C=e("./region/VerticalRegion"),j=e("./region/VehicleRegion"),A=e("./region/DropVehicleRegion"),T=e("./region/PerspectiveRegion"),O=e("./actor/CompanionBlock"),_=e("./actor/QuestionBlock"),E=e("./actor/MarbleBlock"),R=e("./actor/BreakableBlock"),B=e("./actor/Stopper"),I=e("./actor/Zipline"),F=e("./actor/Block3d"),L=e("./actor/Block"),D=e("./actor/Tree"),N=e("./actor/Coconut"),z=e("./actor/Mushroom"),q=e("./actor/Door"),U=e("./actor/PlatformFlare"),H=e("./actor/GravityPad"),W=(e("./actor/Monitor"),e("./actor/monitor/WebMonitor")),G=e("./actor/monitor/RingMonitor"),V=e("./actor/monitor/TripleRingMonitor"),$=e("./actor/monitor/InfoMonitor"),K=e("./actor/monitor/SheildStarMonitor"),Y=e("./actor/monitor/SheildNormalMonitor"),J=e("./actor/monitor/SheildFireMonitor"),X=e("./actor/monitor/SheildWaterMonitor"),Z=e("./actor/monitor/SheildElectricMonitor"),Q=e("./actor/Bumper"),tt=e("./actor/Flipper"),et=e("./actor/SeeSaw"),st=e("./actor/Cinematic"),it=e("./actor/Tumbler"),rt=e("./actor/Flickie"),at=e("./actor/Bubbles"),nt=e("./actor/Redz"),ot=e("./actor/GuardBot"),lt=e("./actor/Sping"),ht=e("./actor/CrabMeat"),gt=e("./actor/BuzzBomber"),ct=e("./actor/MechaFroggy"),dt=e("./actor/DrainFly"),ut=e("./actor/GohlaBall"),pt=e("./actor/Voltorb"),ft=e("./actor/Balkiry"),mt=e("./actor/Jawz"),vt=e("./actor/SnailBot"),yt=e("./actor/Motobug"),bt=e("./actor/BFish"),St=e("./actor/Grounder"),wt=e("./actor/Scratch"),xt=e("./actor/TechnoSqueak"),kt=e("./actor/Blastoid"),Mt=e("./actor/Meanie"),Pt=e("./actor/SpringTurtle"),Ct=e("./actor/Sparkle"),jt=e("./actor/Splats"),At=e("./actor/Relief"),Tt=e("./actor/Barnacle"),Ot=e("./actor/Skorp"),_t=e("./actor/RhinoBot"),Et=e("./actor/Gator"),Rt=e("./actor/ButterDroid"),Bt=e("./actor/Catakiller"),It=e("./actor/CatakillerSegment"),Ft=e("./actor/EggTroid"),Lt=e("./actor/SpitFire"),Dt=e("./actor/SpitSteam"),Nt=e("./actor/Explosion"),zt=e("./actor/StarPost"),qt=e("./actor/ArrowSign"),Ut=e("./actor/Emerald"),Ht=e("./actor/FakeEmerald"),Wt=e("./actor/Window"),Gt=e("./actor/Spring"),Vt=e("./actor/NotchSpring"),$t=(e("./actor/BrokenMonitor"),e("./actor/BoostRing")),Kt=e("./actor/Ring"),Yt=e("./actor/Coin"),Jt=e("./actor/Emblem"),Xt=e("./actor/Apple"),Zt=e("./actor/AntiRing"),Qt=e("./actor/DropCage"),te=e("./actor/SlotMachine"),ee=e("./actor/WaterFall"),se=e("./actor/WaterJet"),ie=e("./actor/WaterSpout"),re=e("./actor/PowerupGlow"),ae=e("./actor/Projectile"),ne=e("./actor/TextActor"),oe=e("./actor/EggMobile"),le=e("./actor/SnowBoard"),he=e("./actor/SkateBoard"),ge=e("./actor/DrillCar"),ce=e("./actor/Tornado"),de=e("./actor/RailCar"),ue=e("./actor/EggWalker"),pe=e("./actor/EggShuttle"),fe=e("./actor/PogoSpring"),me=e("./actor/NuclearSuperball"),ve=e("./actor/Platformer"),ye=e("./actor/MechaSonic"),be=e("./actor/Eggrobo"),Se=e("./actor/Eggman"),we=e("./actor/Sonic"),xe=e("./actor/Tails"),ke=e("./actor/Knuckles"),Me=e("./actor/Seymour"),Pe=e("./actor/Chalmers"),Ce=e("./actor/Sean"),je=e("./actor/Big"),Ae=e("./actor/Rocks"),Te=e("./actor/Switch"),Oe=e("./actor/HeavyDutySwitch"),_e=e("./actor/Balloon"),Ee=e("./actor/StarBalloon"),Re=e("./actor/Spinner"),Be=e("./actor/HallBooster"),Ie=e("./actor/Springboard"),Fe=e("./actor/GrapplePoint"),Le=e("./actor/WoodenCrate"),De=e("./actor/SteelCrate"),Ne=e("./actor/ChaoCrate"),ze=e("./actor/UnbreakableCrate"),qe=e("./actor/Rocket"),Ue=e("./actor/Booster"),He=e("./actor/WindStone"),We=e("./actor/Skull"),Ge=e("./actor/Pumpkin"),Ve=e("./actor/RoadBarrier"),$e=e("./actor/CautionPanel"),Ke=e("./actor/Spikes"),Ye=e("./actor/SpikesSmall"),Je=e("./actor/Cone"),Xe=e("./actor/Fountain"),Ze=e("./actor/CautionSign"),Qe=e("./actor/RollingSign"),ts=e("./actor/Bell"),es=e("./actor/Torch"),ss=e("./actor/LightSource"),is=e("./actor/Signpost"),rs=e("./actor/Umbrella"),as=e("./actor/Dish"),ns=e("./actor/RedEyeJet"),os=e("./actor/MiniMace"),ls=e("./actor/MegaMace"),hs=e("./actor/Beelzebub"),gs=e("./actor/MiniBoss"),cs=e("./actor/PogoEgg"),ds=e("./actor/Magnet"),us=e("./actor/Pulley"),ps=e("./actor/PulleySmall"),fs=e("./actor/Orb"),ms=e("./actor/OrbSmall"),vs=e("./actor/Egg"),ys=e("./actor/Chao"),bs=e("./actor/EggShellTop"),Ss=e("./actor/EggShellBottom"),ws=e("./actor/BackdropSwapper"),xs=e("./actor/LayerController"),ks=e("./actor/WaterController"),Ms=e("./actor/TilesetSwapper"),Ps=e("./actor/CutScene"),Cs=(e("./actor/HtmlFrame"),e("./actor/Panel")),js=e("./actor/Tester"),As=e("./actor/Cursor"),Ts=e("./actor/MouseIndicator"),Os=e("./actor/Spawner"),_s=e("./actor/NeverBetter"),Es=e("./actor/AsteroidLarge"),Rs=e("./actor/AsteroidMedium"),Bs=e("./actor/AsteroidSmall"),Is=e("./actor/Asteroid"),Fs=e("./actor/RocketPlatform"),Ls=e("./actor/PropellerPlatform"),Ds=e("./actor/HexNut"),Ns=e("./actor/SpinningFloat"),zs=e("./actor/Turtloid"),qs=e("./actor/CrossCannon"),Us=e("./actor/ChaoDetailer"),Hs=e("./actor/Angel"),Ws=e("./actor/Flag"),Gs=e("./actor/GiantTire"),Vs=e("./actor/TruckBody"),$s=e("./actor/TruckCab"),Ks=e("./actor/Dolphin"),Ys=e("./actor/Herculad"),Js=e("./actor/Chopper"),Xs=e("./actor/TrickRamp"),Zs=e("./actor/TwistRamp"),Qs=e("./actor/AirBomb"),ti=e("./actor/EggCapsule"),ei=e("./actor/SpikeRing"),si=e("./actor/ToxicBarrel"),ii=e("./actor/SpinBridge"),ri=e("./actor/StoneAltar"),ai=e("./actor/BouncyMushroom"),ni=e("./actor/NitroBooster"),oi=e("./actor/LavaBall");const li={player:me.NuclearSuperball,cinematic:st.Cinematic,spring:Gt.Spring,"layer-switch":i.LayerSwitch,"layer-controller":xs.LayerController,"water-controller":ks.WaterController,"backdrop-swapper":ws.BackdropSwapper,"tileset-swapper":Ms.TilesetSwapper,"star-post":zt.StarPost,"arrow-sign":qt.ArrowSign,projectile:ae.Projectile,block3d:F.Block3d,block:L.Block,tree:D.Tree,coconut:N.Coconut,mushroom:z.Mushroom,door:q.Door,"platform-flare":U.PlatformFlare,"gravity-pad":H.GravityPad,"q-block":_.QuestionBlock,"marble-block":E.MarbleBlock,"companion-block":O.CompanionBlock,"breakable-block":R.BreakableBlock,stopper:B.Stopper,zipline:I.Zipline,bumper:Q.Bumper,flipper:tt.Flipper,"see-saw":et.SeeSaw,"drill-car":ge.DrillCar,"rail-car":de.RailCar,tornado:ce.Tornado,"egg-walker":ue.EggWalker,"snow-board":le.SnowBoard,"skate-board":he.SkateBoard,"egg-mobile":oe.EggMobile,"egg-shuttle":pe.EggShuttle,"pogo-spring":fe.PogoSpring,"rocks-tall":Ae.Rocks,"rocks-med":Ae.Rocks,"rocks-short":Ae.Rocks,"mecha-sonic":ye.MechaSonic,platformer:ve.Platformer,sonic:we.Sonic,tails:xe.Tails,knuckles:ke.Knuckles,eggman:Se.Eggman,robotnik:Se.Eggman,eggrobo:be.Eggrobo,seymour:Me.Seymour,chalmers:Pe.Chalmers,sean:Ce.Sean,big:je.Big,switch:Te.Switch,"heavy-duty-switch":Oe.HeavyDutySwitch,window:Wt.Window,emerald:Ut.Emerald,"fake-emerald":Ht.FakeEmerald,"base-region":r.Region,region:n.WaterRegion,"lava-region":l.LavaRegion,"toxic-region":h.ToxicRegion,"phazon-region":g.PhazonRegion,"dark-region":o.DarkRegion,"shade-region":a.ShadeRegion,"force-region":p.ForceRegion,"friction-region":f.FrictionRegion,"corkscrew-region":m.CorkscrewRegion,"rolling-region":c.RollingRegion,"sliding-region":d.SlidingRegion,"grinding-region":u.GrindingRegion,"exploding-region":S.ExplodingRegion,"boss-region":v.BossRegion,"exit-region":y.ExitRegion,"loading-region":b.LoadingRegion,"switch-region":w.SwitchRegion,"rain-region":x.RainRegion,"debris-region":k.DebrisRegion,"waterfall-region":M.WaterfallRegion,"kill-region":P.KillRegion,"vertical-region":C.VerticalRegion,"vehicle-region":j.VehicleRegion,"drop-vehicle-region":A.DropVehicleRegion,"perspective-region":T.PerspectiveRegion,"boost-ring":$t.BoostRing,ring:Kt.Ring,antiring:Zt.AntiRing,coin:Yt.Coin,emblem:Jt.Emblem,"notch-spring":Vt.NotchSpring,apple:Xt.Apple,"drop-cage":Qt.DropCage,"slot-machine":te.SlotMachine,"powerup-glow":re.PowerupGlow,explosion:Nt.Explosion,"text-actor":ne.TextActor,"water-jet":se.WaterJet,"water-fall":ee.WaterFall,"water-spout":ie.WaterSpout,balloon:_e.Balloon,"star-balloon":Ee.StarBalloon,"web-monitor":W.WebMonitor,"ring-monitor":G.RingMonitor,"triple-ring-monitor":V.TripleRingMonitor,"info-monitor":$.InfoMonitor,"sheild-fire-monitor":J.SheildFireMonitor,"sheild-normal-monitor":Y.SheildNormalMonitor,"sheild-star-monitor":K.SheildStarMonitor,"sheild-water-monitor":X.SheildWaterMonitor,"sheild-electric-monitor":Z.SheildElectricMonitor,flickie:rt.Flickie,crabmeat:ht.CrabMeat,redz:nt.Redz,"guard-bot":ot.GuardBot,sping:lt.Sping,"mecha-froggy":ct.MechaFroggy,"buzz-bomber":gt.BuzzBomber,bubbles:at.Bubbles,drainfly:dt.DrainFly,"gohla-ball":ut.GohlaBall,voltorb:pt.Voltorb,balkiry:ft.Balkiry,jawz:mt.Jawz,snailbot:vt.SnailBot,motobug:yt.Motobug,"b-fish":bt.BFish,grounder:St.Grounder,scratch:wt.Scratch,"techno-squeak":xt.TechnoSqueak,blastoid:kt.Blastoid,meanie:Mt.Meanie,"spring-turtle":Pt.SpringTurtle,sparkle:Ct.Sparkle,splats:jt.Splats,relief:At.Relief,barnacle:Tt.Barnacle,skorp:Ot.Skorp,"rhino-bot":_t.RhinoBot,gator:Et.Gator,"butter-droid":Rt.ButterDroid,catakiller:Bt.Catakiller,"catakiller-segment":It.CatakillerSegment,eggtroid:Ft.EggTroid,spitfire:Lt.SpitFire,spitsteam:Dt.SpitSteam,"grapple-point":Fe.GrapplePoint,rocket:qe.Rocket,booster:Ue.Booster,spinner:Re.Spinner,"hall-booster":Be.HallBooster,springboard:Ie.Springboard,"wooden-crate":Le.WoodenCrate,"steel-crate":De.SteelCrate,"chao-crate":Ne.ChaoCrate,"unbreakable-crate":ze.UnbreakableCrate,"road-barrier":Ve.RoadBarrier,"caution-panel":$e.CautionPanel,signpost:is.Signpost,umbrella:rs.Umbrella,dish:as.Dish,"red-eye-jet":ns.RedEyeJet,beelzebub:hs.Beelzebub,"pogo-egg":cs.PogoEgg,"mini-boss":gs.MiniBoss,"mini-mace":os.MiniMace,"mega-mace":ls.MegaMace,magnet:ds.Magnet,pulley:us.Pulley,"pulley-small":ps.PulleySmall,spikes:Ke.Spikes,"spikes-small":Ye.SpikesSmall,cone:Je.Cone,"wind-stone":He.WindStone,skull:We.Skull,pumpkin:Ge.Pumpkin,fountain:Xe.Fountain,"caution-sign":Ze.CautionSign,"rolling-sign":Qe.RollingSign,bell:ts.Bell,torch:es.Torch,"light-source":ss.LightSource,orb:fs.Orb,"orb-small":ms.OrbSmall,chao:ys.Chao,egg:vs.Egg,"egg-shell-top":bs.EggShellTop,"egg-shell-bottom":Ss.EggShellBottom,"cut-scene":Ps.CutScene,panel:Cs.Panel,tester:js.Tester,cursor:As.Cursor,"mouse-indicator":Ts.MouseIndicator,spawner:Os.Spawner,"never-better":_s.NeverBetter,"asteroid-large":Es.AsteroidLarge,"asteroid-medium":Rs.AsteroidMedium,"asteroid-small":Bs.AsteroidSmall,asteroid:Is.Asteroid,"rocket-platform":Fs.RocketPlatform,"propeller-platform":Ls.PropellerPlatform,"hex-nut":Ds.HexNut,"spinning-float":Ns.SpinningFloat,turtloid:zs.Turtloid,angel:Hs.Angel,"chao-detailer":Us.ChaoDetailer,"cross-cannon":qs.CrossCannon,tumbler:it.Tumbler,flag:Ws.Flag,"giant-tire":Gs.GiantTire,"truck-body":Vs.TruckBody,"truck-cab":$s.TruckCab,dolphin:Ks.Dolphin,herculad:Ys.Herculad,chopper:Js.Chopper,"trick-ramp":Xs.TrickRamp,"twist-ramp":Zs.TwistRamp,"air-bomb":Qs.AirBomb,"egg-capsule":ti.EggCapsule,"spike-ring":ei.SpikeRing,"toxic-barrel":si.ToxicBarrel,"spin-bridge":ii.SpinBridge,"stone-altar":ri.StoneAltar,"bouncy-mushroom":ai.BouncyMushroom,"nitro-booster":ni.NitroBooster,"lava-ball":oi.LavaBall};t.ObjectPalette=li}),require.register("QuadCell.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.QuadCell=void 0;const r=Symbol("CellRef");t.QuadCell=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,"position",{}),i(this,"size",{}),i(this,"divided",!1),i(this,"parent",null),i(this,"leafPoint",{x:null,y:null}),i(this,"leafRefs",null),i(this,"ld",null),i(this,"rd",null),i(this,"lu",null),i(this,"ru",null),i(this,"cells",[]),i(this,"minSize",0),this.parent=r,this.position.x=e.x,this.position.y=e.y,this.size.x=s.x,this.size.y=s.y,this.minSize=t,Object.seal(this)}empty(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.divided)return!this.leafRefs||!this.leafRefs.size;for(const e in this.cells)if(!this.cells[e].empty(t+1))return!1;return!0}insert(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};if(!this.contains(e))return!1;if(!this.leafRefs&&!this.divided)return this.leafRefs=new Set,this.leafPoint.x=e.x,this.leafPoint.y=e.y,this.leafRefs.add(t),t[r]=this,!0;if(this.size.x<=this.minSize)return this.leafRefs.add(t),t[r]=this,!0;if(this.leafRefs&&e.x===this.leafPoint.x&&e.y===this.leafPoint.y)return this.leafRefs.add(t),t[r]=this,!0;this.divided||this.divide();for(const s of this.cells)if(s.insert(t,e))return!0;return!1}move(t,e){const s=t[r];if(s){if(s.leafPoint.x===e.x&&s.leafPoint.y===e.y)return;t[r]=null,s.leafRefs.delete(t),s.parent&&s.parent.join()}this.insert(t,e)}remove(t){const e=t[r];e&&(t[r]=null,e.leafRefs.delete(t),e.parent&&e.parent.join())}join(){if(!this.empty())return!1;let t=null;for(const e of this.cells)if(!e.empty()){if(t)return!1;t=e}this.ld=null,this.rd=null,this.lu=null,this.ru=null,this.cells=[],this.divided=!1,t&&t.leafRefs.forEach(t=>this.insert(t)),this.parent&&this.parent.join()}divide(){if(this.divided)return!1;const t=this.position,e=this.size,s=this.minSize;if(this.ld=new this.constructor(s,{x:t.x-e.x/4,y:t.y-e.y/4},{x:e.x/2,y:e.y/2},this),this.rd=new this.constructor(s,{x:t.x+e.x/4,y:t.y-e.y/4},{x:e.x/2,y:e.y/2},this),this.lu=new this.constructor(s,{x:t.x-e.x/4,y:t.y+e.y/4},{x:e.x/2,y:e.y/2},this),this.ru=new this.constructor(s,{x:t.x+e.x/4,y:t.y+e.y/4},{x:e.x/2,y:e.y/2},this),this.cells.push(this.ld,this.rd,this.lu,this.ru),this.divided=!0,!this.leafRefs.size)return!0;t:for(const t of this.leafRefs)for(const e of this.cells)if(e.insert(t,this.leafPoint)){this.leafRefs.delete(t);continue t}}contains(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0};const e=this.position.x-this.size.x/2,s=this.position.x+this.size.x/2;if(t.x<e||t.x>s)return!1;const i=this.position.y-this.size.y/2,r=this.position.y+this.size.y/2;return!(t.y<i||t.y>r)}select(t,e,s,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.empty())return[];if(s/2+this.size.x/2<Math.abs(t-this.position.x))return[];if(i/2+this.size.y/2<Math.abs(e-this.position.y))return[];if(this.divided){const a=new Set;for(const n of this.cells)for(const o of n.select(t,e,s,i,r+1))a.add(o);return a}return this.leafRefs?this.leafRefs:[]}}}),require.register("ScriptPalette.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptPalette=void 0;const i={"infinite-ruin":e("./zoneScripts/InfiniteRuin").InfiniteRuin,"chao-garden":e("./zoneScripts/ChaoGarden").ChaoGarden};t.ScriptPalette=i}),require.register("World.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.World=void 0;var i=e("curvature/base/Bag"),r=e("curvature/base/Bindable"),a=e("tileMap/TileMap");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class o{constructor(){n(this,"tileMap",new a.TileMap),this.viewports=new i.Bag((t,e,s)=>{switch(s){case BAG.ITEM_ADDED:t.world=this;break;case BAG.ITEM_REMOVED:t.world=null}}),this.actors=new i.Bag((t,e,s)=>{switch(s){case BAG.ITEM_ADDED:t.world=this;break;case BAG.ITEM_REMOVED:t.world=null}})}getOnScreenObjects(t){}update(){}}t.World=o,n(o,"globals",r.Bindable.make({}))}),require.register("abilities/LightDash.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightDash=void 0;t.LightDash=class{}}),require.register("actor/AirBomb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AirBomb=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=e("curvature/base/Tag");t.AirBomb=class extends i.PointActor{constructor(){super(...arguments),this.args.width=22,this.args.height=32,this.args.type="actor-item actor-air-bomb",this.args.decel=0,this.explosions=new Set}update(){this.args.falling||this.explosions.size||this.explode(),super.update();for(const t of this.explosions)t.style({"--x":this.args.x,"--y":this.args.y+-16})}collideA(t){t.controllable&&(t.damage(this),this.explode(),this.args.float=-1,this.args.xSpeed=0,this.args.ySpeed=0)}explode(){if(this.exploded)return;this.exploded=!0,this.args.type="actor-item actor-air-bomb hide";const t=document.createElement("div");t.classList.add("particle-huge-explosion");const e=new a.Tag(t);this.explosions.add(e);const s=this.viewport;this.viewport.particles.add(e),this.viewport.onFrameOut(30,()=>{s.particles.remove(e),s.actors.remove(this),this.explosions.delete(e)}),r.Sfx.play("OBJECT_DESTROYED")}}}),require.register("actor/Angel.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Angel=void 0;var i=e("./PointActor");e("../behavior/Liftable");t.Angel=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-angel",this.args.width=45,this.args.height=80}}}),require.register("actor/AntiRing.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AntiRing=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class n extends i.PointActor{constructor(){var t,e,s;super(...arguments),a(this,"template",'<div class  = "point-actor [[type]]">\n\t\t<div class = "sprite" cv-ref = "sprite"></div>\n\t</div>'),a(this,"float",-1),this.args.type="actor-item actor-anti-ring",this.args.width=15,this.args.height=15,this.args.static=null===(t=this.args.static)||void 0===t||t,this.args.dropped=null===(e=this.args.dropped)||void 0===e||e,this.args.gone=!1,this.args.gravity=.4,this.args.delay=null!==(s=this.args.delay)&&void 0!==s?s:48}update(){if(!this.viewport)return;this.viewport.args.frameId,this.startFrame;this.args.noClip?this.noClip=!0:this.args.decoration?this.noClip=!0:this.args.ySpeed<0?this.noClip=!0:this.attract||(this.noClip=!1),this.args.decoration&&(this.args.type="actor-item actor-anti-ring decoration",this.args.gravity=.36),this.dropped&&(this.args.type="actor-item actor-anti-ring dropped",this.args.height=14);const t=this.viewport;this.dropped&&this.viewport&&!this.viewport.actorIsOnScreen(this,256)&&t.onFrameOut(15,()=>{t.actors.remove(this)}),this.args.reward&&this.args.gone&&t.onFrameOut(15,()=>{t.actors.remove(this)}),super.update(),this.args.reward||(this.getMapSolidAt(this.x+this.args.xSpeed*this.args.direction,this.y+-8)&&(this.args.xSpeed*=-1),!this.dropped&&!this.scattered||this.args.falling&&this.args.ySpeed||(this.args.xSpeed=this.args.xSpeed||this.xSpeedLast||Math.random()-.5,this.args.ySpeed=Math.min(.75*-Math.abs(this.args.ySpeed||this.ySpeedLast||0),-5),this.args.gSpeed=0,this.args.x+=this.args.xSpeed,this.args.y+=this.args.ySpeed,this.args.falling=!0,this.args.groundAngle=0))}callCollideHandler(t){return!(t instanceof n)&&super.callCollideHandler(t)}collideA(t){if(t instanceof this.constructor)return;if(!this.viewport||this.args.gone||this.args.ignore)return!1;if(!t.controllable&&!t.occupant&&!t.args.owner)return!1;const e=this.viewport.args.frameId-this.startFrame;if(this.dropped&&e<this.args.delay)return!1;super.collideA(t),t.args.owner&&(t=t.args.owner),t.occupant&&(t=t.occupant),t.controllable&&(t.args.rings-=1),this.args.gone=!0,this.viewport.auras.delete(this),this.args.static=!0,this.args.float=-1,this.args.type="actor-item actor-anti-ring collected",this.args.xSpeed=0,this.args.ySpeed=0,this.viewport.args.audio&&r.Sfx.play("SPIKE_DAMAGE"),this.viewport.onFrameOut(5,()=>{this.args.type="actor-item actor-anti-ring collected gone"});this.x,this.y,this.viewport;this.viewport.onFrameOut(1200,()=>{this.restore=!0}),t.collect&&this.onNextFrame(()=>{t.collect(this)})}wakeUp(){this.def&&this.restore&&(this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.gone=this.restore=!1,this.args.type="actor-item actor-anti-ring")}get solid(){return!1}get rotateLock(){return!0}}t.AntiRing=n}),require.register("actor/Apple.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Apple=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");t.Apple=class extends i.PointActor{constructor(){super(...arguments),this.args.width=11,this.args.height=11,this.args.type="actor-item actor-apple",this.args.float=-1,this.collected=!1}onRendered(t){return super.onRendered(t)}collideA(t){if(!t.controllable||this.gone)return;const e=this.viewport;e.getZoneState(),this.collected?this.args.type="actor-item actor-apple actor-apple-gone actor-apple-collected":this.args.type="actor-item actor-apple actor-apple-gone",this.gone=!0,e.onFrameOut(20,()=>{e.actors.remove(this)}),e.currentSave.save(),this.viewport.args.audio&&r.Sfx.play("apple_COLLECTED")}}}),require.register("actor/ArrowSign.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrowSign=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag");e("../actor/Projectile"),e("./Monitor"),e("./monitor/RingMonitor"),e("./monitor/SheildFireMonitor"),e("./monitor/SheildWaterMonitor"),e("./monitor/SheildElectricMonitor");t.ArrowSign=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.rotation=t.rotation,e.args.height=t.height,e}constructor(){var t,e;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(s,arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-arrow-sign",this.args.float=null!==(t=this.args.float)&&void 0!==t?t:-1,this.args.static=null===(e=this.args.static)||void 0===e||e,this.args.width=s.width||32,this.args.height=s.height||64}onRendered(t){super.onRendered(t),this.headBox||(this.headBox=new r.Tag('<div class = "arrow-sign-head-box">'),this.post=new r.Tag('<div class = "arrow-sign-post">'),this.head=new r.Tag('<div class = "arrow-sign-head">'),this.sprite.appendChild(this.post.node),this.headBox.appendChild(this.head.node),this.sprite.appendChild(this.headBox.node),this.args.bindTo(["point","height"],(t,e)=>{this.headBox.style({["--"+e]:t})}))}get solid(){return!1}}}),require.register("actor/Asteroid.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Asteroid=void 0;var i=e("./PointActor"),r=(e("./Block"),e("../audio/Sfx"),e("./AsteroidLarge"));t.Asteroid=class extends i.PointActor{constructor(){super(...arguments),this.args.width=80,this.args.height=80,this.args.type="actor-item actor-asteroid",this.args.float=-1,this.args.static=1,this.args.spawned=!1,this.args.firedAt=0}sleep(){this.args.spawned=!1}update(){if(!this.viewport)return;const t=this.viewport;if(t.controlActor){if(t.controlActor.args.respawning)return;if(t.controlActor.args.y<this.args.y)return;if(Math.abs(t.controlActor.args.y-this.args.y)<128)return}if(t.args.frameId-this.args.firedAt<90)super.update();else{if(this.args.spawned)return this.args.spawned=Math.random()>=.01,void super.update();t.actorIsOnScreen(this,128)?(t.spawn.add({object:new r.AsteroidLarge({xSpeed:this.args.xSpeed,ySpeed:this.args.ySpeed,x:this.args.x,y:this.args.y})}),this.args.spawned=!0,this.args.firedAt=t.args.frameId):this.args.spawned=!1,super.update()}}}}),require.register("actor/AsteroidBase.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsteroidBase=void 0;var i=e("./PointActor");e("./Block"),e("../audio/Sfx");t.AsteroidBase=class extends i.PointActor{constructor(){super(...arguments),this.args.width=80,this.args.height=80,this.args.type="actor-item actor-asteroid",this.args.broken=!1,this.args.decel=0}sleep(){this.viewport&&this.viewport.actors.remove(this)}update(){if(!this.viewport||this.args.broken)return super.update(),void(this.args.groundAngle=0);this.viewport,this.args.falling||this.break(),super.update(),this.args.groundAngle=0,this.viewport.actorIsOnScreen(this,128)||this.viewport&&this.viewport.actors.remove(this)}get rotateLock(){return!0}}}),require.register("actor/AsteroidLarge.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsteroidLarge=void 0;var i=e("curvature/base/Tag"),r=(e("./PointActor"),e("./Block"),e("../audio/Sfx")),a=e("./AsteroidMedium"),n=e("./AsteroidBase");t.AsteroidLarge=class extends n.AsteroidBase{constructor(){super(...arguments),this.args.type=`${this.args.type} actor-asteroid-large`,this.args.gravity=.45,this.args.width=64,this.args.height=80}update(){if(super.update(),!this.viewport||this.viewport.args.frameId%3)return;const t=new i.Tag(document.createElement("div"));t.classList.add("particle-dust"),t.style({"--x":this.args.x,"--y":this.args.y+-this.args.height-.75,"z-index":0,opacity:.25*Math.random()+.5}),viewport.particles.add(t),viewport.onFrameOut(30,()=>{viewport.particles.remove(t)})}collideA(t){!t.controllable||this.args.broken||t.args.mercy||t.args.y<this.args.y+.75*-this.args.height||(this.args.xSpeed=0,t.damage(this,"rock"),r.Sfx.play("ROCK_BREAK_1"),this.break())}break(){const t=this.xSpeedLast||this.gSpeedLast||0,e=this.ySpeedLast||0;[new a.AsteroidMedium({falling:!0,x:this.args.x-20,y:this.args.y-20,xSpeed:t,ySpeed:.25*-e-1.5,xSpeed:.333*t-.5}),new a.AsteroidMedium({falling:!0,x:this.args.x+20,y:this.args.y-20,xSpeed:t,ySpeed:.25*-e-1.5,xSpeed:.333*t+.5}),new a.AsteroidMedium({falling:!0,x:this.args.x+0,y:this.args.y-4,xSpeed:t,ySpeed:.25*-e-1,xSpeed:.333*t+0}),new a.AsteroidMedium({falling:!0,x:this.args.x+0,y:this.args.y-40,xSpeed:t,ySpeed:.25*-e-2,xSpeed:.333*t+0})].forEach(t=>viewport.spawn.add({object:t})),viewport.onFrameOut(1,()=>viewport.actors.remove(this)),this.args.broken=!0,r.Sfx.play("ROCK_BREAK_1")}}}),require.register("actor/AsteroidMedium.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsteroidMedium=void 0;e("./PointActor"),e("./Block");var i=e("../audio/Sfx"),r=e("./AsteroidSmall"),a=e("./AsteroidBase");t.AsteroidMedium=class extends a.AsteroidBase{constructor(){super(...arguments),this.args.type=`${this.args.type} actor-asteroid-medium`,this.args.gravity=.5,this.args.width=48,this.args.height=48}collideA(t){!t.controllable||this.args.broken||t.args.mercy||t.args.y<this.args.y+.75*-this.args.height||(t.damage(this,"rock"),i.Sfx.play("ROCK_BREAK_2"))}break(){const t=this.xSpeedLast||this.gSpeedLast||0,e=this.ySpeedLast||0;[new r.AsteroidSmall({falling:!0,x:this.args.x+0,y:this.args.y-24,ySpeed:-.5*e-1,xSpeed:t+0}),new r.AsteroidSmall({falling:!0,x:this.args.x+0,y:this.args.y+0,ySpeed:-.5*e-1,xSpeed:t+0}),new r.AsteroidSmall({falling:!0,x:this.args.x-14,y:this.args.y-12,ySpeed:-.5*e-1,xSpeed:t-.15}),new r.AsteroidSmall({falling:!0,x:this.args.x+14,y:this.args.y-12,ySpeed:-.5*e-1,xSpeed:t+.15})].forEach(t=>viewport.spawn.add({object:t})),viewport.onFrameOut(1,()=>viewport.actors.remove(this)),this.args.broken=!0,i.Sfx.play("ROCK_BREAK_2")}}}),require.register("actor/AsteroidSmall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsteroidSmall=void 0;var i=e("./PointActor"),r=(e("./Block"),e("../audio/Sfx"));t.AsteroidSmall=class extends i.PointActor{constructor(){super(...arguments),this.args.width=32,this.args.height=32,this.args.type="actor-item actor-asteroid-small",this.noClip=!0}sleep(){this.viewport&&this.viewport.actors.remove(this)}collideA(t){t.controllable&&!t.args.mercy&&(this.args.xSpeed=0,t.damage(this,"rock"),r.Sfx.play("ROCK_BREAK_2"))}damage(){}get rotateLock(){return!0}}}),require.register("actor/BFish.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BFish=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../behavior/Patrol"),o=e("../mixin/CanPop");t.BFish=class extends(i.Mixin.from(r.PointActor,o.CanPop)){constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;const s=t.jumpForce||14;super(t,e),this.behaviors.add(new a.SkidDust),this.behaviors.add(new n.Patrol),this.args.type="actor-item actor-b-fish",this.args.animation="standing",this.noClip=!0,this.args.gSpeedMax=5,this.args.jumpForce=s||14,this.args.jumpDelay=this.args.jumpDelay||0,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.willStick=!1,this.stayStuck=!1}update(){const t=this.def.get("y");this.age<=this.args.jumpDelay?this.args.float=-1:this.args.float=!1,this.age>this.args.jumpDelay&&this.args.y>t&&this.viewport.onNextFrame(()=>this.args.ySpeed=-this.args.jumpForce),super.update()}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/BackdropController.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackdropController=void 0;var i=e("./PointActor");e("../BackdropPalette");t.BackdropController=class extends i.PointActor{constructor(t,e){super(t,e),this.args.hidden=!0}activate(t,e){}}}),require.register("actor/BackdropSwapper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackdropSwapper=void 0;var i=e("./PointActor");e("../BackdropPalette");t.BackdropSwapper=class extends i.PointActor{constructor(t,e){super(t,e),this.args.hidden=!0}activate(t,e){}}}),require.register("actor/Balkiry.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Balkiry=void 0;e("./Flickie");var i=e("./Spring"),r=e("curvature/base/Mixin"),a=e("curvature/base/Tag"),n=e("./PointActor"),o=(e("../behavior/SkidDust"),e("../mixin/CanPop"));e("../actor/Explosion"),e("../actor/Projectile");t.Balkiry=class extends(r.Mixin.from(n.PointActor,o.CanPop)){constructor(){super(...arguments),this.args.type="actor-item actor-balkiry",this[i.Spring.WontSpring]=!0,this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=32,this.args.height=16,this.willStick=!1,this.stayStuck=!1,this.args.float=-1,this.noClip=!0}onRendered(){super.onRendered(),this.flame=new a.Tag('<div class = "balkiry-flame">'),this.sprite.appendChild(this.flame.node),this.box.setAttribute("data-animation","standing")}update(){this.args.facing="left",this.args.xSpeed>-12&&(this.args.xSpeed-=.1),this.args.ySpeed=0,this.args.falling=!0,this.args.flying=!0,super.update()}effect(t){super.effect(t)}wakeUp(){}sleep(){}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Balloon.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Balloon=void 0;var i=e("./PointActor");t.Balloon=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-balloon",this.args.width=32,this.args.height=33,this.args.float=-1,this.args.airAngle=-Math.PI}collideA(t){t.controllable}}}),require.register("actor/Barnacle.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Barnacle=void 0;var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=(e("../behavior/Patrol"),e("../mixin/CanPop")),n=e("./BarnacleTrap");t.Barnacle=class extends(i.Mixin.from(r.PointActor,a.CanPop)){constructor(){var t,e,s,i;super(...arguments),this.args.type="actor-item actor-barnacle",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.gravity=.75,this.args.width=34,this.args.height=32,this.args.float=-1,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:10,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:200,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1,this.args.showOff=null!==(i=this.args.showOff)&&void 0!==i&&i,this.args.state="waiting",this.args.showOff&&(this.args.state="intro"),this.args.bindTo("state",()=>this.args.stateAge=0)}update(){super.update(),this.trap||(this.mountPoint=new r.PointActor,this.trap=new n.BarnacleTrap,this.trap.owner=this,this.mountPoint.args.x=this.trap.args.x=this.args.x,this.mountPoint.args.y=this.trap.args.y=this.args.y,this.mountPoint.args.y-=24,this.mountPoint.noClip=!0,this.mountPoint.args.float=-1,this.mountPoint.args.hidden=!0,this.trap.others.tiedTo=this.mountPoint,this.args.showOff||(this.trap.args.y+=this.findRopeLength(),this.trap.args.ropeLength=this.findRopeLength(),this.trap.args.xSpeed+=2*Math.sign(Math.random()+-.5)),this.viewport.spawn.add({object:this.trap})),this.trap.stuck.size&&this.trap.args.ySpeed<=0&&(this.trap.args.xSpeed*=.85);const t=this.args.state;this["state_"+t],this["state_"+t]()}pop(t){this.viewport.actors.remove(this.trap),this.viewport.actors.remove(this.mountPoint),super.pop(t)}updateEnd(){super.updateEnd(),this.args.stateAge++}state_intro(){this.trap.args.ropeLength=2,this.args.stateAge>45&&(this.args.state="spitting")}state_waiting(){this.args.animation="idle",this.args.stateAge>40&&this.trap.stuck.size&&(this.args.state="feeding"),this.trap.args.ropeLength<=0&&(this.args.state="spitting")}state_carriage(){this.args.animation="idle",void 0===this.trap.args.ropeLength&&(this.trap.args.ropeLength=0),this.args.stateAge>40&&(this.args.state="feeding")}state_feeding(){if(this.args.animation="feeding",this.args.stateAge>15&&(this.trap.args.ropeLength>48?this.trap.args.ropeLength-=5:this.trap.args.ropeLength-=3,this.trap.args.falling=!0),this.args.stateAge>25&&(this.args.state="carriage"),this.trap.args.ropeLength<=0){this.trap.args.ropeLength=0,this.trap.args.float=-1,this.args.state="spitting",this.trap.args.xSpeed=0,this.trap.args.ySpeed=0;for(const[t]of this.trap.stuck)"function"==typeof t.pop&&this.viewport.onFrameOut(10,()=>{this.trap.stuck.delete(t),this.trap.ignores.set(t,60),t.pop()})}}state_spitting(){if(60===this.args.stateAge&&(this.trap.args.xSpeed+=2*Math.sign(Math.random()+-.5)),this.args.stateAge>40){const t=this.findRopeLength();this.trap.args.ropeLength=t+-0,this.args.animation="spit",this.trap.args.float=0,this.trap.args.ySpeed=Math.max(2,this.trap.args.ySpeed)}this.args.stateAge>70&&(this.args.state="waiting")}findRopeLength(){if(!this.viewport)return 0;const t=this.viewport.tileMap.castRay(this.args.x,this.args.y,Math.PI/2,2048);return Math.hypot(this.args.x-t[0],this.args.y-t[1])||128}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/BarnacleTrap.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BarnacleTrap=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/Constrainable");t.BarnacleTrap=class extends(r.Mixin.from(i.PointActor,a.Constrainable)){constructor(){super(...arguments),this.args.type="actor-item actor-barnacle-trap",this.args.width=8,this.args.height=8,this.args.ropeLength=0,this.stuck=new Map,this.noClip=!0,this.onRemove(()=>{for(const[t,e]of this.stuck)t.args.float=0,t.args.stuck=!1})}update(){this.others.tiedTo||super.update()}updateEnd(){if(super.update(),this.viewport){for(const[t,e]of this.stuck)this.viewport.args.frameId%25==0&&(e.wiggles=Math.min(8,1+e.wiggles));this.others.tiedTo&&this.setPos();for(const[t,e]of this.stuck)t.args.xSpeed=t.xAxis,t.args.ySpeed=0,t.args.mercy||t.args.dead||e.wiggles<=0?(this.stuck.delete(t),this.ignores.set(t,15),t.args.stuck=!1,t.args.dead||(t.args.float=0)):(this.args.xSpeed+=.1*t.xAxis,Math.abs(this.args.xSpeed)>3&&(this.args.xSpeed=3*Math.sign(this.args.xSpeed)),t.args.x=this.args.x,t.args.y=this.args.y+t.args.height+-this.args.height,t.args.float=-1,t.args.falling=!0,t.dashed=!1,t.args.stuck=!0,t.args.jumping=!1,t.args.spinning=!1,t.args.cameraBias=.2,t.controllable&&(t.args.animation="walking")),t.xAxis&&(Math.sign(e.xAxisLast)!==Math.sign(t.xAxis)&&e.wiggles--,e.xAxisLast=t.xAxis);Math.abs(this.args.xSpeed)<2&&this.args.ySpeed>0&&this.args.ySpeed<2&&this.args.rope>32&&(this.args.xSpeed=2*Math.sign(this.args.xSpeed)),super.updateEnd()}}collideA(t){t!==this.owner&&(t.controllable||"function"==typeof t.pop)&&(t.args.mercy||t.args.dead||this.stuck.size||this.stuck.has(t)||(this.stuck.set(t,{xAxisLast:0,wiggles:8,yDiff:t.args.y-this.args.y}),this.args.falling=!0,this.args.xSpeed=t.args.xSpeed||t.args.gSpeed,this.args.x=t.args.x))}get solid(){return!1}}}),require.register("actor/Beelzebub.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Beelzebub=void 0;var i=e("curvature/base/Tag"),r=e("./PointActor"),a=e("../behavior/Platformer"),n=e("curvature/base/Mixin"),o=(e("../mixin/CanPop"),e("./CutScene"),e("./EggCapsule")),l=e("../audio/Sfx"),h=e("../lib/Analytic");t.Beelzebub=class extends(n.Mixin.from(r.PointActor)){constructor(t,e){super(t,e),this.args.type="actor-item actor-beelzebub",this.args.width=64,this.args.height=32,this.args.float=-1,this.args.damagers=new Map,this.args.phase="idle",this.args.hitPoints=8,this.args.noseAngle=Math.PI/2*3,this.args.drillPush=0,this.args.phaseFrameId=0,this.args.frameId=0,this.args.direction=-1,this.args.facing="left",this.args.bindTo("phase",t=>this.args.phaseFrameId=0)}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--nose-angle"]="noseAngle",this.autoStyle.get(this.box)["--drill-push"]="drillPush",this.autoAttr.get(this.box)["data-phase"]="phase",this.drill=new i.Tag('<div class = "drill">'),this.body=new i.Tag('<div class = "body">'),this.nose=new i.Tag('<div class = "nose">'),this.eyeBack=new i.Tag('<div class = "eye-back">'),this.eyeFore=new i.Tag('<div class = "eye-fore">'),this.body.appendChild(this.eyeBack.node),this.body.appendChild(this.eyeFore.node),this.body.appendChild(this.nose.node),this.sprite.appendChild(this.body.node),this.nose.appendChild(this.drill.node),this.attractor=null}update(){if(this.args.phaseFrameId++,this.args.frameId++,!this.viewport)return;const t=this.viewport;t.auras.add(this);const e=this.viewport.controlActor;if(!e||e.args.respawning)return;this.attractor||(this.attractor={},this.attractor.x=this.x,this.attractor.y=this.y);const s=Math.abs(this.x-this.attractor.x),r=Math.abs(this.y-this.attractor.y),a=Math.sign(this.x-this.attractor.x),n=Math.sign(this.y-this.attractor.y);switch(this.args.phase){case"idle":this.args.xSpeed=0,this.args.ySpeed=0;break;case"intro":this.args.phaseFrameId>30&&(this.args.phase="stalking");break;case"alert":this.args.phaseFrameId>4&&(this.args.drillPush=1,this.args.falling=!0,this.args.float=-1,this.y>this.args.alertTo?this.args.ySpeed--:(this.args.y=this.args.alertTo,this.args.ySpeed=0)),this.args.phaseFrameId>0&&(this.args.phase="stalking");break;case"damaged":this.args.hitPoints>0?this.args.phaseFrameId>20&&(this.args.phase="stalking"):this.args.phaseFrameId>6&&(this.args.phase="dead");break;case"knocked":this.args.xSpeed=0,this.args.phaseFrameId>30&&(this.args.phase="stalking");break;case"dead":this.args.float=0;break;case"stalking":this.args.xSpeed=-a*Math.max(1,s/25),this.args.ySpeed=-n*Math.max(1,r/25),this.args.ySpeed+=3*Math.sin(this.args.frameId/3),this.pointIsSafe(e.x,e.y-128)&&(this.attractor.x=e.x,this.attractor.y=e.y-128),this.args.noseAngle=Math.PI/2*3,this.args.drillPush=0,this.args.phaseFrameId>10&&(this.args.noseAngle=this.angleTo({x:e.x,y:Math.max(this.y,e.y)})),this.args.phaseFrameId>20&&(this.args.drillPush=.5),this.args.phaseFrameId>25&&(this.args.phase="ready");break;case"buzzing":this.pointIsSafe(e.x,e.y+-e.args.height+-34)&&(this.attractor.x=e.x,this.attractor.y=e.y+-e.args.height+-34),this.args.xSpeed=-a*Math.max(1,s/15),this.args.ySpeed=-n*Math.max(1,r/15),this.args.noseAngle=Math.PI/2*3,this.args.drillPush=1,this.args.phaseFrameId>10&&(this.args.drillPush=.5),this.args.phaseFrameId>20&&(this.args.noseAngle=this.angleTo({x:e.x,y:Math.max(this.y,e.y)})),this.args.phaseFrameId>30&&(this.args.phase="ready");break;case"ready":if(this.args.phaseFrameId<10&&(this.readySide=Math.sign(e.xSpeedLast||e.gSpeedLast)),this.pointIsSafe(e.x+128*this.readySide,e.y+-e.args.height+-128)&&(this.attractor.x=e.x+128*this.readySide,this.attractor.y=e.y+-e.args.height+-128),this.args.xSpeed=-a*Math.max(1,s/15),this.args.ySpeed=-n*Math.max(1,r/15),this.args.ySpeed+=3*Math.sin(this.args.frameId/3),this.args.drillPush=.75,this.args.phaseFrameId>30){const t=Math.random();e.args.falling?this.args.phase=t>.5?"buzzing":"stalking":this.args.phase=t>.5?"swooping":"attacking"}break;case"attacking":{this.args.float=-1,this.args.falling=!0,this.args.phaseFrameId>100&&(this.args.phase="stalking"),this.args.phaseFrameId<50?(this.pointIsSafe(e.x+256*(this.readySide||1),e.y-32)&&(this.attractor.x=e.x+256*(this.readySide||1),this.attractor.y=e.y-32),this.args.noseAngle=0):(this.pointIsSafe(e.x+256*(-this.readySide||-1),e.y-16)&&(this.attractor.x=e.x+256*(-this.readySide||-1),this.attractor.y=e.y-16),this.args.noseAngle=this.angleTo({x:e.x,y:Math.max(this.y,e.y)})),this.args.drillPush=1,this.args.float=-1;const t=e.args.xSpeed||e.args.gSpeed;this.args.xSpeed=-a*Math.max(1,s/10)+1.1*t,this.args.ySpeed=-n*Math.max(1,r/10);break}case"swooping":this.pointIsSafe(e.x,e.y-32)&&(this.attractor.x=e.x,this.attractor.y=e.y-32),this.args.xSpeed+=-a*Math.max(1,s/1e4),this.args.ySpeed+=-n*Math.max(1,r/1e4),this.args.noseAngle=this.angleTo({x:e.x,y:Math.max(this.y,e.y)}),this.args.drillPush=1,this.args.float=-1,this.args.phaseFrameId>180&&(this.args.phase="stalking"),e.args.xSpeed||e.args.gSpeed;break;case"exploding":if(90===this.args.phaseFrameId&&(this.args.falling=!0,this.args.ySpeed=-14,this.args.xSpeed=0,this.args.gSpeed=0,this.noClip=!0,this.viewport.auras.delete(this),this.args.phase="exploded",l.Sfx.play("OBJECT_DESTROYED"),t&&t.controlActor)){const e=t.controlActor;t.onFrameOut(60,()=>{const s=new o.EggCapsule({x:e.args.x,y:e.args.y-384,xSpeed:e.args.gSpeed||e.args.xSpeed});t.spawn.add({object:s})})}if(this.args.phaseFrameId>90)return;if(t&&t.args.frameId%3==0){const e=new i.Tag('<div class = "particle-explosion">');l.Sfx.play("BOSS_DAMAGED");const s=this.args.width*Math.random()-this.args.width/2,r=this.args.height*Math.random()-this.args.height/2;e.style({"--x":this.x+s,"--y":this.y+r+-16}),t.particles.add(e),setTimeout(()=>t.particles.remove(e),512)}}"knocked"!==this.args.phase&&this.args.ySpeed<0&&!this.pointIsSafe(this.x,this.y+-this.args.height+this.args.ySpeed+-1)&&(this.args.ySpeed=0),super.update()}updateEnd(){if(super.updateEnd(),!this.viewport)return;const t=this.viewport.controlActor;if(!t)return;this.args.hitPoints<=0&&(t.cofocused=null);const e=Math.abs(this.args.x-t.x),s=Math.abs(this.args.y-t.y),i=Math.sign(this.args.x-t.x),r=Math.sign(this.args.y-t.y);switch(this.args.phase){case"attacking":case"swooping":case"stalking":case"knocked":case"damaged":case"ready":e>384&&(this.args.x=t.x+384*i),s>192&&(this.args.y=t.y+192*r),this.args.hitPoints<=0&&(this.viewport.auras.delete(this),this.args.phase="dead",this.noClip=!1,this.args.float=0,"function"==typeof ga&&h.Analytic.report({eventCategory:"boss",eventAction:"defeated",eventLabel:`${this.viewport.args.actName}::${this.args.id}`}))}switch(this.args.xSpeed<0?this.args.facing="left":this.args.xSpeed>0&&(this.args.facing="right"),this.args.groundAngle=0,this.args.phase){case"attacking":case"swooping":case"stalking":case"ready":this.bMap("checkBelow",this.x,this.y).get(a.Platformer)&&(this.args.falling=!0,this.args.ySpeed=-4,this.args.y--)}}collideA(t,e){if("exploded"===this.args.phase||t.args.mercy)return!1;if(!t.controllable&&!t.hazard)return!0;if(-1===e)return;const s=Math.sign(this.x-t.x),i=(Math.sign(this.y-t.y),Math.max(Math.abs(t.args.xSpeed),5));if(Math.sign(t.args.xSpeed),this.args.hitPoints>0&&t.controllable&&!(t.args.jumping||t.args.rolling||t.dashed))return t.damage(),this.args.phase="ready","function"==typeof ga&&h.Analytic.report({eventCategory:"boss",eventAction:"damaged-player",eventLabel:`${this.viewport.args.actName}::${this.args.id}::${t.args.id}`}),!0;if("dead"===this.args.phase){if(!(t.args.jumping||t.args.rolling||t.dashed))return!0;this.args.explodeFrame=this.viewport.args.frameId,this.args.phase="exploding"}if(1!==e&&3!==e||(t.args.falling?this.ignores.set(t,15):(t.args.gSpeed=4*-Math.sign(this.x-t.x),t.args.rolling&&this.onNextFrame(()=>{t.args.gSpeed=-Math.sign(this.x-t.x),t.args.rolling=!0,t.args.direction=Math.sign(t.args.gSpeed)})),this.args.ySpeed=0,this.args.hitPoints>0&&this.damage(t),this.args.hitPoints>0?(t.args.xSpeed=-s*i,this.args.xSpeed=s*i):(t.args.xSpeed=-s*i*.5,this.args.xSpeed=s*i*.5)),2===e&&(this.viewport.args.audio&&l.Sfx.play("BOSS_DUDHIT"),t.args.falling&&(this.args.ySpeed=2.5*t.args.ySpeed,t.args.controllable&&(t.args.ySpeed=Math.max(7,Math.abs(t.args.ySpeed)))),this.args.xSpeed=0,this.args.hitPoints>0&&(this.args.phase="knocked"),this.ignores.set(t,15)),0===e){if(t.args.falling&&this.ignores.set(t,15),t.controllable){t.args.y=this.y-this.args.height,t.args.animation;const e=t.args.ySpeed;this.onNextFrame(()=>{t.args.ySpeed=-Math.floor(Math.abs(e))||-4})}this.args.xSpeed=0,this.damage(t)}return t.args.ignore=1,this.args.hitPoints||(t.args.ignore=-2),!0}damage(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.args.hitPoints<=0)return;const e=this.args.damagers.get(t);this.args.frameId-e<5||(this.args.hitPoints--,this.args.damagers.set(t,this.args.frameId),this.args.phase="damaged",l.Sfx.play("BOSS_DAMAGED"))}pointIsSafe(t,e){return!this.viewport.actorsAtPoint(t,e).filter(t=>t.hazard).length}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/Bell.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bell=void 0;var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../mixin/Constrainable"),n=e("./Ring");t.Bell=class extends(i.Mixin.from(r.PointActor,a.Constrainable)){constructor(){super(...arguments),this.args.z=100,this.args.width=64,this.args.height=64,this.args.type="actor-item actor-bell",this.cooldown=0,this.noClip=!0,this.args.gravity=.4}update(){this.xLast=this.x,this.yLast=this.y,super.update(),this.cooldown>0&&this.cooldown--,this.cooldown<1&&(this.cooldown=0),this.args.tiedTo,this.setPos(),this.args.falling=!0;const t=this.x-this.xLast;if(Math.abs(t)>1?this.args.animation=["ring-left","","ring-right"][1+Math.sign(this.x-this.xLast)]:this.args.animation="",!this.cooldown&&(Math.abs(this.args.xSpeed)>2||Math.abs(this.args.ySpeed)>6)){const t=new n.Ring({x:this.x,y:this.y});t.dropped=!0,t.delay=5,t.args.static=!1,t.args.ignore=10,t.args.xSpeed=.75*this.args.xSpeed,t.args.ySpeed=this.args.ySpeed;const e=this.rotatePoint(0,32);t.args.x+=e[0],t.args.y+=e[1],this.viewport.spawn.add({object:t}),this.cooldown=45*Math.random()+15,this.viewport.onFrameOut(120,()=>{this.viewport.actors.remove(t)})}}updateEnd(){Math.abs(this.args.xSpeed)<3&&Math.abs(this.args.ySpeed)<3?this.viewport&&!this.viewport.auras.has(this)&&this.viewport.auras.add(this):this.viewport.auras.delete(this),super.updateEnd()}collideB(t){t.controllable&&(this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,t.args.xSpeed*=.99,this.viewport.args.backdrop.args.sunrise=1)}}}),require.register("actor/Big.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Big=void 0;var i=e("./PointActor");t.Big=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-big",this.args.width=42,this.args.height=46}get solid(){return!1}}}),require.register("actor/Blastoid.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Blastoid=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=(e("../behavior/Patrol"),e("../mixin/CanPop")),n=e("../actor/Projectile");t.Blastoid=class extends(i.Mixin.from(r.PointActor,a.CanPop)){constructor(){var t,e;super(...arguments),this.args.type="actor-item actor-blastoid",this.args.animation="standing",this.args.width=35,this.args.height=21,this.args.flipped=!1,this.args.careening=!1,this.args.color=null!==(t=this.args.color)&&void 0!==t?t:"blue",this.willStick=!0,this.stayStuck=!0,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:120}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-color"]="color",this.autoAttr.get(this.box)["data-flipped"]="flipped"}update(){if(this.args.flipped){super.update();const t=this.args.x-this.xLast,e=this.args.y-this.yLast;return!this.args.careening||t||e||this.args.falling?void 0:void super.pop()}this.args.shotTelegraph;const t=this.args.patrolBeat;if(this.viewport.args.frameId%t==0){const t=2.5,e=-3,s=this,i=new n.Projectile({x:this.x+13*this.args.direction,y:this.y+-8,xSpeed:t*this.args.direction,ySpeed:e,owner:s});this.viewport.spawn.add({object:i})}super.update()}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Block.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Block=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("./Ring"),n=e("./LayerSwitch"),o=e("./GrapplePoint"),l=(e("curvature/animate/ease/QuintInOut"),e("curvature/animate/ease/CubicInOut"),e("../behavior/Platformer"));t.Block=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.y=e.originalY=t.y,e}constructor(){var t,e,s,i,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a,arguments.length>1?arguments[1]:void 0),this.hitBlocks=!1,this.args.yForce=0,this.args.yLean=0,this.args.z=null!==(t=this.args.z)&&void 0!==t?t:100,this.args.type="actor-item actor-block",this.args.width=a.width||32,this.args.height=a.height||32,this.args.convey=null!==(e=a.convey)&&void 0!==e?e:0,this.args.conveyed=0,this.args.ySpeedMax=32,this.originalX=this.args.x,this.originalY=this.args.y,this.args.solid=null===(s=this.args.solid)||void 0===s||s,this.args.gravity=.4,this.args.collapse=null!==(i=a.collapse)&&void 0!==i&&i,this.args.drop=null!==(r=a.drop)&&void 0!==r&&r,this.args.active=-1,this.weighted=!1,this.activatedAt=null,this.originalModes=new Map,this.watching=new Set,this.args.master&&(this.childBlocks=new Set)}onRendered(t){if(super.onRendered(t),this.viewport){if(this.args.match&&(this.match=this.viewport.actorsById[this.args.match]),this.args.spriteSheet=this.args.spriteSheet||"/Sonic/marble-zone-block.png",this.args.droop&&this.droop(0),this.args.collapse&&this.tags.sprite.classList.add("collapse"),this.args.platform&&this.tags.sprite.classList.add("platform"),this.args.drop&&this.tags.sprite.classList.add("drop"),this.args.hidden)return t&&t.preventDefault(),!1;this.setTile()}}initialize(){(this.otherDefs.path||this.otherDefs.ridePath)&&this.pathReset()}pathReset(){if(this.args.master){const t=this.otherDefs.path||this.otherDefs.ridePath;if(t){this.pathNext=t,this.args.x=t.x,this.args.y=t.y,this.viewport.setColCell(this);for(const t of this.childBlocks){const e=t.otherDefs.path||t.otherDefs.ridePath;t.pathNext=e,t.args.x=e.x,t.args.y=e.y,this.viewport.setColCell(t)}}}else this.others.childOf&&this.others.childOf.pathReset()}wakeUp(){if(this.sleeping=!1,this.otherDefs.path&&this.others.childOf&&this.others.childOf.childBlocks.add(this),this.pathReset(),this.setTile(),this.noClip=!1,!this.args.tiedTo)return;this.args._tiedTo||(this.args._tiedTo=this.viewport.actorsById[this.args.tiedTo]);const t=this.args._tiedTo;if(t&&!t.hanging.has(this.constructor)){t.hanging.set(this.constructor,new Set);const e=t.hanging.get(this.constructor);e.add(this),this.chain=new r.Tag('<div class = "chain">'),this.sprite.appendChild(this.chain.node),this.onRemove(()=>e.delete(this))}}collideA(t,e){if(t instanceof n.LayerSwitch)return;if(t instanceof o.GrapplePoint&&this.args.platform)return;if(t instanceof this.constructor&&!t.args.falling&&!t.hitBlocks)return!1;if(t.isRegion||t.noClip||t.args.static)return!1;if(t.args.standingOn===this&&(this.weighted=!0),this.objDef&&this.args.platform&&"hex-nut"===this.objDef.type&&t.objDef&&"hex-nut"===t.objDef.type)return!1;let s=.5+(t.x-this.x)/this.args.width;if(t.args.gSpeed<0&&(s=1-s),t.args.mode&&(s=1-s),this.args.hSwap&&t.groundTime>2&&Math.abs(t.args.gSpeed)>8&&s<.2&&(this.watching.add(t),this.originalModes.has(t)||this.originalModes.set(t,{mode:t.args.mode,rolling:t.args.rolling,gSpeed:t.args.gSpeed}),this.originalModes.has(t)&&(t.args.gSpeed=this.originalModes.get(t).gSpeed)),(!t.args.falling&&!t.args.climbing||t.args.climbing&&t.y<this.y-this.args.height)&&this.args.droop&&t.args.ySpeed>=0&&t.args.standingOn!==this)return!0;if(!t.args.climbing&&this.args.droop&&t.controllable&&(0===e||2===e)&&t.args.ySpeed>=0){const e=this.originalY+-this.args.height,s=Math.floor(this.args.width/2),i=t.args.gSpeed;if(Math.abs(i)>s)return this.args.y=this.originalY,t.args.y=Math.trunc(e+-1),this.args.yForce=0,this.args.yLean=0,!0;const r=(this.x+-t.x+-2*i)/s,a=.9*Number(this.args.droop);if(Math.abs(r)>=.9)return this.args.yForce=0,this.args.yLean=this.args.yLean/100,!0;const n=Math.round(a*(1-Math.abs(r))/2);this.args.yForce+=Math.max(t.ySpeedLast,0),this.args.yForce=Math.min(n,this.args.yForce),this.args.yForce=Math.max(this.args.yForce,-n),this.droopPos=this.x-t.x}if(this.args.platform&&!t.args.dead&&!(t instanceof a.Ring)){t.args.y,t.args.height;const e=this.args.y-this.args.height;return this.args.width,t.args.falling&&Math.abs(t.args.y-e)<4&&t.args.ySpeed>=0&&!t.args.float&&(!t.args.dashed||t.args.ySpeed>t.args.xSpeed)&&(t.controllable||t.args.npc?t.args.y=-1+e:t.args.y=e),t.args.y<=e&&(!1===t.args.falling||t.args.ySpeed>0)||(!1===t.args.falling&&2===t.args.mode||(t.args.npc&&!t.args.falling&&this.args.falling&&!this.args.float&&(t.startle(),t.noClip=!0),!1))}if(!t.controllable&&!t.isVehicle)return!0;if(!this.switch&&this.args.drop&&(0===e||2===e)&&this.args.float<=0&&(this.args.float=1,this.args.goBack=!1),!this.switch&&this.args.collapse&&(0===e||2===e)&&this.args.float<=0){if(t.args.ySpeed>15){this.args.float=1,this.args.goBack=!1;const e=t.args.ySpeed;this.onNextFrame(()=>{this.args.falling||this.args.float?(this.args.ySpeed=e,this.args.float=1):(this.args.ySpeed=-1,this.args.float=1),this.args.falling=!0})}else(t.args.ySpeed>0||t.args.gSpeed)&&(this.args.float=this.args.float>=0?this.args.float:this.args.delay||0);this.viewport.onFrameOut(1,()=>this.args.falling=!0)}return!0}activate(){this.args.active=!0}deactivate(){this.args.active=!1}update(){if(!this.others.childOf){if(this.args.master)for(const t of this.childBlocks)t._update();return this._update()}}_update(){if(!this.viewport)return;const t=this.viewport.args.frameId-this.viewport.args.startFrameId;if(this.args.active>0&&(this.activatedAt||(this.activatedAt=t)),this.args.switch&&!this.switch&&(this.switch=this.viewport.actorsById[this.args.switch]),this.args.static)return void super.update();if(this.args.collapse&&(this.args.gSpeed=0,(!this.switch&&this.activatedAt&&t-this.activatedAt>25||this.switch&&this.switch.args.active)&&(this.args.float=this.args.float>=0?this.args.float:this.args.delay||0,this.args.float||(this.args.ySpeed=this.args.ySpeed||12))),this.args.drop&&(this.args.gSpeed=0,(!this.switch&&this.activatedAt&&t-this.activatedAt>25||this.switch&&this.switch.args.active)&&(this.args.float=this.args.float>=0?this.args.float:this.args.delay||0,this.noClip=!0,this.args.active=!1,this.args.falling=!0)),this.match&&(this.args.convey=-this.match.args.convey),this.xLast=this.args.x,this.yLast=this.args.y,this.otherDefs.path){let t=this.pathNext||this.otherDefs.path;if(t){var e;for(const e of t.properties)"next"===e.name&&(t=this.viewport.objDefs.get(e.value));const s=null!==(e=this.args.pathSpeed)&&void 0!==e?e:8,i=this.args.x-t.x,r=this.args.y-t.y,a=Math.atan2(r,i);Math.abs(i)<s&&Math.abs(r)<s&&(this.pathNext=t),Math.abs(i)<s?this.args.x=t.x:this.args.x-=s*Math.cos(a),Math.abs(r)<s?this.args.y=t.y:this.args.y-=s*Math.sin(a)}}if(this.args.float&&this.args.oscillateX&&this.args.oscillateY){var s;const e=t+(null!==(s=this.args.offset)&&void 0!==s?s:0)*Math.PI;{const t=Math.sin(e/this.args.timeX)*this.args.oscillateX;this.args.x=this.originalX-t}{const t=-Math.cos(e/this.args.timeY)*this.args.oscillateY;this.args.y=this.originalY-t}}else if(this.args.float&&(this.args.oscillateX||this.args.oscillateY)){const e=Math.cos(Math.sin(t/90)**5)**16.665;if(this.args.oscillateX){const t=Math.round(e*this.args.oscillateX);this.args.x=this.originalX-t}if(this.args.oscillateY){const t=Math.round(e*this.args.oscillateY);this.args.y=this.originalY-t}}if(!this.switch&&this.args.collapse);else if(this.args.droop){if(this.snapBack=this.snapBack||!1,!this.args.colliding&&this.args.yForce&&this.viewport&&this.viewport.onFrameOut(4,()=>{if(!this.viewport)return;const t=this.viewport.collisions.has(this),e=t?[...this.viewport.collisions.get(this).keys()]:[];t&&e.filter(t=>t.controllable).length||(this.snapBack=!0)}),!this.args.colliding&&this.args.yForce&&this.snapBack&&(this.args.yForce*=.15),Math.abs(this.args.yForce)<=1&&(this.snapBack=!1),this.args.yForce!==this.args.yLean){const t=this.args.yLean-this.args.yForce,e=this.args.yForce>this.args.yLean?.666*Math.abs(t):.333*Math.abs(t);this.args.yLean-=Math.sign(t)*e,Math.abs(t)<e&&(this.args.yLean=this.args.yForce)}this.args.yLean?(this.args.y=Math.ceil(this.originalY+this.args.yLean)||this.originalY,this.droop(-1*this.args.yLean,this.droopPos||0)):this.args.y=this.originalY}this.box&&this.box.style({"--convey":Math.abs(this.args.convey)}),this.box&&this.box.style({"--conveyDir":Math.sign(this.args.conveyed)}),this.args.conveyed+=this.args.convey,this.box&&this.box.style({"--conveyed":.8*this.args.conveyed}),this.box&&this.box.setAttribute("data-design",this.args.design);const i=this.args._tiedTo;if(i&&this.chain){const t={x:this.args.x,y:this.args.y-this.args.height};this.chain.style({"--distance":i.distanceFrom(t)+this.args.height,"--angle":i.angleTo(t)+Math.PI/2})}super.update()}updateStart(){this.args.float&&this.args.settle&&(this.weighted&&this.args.y<this.def.get("y")+this.args.settle&&(this.args.y+=Math.min(Math.abs(this.args.settle),64)/8*Math.sign(this.args.settle)),!this.weighted&&this.y>this.def.get("y")&&(this.args.y-=Math.min(Math.abs(this.args.settle),32)/8*Math.sign(this.args.settle))),this.weighted=!1;for(const t of this.watching){const{mode:e,rolling:s,gSpeed:i}=this.originalModes.get(t);let r=.5+(t.x-this.x)/this.args.width;Math.sign(i)<0&&(r=1-r),e&&(r=1-r);const a=t.args.x-t.xLast;if(r>=1&&(this.originalModes.delete(t),this.watching.delete(t),t.noClip=!1),r>=.75)t.args.xSpeed=a,t.args.float=0,t.args.falling=!1,t.args.rolling=s,t.args.ignore=9,0===e&&(t.args.gSpeed=-i,t.args.y=this.args.y+1,t.args.mode=2,t.args.facing=Math.sign(i)<0?"right":"left"),2===e&&(t.args.gSpeed=-i,t.args.y=this.args.y+-this.args.height,t.args.mode=0,t.args.facing=Math.sign(i)<0?"right":"left");else{const n=a;t.args.gSpeed=e?-n:n,t.args.xSpeed=n,t.args.float=-1,t.noClip=!0,t.args.antiSkid=35,t.args.direction=-Math.sign(i);const o=Math.min(Math.max(1.333*r,0),1);s?t.args.rolling=!0:(t.args.corkscrew=Math.min(.5*o,.375),t.args.animation="barrel-roll"),0===e&&(t.args.y=this.y+-this.args.height+this.args.height*o*2),2===e&&(t.args.y=this.y+-this.args.height*o*2)}}}updateEnd(){if(super.updateEnd(),!this.viewport||!this.viewport.collisions.has(this))return;const t=this.viewport.collisions.get(this);if(this.args.treadmill){this.args.convey=0;let e=0,s=0;for(const[i,r]of t)i.args.standingOn===this&&i.args.gSpeed&&(e++,s+=i.args.gSpeed);e&&(this.args.convey=-s/e)}if(this.args.convey)for(const[e,s]of t){if(!e.controllable||e.args.falling)continue;const t=e.bMap("findNextStep",this.args.convey).get(l.Platformer);t[3]||(t[2]&&(e.args.xSpeed=this.args.convey,e.args.ySpeed=0,e.args.falling=!0,e.args.y=-1+this.y-this.args.height),e.args.x+=t[0],e.args.y+=t[1])}if(!this.args.platform)return;const e=Math.min(this.args.ySpeed,this.args.y-this.yLast,0);if(e<0)for(let t=.5*-this.args.width+4;t<.5*this.args.width;t+=4){const s=this.args.x+t,i=this.viewport.actorsAtLine(s,this.args.y+-this.args.height,s,this.args.y+-e+-this.args.height);for(const[t,s]of i)!t.controllable||!t.args.falling||t.args.y<this.args.y||(t.args.y=this.args.y+e+-this.args.height,t.args.ySpeed=this.args.ySpeed,t.args.falling=!1)}}sleep(){this.sleeping=!0,this.args.drop&&this.args.once&&!this.args.float&&this.viewport.actors.remove(this),this.args.drop&&this.args.float>=0&&(this.args.ySpeed=0,this.args.float=-1,this.args.active=!1,this.args.falling=!1,this.viewport.onFrameOut(120,()=>{this.args.y=this.originalY,this.activatedAt=null,this.args.goBack=!1,this.noClip=!1,this.args.ySpeed=0,this.args.float=-1,this.args.active=!1,this.args.falling=!1,this.viewport.setColCell(this)}))}get rotateLock(){return!0}get canStick(){return!this.args.platform}get solid(){return this.args.solid&&(!this.args.collapse||0!==this.args.float||!this.args.goBack)}}}),require.register("actor/Block3d.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Block3d=void 0;var i=e("./Block"),r=e("curvature/base/Tag");t.Block3d=class extends i.Block{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.args.type="actor-item actor-block actor-block-3d"}onRendered(t){super.onRendered(t);const e=new r.Tag('<div class = "panel-3d front-3d">'),s=new r.Tag('<div class = "panel-3d back-3d">'),i=new r.Tag('<div class = "panel-3d right-3d">'),a=new r.Tag('<div class = "panel-3d left-3d">'),n=new r.Tag('<div class = "panel-3d top-3d">'),o=new r.Tag('<div class = "panel-3d bottom-3d">');this.box.append(s.node),this.box.append(i.node),this.box.append(a.node),this.box.append(e.node),this.box.append(n.node),this.box.append(o.node)}}}),require.register("actor/BoostRing.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoostRing=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");t.BoostRing=class extends i.PointActor{constructor(){var t,e;super(...arguments),this.args.type="actor-item actor-boost-ring",this.args.width=16,this.args.height=16,this.args.float=-1,this.args.pointing=null!==(t=this.args.pointing)&&void 0!==t?t:0,this.args.power=null!==(e=this.args.power)&&void 0!==e?e:15,this.shooting=new Set}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--pointing"]="pointing"}collideA(t){!t.controllable||this.shooting.has(t)||t.args.mercy>120||(t.args.rolling=!0,t.args.jumping=!0,t.dashed=!1,t.args.x=this.args.x,t.args.y=this.args.y,t.args.xSpeed=0,t.args.ySpeed=0,t.args.float=15,t.args.ignore=15,t.args.cameraIgnore=30,t.args.groundAngle=0,t.args.cameraMode="boost-ring",t.args.angle=this.args.pointing,t.args.flying=!1,this.shooting.add(t),this.viewport.onFrameOut(4,()=>t.impulse(this.args.power,this.args.pointing,!0)),this.viewport.onFrameOut(2,()=>r.Sfx.play("BOOST_RING")),this.viewport.onFrameOut(10,()=>this.shooting.delete(t)))}get solid(){return!1}}}),require.register("actor/Booster.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Booster=void 0;var i=e("./PointActor");t.Booster=class extends i.PointActor{constructor(){var t,e;super(...arguments),this.args.type="actor-item actor-booster",this.args.xMax=null!==(t=this.args.xMax)&&void 0!==t?t:24,this.args.yMax=null!==(e=this.args.yMax)&&void 0!==e?e:24,this.args.width=64,this.args.height=345,this.args.float=-1}update(){this.viewport&&(super.update(),this.args.launched&&Math.abs(this.args.xSpeed)<Math.abs(this.args.xMax)&&(this.args.xSpeed+=.5*Math.sign(this.args.xMax)),this.args.launched&&Math.abs(this.args.ySpeed)<Math.abs(this.args.yMax)&&(this.args.ySpeed-=5*Math.sign(this.args.yMax)),this.args.launched&&(this.args.falling=!0),this.args.launched&&0===this.args.xSpeed&&this.args.ySpeed)}activate(){this.args.active=!0,this.viewport.auras.add(this),this.args.launched=!0,this.args.xMax&&(this.args.xSpeed+=.5),this.args.yMax&&(this.args.ySpeed-=.5)}explode(){this.viewport.onFrameOut(60,()=>{this.args.launched=!1,this.args.active=!1,this.viewport.auras.delete(this),this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.xSpeed=0,this.args.ySpeed=0,this.args.gSpeed=0,this.viewport.setColCell(this);const t=new CustomEvent("exploded",{detail:{actor:this}});this.dispatchEvent(t)})}sleep(){this.args.launched&&this.explode()}}}),require.register("actor/BouncyMushroom.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BouncyMushroom=void 0;var i=e("./Block");t.BouncyMushroom=class extends i.Block{constructor(){var t;super(...arguments),this.args.width=64,this.args.height=32,this.args.platform=!0,this.args.float=-1,this.args.type="actor-item actor-bouncy-mushroom",this.args.stemLength=null!==(t=this.args.stemLength)&&void 0!==t?t:64,this.args.pressed=0}onRendered(){super.onRendered(),this.autoStyle.get(this.box)["--stem-length"]="stemLength"}update(){if(super.update(),!this.def.get("stemLength")){const t=this.castRayQuick(1024,Math.PI/2,[-16,0],!0)||32,e=this.castRayQuick(1024,Math.PI/2,[16,0],!0)||32;this.args.stemLength=Math.min(t,e)}this.args.active=this.args.pressed>0,this.args.pressed>0&&this.args.pressed--}collideA(t,e){return 0===e&&t.args.ySpeed>=0?(t.args.ySpeed=t.args.flying&&t.flyTime>2?-2:-8,super.collideA(t,e),void(this.args.pressed=6)):super.collideA(t,e)}}}),require.register("actor/BreakableBlock.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreakableBlock=void 0;var i=e("./Block"),r=e("./Orb"),a=(e("./OrbSmall"),e("curvature/base/Tag")),n=e("../audio/Sfx"),o=(e("../behavior/Platformer"),e("../ObjectPalette"));let l=0;class h extends i.Block{constructor(){var t;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-breakable-block",this.args.collapse&&(this.args.type="actor-item actor-breakable-block collapsible-block"),this.args.static=null===(t=this.args.static)||void 0===t||t,this.args.strength=Number(this.args.strength),this.fragmentsX=document.createElement("div"),this.fragmentsY=document.createElement("div"),this.fragmentsX.classList.add("fragmentsX"),this.fragmentsY.classList.add("fragmentsY"),this.fragmentTopLeft=document.createElement("div"),this.fragmentTopRight=document.createElement("div"),this.fragmentBottomLeft=document.createElement("div"),this.fragmentBottomRight=document.createElement("div"),this.fragmentTopLeft.classList.add("fragment"),this.fragmentTopLeft.classList.add("fragment-top-left"),this.fragmentTopRight.classList.add("fragment"),this.fragmentTopRight.classList.add("fragment-top-right"),this.fragmentBottomLeft.classList.add("fragment"),this.fragmentBottomLeft.classList.add("fragment-bottom-left"),this.fragmentBottomRight.classList.add("fragment"),this.fragmentBottomRight.classList.add("fragment-bottom-right"),this.fragmentsY.append(this.fragmentTopLeft),this.fragmentsY.append(this.fragmentTopRight),this.fragmentsY.append(this.fragmentBottomLeft),this.fragmentsY.append(this.fragmentBottomRight),this.fragmentsX.append(this.fragmentsY),this.broken=!1}updateStart(){super.updateStart(),this.switch&&this.switch.args.active&&!this.broken&&this.break()}update(){const t=this.regions;for(const e of t)e.updateActor(this);if(this.args.worm&&!this.broken&&!this.delay2&&this.viewport&&this.viewport.controlActor){this.viewport.controlActor.args.dead&&this.args.x<this.viewport.controlActor.args.x+32&&(this.box.classList.add("will-break"),this.box.classList.add("breaking"),this.box.classList.add("worm"),this.delayedBreak(1),this.delay2||(this.delay2=this.viewport.onFrameOut(1,()=>{this.box.classList.add("broken"),this.delay2=!1})));let t=0;this.viewport.controlActor.args.falling&&(t=-32),this.viewport.controlActor.args.startled&&(t=16),this.args.x<this.viewport.controlActor.args.x+t&&(this.box.classList.add("will-break"),this.box.classList.add("breaking"),this.box.classList.add("worm"),this.delayedBreak(1),this.delay2||(this.delay2=this.viewport.onFrameOut(1,()=>{this.box.classList.add("broken"),this.delay2=!1})))}super.update()}callCollideHandler(){return!this.broken&&super.callCollideHandler(...arguments)}collideA(t,e){if(this.broken)return!1;if(t instanceof i.Block&&(t.args.float||this.args.float))return!1;if(!(t instanceof r.Orb||t.isVehicle||t.controllable||t.args.rolling))return!this.broken;if(this.args.collapse){if(!this.broken&&t.y<=this.y-this.args.height){const e=this.viewport.actorsAtPoint(this.x,this.y+-this.args.height+-1,0,0,{ghosts:!0});if(Array.isArray(e))for(const t of e)if(t instanceof h&&t.args.collapse&&!t.broken)return!1;return this.fragmentsX.style.setProperty("--xSpeed",0),t.args.falling||this.args.worm||this.delayedBreak(25),!0}return!(this.broken||!(!t.args.falling&&!t.args.climbing||t.args.climbing&&t.y<this.y-this.args.height||t.args.ySpeed>0&&t.y<this.y-this.args.height))}if(-2===this.args.strength&&(t.args.falling||Math.abs(t.args.gSpeed)>4))return this.broken||this.break(t),!1;if(-1===this.args.strength)return!0;if(1===this.args.strength&&"knuckles"===t.args.name&&(t.args.falling||Math.abs(t.args.gSpeed)>4)){const e=this.y-this.args.height;return this.args.bounceBack&&t.args.falling&&t.y<e&&(t.args.ySpeed=-this.args.bounceBack,t.args.y=e),this.broken||this.break(t),!1}if(1===this.args.strength){if("knuckles"!==t.args.name&&!t.isVehicle)return!0;if("knuckles"!==t.args.name||t.args.falling||Math.abs(t.args.gSpeed)>4){const e=this.y-this.args.height;return this.args.bounceBack&&t.args.falling&&t.y<e&&(t.args.ySpeed=-this.args.bounceBack,t.args.y=e),this.broken||this.break(t),!1}}if(2===this.args.strength){if(t.isVehicle||t.args.standingOn&&t.args.standingOn.isVehicle){if(0===e)return this.viewport.onFrameOut(1,()=>this.broken||this.break(t)),!0;const s=this.y-this.args.height;return this.args.bounceBack&&t.args.falling&&t.y<s&&(t.args.ySpeed=-this.args.bounceBack,t.args.y=s),this.broken||this.break(t),!1}return!0}if((!t.args.rolling||t.dropDashCharge||!t.args.mode)&&!t.isVehicle&&!t.args.spinning&&(t.args.falling&&!t.dashed&&!t.args.jumping||!t.args.falling&&0===e))return!this.broken;if(!(t instanceof r.Orb||t.falling||t.isVehicle||t.args.gSpeed||t.args.falling))return!this.broken;if(t instanceof r.Orb||t.isVehicle||t.args.spinning&&!t.spinDashCharge||t.args.dashed||t.punching||t.dropDashCharge&&t.args.ySpeed>=0){const e=this.y-this.args.height;return this.args.bounceBack&&t.args.falling&&t.y<e&&(t.args.ySpeed=-this.args.bounceBack,t.args.y=e),this.break(t),!1}return!this.broken}sleep(){this.viewport&&(this.args.dontRestore||(this.args.collapse&&(this.args.static=!0,this.args.falling=!1,this.args.float=-1,this.noClip=!1,this.args.ySpeed=0,this.box.classList.remove("broken"),this.box.classList.remove("breaking"),this.box.classList.remove("will-break"),this.fragmentsX.remove(),this.broken=!1),this.args.worm?this.args.x+=this.args.worm:this.def&&(this.args.x=this.def.get("x")),this.def?(this.args.y=this.def.get("y")+1,this.broken&&(this.box.classList.remove("broken"),this.box.classList.remove("breaking"),this.box.classList.remove("will-break"),this.fragmentsX.remove()),this.args.active=0,this.broken=!1,this.viewport.setColCell(this)):this.viewport.actors.remove(this)))}delayedBreak(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.delay||e&&e.args.falling||(this.box.append(this.fragmentsX),this.delay=this.viewport.onFrameOut(t,()=>{this.break(e,s,!0),this.delay=!1}))}break(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.broken;if(!this.broken){if(s||this.box.append(this.fragmentsX),this.broken=!0,this.box){const e=this.viewport;(!this.args.worm||t&&t.noClip)&&(this.box.classList.add("will-break"),this.box.classList.add("breaking"),this.delay3||(this.delay3=e.onFrameOut(3,()=>{this.box.classList.add("broken"),this.delay3=!1})))}!e&&Date.now()-l>100&&(this.args.worm?(this.viewport.onFrameOut(Math.trunc(3*Math.random()),()=>n.Sfx.play("WORM_BLOCK_DESTROYED")),l=Date.now()):this.viewport.onFrameOut(Math.trunc(3*Math.random()),()=>n.Sfx.play(this.breakSound||"BLOCK_DESTROYED")));const i=t&&t.occupant||t;if(i&&i.controllable){if(i.args.popChain.length){const t={label:this.args.name,points:10,multiplier:1};i.args.popCombo+=1,i.args.popChain.push(t)}const t=document.createElement("div");t.classList.add("particle-score"),t.classList.add("score-10");const e=new a.Tag(t);e.style({"--x":this.args.x,"--y":this.args.y-this.args.height}),this.viewport.particles.add(e),setTimeout(()=>this.viewport&&this.viewport.particles.remove(e),768),i.args.score+=10}if(this.args.contains&&o.ObjectPalette[this.args.contains]){const t=new o.ObjectPalette[this.args.contains];t.args.x=this.args.x,t.args.y=this.args.y-.5*this.args.height,t.args.falling=!0,t.args.xSpeed=this.xSpeedLast||this.gSpeedLast,t.args.ySpeed=this.args.ySpeed,t.args.ySpeed=-6,this.viewport.spawn.add({object:t})}}if(this.delay4||(this.delay4=this.viewport.onFrameOut(20,()=>{this.box&&this.box.classList.remove("breaking"),this.fragmentsX.remove(),this.delay4=!1})),!this.args.collapse&&t&&t.args.mode%2==0){const e=t.args.xSpeed||t.args.gSpeed,s=Math.sign(e),i=Math.abs(e),r=Math.min(512,i)*s;t.isVehicle?this.fragmentsX.style.setProperty("--xSpeed",Math.round(1.1*r)):t.controllable?this.fragmentsX.style.setProperty("--xSpeed",Math.round(1.5*r)):this.fragmentsX.style.setProperty("--xSpeed",2*Math.round(r))}if(this.refresher||(this.refresher=!0),this.args.active=1,this.args.collapse&&!i){const t=this.viewport.actorsAtPoint(this.x-this.args.width,this.y,0,0,{ghosts:!0}),s=this.viewport.actorsAtPoint(this.x+this.args.width,this.y,0,0,{ghosts:!0}),i=this.viewport.actorsAtPoint(this.x,this.y+1,0,0,{ghosts:!0});if(Array.isArray(t)&&!Math.sign(this.args.worm))for(const s of t)s instanceof h&&s.args.collapse&&(s.broken||s.delayedBreak(8,null,e));if(Array.isArray(s)&&!Math.sign(this.args.worm))for(const t of s)t instanceof h&&t.args.collapse&&(t.broken||t.delayedBreak(8,null,e));if(Array.isArray(i)&&!Math.sign(this.args.worm))for(const t of i)t instanceof h&&t.args.collapse&&(t.broken||t.delayedBreak(8,null,!0))}else if(!i){const t=this.viewport.actorsAtPoint(this.x,this.y+-this.args.height,0,0,{ghosts:!0});if(Array.isArray(t)&&!Math.sign(this.args.worm))for(const s of t)s instanceof h&&s.args.collapse&&(s.broken||s.delayedBreak(8,null,e))}this.viewport&&this.viewport.settings.rumble&&!this.broken&&t&&t.controller&&t.controller.rumble&&(t.controller&&t.controller.rumble&&t.controller.rumble({duration:140,strongMagnitude:1,weakMagnitude:1}),this.onTimeout(140,()=>{t.controller.rumble({duration:100,strongMagnitude:0,weakMagnitude:.25})})),this.broken=!0}damage(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.break(t)}get solid(){return this.args.solid&&!this.broken&&-2!==this.args.strength}}t.BreakableBlock=h}),require.register("actor/BrokenMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrokenMonitor=void 0;var i=e("./PointActor");e("../actor/Explosion"),e("../actor/Monitor");t.BrokenMonitor=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-monitor actor-monitor-broken",this.args.width=28,this.args.height=32}collideA(t){return super.collideA(t),!0}get canStick(){return!1}get solid(){return!1}}}),require.register("actor/Bubbles.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bubbles=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/base/Tag"),a=(e("./Flickie"),e("./PointActor")),n=e("../behavior/SkidDust"),o=e("../mixin/CanPop"),l=(e("../actor/Explosion"),e("../actor/Projectile"),e("../powerups/ElectricSheild"));t.Bubbles=class extends(i.Mixin.from(a.PointActor,o.CanPop)){constructor(){super(...arguments),this.behaviors.add(new n.SkidDust),this.args.type="actor-item actor-bubbles",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=32,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.float=-1,this.args.static=!0,this.aiming=!1}onRendered(t){super.onRendered(t),this.shield=new l.ElectricSheild,this.args.electric&&(this.inventory.add(this.shield),this.args.currentSheild=this.shield),this.autoAttr.get(this.box)["data-gold"]="gold",this.autoAttr.get(this.box)["data-fade"]="fade",this.chain=new r.Tag('<div class = "bubbles-flame">'),this.sprite.appendChild(this.chain.node)}update(){if(!this.viewport||!this.viewport.controlActor)return;if(this.args.gold&&!this.args.fading&&Math.abs(this.viewport.controlActor.x-this.x)<256&&Math.abs(this.viewport.controlActor.y-this.y)<128){this.args.fading=!0;const t=this.viewport;t.onFrameOut(25,()=>this.args.fade=!0),t.onFrameOut(55,()=>t.actors.remove(this))}const t=this.viewport.args.frameId-this.viewport.args.startFrameId;this.viewport&&this.args.electric&&t%100==0&&(this.args.currentSheild=this.args.currentSheild?null:this.shield),this.box&&this.box.setAttribute("data-animation","standing"),this.args.falling=!0,this.args.flying=!0,super.update()}hold_1(){this.aiming=!0}release_1(){this.aiming=!1}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Bumper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bumper=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Bumper=class extends i.PointActor{constructor(){super(...arguments),a(this,"float",-1),this.args.type="actor-item actor-bumper",this.args.width=16,this.args.height=16,this.ignores=new Map}collideA(t){if(!(t.args.static||t.isRegion||this.ignores.has(t)||t.noClip)){if(this.args.type="actor-item actor-bumper actor-bumper-active",this.viewport.onFrameOut(3,()=>this.args.type="actor-item actor-bumper"),t.args.falling){r.Sfx.play("BUMPER_BOUNCE");const e=this.x-t.x,s=this.y-t.y,i=Math.max(12,Math.hypot(t.args.xSpeed,t.args.ySpeed)),a=Math.atan2(s,e);t.args.width,t.args.x=this.x,t.args.y=this.y,t.args.xSpeed=-i*Math.cos(a),t.args.ySpeed=-i*Math.sin(a)}else t.args.gSpeed*=-1,Math.abs(t.args.gSpeed)<7&&(t.args.gSpeed=7*Math.sign(t.args.gSpeed));this.ignores.set(t,8),this.viewport.settings.rumble&&t&&t.controller&&t.controller.rumble&&(t.controller.rumble({duration:120,strongMagnitude:1,weakMagnitude:1}),this.onTimeout(120,()=>{t.controller.rumble({duration:120,strongMagnitude:0,weakMagnitude:1})}))}}get canStick(){return!1}get rotateLock(){return!0}get solid(){return!0}}}),require.register("actor/ButterDroid.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButterDroid=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/CanPop");t.ButterDroid=class extends(r.Mixin.from(i.PointActor,a.CanPop)){constructor(t,e){super(t,e),this.args.type="actor-item actor-butter-droid",this.args.width=24,this.args.height=24,this.args.float=-1,this.args.gravity=0,this.args.phase="idle"}update(){if(!this.viewport||!this.viewport.actorIsOnScreen(this))return;const t=this.viewport;this.args.xSpeed=.8*Math.sign(Math.sin(this.age/60)),super.update(),t.controlActor?(this.args.facing=this.args.xSpeed>0?"left":"right",this.args.float=-1):this.args.phase="idle"}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/BuzzBomber.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuzzBomber=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("curvature/base/Tag"),a=e("./PointActor"),n=e("../behavior/SkidDust"),o=e("../mixin/CanPop"),l=(e("../actor/Explosion"),e("../actor/Projectile"));t.BuzzBomber=class extends(i.Mixin.from(a.PointActor,o.CanPop)){constructor(){super(...arguments),this.behaviors.add(new n.SkidDust),this.args.type="actor-item actor-buzz-bomber",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=2,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=32,this.args.height=16,this.willStick=!1,this.stayStuck=!1,this.args.float=-1,this.aiming=!1}onRendered(){if(super.onRendered(),this.flame=new r.Tag('<div class = "buzz-bomber-flame">'),this.wings=new r.Tag('<div class = "buzz-bomber-wings">'),this.sprite.appendChild(this.flame.node),this.sprite.appendChild(this.wings.node),this.aiming)this.box.setAttribute("data-animation","aiming");else{const t=this.args.direction;Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","skidding"):this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")}}update(){this.args.ySpeed=this.yAxis,this.flame,0===this.args.xSpeed&&this.viewport&&this.viewport.onFrameOut(10,()=>{this.attack()}),this.args.falling=!0,this.args.flying=!0,super.update()}command_1(){this.aiming=!this.aiming}command_2(){if(!this.aiming||!this.viewport)return;const t=[0,-24],e=new l.Projectile({direction:this.args.direction,x:this.args.x+t[0]+(this.args.xSpeed||this.args.gSpeed),y:this.args.y+t[1],owner:this,xSpeed:this.args.xSpeed||this.args.gSpeed,YSpeed:this.args.YSpeed});e.impulse(6,1.57+Math.PI/4*1),this.viewport.auras.add(e),this.viewport.spawn.add({object:e})}effect(t){super.effect(t)}wakeUp(){this.viewport&&(this.viewport,this.sleeping=!1,this.attack())}attack(){if(this.sleeping||this.attacking)return;if(!this.viewport)return;const t=this.viewport;this.args.direction=-1,this.args.facing="left",this.args.xSpeed=-10,this.aiming=!1,this.attacking=!0,t.onFrameOut(5,()=>{this.aiming=!0,t.onFrameOut(5,()=>{let e=2;const s=t.onFrameInterval(5,()=>{this.command_2(),e--||s()})})}),t.onFrameOut(50,()=>{const e=this.args.xSpeed;this.args.xSpeed=.5*-e,t.onFrameOut(100,()=>{this.aiming=!1,this.attacking=!1,this.args.xSpeed=0,this.args.ySpeed=0})})}sleep(){this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.onNextFrame(()=>{this.viewport&&(this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.args.xSpeed=0,this.args.ySpeed=0,this.args.pushed=0,this.args.float=0,this.attacking=!1,this.sleeping=!0)})}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Catakiller.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Catakiller=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/CanPop"),n=e("./CatakillerSegment");t.Catakiller=class extends(r.Mixin.from(i.PointActor,a.CanPop)){constructor(t,e){super(t,e),this.args.type="actor-item actor-catakiller",this.args.width=16,this.args.height=24,this.args.phase="idle",this.args.scootSpeed=this.args.scootSpeed||2,this.args.segments=this.args.segments||6,this.args.pauseTime=this.args.pauseTime||45,this.args.phaseTime=this.args.phaseTime||600,this.segments=[]}update(){if(this.segments.length<this.args.segments){const t=new n.CatakillerSegment({leader:this.segments.length?this.segments[this.segments.length-1]:this,position:this.segments.length,following:!0,head:this,x:this.args.x+10*(this.segments.length+1),y:this.args.y,z:this.args.z-(this.segments.length+1)});this.segments.push(t),this.viewport.spawn.add({object:t})}if(!this.viewport||!this.viewport.actorIsOnScreen(this))return void super.update();this.viewport;const t=this.args.phaseTime,e=.5*t,s=this.age%30,i=this.age%t<e?1:-1;this.age%e<e-this.args.pauseTime&&s>15?(this.args.gSpeed=this.args.scootSpeed*i,this.args.animation="mouth-open",0!==Math.round(this.args.gSpeed)&&(this.args.facing=this.args.gSpeed>0?"left":"right")):(this.args.animation="mouth-closed",this.args.gSpeed=0),super.update()}pop(){this.segments&&this.segments.forEach(t=>{t.args.popped=!0,t.args.falling=!0,t.args.xSpeed=2*-Math.sign(this.gSpeedLast)*(t.args.position-this.segments.length/2),t.args.ySpeed=-14,t.viewport&&t.viewport.onFrameOut(160,()=>t.noClip=!0)}),super.pop(...arguments)}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/CatakillerSegment.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CatakillerSegment=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin");e("../mixin/CanPop");t.CatakillerSegment=class extends(r.Mixin.from(i.PointActor)){constructor(t,e){super(t,e),this.args.type="actor-item actor-catakiller-segment",this.args.width=16,this.args.height=16,this.args.following=this.args.following||!1,this.args.willMove=!0,this.args.popped=!1,this.args.bounces=1}collideA(t,e){t.controllable&&!this.args.popped&&(0===this.args.position&&this.args.head?this.args.head.collideA(t,e):t.damage(this))}onRendered(){super.onRendered(),this.box&&this.args.position%2==0&&(this.autoStyle.get(this.box)["--space"]="space")}update(){if(this.args.leader&&this.args.head&&!this.args.popped){const t=this.args.leader.args.x,e=Math.abs(this.args.x-t);let s=Math.abs(this.args.head.gSpeedLast||0);this.args.space=e,e<9.5?this.args.willMove=!1:e>13&&(this.args.willMove=!0),this.args.willMove?this.args.gSpeed=s*-Math.sign(this.args.x-t):this.args.gSpeed=0,0!==this.args.gSpeed&&(this.args.facing=this.args.gSpeed>0?"left":"right"),this.args.groundAngle=0}const t=this.args.y;super.update(),this.args.popped&&this.args.y===t&&(this.args.bounces>0?(this.args.ySpeed=-Math.max(this.ySpeedLast||5),this.args.xSpeed=(this.gSpeedLast||this.xSpeedLast||0)+Math.sign(this.xSpeedLast||0),this.args.falling=!0,this.args.bounces--):(this.noClip=!0,this.args.ySpeed=Math.max(this.ySpeedLast||5),this.args.falling=!0))}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/CautionPanel.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CautionPanel=void 0;var i=e("./PointActor");t.CautionPanel=class extends i.PointActor{constructor(){super(...arguments),this.args.width=80,this.args.height=48,this.args.type="actor-item actor-caution-panel",this.args.z=0}get solid(){return!1}}}),require.register("actor/CautionSign.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CautionSign=void 0;var i=e("./PointActor");t.CautionSign=class extends i.PointActor{constructor(){super(...arguments),this.args.width=20,this.args.height=60,this.args.type="actor-item actor-caution-sign"}get solid(){return!1}}}),require.register("actor/ChainShot.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChainShot=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");e("curvature/base/Tag");t.ChainShot=class extends i.PointActor{constructor(){super(...arguments),this.args.width=16,this.args.height=128,this.args.type="actor-item actor-chain-shot",this.args.float=-1,this.args.shooting=!1,this.args.animation="idle"}update(){super.update(),"shooting"===this.args.animation&&this.viewport.args.frameId%5==0&&r.Sfx.play("CHOPPER_GUN",{})}collideA(t){this.args.shooting&&t.controllable&&t.damage(this)}}}),require.register("actor/Chalmers.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chalmers=void 0;var i=e("./PointActor"),r=(e("curvature/base/Tag"),e("../behavior/SkidDust"));t.Chalmers=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new r.SkidDust),this.args.type="actor-item actor-chalmers",this.args.normalHeight=45,this.args.rollingHeight=23,this.args.accel=.25,this.args.decel=.4,this.args.gSpeedMax=18,this.args.jumpForce=11,this.args.gravity=.5,this.args.width=18,this.args.height=32}onRendered(t){super.onRendered(t),this.box=this.findTag("div")}update(){const t=this.args.falling;if(this.box){if(t)this.args.standingOn&&this.args.standingOn.isVehicle?this.box.setAttribute("data-animation","standing"):this.args.jumping&&this.box.setAttribute("data-animation","jumping");else{this.yAxis>0?this.args.crouching=!0:this.args.crouching=!1;const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;this.args.rolling?this.box.setAttribute("data-animation","rolling"):Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","standing"):s>.25*i?this.box.setAttribute("data-animation","running"):this.args.moving&&e?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")}super.update()}else super.update()}get solid(){return!1}get canRoll(){return!0}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/Chao.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chao=void 0;var i=e("../sprite/Png"),r=e("./PointActor"),a=e("./Mushroom"),n=e("./Coconut"),o=e("./Tree"),l=e("curvature/base/Uuid");function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Chao=class extends r.PointActor{constructor(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];super(...e),h(this,"png",new i.Png("/DBurraki/chao-normal.png")),this.args.type="actor-item actor-chao",this.args.particleScale=.75,this.args.spriteSheet=this.spriteSheet="/DBurraki/chao-normal.png",this.args.width=14,this.args.height=18,this.args.uuid=e.uuid||String(new l.Uuid),this.xHold=8,this.yHold=0,this.maxFlight=270,this.emotes=["normal","alert","inquire","like","love","angry"],this.emoteIndex=0,this.args.animation="standing",this.args.inWater=!1,this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),t)this.cX=t.args.bindTo("x",e=>this.args.x=e+8*t.args.direction),this.cY=t.args.bindTo("y",t=>this.args.y=t+-16),t.carrying.add(this),this.args.float=-1,this.args.groundAngle=0;else if(this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,t.carrying.delete(this),this.args.falling=!0,this.args.float=0}}),this.args.direction=1,this.args.currentState=this.args.currentState||"sitting",this.args.bindTo("currentState",()=>{this.args.stateTime=0}),this.args.alignment="neutral",this.stats={intelligence:0,stamina:0,luck:0,run:0,swim:0,fly:0,power:0},this.traits={appetite:0,sociable:0,restless:0},this.mood={attitude:0,happy:1,hunger:0,health:1,social:0},this.defaultColors=["addef8","2ebee9","0e6d89","ecde2f","dcb936","985000","f8b0c0","f85080","e4e0e4","e0e0e0","f8f820","606080"],this.customColors=[null,null,null,null,null,null,null,null,null,null,null,null],this.customColors.bindTo(()=>{const t={};for(const s in this.defaultColors){var e;t[this.defaultColors[s]]=null!==(e=this.customColors[s])&&void 0!==e?e:this.defaultColors[s]}this.png.ready.then(()=>{const e=this.png.recolor(t).toUrl();this.args.spriteSheet=e})},{wait:0}),this.chaoAge=0}onAttached(t){this.listening||(this.box.addEventListener("click",t=>this.onClick(t)),this.box.addEventListener("contextmenu",t=>this.onRightClick(t)),this.listening=!0),this.setAutoAttr("currentState","data-current-state"),this.setAutoAttr("alignment","data-alignment"),this.setAutoAttr("direction","data-direction"),this.setAutoAttr("emote","data-emote");const e=this.viewport;this.onRemove(()=>clearInterval(e.onInterval(1500,()=>{this.emoteIndex>=this.emotes.length&&(this.emoteIndex=0),this.args.emote=this.emotes[this.emoteIndex],this.emoteIndex++,this.onRemove(()=>e.onTimeout(500,()=>{this.args.emote="normal"}))})));const s={addef8:"e4e0e4","2ebee9":"c0bde4","0e6d89":"9c99c0",ecde2f:"addef8",dcb936:"2ebee9",985000:"0e6d89",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"cdeef8",f8f820:"9c99c0"},i={addef8:"485070","2ebee9":"303058","0e6d89":"202020",ecde2f:"b70000",dcb936:"770000",985000:"420000",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",f8f820:"bf999c",606080:"202020"},r={addef8:"ff7575","2ebee9":"e00000","0e6d89":"800000",ecde2f:"b70000",dcb936:"770000",985000:"420000",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",606080:"202020"},a={addef8:"e08000","2ebee9":"b76900","0e6d89":"7d4800",ecde2f:"b44800",dcb936:"844221",985000:"630000",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",606080:"202020"},n={addef8:"80e000","2ebee9":"69b700","0e6d89":"487d00",ecde2f:"48b400",dcb936:"428421",985000:"006300",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",606080:"202020"},o={addef8:"485070","2ebee9":"303058","0e6d89":"202020",ecde2f:"c0bde4",dcb936:"9c99c0",985000:"606080",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",f8f820:"9c99c0",606080:"202020"},l={addef8:"c0bde4","2ebee9":"9c99c0","0e6d89":"606080",ecde2f:"485070",dcb936:"303058",985000:"202020",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",f8f820:"9c99c0",606080:"202020"},h={addef8:"c0bde4","2ebee9":"9c99c0","0e6d89":"606080",ecde2f:"e4e0e4",dcb936:"c0bde4",985000:"9c99c0",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",f8f820:"9c99c0",606080:"202020"},g={addef8:"80e000","2ebee9":"69b700","0e6d89":"487d00",ecde2f:"b70000",dcb936:"770000",985000:"420000",ffa3b1:"ffa3b1",fa6379:"fa6379",e4e0e4:"e4e0e4",606080:"202020"};this.png.ready.then(()=>{this.heroSheet=this.png.recolor(s).toUrl(),this.darkSheet=this.png.recolor(i).toUrl(),this.rubySheet=this.png.recolor(r).toUrl(),this.tangySheet=this.png.recolor(a).toUrl(),this.limeSheet=this.png.recolor(n).toUrl(),this.coalSheet=this.png.recolor(o).toUrl(),this.mimeSheet=this.png.recolor(l).toUrl(),this.whiteSheet=this.png.recolor(h).toUrl(),this.limeRubySheet=this.png.recolor(g).toUrl()})}generate(){Object.assign(this.stats,{intelligence:0,stamina:0,luck:0,run:0,swim:0,fly:0,power:0}),Object.assign(this.traits,{appetite:0,sociable:0,restless:0}),Object.assign(this.mood,{attitude:0,happy:1,hunger:0,health:1,social:0})}lift(t){if(this.carriedBy===t)return this.carriedBy=null,void(this.args.currentState="standing");this.carriedBy=t,this.args.currentState="held"}get solid(){return!1}update(){if("garden"===viewport.meta.fieldType&&this.chaoAge%120==0){const t=viewport.getZoneState(),e=t.chao.find(t=>t.uuid===this.args.uuid);e?Object.assign(e,this.store()):t.chao.push(this.store()),viewport.currentSave.save()}for(const t of this.carrying)t.args.x=this.args.x+this.args.direction*this.xHold,t.args.y=this.args.y+this.yHold;this.args.inWater=!1;const t=[...this.regions].filter(t=>t.args.density>=1);if(t.length){if("flying"!==this.args.currentState&&this.args.ySpeed>=0){const e=t[0].args.y-t[0].args.height+6,s=3;"walking"!==this.args.currentState&&(this.args.xSpeed=.95*this.args.xSpeed),this.args.y>e?(this.args.falling=!0,this.args.ySpeed+=-.25,this.args.float=-1,this.args.ySpeed>s&&(this.args.ySpeed=s),this.args.ySpeed<-s&&(this.args.ySpeed=-s)):(this.args.ySpeed>0&&Math.abs(this.args.y-e)<s&&(this.args.y=e),this.args.ySpeed=0,this.args.float=1),this.args.groundAngle=0}this.args.inWater=!0}else"flying"!==this.args.currentState&&(this.args.float=0);this.mood.hunger<1&&(this.traits.appetite<.333?this.mood.hunger+=2e-5:this.traits.appetite<.666?this.mood.hunger+=4e-5:this.mood.hunger+=6e-5),this.mood.social<1&&(this.traits.sociable<.333?this.mood.social+=2e-4:this.traits.sociable<.666?this.mood.social+=4e-4:this.mood.social+=6e-4),["eating","holding"].includes(this.args.currentState)||this.carrying.size&&(this.args.currentState="holding");const e=String(this.args.currentState).charAt(0).toUpperCase()+String(this.args.currentState).slice(1);"function"==typeof this["state"+e]&&this["state"+e](),this.mood.hunger<.3&&(this.selectedFood=null,this.selectedTree=null),this.selectedFood&&this.selectedFood.carriedBy&&(this.selectedThing=null,this.selectedFood=null),this.selectedTree&&this.selectedTree.args.shaking&&"shakingTree"!==this.args.currentState&&(this.selectedThing=null,this.selectedTree=null),this.selectedTree&&this.selectedTree.args.shaking||(this.args.z=2),super.update(),this.args.stateTime++,this.chaoAge++}collideA(t,e){super.collideA(t,e),this.selectedFriend!==t||this.carriedBy||"flying"===this.args.currentState||(this.args.currentState="fun"),t.carriedBy||this.carrying.size||((t instanceof n.Coconut||t instanceof a.Mushroom)&&t.args.size&&t.args.falling===this.args.falling&&t.lift(this),this.selectedFood===t&&(this.selectedThing=null,this.selectedFood=null),this.selectedTree===t&&Math.abs(this.args.x-t.args.x)<8&&this.args.y<=t.args.y+3&&(this.args.currentState="shakingTree"))}stateStanding(){this.args.animation="standing",this.args.falling||(this.args.xSpeed=0,this.args.ySpeed=0),this.args.stateTime>120&&(this.args.currentState="thinking")}stateThinking(){this.args.falling||(this.args.xSpeed=0,this.args.ySpeed=0),this.args.animation="thinking",this.args.stateTime>60?this.args.currentState="searching":0==this.args.stateTime&&(this.args.emote="inquire")}stateSearching(){this.args.animation="searching",this.args.emote="inquire",this.args.stateTime>90?this.args.emote="alert":this.args.emote="inquire",this.args.stateTime>120&&(this.args.direction=Math.sign(Math.random()-.5),this.getMapSolidAt(this.args.x+8*this.args.direction,this.args.y)&&(this.args.direction*=-1),this.mood.hunger>.5?this.args.currentState="seekingFood":this.mood.social>.75?this.args.currentState="seekingFriend":Math.random()>.15*this.traits.restless?this.args.groundAngle||this.args.inWater?this.args.currentState="walking":this.args.currentState="sitting":this.args.currentState="walking")}stateWalking(){this.args.inWater?this.args.animation="flying":this.args.animation="walking",this.args.stateTime<15?this.args.emote="alert":16===this.args.stateTime&&(this.args.emote="normal"),this.args.inWater?this.args.xSpeed=1*this.args.direction:this.args.gSpeed=.01*this.args.direction,this.args.stateTime>40&&(!this.args.inWater&&Math.random()>.9&&(this.args.currentState="tripping"),!this.selectedThing&&Math.random()>.95?this.args.currentState="flying":this.selectedThing&&this.selectedThing.args.y<this.args.y?this.args.currentState="flying":!this.selectedThing&&Math.random()>.98&&(this.args.currentState="searching"))}stateTripping(){this.args.animation="tripping",this.args.stateTime>10?this.args.gSpeed=0:this.args.gSpeed=1*this.args.direction,this.args.stateTime>20?this.args.stateTime<30&&Math.random()>.6&&(this.args.emote="angry"):this.args.emote="alert",this.args.stateTime>120&&(this.args.currentState="sitting")}stateFlying(){this.args.animation="flying",this.args.inWater&&this.args.y--,1===this.args.stateTime&&(this.flightTime=this.maxFlight/2+Math.round(this.maxFlight/2*Math.random())),this.args.xSpeed&&this.getMapSolidAt(this.args.x+8*Math.sign(this.args.xSpeed),this.args.y)&&(this.args.direction*=-1,this.args.xSpeed*=-1),this.getMapSolidAt(this.args.x,this.args.y+2)&&(this.args.falling=!0,this.args.float=-1),!this.selectedThing&&this.args.stateTime>120&&this.args.ySpeed<0?this.args.ySpeed*=.4:this.selectedThing&&this.args.y<this.selectedThing.args.y-96&&(this.args.ySpeed*=.4),this.selectedThing&&this.selectedThing.args.y-32<this.args.y?(this.selectedThing&&Math.abs(this.selectedThing.args.x-this.args.x)>32&&(this.args.direction=Math.sign(this.selectedThing.args.x-this.args.x)),this.args.xSpeed=1.25*this.args.direction,this.args.ySpeed>-1.5&&(this.args.ySpeed-=.1)):this.selectedThing&&Math.abs(this.selectedThing.args.x-this.args.x)<32&&(this.args.direction=Math.sign(this.selectedThing.args.x-this.args.x),this.args.currentState="walking"),this.args.stateTime<this.flightTime?(this.args.groundAngle=0,this.args.ySpeed&&this.args.falling?this.args.ySpeed>=0&&(this.args.currentState="flying"):(this.args.xSpeed||this.args.gSpeed||this.selectedThing||(this.args.direction=Math.sign(Math.random()-.5)),this.args.falling=!0,this.args.ySpeed=-1,this.args.xSpeed=1.25*this.args.direction,this.args.float=-1)):this.selectedThing||(this.args.currentState="thinking")}stateHatching(){this.stateSitting()}stateSitting(){this.args.xSpeed=0,this.args.inWater?this.args.animation="standing":this.args.animation="sitting",this.args.stateTime>120&&(this.mood.hunger>.5?this.args.currentState="seekingFood":this.mood.social>.75?this.args.currentState="seekingFriend":Math.random()>.35*this.traits.restless?this.args.currentState="walking":this.args.currentState="thinking")}stateWaiting(){this.args.xSpeed=0,Math.trunc(this.args.stateTime/15)%2&&(Math.random()<.2?this.args.emote="inquire":this.args.emote="normal"),this.args.inWater?this.args.animation="standing":this.args.animation="sitting"}stateSwimming(){}stateFlyingLooking(){}stateHolding(){if(this.args.stateTime<60)return this.args.animation="thinking",void(this.args.emote="inquire");for(const t of this.carrying)t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=0,(t instanceof n.Coconut||t instanceof a.Mushroom)&&(this.mood.hunger>.5||this.mood.hunger>.25&&Math.random()<.5?(this.args.emote="love",this.args.currentState="eating",t.carriedBy=this,t.noClip=!0):(this.args.currentState="walking",t.noClip=!1,t.carriedBy=null,this.carrying.delete(t),t.args.falling=!0,t.args.x=this.args.x,t.args.y=this.args.y,t.args.xSpeed=-3*this.args.direction+Math.random(),t.args.ySpeed=-3+Math.random(),t.args.float=0,this.ignores.set(t,60)))}stateEating(){const t=new Set;for(const e of this.carrying)(e instanceof n.Coconut||e instanceof a.Mushroom)&&t.add(e);if(this.args.falling||(this.args.ySpeed=0),this.carriedBy?this.args.float=-1:this.args.float=0,this.args.xSpeed=0,this.args.animation="eating",this.args.emote="love",this.selectedThing!==this.selectedFriend&&(this.selectedThing=null),this.selectedFood=null,this.selectedTree=null,this.args.stateTime&&this.args.stateTime%75==0)for(const e of t)e.args.size--,this.mood.hunger-=e.args.nourishment,e.args.size||(this.carriedBy?this.args.currentState="held":this.args.currentState="thinking",e.lift(this),this.viewport.actors.remove(e))}stateHeld(){this.args.falling=!1,this.args.stateTime<15?this.args.emote="like":this.args.stateTime<60?(this.args.emote="love",this.args.animation="walking"):61===this.args.stateTime&&(this.args.emote="normal",this.args.animation="searching")}stateFun(){const[t,e]=this.nearestFriend();if(!t)return void(this.args.currentState="searching");const s=Math.sign(this.args.x-t.args.x);if(this.args.direction=-s,Math.abs(this.args.x-t.args.x)<16&&(this.args.x-=.1*(this.args.x-(t.args.x+16*s))),e>25)return void(this.args.currentState="searching");if(this.mood.social<.5)return this.args.direction*=-1,this.args.currentState="walking",this.selectedFriend=null,void(this.selectedThing=null);this.args.stateTime<45?this.args.emote="alert":this.args.emote="love",this.args.animation="walking";let i=1;this.selectedThing&&"fun"===this.selectedThing.args.currentState&&(i=.4),this.traits.sociable<.333?this.mood.social-=.004*i:this.traits.sociable<.666?this.mood.social-=.003*i:this.mood.social-=.002*i}stateSeekingFriend(){if(this.viewport.args.frameId%60==0){const[t,e]=this.nearestFriend();if(this.selectedThing=t,this.selectedFriend=t,!t)return void(this.args.currentState="thinking");this.args.direction=Math.sign(t.args.x-this.args.x),t.args.y<this.args.y?this.args.currentState="flying":this.args.currentState="walking"}}stateSeekingFood(){if(this.selectedFriend=null,this.viewport.args.frameId%60==0){const[t,e]=this.nearestFood();if(this.selectedThing=t,this.selectedFood=t,t)this.args.direction=Math.sign(t.args.x-this.args.x),t.args.y<this.args.y?this.args.currentState="flying":this.args.currentState="walking";else{this.selectedThing=null,this.selectedFood=null,this.args.currentState="thinking";const[t,e]=this.nearestTree();if(this.selectedThing=t,this.selectedTree=t,!t)return this.selectedThing=null,this.selectedTree=null,void(this.args.currentState="thinking");this.args.direction=Math.sign(t.args.x-this.args.x),t.args.y<this.args.y?this.args.currentState="flying":this.args.currentState="walking"}}}stateShakingTree(){if(!this.selectedTree)return void(this.args.currentState="thinking");if(!this.selectedTree.args.coconutCount)return void(this.args.currentState="thinking");if(this.args.stateTime%45==0&&Math.random()>.75)return this.args.selectedThing=null,this.args.selectedTree=null,this.args.currentState="seekingFood",void(this.args.animation="standing");const t=Math.sign(this.args.x-this.selectedTree.args.x);this.args.direction=-t,this.args.x=this.selectedTree.args.x+8*t,this.args.z=this.selectedTree.args.z-1,this.args.gSpeed=0,this.args.animation="shaking"}store(){return{stateTime:this.args.stateTime,state:this.args.currentState,name:this.args.name,colors:this.customColors,align:this.args.alignment,position:[this.args.x,this.args.y],traits:this.traits,uuid:this.args.uuid,stats:this.stats,mood:this.mood,age:this.chaoAge}}load(t){var e,s;"string"==typeof t&&(t=JSON.parse(t)),this.args.name=null!==(e=t.name)&&void 0!==e?e:"",t.align&&(this.args.alignment=t.align),t.position&&(this.args.x=t.position[0],this.args.y=t.position[1]),t.state&&(this.args.currentState=t.state,this.args.stateTime=null!==(s=t.stateTime)&&void 0!==s?s:0),t.uuid&&(this.args.uuid=t.uuid),t.age&&(this.chaoAge=t.age),t.colors&&Object.assign(this.customColors,t.colors),t.traits&&Object.assign(this.stats,t.traits),t.stats&&Object.assign(this.stats,t.stats),t.mood&&Object.assign(this.mood,t.mood)}nearestFriend(){const t=this.viewport.nearbyActors(this.args.x,this.args.y);let e=null,s=1/0;for(const i of t){if(i===this)continue;if(!(i instanceof this.constructor))continue;if(i.args.gSpeed||"eating"===i.args.currentState)continue;const t=this.distanceTo(i);this.canSee(i)&&t<s&&(e=i,s=t)}return[e,s]}nearestFood(){const t=this.viewport.nearbyActors(this.args.x,this.args.y);let e=null,s=1/0;for(const i of t){if(i===this)continue;if(!(i instanceof n.Coconut))continue;if(i.carriedBy)continue;const t=this.distanceTo(i);this.canSee(i)&&t<s&&(e=i,s=t)}return[e,s]}nearestTree(){const t=this.viewport.nearbyActors(this.args.x,this.args.y);let e=null,s=1/0;for(const i of t){if(i===this)continue;if(!(i instanceof o.Tree))continue;if(!i.args.coconutCount)continue;if(i.args.shaking)continue;const t=this.distanceTo(i);this.canSee(i)&&t<s&&(e=i,s=t)}return[e,s]}}}),require.register("actor/ChaoCrate.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChaoCrate=void 0;var i=e("./BreakableBlock"),r=e("./Egg");t.ChaoCrate=class extends i.BreakableBlock{constructor(){super(...arguments),this.args.type="actor-item actor-breakable-block actor-chao-crate",this.args.width=60,this.args.height=60,this.args.static=!1,this.args.spriteSheet="/Sonic/chao-crate.png"}setTile(){}sleep(){}wakeUp(){}collideA(t,e){return!(0!==e||!t.controllable)||(-1!==e||t.args.gSpeed||t.args.falling||!t.controllable?1!==e&&3!==e||t.y<=this.y-this.args.height||(t.args.rolling||2===e?(this.break(),!1):!!this.viewport&&(-1!==e&&!t.args.rolling||super.collideA(t,e))):(this.break(),!1))}break(){if(!this.broken){if("garden"!==this.viewport.meta.fieldType)return this.viewport.args.inventory.push({points:1e4,tallyIcon:"/DBurraki/chao-icon.png",icon:"/DBurraki/chao-icon.png",id:this.oid}),void super.break();for(let t=0;t<5;t++){const t=new r.Egg({x:this.x,y:this.y-3});this.viewport.spawn.add({object:t}),t.args.falling=!0,t.args.xSpeed=6*(-.5+Math.random()),t.args.ySpeed=-7}super.break(),this.viewport.onTimeout(1e3,()=>{this.viewport&&this.viewport.actors.remove(this)})}}}}),require.register("actor/ChaoDetailer.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChaoDetailer=void 0;var i=e("./Block"),r=e("./Chao");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ChaoDetailer=class extends i.Block{constructor(){super(...arguments),a(this,"chaoStats",new WeakMap)}updateEnd(){let t=!1;if(this.viewport.collisions.has(this))for(const[e,s]of this.viewport.collisions.get(this))0===s&&(e.args.falling||e instanceof r.Chao&&(this.viewport.args.quickForm=JSON.stringify({name:e.args.name,alignment:e.args.alignment},null,4)+"\n"+JSON.stringify(e.mood,null,4)+"\n"+JSON.stringify(e.traits,null,4)+"\n"+JSON.stringify(e.stats,null,4),e.args.currentState="waiting",t=!0));t||(this.viewport.args.quickForm=null),super.update()}}}),require.register("actor/Chopper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chopper=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("curvature/base/Mixin"),n=e("../audio/Sfx"),o=e("./AirBomb"),l=e("./ChainShot"),h=e("./EggCapsule"),g=e("./SkateBoard");e("../intro/TitleScreenCard");t.Chopper=class extends(a.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-chopper",this.args.width=80,this.args.height=48,this.args.gravity=.25,this.args.float=-1,this.args.direction=1,this.exploded=!1,this.explosions=new Set,this.contains=new Set,this.args.xSpeed=8,this.args.ySpeed=6,this.args.attacker=this.args.attacker||!1,this.args.color=3,this.playingSound=!1,this.activated=!1,this.targetPoint=[0,0],this.damageTimer=0,this.args.attacker&&(this.args.hitPoints=8),this.bombs=new Set,this.bombCount=0}collideA(t,e){if(!this.damageTimer&&this.args.attacker&&(t.args.jumping||t.args.rolling)){const e=.5*(t.args.xSpeed+this.args.xSpeed);n.Sfx.play("BOSS_DAMAGED"),this.damageTimer=30,this.args.hitPoints--,t.args.xSpeed=e,t.args.ySpeed*=-1,t.args.ySpeed>0&&(t.args.ySpeed=-3),this.args.hitPoints<=0?(this.destroy(),this.noClip=!0,viewport.onFrameOut(60,()=>{viewport.actors.remove(this),viewport.onFrameOut(60,()=>{const e=new h.EggCapsule({x:t.args.x,y:t.args.y-384,xSpeed:t.args.gSpeed||t.args.xSpeed});viewport.spawn.add({object:e})})})):this.args.xSpeed=0}}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--color"]="color"}update(){this.damageTimer?this.args.type="actor-item actor-chopper actor-chopper-damaged":this.args.type="actor-item actor-chopper",this.args.attacker?this.damageTimer>0&&this.damageTimer--:this.introUpdate()}updateEnd(){this.args.attacker?this.attackUpdate():super.updateEnd();for(const t of this.bombs)t.args.x=this.args.x+t.xOffset}introUpdate(){if(this.viewport.currentMap===this.mapUrl){this.viewport.controlActor&&this.contains.add(this.viewport.controlActor),this.viewport.controlActor&&this.viewport.controlActor,this.args.ySpeed>-4&&(this.args.ySpeed-=.025);for(const t of this.explosions)t.style({"--x":this.args.x+t.x*this.args.direction,"--y":this.args.y});if(this.exploded)return this.args.float&&(n.Sfx.stop("COPTER_SPIN",!1),this.viewport.onFrameOut(120,()=>n.Sfx.play("RADIO_CHATTER_1")),this.args.float=0),void super.update();!this.playingSound&&this.viewport.args.audio,this.viewport.args.frameId-this.playingSound>10&&(this.playingSound=this.viewport.args.frameId,n.Sfx.play("COPTER_SPIN",{}));for(const t of this.contains)t.args.float=-1,t.args.x=this.args.x,t.args.y=this.args.y,t.args.hidden=!0,t.args.xSpeed=this.args.xSpeed,t.args.ySpeed=this.args.ySpeed;if(super.update(),this.viewport&&this.age&&this.age%300==0){const t=document.createElement("div");t.classList.add("particle-huge-explosion");const e=new r.Tag(t);e.style({"--x":this.args.x+18*this.args.direction,"--y":this.args.y-16}),n.Sfx.play("OBJECT_DESTROYED");const s=this.viewport;this.viewport.onFrameOut(200,()=>{s.actors.remove(this)}),this.viewport.onFrameOut(10,()=>{this.noClip=!0,this.args.xSpeed*=.5,this.args.ySpeed=2,this.args.gravity=.35;for(const t of this.contains)t.args.ySpeed=-12,t.args.xSpeed=0,t.args.hidden=!1,t.args.float=0}),this.args.animation="exploded",e.x=18,this.explosions.add(e),this.exploded=!0,this.viewport.particles.add(e),this.viewport.onFrameOut(30,()=>{s.particles.remove(e),this.explosions.delete(e)});const i=new g.SkateBoard({x:this.args.x,y:this.args.y,ySpeed:-10,xSpeed:4*Math.sign(this.args.xSpeed),groundAngle:Math.PI/4,ignore:-2});this.viewport.controlActor.args.standingOn=i,this.viewport.spawn.add({object:i})}if(this.viewport&&this.age&&this.age%290==0){const t=document.createElement("div");t.classList.add("particle-huge-explosion");const e=new r.Tag(t);this.explosions.add(e),e.style({"--x":this.args.x+36*this.args.direction,"--y":this.args.y-32}),e.x=36,n.Sfx.play("OBJECT_DESTROYED"),this.viewport.particles.add(e),this.viewport.onFrameOut(30,()=>viewport.particles.remove(e))}if(this.viewport&&this.age&&this.age%295==0){const t=document.createElement("div");t.classList.add("particle-huge-explosion");const e=new r.Tag(t);this.explosions.add(e),e.style({"--x":this.args.x+0*this.args.direction,"--y":this.args.y-24}),e.x=0,n.Sfx.play("OBJECT_DESTROYED"),this.viewport.particles.add(e),this.viewport.onFrameOut(30,()=>viewport.particles.remove(e))}this.args.falling=!0}}attackUpdate(){if(this.args.hitPoints<=0)return this.args.falling=!0,this.args.float=0,super.update(),void super.updateEnd();this.args.groundAngle=0;const t=this.viewport.controlActor;if(!this.playingSound&&this.viewport.args.audio,this.viewport.args.frameId-this.playingSound>10&&(this.playingSound=this.viewport.args.frameId,n.Sfx.play("COPTER_SPIN",{})),0!==t.args.mode)return super.update(),void super.updateEnd();if(!this.activated){if(t.args.x>this.args.x+64){const t=this.viewport.controlActor;this.args.xSpeed=t.args.gSpeed||t.args.xSpeed,this.viewport.auras.add(this),this.activated=this.viewport.args.frameId}return super.update(),void super.updateEnd()}if(this.chainShot||(this.chainShot=new l.ChainShot,this.viewport.spawn.add({object:this.chainShot}),this.chainShot.args.x=this.args.x,this.chainShot.args.y=this.args.y),t.dashed)return super.update(),super.updateEnd(),void(this.chainShot.args.animation="idle");const e=this.viewport.args.frameId-this.activated;e>120?Math.floor(e/240)%2==0?this.bombModeUpdate():this.gunModeUpdate():this.initModeUpdate()}initModeUpdate(){const t=this.viewport.controlActor;if(this.chainShot&&(this.chainShot.args.animation="idle"),!this.viewport||!this.viewport.controlActor||this.damageTimer)return this.damageTimer&&(this.args.xSpeed=0,this.args.ySpeed=0),super.update(),super.updateEnd(),void this.lockPosition();(Math.abs(t.args.gSpeed)>4||t.args.falling)&&(this.targetPoint[0]=t.args.x+(-0-Math.min(64,Math.abs(4*t.args.gSpeed)))*Math.sign(t.args.gSpeed),this.targetPoint[1]=t.args.y+-128),t.args.x<this.args.x?this.args.facing="left":this.args.facing="right",this.args.xSpeed=1*Math.min(25,Math.abs(.35*(this.args.x-this.targetPoint[0])))*-Math.sign(this.args.x-this.targetPoint[0]),this.args.ySpeed=1*Math.min(25,Math.abs(.1*(this.args.y-this.targetPoint[1])))*-Math.sign(this.args.y-this.targetPoint[1]),this.args.falling=!0,this.args.direction="left"===this.args.facing?-1:1,super.update(),super.updateEnd(),this.lockPosition()}gunModeUpdate(){const t=this.viewport.controlActor;if(t.args.dead)return this.args.xSpeed=0,this.args.ySpeed=0,super.update(),super.updateEnd(),this.fireChaingun(),void(this.chainShot.args.animation="shooting");if(!this.viewport||!this.viewport.controlActor||this.damageTimer)return this.damageTimer&&(this.args.xSpeed=0,this.args.ySpeed=0,this.chainShot.args.animation="idle"),super.update(),super.updateEnd(),this.lockPosition(),void(this.chainShot.args.animation="idle");(Math.abs(t.args.gSpeed)>4||t.args.falling)&&(this.targetPoint[0]=t.args.x+(-96-Math.min(64,Math.abs(4*t.args.gSpeed)))*Math.sign(t.args.gSpeed),this.targetPoint[1]=t.args.y+(-40-Math.min(0,Math.abs(t.args.gSpeed))));let e=1;t.args.jumping&&Math.abs(t.args.xSpeed)<15&&Math.sign(t.args.xSpeed)===Math.sign(this.args.x-t.args.x)&&(console.log(Math.sign(t.args.xSpeed),Math.sign(this.args.x-t.args.x)),e=.25),t.args.x<this.args.x?this.args.facing="left":this.args.facing="right",this.args.xSpeed=e*Math.min(25,Math.abs(.35*(this.args.x-this.targetPoint[0])))*-Math.sign(this.args.x-this.targetPoint[0]),this.args.ySpeed=e*Math.min(25,Math.abs(.2*(this.args.y-this.targetPoint[1])))*-Math.sign(this.args.y-this.targetPoint[1]),this.args.falling=!0,this.args.direction="left"===this.args.facing?-1:1,super.update(),super.updateEnd(),this.lockPosition(),Math.abs(t.args.y-this.args.y)<48&&!t.args.falling?(this.fireChaingun(),this.chainShot.args.animation="shooting"):this.chainShot.args.animation="idle"}bombModeUpdate(){const t=this.viewport.controlActor;if(this.chainShot&&(this.chainShot.args.animation="idle"),!this.viewport||!this.viewport.controlActor||this.damageTimer)return this.damageTimer&&(this.args.xSpeed=0,this.args.ySpeed=0),super.update(),super.updateEnd(),void this.lockPosition();if((Math.abs(t.args.gSpeed)>4||t.args.falling)&&(this.targetPoint[0]=t.args.x+(-0-Math.min(64,Math.abs(4*t.args.gSpeed)))*Math.sign(t.args.gSpeed),this.targetPoint[1]=t.args.y+-128),t.args.x<this.args.x?this.args.facing="left":this.args.facing="right",this.args.xSpeed=1*Math.min(25,Math.abs(.35*(this.args.x-this.targetPoint[0])))*-Math.sign(this.args.x-this.targetPoint[0]),this.args.ySpeed=1*Math.min(25,Math.abs(.1*(this.args.y-this.targetPoint[1])))*-Math.sign(this.args.y-this.targetPoint[1]),this.args.falling=!0,this.viewport.args.frameId%30==0){const t=16*Math.sign(this.args.direction)+16*(this.bombCount%2-.5),e=new o.AirBomb({x:this.args.x+t,y:this.args.y,xSpeed:this.args.xSpeed,ySpeed:this.args.ySpeed});this.bombCount++,e.xOffset=t,this.bombs.add(e),this.viewport.spawn.add({object:e})}this.args.direction="left"===this.args.facing?-1:1,super.update(),super.updateEnd(),this.lockPosition()}fireChaingun(){this.args.direction=this.args.direction||Math.sign(this.xSpeedLast);const t=56*Math.sign(this.args.direction);this.chainShot.args.x=this.args.x+t,this.chainShot.args.y=this.args.y+0,this.chainShot.args.xSpeed=this.args.xSpeed,this.chainShot.args.ySpeed=this.args.ySpeed,this.viewport.setColCell(this.chainShot),this.args.direction>0?this.chainShot.args.groundAngle=-.65*Math.PI:this.chainShot.args.groundAngle=.65*Math.PI,this.chainShot.args.shooting=!0;const e=this.chainShot.castRayQuick(786,.5*-Math.PI-this.chainShot.args.groundAngle);this.chainShot.args.shooting=!1,this.chainShot.args.height=e||786}lockPosition(){{const t=this.args.x-this.targetPoint[0],e=Math.abs(t),s=Math.sign(t);e>386&&(this.args.x=this.targetPoint[0]+386*s)}{const t=this.args.y-this.targetPoint[1],e=Math.abs(t),s=Math.sign(t);e>386&&(this.args.y=this.targetPoint[1]+386*s)}}destroy(){const t=this.viewport;n.Sfx.stop("COPTER_SPIN",!1),t.onFrameOut(20,()=>{const e=document.createElement("div");e.classList.add("particle-huge-explosion");const s=new r.Tag(e);s.style({"--x":this.args.x+18*this.args.direction,"--y":this.args.y-16}),n.Sfx.play("OBJECT_DESTROYED"),this.args.animation="exploded",s.x=18,this.explosions.add(s),this.exploded=!0,t.particles.add(s),t.onFrameOut(30,()=>{t.particles.remove(s),this.explosions.delete(s)}),t.controlActor.cofocused=null}),t.onFrameOut(0,()=>{const e=document.createElement("div");e.classList.add("particle-huge-explosion");const s=new r.Tag(e);this.explosions.add(s),s.style({"--x":this.args.x+36*this.args.direction,"--y":this.args.y-32}),s.x=36,n.Sfx.play("OBJECT_DESTROYED"),t.particles.add(s),t.onFrameOut(30,()=>t.particles.remove(s))}),t.onFrameOut(10,()=>{const e=document.createElement("div");e.classList.add("particle-huge-explosion");const s=new r.Tag(e);this.explosions.add(s),s.style({"--x":this.args.x+0*this.args.direction,"--y":this.args.y-24}),s.x=0,n.Sfx.play("OBJECT_DESTROYED"),t.particles.add(s),t.onFrameOut(30,()=>t.particles.remove(s))})}}}),require.register("actor/Cinematic.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cinematic=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Cinematic=class extends i.PointActor{constructor(t,e){super(t,e),r(this,"noClip",!0),r(this,"panSpeed",9),this.args.isGhost=!0,this.args.float=-1,this.target=null,this.targets=[[250,6500],[5900,6600],[250,6500],[7700,7800],[6800,4200],[6800,4200],[8e3,4300],[1450,1800]]}setCameraMode(){this.args.cameraMode="cinematic"}update(){if(super.update(),!this.args.selected)return;if(!this.target||this.x===this.target[0]&&this.y===this.target[1])return this.targets.length||this.remove(),void(this.target=this.targets.shift());const t=this.target;if(this.x!==t[0]){const e=t[0]-this.x;this.args.x+=Math.sign(e)*this.panSpeed,Math.abs(e)<this.panSpeed&&(this.args.x=t[0])}if(this.y!==t[1]){const e=t[1]-this.y;this.args.y+=Math.sign(e)*this.panSpeed,Math.abs(e)<this.panSpeed&&(this.args.y=t[1])}}get controllable(){return!0}}}),require.register("actor/Coconut.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coconut=void 0;var i=e("./PointActor");t.Coconut=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-coconut",this.args.width=12,this.args.height=13,this.args.size=4,this.args.nourishment=.05,this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.falling?t.args.ySpeed:0,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,t.carrying.delete(this),this.args.falling=!0,this.args.float=0}t&&(this.cX=t.args.bindTo("x",e=>this.args.x=e+t.args.direction*t.xHold),this.cY=t.args.bindTo("y",e=>this.args.y=e+-t.yHold),this.args.xSpeed=0,this.args.ySpeed=0,t.carrying.add(this),this.args.float=-1)})}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--size"]="size"}lift(t){this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null}get solid(){return!1}get rotateLock(){return!0}sleep(){this.carriedBy||this.viewport&&this.viewport.actors.remove(this)}}}),require.register("actor/Coin.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coin=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Coin=class extends i.PointActor{constructor(){super(...arguments),r(this,"float",-1),this.args.type="actor-item actor-coin",this.args.width=32,this.args.height=32,this.args.gone=!1}update(){super.update(),this.viewport.args.audio&&!this.sample&&(this.sample=new Audio("/mario/smw_coin.wav"),this.sample.volume=1)}collideA(t){super.collideA(t),this.args.gone||(this.args.type="actor-item actor-coin collected",this.args.gone||(this.viewport.args.audio&&this.sample&&this.sample.play(),this.viewport.onFrameOut(40,()=>{this.args.type="actor-item actor-coin collected gone"}),this.viewport.onFrameOut(80,()=>{this.viewport.actors.remove(this),this.remove()}),this.x,this.y,t.args.owner?t.args.owner.args.coins+=1:t.occupant?t.occupant.args.coins+=1:t.args.coins+=1),this.args.gone=!0)}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/CompanionBlock.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompanionBlock=void 0;var i=e("./MarbleBlock"),r=e("../region/LavaRegion"),a=e("../audio/Sfx"),n=e("../lib/Analytic");t.CompanionBlock=class extends i.MarbleBlock{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.args.type="actor-item actor-marble-companion-block",this.played=!1,this.args.density=this.args.density||10}collideA(t,e){return this.args.falling&&t.y>8+this.y+-this.args.height||this.args.falling&&t.y>this.y-this.args.height||this.args.falling&&t.args.modeTime<3&&(t.args.gSpeed=0),super.collideA(t,e)}update(){this.args.x;let t=!1;const e=this.regions;let s=0,i=null;for(const o of e)o.args.density>s&&(s=o.args.density,i=o),this.args.y=Math.round(this.args.y),o instanceof r.LavaRegion&&(t=!0,this.played||(this.args.type="actor-item actor-marble-companion-block actor-marble-companion-block-dying",this.viewport.onFrameOut(80,()=>{this.args.type="actor-item actor-marble-companion-block actor-marble-companion-block-dead",a.Sfx.play("PLAYER_DAMAGED")}),"function"==typeof ga&&n.Analytic.report({eventCategory:"companion-block",eventAction:"pushed",eventLabel:`${this.viewport.args.actName}::${this.args.id}`}),this.played=!0));if(i&&s&&this.args.density){const t=this.args.y,e=i.args.y+-i.args.height,r=Math.min(this.args.height,t-e),a=this.args.gravity*(s/this.args.density)*(r/this.args.height);this.args.ySpeed-=a,this.args.falling||(this.args.y--,this.args.falling=!0)}super.update(),t&&(this.fallTime<100?this.args.xSpeed=0:this.args.xSpeed=Math.sign(this.gSpeedLast||this.xSpeedLast))}sleep(){this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.onNextFrame(()=>{this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.args.xSpeed=0,this.args.ySpeed=0,this.args.pushed=0,this.args.float=0})}}}),require.register("actor/Cone.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cone=void 0;var i=e("./PointActor");t.Cone=class extends i.PointActor{constructor(){super(...arguments),this.args.width=16,this.args.height=32,this.args.type="actor-item actor-cone"}get solid(){return!1}}}),require.register("actor/CrabMeat.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CrabMeat=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../behavior/Patrol"),o=e("../mixin/CanPop"),l=(e("../actor/Explosion"),e("../actor/Projectile"));t.CrabMeat=class extends(i.Mixin.from(r.PointActor,o.CanPop)){constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.behaviors.add(new n.Patrol),this.args.type="actor-item actor-crabmeat",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=32,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.patrolBeat=this.args.patrolBeat||90,this.args.patrolPause=this.args.patrolPause||25,this.args.patrolSpeed=this.args.patrolSpeed||.25,this.args.shotTelegraph=this.args.shotTelegraph||65}update(){const t=this.args.direction;super.update();const e=this.args.shotTelegraph,s=this.args.patrolBeat;if(this.box&&(Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","skidding"):this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.age%s<e||this.age%s>s-15?this.box.setAttribute("data-animation","shooting"):this.box.setAttribute("data-animation","standing")),this.age%s==s-3){const t=this.x+19,e=this.x+-19,s=this.y+-19,i=-1,r=-1.5,a=-3,n=this,o=new l.Projectile({x:t,y:s,z:i,owner:n}),h=new l.Projectile({x:e,y:s,z:i,owner:n});this.viewport.onFrameOut(3,()=>{Object.assign(o.args,{xSpeed:-r,ySpeed:a}),Object.assign(h.args,{xSpeed:r,ySpeed:a})}),this.viewport.spawn.add({object:o}),this.viewport.spawn.add({object:h})}}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/CrossCannon.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CrossCannon=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("../audio/Sfx");t.CrossCannon=class extends i.PointActor{constructor(){super(...arguments),this.args.width=48,this.args.height=40,this.args.type="actor-item actor-cross-cannon",this.args.float=-1,this.args.power=this.args.power||20,this.holding=new Map,this.args.spinTime=0,this.args.minHold=9,this.args.grabbing=null}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-firing"]="firing",this.autoAttr.get(this.box)["data-aiming"]="aiming",this.autoAttr.get(this.box)["data-grabbing"]="grabbing",this.barrelUp||(this.barrelUp=new r.Tag('<div class = "barrel barrel-up">'),this.box.appendChild(this.barrelUp.node)),this.barrelDown||(this.barrelDown=new r.Tag('<div class = "barrel barrel-down">'),this.box.appendChild(this.barrelDown.node)),this.barrelLeft||(this.barrelLeft=new r.Tag('<div class = "barrel barrel-left">'),this.box.appendChild(this.barrelLeft.node)),this.barrelRight||(this.barrelRight=new r.Tag('<div class = "barrel barrel-right">'),this.box.appendChild(this.barrelRight.node))}collideA(t,e){if(t.controllable)return t.isVehicle&&(t=t.occupant),!this.holding.has(t)&&(t.args.x,t.args.y,t.args.falling||(t.args.falling=!0,t.args.float=1,t.args.y-=1),t.args.standingOn&&(t.args.standingOn=null,t.args.xSpeed=0,t.args.ySpeed=0),a.Sfx.play("SS_BWIP"),-1!==e&&e%2!=0||(Math.abs(t.args.x-this.args.x),this.holding.set(t,this.viewport.args.frameId),t.args.xSpeed=0,t.args.ySpeed=0,t.args.float=-1,t.args.ignore=-1,!1))}dropDelay(t){let e=!1;return this.args.waitFor&&(e=this.viewport.actorsById[this.args.waitFor]),e?e.dropDelay(t):new Promise(t=>this.viewport.onFrameOut(240,()=>t()))}update(){super.update(),this.holding.size||(this.args.spinTime=0);for(const[t,e]of this.holding){const s=this.args.x+-4,i=-6+this.args.y,r=(s+-t.args.x)/6,n=(i+-t.args.y)/6,o=this.viewport.args.frameId-e;if(t.args.animation="jumping",Math.abs(t.args.y-i)<n?t.args.y=i:t.args.y+=n,Math.abs(t.args.x-s)<r?t.args.x=s:t.args.x+=r,t.args.groundAngle+=.05*-t.args.groundAngle,this.args.grabbing=o<5?"grabbing":o<10?"grabbed":null,t.canJump=!0,t.args.jumping=!1,t.willJump&&this.args.spinTime<this.args.minHold)return this.args.spinTime=0,void(this.args.aiming="");t.willJump&&this.args.aiming&&this.args.spinTime>=this.args.minHold&&(this.args.firing="firing",this.viewport.onFrameOut(6,()=>{this.args.firing="fired"}),this.viewport.onFrameOut(16,()=>{this.args.firing=""}),this.viewport.onFrameOut(24,()=>{this.args.aiming=""}),this.viewport.onFrameOut(6,()=>{this.args.aiming&&(a.Sfx.play("SPRING_SHOT"),this.holding.delete(t),t.args.jumping=!0,this.ignores.set(t,2),t.args.ignore=1,t.args.float=0,t.yAxis>0?t.args.ySpeed=this.args.power:t.yAxis<0?t.args.ySpeed=-this.args.power:t.xAxis>0?(t.args.xSpeed=this.args.power,t.args.ySpeed=0,t.args.float=8):t.xAxis<0&&(t.args.xSpeed=-this.args.power,t.args.ySpeed=0,t.args.float=8))})),this.args.spinTime>5?t.args.cameraMode="cross-cannon-quick":t.args.cameraMode="cross-cannon",t.yAxis>0?this.args.aiming="down":t.yAxis<0?this.args.aiming="up":t.xAxis>0?this.args.aiming="right":t.xAxis<0&&(this.args.aiming="left"),t.yAxis||t.xAxis?this.args.aiming&&(0===this.args.spinTime&&a.Sfx.play("QUICK_SLIDE"),this.args.spinTime++):(this.args.spinTime=0,this.args.aiming=""),this.args.spinTime===this.args.minHold&&this.args.aiming&&a.Sfx.play("PAD_BOUNCE")}}wakeUp(){this.args.aiming=""}}}),require.register("actor/Cursor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0;var i=e("./PointActor");t.Cursor=class extends i.PointActor{update(){}}}),require.register("actor/CutScene.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CutScene=void 0;var i=e("./PointActor");t.CutScene=class extends i.PointActor{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t,arguments.length>1?arguments[1]:void 0),t.src?this.fetcher=fetch(t.src).then(t=>t.json()):t.frames&&(this.fetcher=Promise.resolve(t.frames)),this.args.hidden=!0}playSample(t){this.viewport.args.audio&&new Audio(t.source).play()}activate(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.controllable||t.args.falling&&!s)return;if(!e&&"Sonic"!==t.args.canonical)return;const i=this.viewport;i&&!this.args.running&&(this.args.running=!0,t.args.gSpeed=0,i.args.cutScene=!0,t.controller.zero(),this.fetcher.then(e=>{let s=0;for(const r of e){const e=()=>{switch(r.event){case"dialog":i.showDialog(r.lines,r.classes);break;case"audio":this.playSample(r);break;case"face":t.args.direction=r.direction,t.args.facing=r.direction>0?"right":"left";break;case"input":r.axes&&t.controller.replay({axes:r.axes}),r.buttons&&t.controller.replay({buttons:r.buttons}),t.readInput();break;case"superdrop":t.dropDashCharge=30;break;case"clearAct":i.clearAct(r.message);break;case"clear":i.clearDialog();break;case"message":i.showCenterMessage(r.message);break;case"hide":i.hideCenterMessage(),i.hideDialog();break;case"wait":i.args.cutScene=!1,i.hideCenterMessage(),i.hideDialog()}};s?i.onFrameOut(s,e):e(),s+=r.time||0}}))}}}),require.register("actor/Dish.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dish=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/CanPop");t.Dish=class extends(r.Mixin.from(i.PointActor,a.CanPop)){static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}constructor(){super(...arguments),this.args.width=46,this.args.height=50,this.args.type="actor-item actor-dish"}get solid(){return!1}}}),require.register("actor/Dolphin.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dolphin=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin");t.Dolphin=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-dolphin",this.args.width=64,this.args.height=64,this.args.gravity=.4,this.noClip=!0,this.args.float=-1}update(){if(!this.viewport||!this.viewport.controlActor)return;const t=this.viewport.controlActor;this.args.ySpeed<-4?this.args.type="actor-item actor-dolphin":this.args.type="actor-item actor-dolphin actor-dolphin-downward",!this.args.ySpeed&&this.args.x<-128+t.args.x&&(this.args.falling=!0,this.args.xSpeed=6+(t.args.xSpeed||t.args.gSpeed),this.args.ySpeed=-16,this.args.float=0),super.update()}}}),require.register("actor/Door.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Door=void 0;var i=e("./PointActor");t.Door=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.clear(),this.args.type="actor-item actor-door",this.args.width=32,this.args.height=64,this.args.opened=!1,this.args.opening=!1}onRendered(){super.onRendered(event),this.setAutoAttr("opening","data-opening"),this.setAutoAttr("opened","data-opened")}open(t){t.controllable&&(this.others.waitFor&&this.others.waitFor.args.opened?this.args.opening=this.args.opened=!1:(this.args.opening=!0,this.viewport.onFrameOut(10,()=>this.args.opened=!0),this.viewport.onFrameOut(50,()=>this.args.opening=!1),this.viewport.onFrameOut(55,()=>this.args.opened=!1)))}collideA(t,e){return this.args.opening?!this.args.opened:(this.args.opened||this.viewport.onFrameOut(20,()=>this.open(t)),!this.args.opened)}sleep(){this.viewport&&(this.args.opening=this.args.opened=!1)}get solid(){return!this.args.opened}get rotateLock(){return!0}}}),require.register("actor/DrainFly.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrainFly=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer"),a=e("curvature/base/Mixin"),n=e("../mixin/CanPop");t.DrainFly=class extends(a.Mixin.from(i.PointActor,n.CanPop)){constructor(t,e){super(t,e),this.args.type="actor-item actor-drainfly",this.args.width=16,this.args.height=16,this.args.float=-1,this.args.gravity=0,this.args.phase="idle"}update(){if(!this.viewport||!this.viewport.actorIsOnScreen(this))return;const t=this.viewport;super.update();const e=t.controlActor;if(e){switch(this.args.phase){case"idle":this.args.alertTo=this.y-64,e.x+-this.x>-128&&(this.args.phase="alert");break;case"alert":this.y>this.args.alertTo?this.args.ySpeed--:(this.args.phase="attacking",this.args.y=this.args.alertTo,this.args.ySpeed=0);break;case"attacking":{const t=Math.sign(e.args.x+-this.args.x)||0,s=Math.sign(e.args.y+-this.args.y+-24)||0;this.args.xSpeed+=.2*t-Math.random()/10||0,this.args.ySpeed+=.5*s-Math.random()/10||0,Math.abs(this.args.xSpeed)>6&&(this.args.xSpeed=4*t),Math.abs(this.args.ySpeed)>8&&(this.args.ySpeed=4*s),this.bMap("checkBelow",this.x,this.y).get(r.Platformer)&&(this.args.falling=!0,this.args.ySpeed=-1,this.args.y-=1);break}}this.args.facing=this.args.xSpeed>0?"left":"right",this.args.float=-1}else this.args.phase="idle"}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/DrillCar.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrillCar=void 0;var i=e("./Vehicle"),r=e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.DrillCar=class extends i.Vehicle{constructor(){super(...arguments),a(this,"instructions",["Jump ","Fly +"]),this.args.type="actor-item actor-drill-car",this.args.width=38,this.args.height=48,this.removeTimer=null,this.args.gSpeedMax=26,this.args.decel=.3,this.args.accel=.75,this.args.seatHeight=34,this.args.skidTraction=.95,this.dustCount=0,this.args.particleScale=2}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite"),this.backSprite=new r.Tag('<div class = "sprite-back sprite">'),this.drill=new r.Tag('<div class = "drill-car-drill">'),this.seat=new r.Tag('<div class = "drill-car-seat">'),this.windsheild=new r.Tag('<div class = "drill-car-windsheild">'),this.copterCap=new r.Tag('<div class = "drill-car-copter-cap">'),this.copterBladeA=new r.Tag('<div class = "drill-car-copter-blade-a">'),this.copterBladeB=new r.Tag('<div class = "drill-car-copter-blade-b">'),this.frontWheelA=new r.Tag('<div class = "drill-car-tire drill-car-tire-front-a">'),this.frontWheelB=new r.Tag('<div class = "drill-car-tire drill-car-tire-front-b">'),this.backWheelA=new r.Tag('<div class = "drill-car-tire drill-car-tire-back-a">'),this.backWheelB=new r.Tag('<div class = "drill-car-tire drill-car-tire-back-b">'),this.sprite.appendChild(this.drill.node),this.backSprite.appendChild(this.copterCap.node),this.backSprite.appendChild(this.copterBladeA.node),this.backSprite.appendChild(this.copterBladeB.node),this.sprite.appendChild(this.windsheild.node),this.backSprite.appendChild(this.seat.node),this.sprite.appendChild(this.frontWheelA.node),this.backSprite.appendChild(this.frontWheelB.node),this.sprite.appendChild(this.backWheelA.node),this.backSprite.appendChild(this.backWheelB.node),this.box.appendChild(this.backSprite.node)}update(){const t=this.args.falling;if(this.viewport.args.audio&&!this.flyingSound&&(this.flyingSound=new Audio("/Sonic/drill-car-copter.wav"),this.flyingSound.volume=.35+-.2*Math.random(),this.flyingSound.loop=!0),this.flyingSound&&(this.flyingSound.paused||(this.flyingSound.volume=.25+-.2*Math.random()),this.flyingSound.currentTime>.2&&(this.flyingSound.currentTime=0)),this.box){if(t)this.args.flying?this.box.setAttribute("data-animation","flying"):this.args.falling&&(this.flyingSound&&this.flyingSound.pause(),this.box.setAttribute("data-animation","jumping"));else{this.flyingSound&&this.flyingSound.pause();const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;if(this.dustCount>0&&this.dustCount--,Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5){this.box.setAttribute("data-animation","skidding");const t=this.viewport,e=new r.Tag('<div class = "particle-dust">'),s=this.rotatePoint(this.args.gSpeed,0);e.style({"--x":s[0]+this.x,"--y":s[1]+this.y,"z-index":0,opacity:2*Math.random()});const i=new r.Tag('<div class = "particle-dust">'),a=this.rotatePoint(this.args.gSpeed+40*this.args.direction,0);i.style({"--x":a[0]+this.x,"--y":a[1]+this.y,"z-index":0,opacity:2*Math.random()}),t.particles.add(e),t.particles.add(i),setTimeout(()=>{t.particles.remove(e),t.particles.remove(i)},350)}else this.args.moving&&s>.75*i?this.box.setAttribute("data-animation","running"):this.args.moving&&s?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")}0==this.args.copterCoolDown?this.args.ySpeed>5&&(this.flyingSound&&this.flyingSound.pause(),this.args.flying=!1):this.args.copterCoolDown>0&&this.args.copterCoolDown--,super.update()}else super.update()}command_0(){if(!this.args.falling)return this.args.copterCoolDown=15,void super.command_0();this.args.copterCoolDown>0||this.args.ySpeed>-16&&(this.args.flying||this.flyingSound&&this.flyingSound.play(),this.args.flying=!0,0==this.args.copterCoolDown&&(this.args.copterCoolDown=7),this.args.ySpeed=-1,this.args.ySpeed=-4,this.args.float=8)}sleep(){this.flyingSound&&this.flyingSound.pause()}get solid(){return!this.occupant}}}),require.register("actor/DropCage.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropCage=void 0;var i=e("./PointActor");t.DropCage=class extends i.PointActor{constructor(){super(...arguments),this.args.width=48,this.args.height=40,this.args.type="actor-item actor-drop-cage",this.args.float=-1,this.holding=!1}collideA(t,e){return!(this.holding||!t.controllable)&&(this.ignores.has(t)?(this.ignores.set(t,60),!1):-1!==e&&e%2!=0||(Math.abs(t.args.x-this.args.x),t.args.xSpeed=0,this.holding=t,t.args.ySpeed=0,t.args.float=-1,t.args.ignore=-1,this.dropDelay(t).then(()=>{t.args.float=0,t.args.ignore=5,this.ignores.set(t,60),this.holding=!1}),!1))}dropDelay(t){let e=!1;return this.args.waitFor&&(e=this.viewport.actorsById[this.args.waitFor]),e?e.dropDelay(t):new Promise(t=>this.viewport.onFrameOut(30,()=>t()))}update(){if(super.update(),this.holding){const t=this.holding,e=this.x,s=-6+this.y,i=(e+-t.args.x)/3,r=(s+-t.args.y)/3;Math.abs(t.args.x-e)<.1?(t.args.x=e,Math.abs(t.args.y-s)<.1?t.args.y=s:t.args.y+=r):t.args.x+=i}}get solid(){return!this.holding&&!this.ignores.size}}}),require.register("actor/Egg.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Egg=void 0;var i=e("../sprite/Png"),r=e("./PointActor"),a=(e("../behavior/Platformer"),e("./EggShellTop")),n=e("./Chao");t.Egg=class extends r.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-egg",this.args.shell="normal",this.args.bindTo("shell",t=>{switch(t){case"flat":case"normal":this.args.spriteSheet=`/DBurraki/chao-egg-${t}.png`;break;default:this.args.spriteSheet="/DBurraki/chao-egg-normal.png"}this.png=new i.Png(this.args.spriteSheet)}),this.args.width=15,this.args.height=20,this.broken=!1,this.customChaoColors=[null,null,null,null,null,null,null,null,null,null,null,null,null];const t=[12,0,1,2];this.defaultColors=["e2e0e2","addef8","2ebee9","0e6d89"],this.customColors=[null,null,null,null],this.customColors.bindTo(()=>{const t={};for(const s in this.defaultColors){var e;t[this.defaultColors[s]]=null!==(e=this.customColors[s])&&void 0!==e?e:this.defaultColors[s]}this.png.ready.then(()=>{const e=this.png.recolor(t).toUrl();this.args.spriteSheet=e})},{wait:0}),this.customChaoColors.bindTo((e,s)=>{if(s=Number(s),!t.includes(s))return;const i=t.indexOf(s);this.customColors[i]=e,null!==e&&(this.args.shell="flat")});const e=[[null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,"80e000","69b700","487d00",null,null,null,null,null,null,null],["485070","303058","202020",null,null,null,null,null,null,null,null,"202020","5f6994"],["e4e0e4","c0bde4","9c99c0",null,null,null,null,null,null,null,null,null,"e4e0e4"],["e4e0e4","c0bde4","9c99c0","addef8","2ebee9","0e6d89",null,null,null,null,null,null,"e4e0e4"],["485070","303058","202020","b70000","770000","420000",null,null,null,null,"bf999c","202020","5f6994"],["ff7575","e00000","800000","b70000","770000","420000",null,null,null,null,null,"202020","ffaeae"],["ffc20e","dd8604","ad4d05","b44800","844221","630000",null,null,null,null,null,"202020","fae3af"],["80e000","69b700","487d00","48b400","428421","006300",null,null,null,null,null,"202020","cef00f"],["485070","303058","202020","c0bde4","9c99c0","606080",null,null,null,null,"9c99c0","202020","5f6994"],["c0bde4","9c99c0","606080","485070","303058","202020",null,null,null,null,"9c99c0","202020","e4e0e4"],["c0bde4","9c99c0","606080","e4e0e4","c0bde4","9c99c0",null,null,null,null,"9c99c0","202020","e4e0e4"]];Object.assign(this.customChaoColors,e[Math.trunc(Math.random()*(-1+e.length))]),this.args.bindTo("falling",t=>{const e=this.ySpeedLast;t||this.broken||e<12||this.hatch()}),this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),t)this.cX=t.args.bindTo("x",e=>this.args.x=e+12*t.args.direction),this.cY=t.args.bindTo("y",t=>this.args.y=t+-12),t.carrying.add(this),this.args.standingOn=null,this.args.falling=!0,this.args.float=-1,this.args.groundAngle=0;else if(this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,this.args.xSpeed+=2*t.xAxis,t.carrying.delete(this),this.args.falling=!0,this.args.float=0,this.args.groundAngle=0}})}onRendered(t){super.onRendered(t),this.setAutoAttr("shell","data-shell")}lift(t){this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null}sleep(){this.broken&&this.viewport.actors.remove(this)}hatch(){const t=this.ySpeedLast;this.args.type="actor-item actor-egg actor-egg-shell-bottom";const e=new a.EggShellTop({spriteSheet:this.args.spriteSheet,xSpeed:.6*this.xSpeedLast,ySpeed:.4*-t,x:this.x,y:this.y-10}),s=new n.Chao({currentState:"hatching",xSpeed:.4*this.xSpeedLast,ySpeed:.4*-t,x:this.x,y:this.y-10});this.args.gSpeed=.2*this.xSpeedLast,this.viewport.spawn.add({object:e}),this.viewport.spawn.add({object:s}),Object.assign(s.customColors,this.customChaoColors),Object.assign(s.traits,{appetite:Math.random(),sociable:Math.random(),restless:Math.random()}),s.mood.hunger=.8,this.broken=!0}updateStart(){super.updateStart()}update(){this.broken&&!this.carriedBy&&(this.args.startFrame=this.args.startFrame||this.viewport.args.frameId,this.viewport.args.frameId-this.args.startFrame>120)?this.viewport.actors.remove(this):super.update()}get rotateLock(){return!0}get solid(){return!1}}}),require.register("actor/EggCapsule.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggCapsule=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=e("../audio/Bgm"),n=e("curvature/base/Tag");t.EggCapsule=class extends i.PointActor{constructor(){super(...arguments),this.args.width=64,this.args.height=69,this.args.type="actor-item actor-egg-capsule",this.args.gravity=.4,this.args.bindTo("falling",t=>{t||(this.viewport.args.shakeY=7)}),this.triggered=!1}collideA(t,e){return this.args.falling?(t.startle(this),!0):!(t.controllable&&0===e&&(this.triggered?(t.args.x+=.1*Math.sign(this.args.x-t.args.x),t.args.gSpeed=0,this.args.active=!0,0):this.groundTime>15&&0===e&&!this.triggered&&(t.args.ignore=200,r.Sfx.play("WTF_BOOM"),a.Bgm.fadeOut(1500),this.viewport.onFrameOut(107,()=>{const t=document.createElement("div");t.classList.add("particle-huge-explosion");const e=new n.Tag(t);this.viewport.controlActor.screenLock=null,e.style({"--x":this.args.x,"--y":this.args.y}),this.viewport.particles.add(e),this.viewport.onFrameOut(15,()=>this.viewport.particles.remove(e))}),this.viewport.onFrameOut(240,()=>this.triggered=!1),this.viewport.onFrameOut(117,()=>t.args.ySpeed=-65),this.viewport.onFrameOut(115,()=>t.startle(this)),this.triggered=!0,0)))}get solid(){return this.groundTime>15}}}),require.register("actor/EggMobile.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggMobile=void 0;var i=e("./Vehicle"),r=e("../behavior/Platformer");t.EggMobile=class extends i.Vehicle{constructor(){super(...arguments),this.args.type="actor-item actor-vehicle actor-eggmobile",this.args.accel=.15,this.args.decel=.8,this.args.gSpeedMax=15,this.args.xSpeedMax=45,this.args.ySpeedMax=45,this.args.jumpForce=12,this.args.gravity=.6,this.args.width=28,this.args.height=20,this.args.yMargin=42,this.args.falling=!0,this.args.flying=!0,this.args.float=-1}update(){if(this.bMap("checkBelow",this.x,this.y).get(r.Platformer)&&this.args.y--,Math.abs(this.yAxis)>.5){if(Math.abs(this.args.ySpeed)<this.args.ySpeedMax){let t=this.args.ySpeed;Math.sign(this.yAxis)===Math.sign(this.args.ySpeed)?t+=this.yAxis*this.args.accel*3:t+=this.yAxis*this.args.accel*6,t=t>0?Math.floor(1e3*t)/1e3:Math.ceil(1e3*t)/1e3,this.args.ySpeed=t}}else this.args.ySpeed=this.args.ySpeed*this.args.decel;this.xAxis||(Math.abs(this.args.xSpeed)<=1&&(this.args.xSpeed=0),this.args.xSpeed>0?this.args.xSpeed=Math.floor(this.args.xSpeed*this.args.decel):this.args.xSpeed=Math.ceil(this.args.xSpeed*this.args.decel)),this.occupant||(this.args.xSpeed=0,this.args.ySpeed=0),this.args.falling=!0,this.args.flying=!0,this.args.mode=0,this.args.cameraMode="aerial",super.update()}get solid(){return!this.occupant}}}),require.register("actor/EggShellBottom.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggShellBottom=void 0;var i=e("./PointActor");t.EggShellBottom=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-egg-shell-bottom",this.args.width=15,this.args.height=20}update(){this.args.startFrame=this.args.startFrame||this.viewport.args.frameId,this.viewport.args.frameId-this.args.startFrame>45?this.viewport.actors.remove(this):super.update()}get solid(){return!1}sleep(){this.viewport.actors.remove(this),console.log(this)}}}),require.register("actor/EggShellTop.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggShellTop=void 0;var i=e("./PointActor");t.EggShellTop=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-egg-shell-top",this.args.width=15,this.args.height=20}update(){this.args.startFrame=this.args.startFrame||this.viewport.args.frameId,this.viewport.args.frameId-this.args.startFrame>90?this.viewport.actors.remove(this):super.update()}get solid(){return!1}sleep(){this.viewport.actors.remove(this)}}}),require.register("actor/EggShuttle.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggShuttle=void 0;var i=e("curvature/base/Tag"),r=e("./Vehicle");t.EggShuttle=class extends r.Vehicle{constructor(){super(...arguments),this.args.type="actor-item actor-vehicle actor-egg-shuttle",this.args.accel=.15,this.args.decel=.8,this.args.gSpeedMax=15,this.args.xSpeedMax=15,this.args.ySpeedMax=15,this.args.jumpForce=3,this.args.gravity=.6,this.args.width=96,this.args.height=308,this.args.yMargin=42,this.args.falling=!0,this.args.flying=!0,this.args.float=-1,this.args.seatHeight=this.args.height-40,this.args.seatForward=-16,this.args.seatAngle=Math.PI/2,this.args.thrustAngle=-Math.PI/2,this.args.bindTo("boosting",t=>{this.boost&&this.boost.setAttribute("data-active",!!t)}),this.args.crashAngle=0,this.args.bindTo("falling",t=>{Math.abs(this.args.groundAngle)<Math.PI/4||(this.args.crashAngle=this.args.groundAngle)})}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--crash-angle"]="crashAngle"}updateStart(){super.updateStart(),this.args.falling&&(this.args.groundAngle=-(this.args.thrustAngle+Math.PI/2))}updateEnd(){if(super.updateEnd(),this.args.falling||(this.args.groundAngle=0),this.args.crashAngle&&(this.args.groundAngle=this.args.crashAngle,this.occupant)){const t=this.occupant;t.args.standingOn=!1,t.args.falling=!0,t.args.xSpeed=2*Math.sign(this.xSpeedLast),t.args.ySpeed=-12,t.args.y+=-12}}update(){this.sprite&&!this.windshield&&(this.windshield=new i.Tag('<div class = "shuttle-windshield">'),this.boost=new i.Tag('<div class = "shuttle-boost">'),this.sprite.appendChild(this.windshield.node),this.sprite.appendChild(this.boost.node)),this.occupant?(this.args.type="actor-item actor-vehicle actor-egg-shuttle actor-egg-shuttle-occupied",this.args.float=1):(this.args.type="actor-item actor-vehicle actor-egg-shuttle",this.args.float=0),this.args.gSpeed=0,this.args.facing="right",super.update(),this.args.falling?(this.args.cameraMode="rocket",this.args.thrustAngle+=.02*this.xAxis,this.args.thrustAngle<7*-Math.PI/8&&(this.args.thrustAngle=7*-Math.PI/8),this.args.thrustAngle>1*-Math.PI/8&&(this.args.thrustAngle=1*-Math.PI/8)):(this.args.cameraMode="normal",this.args.cameraBias=0,this.args.boosting=!1,this.args.thrustAngle=-Math.PI/2)}processInputDirect(){}command_0(t){}release_0(t){this.args.boosting=!1}hold_0(t){if(this.args.x+=this.viewport.args.frameId%2?-1:1,!this.args.falling&&t.time<60)return;this.args.falling=!0;const e=this.args.gravity*(1+.002*Math.min(-60+t.time,150));this.args.xSpeed+=e*Math.cos(this.args.thrustAngle),this.args.ySpeed+=e*Math.sin(this.args.thrustAngle),Math.abs(this.args.xSpeed)>this.args.xSpeedMax&&(this.args.xSpeed=this.args.xSpeedMax*Math.sign(this.args.xSpeed)),Math.abs(this.args.ySpeed)>this.args.ySpeedMax&&(this.args.ySpeed=this.args.ySpeedMax*Math.sign(this.args.ySpeed)),this.args.boosting=!0}collideA(t,e){if(this.args.crashAngle)return!1;super.collideA(t,e)}get solid(){return!this.args.crashAngle&&!this.occupant}}}),require.register("actor/EggTroid.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggTroid=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/CanPop");t.EggTroid=class extends(r.Mixin.from(i.PointActor,a.CanPop)){constructor(t,e){super(t,e),this.args.type="actor-item actor-eggtroid",this.args.width=40,this.args.height=25,this.args.float=-1,this.args.gravity=.5,this.args.phase="idle"}update(){if(!this.viewport||!this.viewport.actorIsOnScreen(this))return;const t=this.viewport;if("diving"!==this.args.animation&&(this.args.xSpeed=.8*Math.sign(Math.sin(this.age/60))),super.update(),!this.viewport)return;if(!t.controlActor)return void(this.args.phase="idle");this.args.facing=this.args.xSpeed>0?"left":"right",this.args.float=-1;const e=this.castRayQuick(128,Math.PI/2,[0,0],!1)||128;if(e){const t=this.viewport.actorsAtLine(this.args.x,this.args.y,this.args.x,this.args.y+e),s=[...t.keys()];t.size&&s.filter(t=>t!==this&&t.controllable&&!t.args.dead).length&&(console.log(s.filter(t=>t!==this&&t.controllable)),this.args.animation="diving",this.args.xSpeed=0,this.args.ySpeed=6,this.args.float=0)}this.args.falling||this.pop()}get solid(){return!1}get rotateLock(){return!0}}}),require.register("actor/EggWalker.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EggWalker=void 0;var i=e("./Vehicle"),r=e("../behavior/Platformer"),a=e("./Projectile"),n=e("curvature/base/Tag");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.EggWalker=class extends i.Vehicle{constructor(){super(...arguments),o(this,"instructions",[]),this.args.type="actor-item actor-egg-walker",this.args.width=32,this.args.height=64,this.args.weight=1500,this.removeTimer=null,this.args.gSpeedMax=2.5,this.args.decel=.05,this.args.accel=.1,this.args.seatHeight=48,this.args.jumpForce=12,this.args.skidTraction=.9,this.dustCount=0,this.args.particleScale=2,this.args.bindTo("falling",t=>{t||!this.crouching||this.ySpeedLast<8||(this.viewport.args.shakeY=7)})}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite"),this.backSprite=new n.Tag('<div class = "sprite-back sprite">'),this.body=new n.Tag('<div class = "egg-walker-body">'),this.sprite.appendChild(this.body.node),this.punch=new n.Tag('<div class = "egg-walker-punch">'),this.sprite.appendChild(this.punch.node),this.legFront=new n.Tag('<div class = "egg-walker-leg">'),this.sprite.appendChild(this.legFront.node),this.boostFront=new n.Tag('<div class = "egg-boost">'),this.legFront.appendChild(this.boostFront.node),this.legBack=new n.Tag('<div class = "egg-walker-leg egg-walker-leg-back">'),this.backSprite.appendChild(this.legBack.node),this.boostBack=new n.Tag('<div class = "egg-boost">'),this.legBack.appendChild(this.boostBack.node),this.chair=new n.Tag('<div class = "egg-walker-chair">'),this.backSprite.appendChild(this.chair.node),this.gun=new n.Tag('<div class = "egg-walker-gun">'),this.backSprite.appendChild(this.gun.node),this.box.appendChild(this.backSprite.node)}update(){super.update(),this.boosting?(this.args.type="actor-item actor-egg-walker egg-walker-boosting",this.args.ySpeed>0&&(this.args.ySpeed-=(Math.sin(this.viewport.args.frameId/10)+.9)/2*1.25+.5)):this.args.type="actor-item actor-egg-walker",this.boosting=!1,this.yAxis>.55&&(!this.xAxis||this.falling&&this.args.ySpeed>0)?(this.crouching&&(this.args.y+=.001,this.args.y-=.001),this.args.falling&&!this.crouching&&(this.args.ySpeed+=4),this.args.gSpeed=0,this.args.animation="crouching",this.crouching=!0,this.args.seatHeight=30,this.args.height=48):(this.crouching||(this.args.y+=.001,this.args.y-=.001),this.crouching=!1,this.args.seatHeight=48,this.args.height=64,this.args.falling?this.args.animation="falling":Math.sign(this.args.gSpeed)===this.args.direction?this.args.animation="walking":this.args.animation="standing")}hold_0(){const t=this.bMap("checkBelow",this.x,this.y+1).get(r.Platformer);!this.args.falling&&this.args.ySpeed<0||t||this.yAxis>.55||(this.boosting=!0)}hold_2(){if(this.shooting)return;let t,e,s;const i=Math.sign(this.args.direction),r=this.args.groundAngle;switch(this.args.mode){case 0:s=-r-Math.PI/2+Math.PI/4*i,e=-r;break;case 1:s=-r+Math.PI/4*i,e=-r+Math.PI/2;break;case 2:s=-r+Math.PI/2+Math.PI/4*i,e=-r-Math.PI;break;case 3:s=-r-Math.PI+Math.PI/4*i,e=-r-Math.PI/2}t=[32*Math.cos(s),120*Math.sin(s)];const n=new a.Projectile({direction:this.args.direction,x:this.args.x+t[0]+(this.args.xSpeed||this.args.gSpeed),y:this.args.y+t[1]-(this.crouching?-20:0),owner:this,xSpeed:this.args.xSpeed||this.args.gSpeed||this.args.direction,float:10,strength:2});n.impulse(8,e+(i<0?Math.PI:0),!0),this.viewport.spawn.add({object:n}),this.viewport.auras.add(n),n.update(),this.box.setAttribute("data-shoot","true"),this.shooting=!0,this.viewport.onFrameOut(1,()=>{this.box.setAttribute("data-shoot","false")}),this.viewport.onFrameOut(6,()=>{this.shooting=!1})}command_0(){this.crouching||super.command_0()}command_1(){this.punching||(this.box.setAttribute("data-punch","true"),this.punching=!0,this.viewport.onFrameOut(12,()=>{this.box.setAttribute("data-punch","false")}),this.viewport.onFrameOut(25,()=>{this.punching=!1}))}get solid(){return!this.occupant}}}),require.register("actor/Eggman.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Eggman=void 0;var i=e("./PointActor"),r=(e("curvature/base/Tag"),e("../behavior/SkidDust"));t.Eggman=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.name="Robotnik",e}constructor(){super(...arguments),this.behaviors.add(new r.SkidDust),this.args.type="actor-item actor-eggman",this.accelNormal=.15,this.accelSuper=.3,this.args.weight=200,this.args.accel=.15,this.args.decel=.3,this.args.normalHeight=40,this.args.rollingHeight=28,this.gSpeedMaxNormal=18,this.gSpeedMaxSuper=28,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.normalHeight=57,this.args.rollingHeight=29,this.jumpForceNormal=11,this.jumpForceSuper=18,this.args.jumpForce=this.jumpForceNormal,this.args.gravity=.5,this.args.width=18,this.args.height=57,this.args.lookingUp=!1,this.args.spriteSheet=this.spriteSheet="/Sonic/eggman.png",this.superSpriteSheet="/Sonic/eggman-super.png"}onRendered(t){super.onRendered(t),this.box=this.findTag("div")}updateStart(){this.args.grinding&&this.args.falling&&this.args.ySpeed>0&&(this.args.animation="airdash",this.args.grinding=!1),super.updateStart(),this.args.dead&&(this.args.animation="dead")}update(){const t=this.args.falling;if(!this.box)return void super.update();this.yAxis>.5&&!this.args.ignore?(this.args.crouching=!0,this.args.lookTime--,this.args.lookTime<-45&&(this.args.cameraBias=-.5)):this.yAxis<-.5&&!this.args.ignore?(this.args.lookingUp=!0,this.args.lookTime++,this.args.lookTime>45&&(this.args.cameraBias=.25)):this.args.lookingUp=this.args.crouching=!1;const e=this.args.direction,s=this.args.gSpeed,i=Math.abs(s),r=this.args.gSpeedMax;t?(this.args.jumping&&(this.args.animation="jumping"),this.args.height=this.args.rollingHeight):this.args.rolling?(this.args.height=this.args.rollingHeight,this.args.direction!==Math.sign(this.args.gSpeed)&&(this.args.direction=Math.sign(this.args.gSpeed),this.args.direction<0?this.args.facing="left":this.args.facing="right"),this.args.animation="rolling"):(this.args.height=this.args.normalHeight,Math.sign(this.args.gSpeed)!==e&&Math.abs(this.args.gSpeed-e)>5?this.args.animation="skidding":i>r/2?this.args.animation="running":this.args.moving&&s?this.args.animation="walking":this.args.lookingUp?this.args.animation="lookingUp":this.args.crouching||this.args.standingOn&&this.args.standingOn.isVehicle?this.args.animation="crouching":this.args.animation="standing"),this.args.hangingFrom&&(this.args.animation="hanging"),this.args.grinding&&(this.args.rolling=!1,this.yAxis>.5?this.args.animation="grinding-crouching":this.args.animation="grinding"),super.update()}command_3(){this.isSuper=!this.isSuper,this.onTimeout(150,()=>{0===this.args.rings&&this.setProfile()}),this.setProfile()}setProfile(){this.isSuper?(this.args.spriteSheet=this.superSpriteSheet,this.args.gSpeedMax=this.gSpeedMaxSuper,this.args.jumpForce=this.jumpForceSuper,this.args.accel=this.accelSuper):(this.args.spriteSheet=this.spriteSheet,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.accel=this.accelNormal)}get solid(){return!1}get canRoll(){return!0}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/Eggrobo.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Eggrobo=void 0;var i=e("./PointActor"),r=e("./Projectile"),a=e("curvature/base/Tag"),n=e("../behavior/SkidDust"),o=e("../audio/Sfx");t.Eggrobo=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new n.SkidDust),this.args.type="actor-item actor-eggrobo",this.args.accel=.125,this.args.decel=.3,this.args.gSpeedMax=14,this.args.jumpForce=11,this.args.gravity=.5,this.args.width=18,this.args.height=57}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite"),this.flame=new a.Tag('<div class = "eggrobo-flame">'),this.muzzleFlash=new a.Tag('<div class = "eggrobo-muzzle-flash">'),this.sprite.appendChild(this.flame.node),this.sprite.appendChild(this.muzzleFlash.node)}update(){const t=this.args.falling;if(this.viewport.args.audio&&!this.thrusterSound&&(this.thrusterSound=new Audio("/Sonic/mecha-sonic-thruster.wav"),this.thrusterSound.loop=!0),this.thrusterSound&&(this.thrusterSound.currentTime>.4+Math.random()/10&&(this.thrusterSound.currentTime=.05),this.thrusterSound.volume=.2+-.05*Math.random()),this.box){if(t)this.args.crouching=!1,this.args.jumping&&this.box.setAttribute("data-animation","jumping");else{this.yAxis>0?this.args.crouching=!0:this.args.crouching=!1;const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?(this.thrusterSound&&this.thrusterSound.pause(),this.box.setAttribute("data-animation","skidding")):s>i/2?(this.thrusterSound&&this.thrusterSound.pause(),this.box.setAttribute("data-animation","running")):this.args.moving&&e?this.box.setAttribute("data-animation","walking"):this.args.crouching||this.standingOn&&this.standingOn.isVehicle?this.box.setAttribute("data-animation","crouching"):this.box.setAttribute("data-animation","standing")}this.args.falling||(this.args.flying=!1),this.args.flying?this.box.setAttribute("data-animation","flying"):this.args.falling&&this.box.setAttribute("data-animation","jumping"),this.args.shotCoolDown>0&&this.args.shotCoolDown--,0==this.args.rocketCoolDown&&this.thrusterSound&&this.thrusterSound.pause(),this.args.rocketCoolDown>0&&this.args.rocketCoolDown--,0==this.args.rocketCoolDown&&(this.args.flying=!1),super.update()}else super.update()}get solid(){return!0}get isEffect(){return!1}hold_0(){this.args.falling?(this.args.ySpeed>1||this.args.flying)&&(this.args.flying=!0,this.args.rocketCoolDown<=1&&(this.thrusterSound&&this.thrusterSound.play(),this.args.rocketCoolDown=3),this.args.ySpeed=.999*this.args.ySpeed,this.args.float=3):this.args.rocketCoolDown=5}hold_2(){if(this.args.shotCoolDown>0)return;const t=Math.sign(this.args.direction),e=this.args.groundAngle;let s,i,a;switch(this.args.mode){case 0:a=-e-Math.PI/2+Math.PI/4*t,i=-e;break;case 1:a=-e+Math.PI/4*t,i=-e+Math.PI/2;break;case 2:a=-e+Math.PI/2+Math.PI/4*t,i=-e-Math.PI;break;case 3:a=-e-Math.PI+Math.PI/4*t,i=-e-Math.PI/2}s=[50*Math.cos(a),50*Math.sin(a)],(this.args.falling||this.args.crouching)&&(i=0,s=[26*t,-26]);const n=new r.Projectile({direction:this.args.direction,x:this.args.x+s[0]+(this.args.xSpeed||this.args.gSpeed),y:this.args.y+s[1],owner:this,xSpeed:this.args.xSpeed||this.args.gSpeed,YSpeed:this.args.YSpeed});n.impulse(20,i+(t<0?Math.PI:0),!0),n.update(),this.viewport.auras.add(n),this.viewport.spawn.add({object:n}),this.box.setAttribute("data-shooting","true"),this.onTimeout(140,()=>{this.box.setAttribute("data-shooting","false")}),o.Sfx.play("SHOT_FIRED"),this.args.shotCoolDown=4}get canFly(){return!0}get solid(){return!1}get controllable(){return!0}}}),require.register("actor/Emblem.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Emblem=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("../audio/Sfx"),n=e("../lib/Analytic");t.Emblem=class extends i.PointActor{constructor(){var t;super(...arguments),this.args.width=32,this.args.height=32,this.args.type="actor-item actor-emblem",this.args.float=-1,this.args.static=!0,this.collected=!1,this.args.character=null!==(t=this.args.character)&&void 0!==t?t:"sonic"}onRendered(t){if(!this.viewport)return super.onRendered(t);const e=this.viewport.getZoneState();e&&e.emblems&&e.emblems.includes(this.oid)&&(this.viewport.replay||(this.args.type="actor-item actor-emblem actor-emblem-collected",this.collected=!0)),super.onRendered(t),this.autoAttr.get(this.box)["data-character"]="character"}collideA(t){if(!t.controllable||this.gone)return;const e=this.viewport,s=e.getZoneState();t.args.emblemsCurrent.push(this),this.collected?this.args.type="actor-item actor-emblem actor-emblem-gone actor-emblem-collected":(t.args.emblems.push(this),s.emblems.push(this.oid),this.args.type="actor-item actor-emblem actor-emblem-gone");const i=document.createElement("div");i.classList.add("particle-score");const o=new r.Tag(i);let l;switch(o.style({"--x":this.args.x,"--y":this.args.y-16}),t.args.emblemsCurrent&&t.args.emblemsCurrent.length){case 1:i.classList.add("score-100"),l=100;break;case 2:i.classList.add("score-200"),l=200;break;case 3:i.classList.add("score-500"),l=500;break;case 4:i.classList.add("score-1000"),l=1e3;break;case 5:i.classList.add("score-10000"),l=1e4}e.particles.add(o),setTimeout(()=>e.particles.remove(o),768),t.args.score+=l,this.gone=!0,e.onFrameOut(20,()=>e.actors.remove(this)),this.viewport.args.inventory.push({tallyIcon:"/custom/hud-emblem.png",points:1e3,id:this.oid}),e.currentSave.save(),this.viewport.args.audio&&a.Sfx.play("EMBLEM_COLLECTED"),"function"==typeof ga&&n.Analytic.report({eventCategory:"emblem",eventAction:"collected",eventLabel:`${this.viewport.args.actName}::${this.oid}`})}}}),require.register("actor/Emerald.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Emerald=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=e("../lib/Analytic");t.Emerald=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-emerald emerald-"+(this.args.color||"white"),this.args.width=12,this.args.height=12}collideA(t){if(super.collideA(t),!this.args.gone&&t.controllable){if(this.args.type="actor-item actor-emerald collected emerald-"+(this.args.color||"white"),!this.args.gone){r.Sfx.play("EMERALD_COLLECTED"),this.args.type="actor-item actor-emerald collected gone emerald-"+(this.args.color||"white"),t.args.owner?t.args.owner.args.emeralds+=1:t.occupant?t.occupant.args.emeralds+=1:t.args.emeralds+=1,this.viewport.args.emeralds.includes(this.args.color)||this.viewport.args.emeralds.push(this.args.color);const e=viewport.currentSave;e.emeralds.includes(this.args.color)||e.emeralds.push(this.args.color),this.viewport.args.inventory.push({points:1e4,tallyIcon:`/Sonic/emerald-${this.args.color}-mini.png`,id:this.oid}),e.save(),a.Analytic.report({eventCategory:"chaos-emerald",eventAction:"collected",eventLabel:`${this.viewport.args.actName}::${this.args.color}::${this.args.id}`}),this.viewport.actors.remove(this),this.remove()}this.args.gone=!0}}get solid(){return!1}get effect(){return!0}}}),require.register("actor/Explosion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Explosion=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Explosion=class extends i.PointActor{constructor(){super(...arguments),r(this,"float",-1),this.args.type="actor-item actor-explosion",this.args.width=48,this.args.height=48,this.removeTimer=null}update(){super.update(),this.removeTimer||(this.viewport,this.removeTimer=this.onTimeout(360,()=>{}))}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/FakeEmerald.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FakeEmerald=void 0;var i=e("./BreakableBlock");t.FakeEmerald=class extends i.BreakableBlock{constructor(){super(...arguments),this.args.width=64,this.args.height=34,this.args.type="actor-item actor-breakable-block actor-fake-emerald",this.args.z=128,this.args.float=-1,this.breakable=!1}updateStart(){}update(){super.update(),this.switch&&this.switch.args.active&&(this.breakable=!0)}collideA(t,e){return!!this.breakable&&super.collideA(t,e)}get solid(){return this.breakable}}}),require.register("actor/Flag.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flag=void 0;var i=e("./PointActor");t.Flag=class extends i.PointActor{constructor(){super(...arguments),this.args.width=45,this.args.height=53,this.args.type="actor-item actor-flag",this.args.z=0}get solid(){return!1}}}),require.register("actor/Flickie.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flickie=void 0;var i=e("./Follower");t.Flickie=class extends i.Follower{constructor(t,e){super(t,e),this.args.type="actor-item actor-flickie",this.args.palletShift=Math.floor(8*Math.random())}}}),require.register("actor/Flipper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flipper=void 0;var i=e("./PointActor");t.Flipper=class extends i.PointActor{constructor(t,e){var s;super(t,e),this.args.width=64,this.args.height=48,this.noClip=!0,this.args.float=-1,this.args.direction=this.args.direction||1,this.args.power=null!==(s=this.args.power)&&void 0!==s?s:12,this.args.type="actor-item actor-flipper",this.args.bindTo("direction",t=>this.args.type=t<0?"actor-item actor-flipper actor-flipper-right":"actor-item actor-flipper actor-flipper-left"),this.flipped=new WeakSet}collideA(t,e){if(t.y<=this.y-this.args.height)return;if(this.flipped.has(t))return;const s=this.x-this.args.direction*this.args.width;if(t.args.rolling=!0,t.willJump=!1,t.buttons[0]&&1===t.buttons[0].time){const e=-t.args.groundAngle+-Math.PI/2;this.args.animation="flipping",t.args.xSpeed=0,t.args.ySpeed=0,t.args.gSpeed=0;const i=(t.x-s)/this.args.width*.5*this.args.direction;t.impulse(this.args.power*i,e,!0);const r=Number(Number(1*Math.cos(e)).toFixed(3)),a=Number(Number(1*Math.sin(e)).toFixed(3));return t.args.y+=-4,t.args.xSpeed=r,t.args.ySpeed=a,t.args.falling=!0,this.viewport.onFrameOut(3,()=>this.args.animation="unflipping"),t.args.jumping=!1,t.args.falling=!0,this.flipped.add(t),this.viewport.onFrameOut(1,()=>t.willJump=!1),this.viewport.onFrameOut(3,()=>t.args.jumping=!1),void this.viewport.onFrameOut(5,()=>this.flipped.delete(t))}Math.abs(t.args.gSpeed)<3?t.args.gSpeed=Math.min(2,Math.abs(t.args.gSpeed)||1)*Math.sign(t.args.gSpeed||this.args.direction):t.args.gSpeed*=.5}}}),require.register("actor/Follower.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Follower=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Follower=class extends i.PointActor{constructor(t,e){super(t,e),r(this,"noClip",1),this.args.isGhost=!0,this.args.type="actor-item actor-follower",this.args.float=-1,this.args.width=16,this.args.height=16,this.stopSwapZ=0,this.args.z=-1}update(){super.update(),this.stopSwapZ>0&&this.stopSwapZ--,this.args.standingOn=!1;const t=this.viewport.controlActor;if(!t)return;this.args.falling=!0,this.args.float=-1;const e=Math.random();let s=Math.random();const i=t.x+-this.x,r=t.y+-this.y,a=Math.atan2(r,i),n=Math.hypot(r,i),o=1.1*Math.max(Math.abs(t.args.gSpeed),Math.abs(t.args.xSpeed),Math.abs(t.args.ySpeed),1),l=this.args.xSpeed-(t.args.xSpeed||t.args.gSpeed);let h=o+3,g=null;n<64?(Math.abs(this.args.xSpeed)<1&&(this.args.xSpeed=1*Math.sign(-.5+Math.random())),Math.abs(this.args.ySpeed)<1&&(this.args.ySpeed=1*Math.sign(-.5+Math.random()))):n>=256&&(this.args.x=Math.floor(t.x-256*Math.cos(a)),this.args.y=Math.floor(t.y-256*Math.sin(a)),this.args.xSpeed=i/60+(t.args.xSpeed||t.args.gSpeed),this.args.ySpeed=0,this.viewport.setColCell(this),g=this.x>t.x?"left":"right",h*=4);const c=Math.sign(i),d=Math.sign(r),u=Math.sign(this.args.xSpeed)===c,p=this.args.ySpeed&&Math.sign(this.args.ySpeed)===d,f=.35*Math.max(e)*(u?.85:.55),m=.1*Math.max(e)*(u?.75:1.5);if(!u||Math.abs(this.args.xSpeed)<h){const e=f*c*s;let a=this.args.xSpeed+e;if(Math.abs(this.args.xSpeed)>h&&(a=h*Math.sign(this.args.xSpeed)),this.args.xSpeed=a,n>=256){const e=t.args.xSpeed||t.args.gSpeed,s=t.args.ySpeed;g&&(this.args.xSpeed=i/90+e,this.args.ySpeed=r/90+s)}}if(!g&&this.args.xSpeed<0?g="left":g||(g="right"),!p||Math.abs(this.args.ySpeed)<h){let t=this.args.ySpeed+m*d;Math.abs(this.args.ySpeed)>h&&(t=h*Math.sign(this.args.ySpeed)),this.args.ySpeed=t}if(Math.sign(l)&&Math.sign(t.args.xSpeed||t.args.gSpeed)!==Math.sign(l)&&0===this.stopSwapZ&&(Math.abs(this.x-t.x)>64||Math.abs(this.y-t.y)>64)&&(this.args.z=this.args.z>-1e3?-1e5:1e5,this.stopSwapZ=30),g&&(this.args.facing=g),this.args.ySpeed>0){if(this.args.ySpeed<=0||o<1.5)return;this.box&&(this.box.classList.add("decending"),this.box.classList.remove("ascending"))}else this.box&&(this.box.classList.remove("decending"),this.box.classList.add("ascending"))}get solid(){return!1}}}),require.register("actor/Fountain.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fountain=void 0;var i=e("./PointActor");t.Fountain=class extends i.PointActor{constructor(){super(...arguments),this.args.width=72,this.args.height=120,this.args.float=-1,this.args.type="actor-item actor-fountain"}collideA(t){t.controllable&&t.args.falling&&(t.y>this.y+.5*-this.args.height&&(t.args.x=this.x),t.args.ySpeed>0&&(t.args.ySpeed*=.75),t.args.ySpeed>-20&&Math.abs(this.x-t.x)<8&&(t.args.ySpeed-=.4))}get solid(){return!1}}}),require.register("actor/Gator.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Gator=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.Gator=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-gator-bot",this.args.animation="standing",this.args.accel=.75,this.args.decel=.5,this.args.gSpeedMax=15,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=44,this.args.height=32,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:20,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:110,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1,this.chasing=!1}onRendered(t){super.onRendered(t)}update(){this.viewport&&this.viewport.controlActor&&(Math.abs(this.viewport.controlActor.args.x-this.args.x)<64?this.box.setAttribute("data-animation","chomping"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.direction=Math.sign(this.args.gSpeed),this.args.facing=this.args.direction>0?"right":"left"}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/GiantTire.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GiantTire=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("./TruckBody"),n=e("./TruckCab"),o=(e("../behavior/Platformer"),e("../audio/Sfx"));class l extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-giant-tire",this.args.rear&&(this.args.type+=" actor-giant-tire-back"),this.args.width=64,this.args.height=64,this.args.rolled=0,this.gSpeedLast=0,this.args.accel=0,this.args.decel=0,this.args.gravity=.6,this.args.driver=this.args.driver||null,this.args.partner=this.args.partner||null,this.args.idler=null,this.args.body=this.args.body||null}spawnParts(){if(this.args.driver||this.args.idler)return;const t=this.args.idler=new l({driver:this,x:this.args.x-96,y:this.args.y}),e=this.args.partner=new l({driver:this,rear:!0,x:this.args.x+32,y:this.args.y}),s=this.args.idlerPartner=new l({driver:this,rear:!0,x:this.args.x-64,y:this.args.y}),i=this.args.body=new a.TruckBody({driver:this,x:this.args.x-32,y:this.args.y-32}),r=this.args.cab=new n.TruckCab({driver:this,x:this.args.x+48,y:this.args.y-28});this.viewport.spawn.add({object:t}),this.viewport.spawn.add({object:e}),this.viewport.spawn.add({object:s}),this.viewport.spawn.add({object:i}),this.viewport.spawn.add({object:r}),this.viewport.auras.add(this),this.viewport.auras.add(t),this.viewport.auras.add(e),this.viewport.auras.add(s),this.viewport.auras.add(i),this.viewport.auras.add(r)}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--rolled"]="rolled"}updateStart(){if(this.args.driver||this.args.idler||this.spawnParts(),this.args.destroyed&&!this.args.falling){if(this.args.type+=" actor-giant-tire-destroyed",this.args.idler.args.type+=" actor-giant-tire-destroyed",this.args.partner.args.type+=" actor-giant-tire-destroyed",this.args.idlerPartner.args.type+=" actor-giant-tire-destroyed",this.args.cab.args.type+=" actor-truck-cab-destroyed",this.args.body.args.type+=" actor-truck-body-destroyed",o.Sfx.play("ROCK_BREAK_1"),o.Sfx.play("OBJECT_DESTROYED"),this.viewport.onFrameOut(180,()=>o.Sfx.play("RADIO_CHATTER_2")),!this.args.driver){let t=this.viewport.controlActor;this.viewport.onFrameOut(15,()=>t.cofocused=null),this.args.body.noClip=!0,this.args.cab.noClip=!0,this.args.body.args.destroyed=!0,this.args.cab.args.destroyed=!0,this.args.body.args.xSpeed=1.2*this.gSpeedLast,this.args.cab.args.xSpeed=1.3*this.gSpeedLast,this.args.body.args.ySpeed=-6,this.args.cab.args.ySpeed=-14,this.args.body.args.falling=!0,this.args.cab.args.falling=!0,this.args.body.args.float=0,this.args.cab.args.float=0}this.args.ySpeed=-11,this.args.xSpeed=1.4*this.gSpeedLast,this.args.falling=!0}if(this.args.destroyed)return this.args.idler&&!this.args.idler.args.destroyed&&(this.args.idler.args.destroyed=!0,this.args.partner.args.destroyed=!0,this.args.idlerPartner.args.destroyed=!0,this.args.idler.args.falling=!0,this.args.partner.args.falling=!0,this.args.idlerPartner.args.falling=!0,this.args.idler.args.xSpeed=1.7*this.gSpeedLast,this.args.partner.args.xSpeed=1.5*this.gSpeedLast,this.args.idlerPartner.args.xSpeed=1.8*this.gSpeedLast,this.args.idler.args.ySpeed=-11,this.args.partner.args.ySpeed=-11,this.args.idlerPartner.args.ySpeed=-11,this.args.idler.args.float=0,this.args.partner.args.float=0,this.args.idlerPartner.args.float=0,this.args.idler.noClip=!0,this.args.partner.noClip=!0,this.args.idlerPartner.noClip=!0),this.args.float=0,void(this.noClip=!0);for(;this.getMapSolidAt(this.args.x,this.args.y-1);)this.args.y--;if(!this.args.idler||!this.viewport.controlActor||this.viewport.controlActor.args.dead)return void super.updateStart();let t=this.viewport.controlActor;if(this.age<36&&this.args.x>-160+t.args.x)return void super.updateStart();t.args.standingOn&&t.args.standingOn.isVehicle&&(t=t.args.standingOn),this.args.falling?this.args.x>-160+t.args.x?this.args.xSpeed*=.99:this.args.xSpeed=Math.max(this.args.xSpeed,t.args.xSpeed||t.args.xSpeed):t.args.gSpeed&&this.args.x>-160+t.args.x?this.args.gSpeed*=.99:this.args.gSpeed=Math.max(this.args.gSpeed,t.args.gSpeed||t.args.xSpeed),t.args.x<this.args.x||t.args.falling&&t.args.xSpeed<0?this.args.gSpeed=Math.min(-8,.75*t.args.xSpeed):t.args.gSpeed&&t.args.gSpeed<5&&this.args.gSpeed++;const e=this.args.body.distanceTo(t);e<768&&t.args.jumping&&t.fallTime<120&&(this.args.gSpeed*=.9),t.cofocused=e<512?this.args.idler:null}updateEnd(){if(!this.args.idler||this.args.destroyed)return void super.updateEnd();for(const t of this.viewport.regionsAtPoint(this.args.x+80,this.args.y))t.args.destroyTruck&&(this.args.destroyed=!0);const t=this.args.idler,e=this.args.partner,s=this.args.idlerPartner,i=.5*(this.args.x+t.args.x),r=.5*(this.args.y+t.args.y)-32,a=this.angleTo(t);this.distanceTo(t);this.ensureSpace(t,96),this.ensureSpace(e,-16),this.ensureSpace(s,80),this.args.body.args.x=i,this.args.body.args.y=r,this.args.body.args.groundAngle=-a,this.args.body.args.falling=!0,this.args.body.args.mode=0,this.args.body.args.xSpeed=this.args.xSpeed||this.args.gSpeed*Math.cos(a),this.args.body.args.ySpeed=this.args.ySpeed||this.args.gSpeed*Math.sin(a),this.args.cab.args.xSpeed=this.args.xSpeed||this.args.gSpeed*Math.cos(a),this.args.cab.args.ySpeed=this.args.ySpeed||this.args.gSpeed*Math.sin(a),this.args.cab.args.x=0+i+80*Math.cos(a),this.args.cab.args.y=3+r+80*Math.sin(a),this.args.cab.args.groundAngle=1.1*-a,this.args.cab.args.falling=!0,this.args.cab.args.mode=0,this.args.gSpeed?(this.args.animation="rolling",this.args.idler.args.animation="rolling",this.args.partner.args.animation="rolling",this.args.idlerPartner.args.animation="rolling"):(this.args.animation="idle",this.args.idler.args.animation="idle",this.args.partner.args.animation="idle",this.args.idlerPartner.args.animation="idle"),super.updateEnd()}ensureSpace(t,e){let s=this.distanceFrom(t),i=Math.abs(e),r=Math.abs(i-s),a=this.angleTo(t);if(e>0&&t.args.x>this.args.x?(t.args.x=this.args.x-4,t.args.y=this.args.y):e<0&&t.args.x<this.args.x&&(t.args.x=this.args.x+4,t.args.y=this.args.y),this.args.falling?(t.args.gSpeed=this.args.xSpeed,t.args.xSpeed=this.args.xSpeed):s>i?(t.args.gSpeed=this.args.gSpeed+r*Math.cos(a),t.args.xSpeed=this.args.xSpeed||t.args.gSpeed):s<i?(t.args.gSpeed=this.args.gSpeed+-r*Math.cos(a),t.args.xSpeed=t.args.gSpeed):(t.args.gSpeed=this.args.gSpeed,t.args.xSpeed=t.args.gSpeed),this.args.falling&&t.args.falling){t.args.xSpeed=this.args.xSpeed,t.args.ySpeed=this.args.ySpeed;const e=this.distanceTo(t),s=this.angleTo(t);96!==e&&(t.args.x=this.args.x-i*Math.cos(s),t.args.y=this.args.y-i*Math.sin(s))}}collideA(t,e){this.args.destroyed||(t.break?t.break(this):t.pop?t.pop(this):t.controllable&&t.damage(this))}}t.GiantTire=l}),require.register("actor/GohlaBall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GohlaBall=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../mixin/CanPop");e("../actor/Explosion"),e("../actor/Projectile");t.GohlaBall=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.args.type="actor-item actor-gohla-ball",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=16,this.args.height=16,this.willStick=!1,this.stayStuck=!1}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/GrapplePoint.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GrapplePoint=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("./Spring"),n=e("curvature/base/Mixin"),o=e("../mixin/Constrainable");t.GrapplePoint=class extends(n.Mixin.from(i.PointActor,o.Constrainable)){constructor(){super(...arguments),this.args.width=28,this.args.height=16,this.args.type="actor-item actor-grapple-point",this.ignoreOthers=new Set,this.args.gravity=.6,this[a.Spring.WontSpring]=!0,this.hooked=new Set}updateEnd(){super.update();const t=this.others.tiedTo;if(t?this.setPos():this.noClip=!0,t||this.unhookAll(),this.args.falling=!0,this.hooked.size){"phazon"===this.viewport.args.theme&&(this.lightning||(this.lightning=new r.Tag('<div class = "particle-sparkle-lightning">'),viewport.particles.add(this.lightning),console.log(this.lightning)),this.lightning.style({"--x":t.args.x,"--y":t.args.y,height:2*this.args.ropeLength+"px","--angle":-this.args.groundAngle}));const e=[...this.hooked][0];e.xAxis&&(Math.sign(this.args.xSpeed)||Math.sign(this.args.xSpeed)===Math.sign(this.hooked.xAxis))&&(this.y>t.y?this.args.xSpeed+=.25*e.xAxis:this.args.xSpeed-=.25*e.xAxis);for(const t of this.hooked)t.args.x=this.x,t.args.y=this.y+e.args.height+-5,t.args.xSpeed=0,t.args.ySpeed=0,t.args.groundAngle=0,t.xAxis>0?(t.args.facing="right",t.args.direction=1):t.xAxis<0&&(t.args.facing="left",t.args.direction=-1),t.args.cameraMode="hooked"}else this.lightning&&(this.viewport.particles.remove(this.lightning),this.lightning=null);super.updateEnd()}update(){}collideA(t){if(!t.controllable)return!1;const e=this.others.tiedTo;if(!e||e.noClip)return!1;if(!t.args.hangingFrom&&!this.ignoreOthers.has(t)){if(this.args.ignore)return!1;if(t.args.falling=!0,t.swing=!0,this.hooked.add(t),this.viewport.auras.add(this),this.args.xSpeed=t.args.xSpeed||t.args.gSpeed,2===t.args.mode&&(this.args.xSpeed=t.args.xSpeed||-t.args.gSpeed),this.args.ySpeed=t.args.ySpeed,t.args.xSpeed=0,t.args.ySpeed=0,t.args.gSpeed=0,t.args.ignore=-4,t.args.float=-1,t.xLast=t.args.x,t.yLast=t.args.y,t.args.x=this.args.x,t.args.y=this.args.y+t.args.height,t.args.hangingFrom=this,t.args.jumping=!1,this.others.tiedTo){const e=this.others.tiedTo;e.dispatchEvent(new CustomEvent("hooked"),{detail:{hook:this,subject:t}}),e.activate&&e.activate(t);const s=()=>{if(this.viewport){if(!this.hooked.size)return this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),void this.viewport.setColCell(this);if(this.unhookAll(),e.explode){for(const t of this.hooked)t.args.gSpeed=0;e.explode(),this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this)}}};e.args.flightTime&&this.viewport.onFrameOut(e.args.flightTime,s),e.onRemove(s),e.addEventListener("exploded",s)}}}unhook(t){if(!this.hooked.has(t))return;this.hooked.delete(t);const e=this.others.tiedTo;t.args.ignore=t.args.float=0,t.args.y++,t.args.xSpeed+=e.xSpeedLast||this.xSpeedLast||0,t.args.ySpeed+=e.ySpeedLast||this.ySpeedLast||0,t.args.groundAngle=0,t.args.hangingFrom=null,this.ignoreOthers.add(t),t.args.falling=!0,t.args.jumping=!0;const s=this.viewport;s.onFrameOut(15,()=>{this.ignoreOthers.delete(t),s.auras.delete(this)})}unhookAll(){for(const t of this.hooked)this.unhook(t)}}}),require.register("actor/GravityPad.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GravityPad=void 0;var i=e("./PointActor");e("./Block"),e("../audio/Sfx");t.GravityPad=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e}constructor(){super(...arguments),this.args.width=this.args.width||24,this.args.height=32,this.args.type="actor-item actor-gravity-pad",this.args.float=-1}collideA(t){t.args.mode||t.args.float||t.args.static||(t.args.float=1,t.args.xSpeed=t.args.xSpeed||t.args.gSpeed,Math.abs(t.xLast-t.args.x)>5&&(t.args.ignore=1),t.args.ySpeed=Math.min(0,t.args.ySpeed),t.args.falling=!0,t.args.y>this.args.y+-this.args.height?(t.args.y-=1,t.args.ySpeed-=.5):t.args.ySpeed*=.25,t.args.y>=this.args.y+-.5*this.args.height&&(t.args.ySpeed-=1),t.args.animation="flip",t.args.jumping=!1,t.dashed=!1)}}}),require.register("actor/Grounder.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Grounder=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.Grounder=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s,i;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-grounder",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.args.color=null!==(t=this.args.color)&&void 0!==t?t:"green",this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(e=this.args.patrolPause)&&void 0!==e?e:20,this.args.patrolBeat=null!==(s=this.args.patrolBeat)&&void 0!==s?s:120,this.args.patrolSpeed=null!==(i=this.args.patrolSpeed)&&void 0!==i?i:1}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-color"]="color"}update(){this.args.direction,this.args.shotTelegraph,this.args.patrolBeat,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.direction=Math.sign(this.args.gSpeed)}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/GuardBot.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GuardBot=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../mixin/CanPop");e("../actor/Explosion"),e("../actor/Projectile");t.GuardBot=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.args.type="actor-item actor-guard-bot",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=24,this.args.height=24,this.args.static=!0,this.willStick=!1,this.stayStuck=!1}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/HallBooster.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallBooster=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");const a=Symbol("Boosted");class n extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-hall-booster",this.args.width=64,this.args.height=24,this.args.direction=this.args.direction||1,this.args.static=!0}update(){super.update()}collideA(t){if(t.isRegion||t.args.static)return;if(t instanceof n)return;if(t.args.gSpeed,t.args.falling||t[a])return;this.viewport.onFrameOut(10,()=>delete t[a]),t[a]=this;const e=this.args.toSpeed||24;t.args.ignore=2,t.args.direction=this.args.direction,t.args.facing=this.args.direction>0?"right":"left",t.args.gSpeed=e*this.args.direction,r.Sfx.play("HALLBOOSTER_HIT")}}t.HallBooster=n}),require.register("actor/HeavyDutySwitch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeavyDutySwitch=void 0;var i=e("./Switch");t.HeavyDutySwitch=class extends i.Switch{constructor(){super(...arguments),this.args.type="actor-item actor-switch actor-heavy-duty-switch",this.args.height=this.height=19}}}),require.register("actor/Herculad.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Herculad=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../audio/Sfx");t.Herculad=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-herculad",this.args.width=32,this.args.height=32,this.args.gravity=.4,this.args.collected=!1}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-collected"]="collected"}collideA(t,e){t.controllable&&(this.args.collected||(a.Sfx.play("DOOT_DOOT"),this.viewport.args.inventory.push({tallyIcon:"/secret/herculad-icon.png",icon:"/secret/herculad-icon.png",points:1e4,id:this.oid})),this.args.collected="collected"),super.collideA(t,e)}}}),require.register("actor/HexNut.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HexNut=void 0;var i=e("./Block");e("../audio/Sfx");t.HexNut=class extends i.Block{constructor(){var t;super(...arguments),this.args.maxClimb=null!==(t=this.args.maxClimb)&&void 0!==t?t:262,this.args.width=64,this.args.height=24,this.args.platform=1,this.args.float=-1,this.args.type="actor-item actor-hex-nut",this.args.static=0,this.args.spinning=0,this.args.bouncing=0,this.args.treadmill=!0}collideA(t,e){return!t.args.platform&&super.collideA(t,e)}update(){this.args.treadmill=!0,this.standingUnder.forEach(t=>{Math.abs(t.args.gSpeed)>16&&(t.args.gSpeed=16*Math.sign(t.args.gSpeed))});const t=this.originalY+-this.args.maxClimb;this.args.convey>0?this.getMapSolidAt(this.args.x,this.args.y+1)?(this.args.ySpeed=0,this.args.treadmill=!1,this.args.convey=0):this.args.y+=.1*this.args.convey:this.args.convey<0&&(this.args.y<=t?(this.args.y=t,this.args.ySpeed=0,this.args.treadmill=!1,this.args.convey=0):this.args.y+=.1*this.args.convey),Math.abs(this.args.convey)>8?this.standingUnder.forEach(t=>t.args.x=this.args.x):this.standingUnder.forEach(t=>{Math.abs(this.args.x-t.args.x)<1&&(t.args.x=this.args.x),t.args.x+=Math.sign(this.args.x-t.args.x)}),super.update()}sleep(){this.args.y=this.originalY}}}),require.register("actor/HtmlFrame.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlFrame=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag");t.HtmlFrame=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.tileId=t.gid,e.args.y=e.originalY=t.y,e}constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e,arguments.length>1?arguments[1]:void 0),this.args.yForce=0,this.args.yLean=0,this.args.type="actor-item actor-html-frame",this.args.width=e.width||32,this.args.height=e.height||32,this.originalX=this.args.x,this.originalY=this.args.y,this.args.z=-1e3,this.args.static=!0,this.args.gravity=.5,this.args.collapse=null!==(t=e.collapse)&&void 0!==t&&t;const s=["pxIofYrt0kE","aRsOBFhNjVM","obtGE_8NAp8","uRjoPlWWljk"],i=Math.random();console.log(i),this.args.url=(t=>`https://www.youtube.com/embed/${t}?controls=0&autoplay=1`)(s[Math.trunc(i*s.length)])}onRendered(t){super.onRendered(t),this.screen||(this.screen=new r.Tag('<iframe width="560" height="315" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'),this.sprite.appendChild(this.screen.node),this.args.spriteSheet=this.args.spriteSheet||"/Sonic/marble-zone-block.png",this.args.bindTo("url",t=>this.screen.src=t),this.args.bindTo("html",t=>this.screen.srcDoc=t))}}}),require.register("actor/Jawz.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Jawz=void 0;e("./Flickie");var i=e("./Spring"),r=e("curvature/base/Mixin"),a=(e("curvature/base/Tag"),e("./PointActor")),n=e("../mixin/CanPop");t.Jawz=class extends(r.Mixin.from(a.PointActor,n.CanPop)){constructor(){super(...arguments),this.args.type="actor-item actor-jawz",this[i.Spring.WontSpring]=!0,this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=56,this.args.height=16,this.willStick=!1,this.stayStuck=!1,this.args.float=-1,this.noClip=!0}onRendered(){super.onRendered(),this.box.setAttribute("data-animation","standing")}update(){this.args.facing="left",this.args.xSpeed>-4&&(this.args.xSpeed-=.2),this.args.ySpeed=0,this.args.falling=!0,this.args.flying=!0,super.update()}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Knuckles.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Knuckles=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer"),a=e("curvature/base/Tag"),n=e("./KnuxBomb"),o=e("../behavior/Spindash"),l=e("./Spring"),h=e("../behavior/SkidDust"),g=e("../behavior/Crouch"),c=e("../behavior/LookUp"),d=e("../behavior/EmeraldHalo"),u=e("../behavior/SuperForm"),p=e("../lib/Color"),f=e("../sprite/Png");function m(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Knuckles=class extends i.PointActor{constructor(t,e){super(t,e),m(this,"png",new f.Png("/Sonic/knuckles.png")),this.args.canonical="Knuckles",window.knuckles=this,this.behaviors.add(new h.SkidDust),this.behaviors.add(new o.Spindash),this.behaviors.add(new g.Crouch),this.behaviors.add(new c.LookUp),this.behaviors.add(new u.SuperForm),this.behaviors.add(new d.EmeraldHalo),this.args.isHyper=this.args.isSuper=!1,this.args.type="actor-item actor-knuckles",this.args.spriteSheet=this.spriteSheet="url('/Sonic/knuckles.png')",this.gSpeedMaxNormal=18,this.gSpeedMaxSuper=20,this.gSpeedMaxHyper=23,this.climbSpeedMaxNormal=4,this.climbSpeedMaxSuper=6,this.climbSpeedMax=this.climbSpeedMaxNormal,this.jumpForceNormal=9.5,this.jumpForceSuper=10,this.jumpForceHyper=11,this.accelNormal=.15,this.accelSuper=.24,this.args.accel=this.accelNormal,this.args.decel=.4,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.gravity=.5,this.args.normalGravity=.5,this.args.slowGravity=.125,this.args.punchMomentum=0,this.args.width=15,this.args.height=41,this.args.weight=150,this.args.normalHeight=41,this.args.rollingHeight=28,this.punchTime=0,this.punched=0,this.beforePunch="standing",this.bombsDropped=0,this.args.bellySliding=!1,this.slideTime=0,this.sparks=new Set,this.flyTime=0,this.transformTime=0,this.args.minRingsSuper=50,this.args.minRingsHyper=75,this.args.bindTo("punchMomentum",t=>this.args.punchSpeed=Math.abs(.5*t)),this.args.bindTo("falling",t=>{!t&&this.args.flying&&(1!==this.args.mode&&2!==this.args.mode&&3!==this.args.mode||(this.args.climbing=!0,this.isHyper&&Math.abs(this.args.xSpeed)>5&&(this.viewport.args.shakeX=16,this.viewport&&this.viewport.settings.rumble&&this.controller&&this.controller.rumble&&this.controller.rumble({duration:800,strongMagnitude:1,weakMagnitude:1})),this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0))}),this.costumes={Tails:{h:-125,s:1,v:1},Enerjak:{h:120,s:1,v:.55},Pink:{h:0,s:1.5,v:1.5},Wechnia:{h:0,s:0,v:.85}}}onRendered(t){if(this.box)return;super.onRendered(t),this.autoStyle.get(this.box)["--punchSpeed"]="punchSpeed",this.autoStyle.get(this.box)["--sprite-sheet"]="spriteSheet",this.punchAura=new a.Tag('<div class = "punch-aura">'),this.punchAura.style({display:"none"}),this.sprite.appendChild(this.punchAura.node),this.args.bindTo("animation",t=>this.box.setAttribute("data-animation",t)),this.addEventListener("jump",t=>{this.willPunch&&(this.punchTime=this.viewport.args.frameId,this.punched++)}),this.rotatedSpriteSheet=this.spriteSheet;const e=()=>{var t,e,s;let i=Number(null!==(t=this.viewport.customColor.h)&&void 0!==t?t:0),r=Number(null!==(e=this.viewport.customColor.s)&&void 0!==e?e:1),a=Number(null!==(s=this.viewport.customColor.v)&&void 0!==s?s:1);this.rotateMainColor(i,r,a),this.box.node.style.setProperty("--sprite-sheet",`url(${this.args.rotatedSpriteSheet})`)},s=this.viewport.customColor.bindTo("h",e,{wait:0}),i=this.viewport.customColor.bindTo("s",e,{wait:0}),r=this.viewport.customColor.bindTo("v",e,{wait:0});this.onRemove(s),this.onRemove(i),this.onRemove(r),this.viewport.args.mainPallet&&this.costumes[this.viewport.args.mainPallet]&&Object.assign(this.viewport.customColor,this.costumes[this.viewport.args.mainPallet]),this.superSheet=0;const n={f1958e:"cacaca",d3565c:"cacaca",c00020:"b0b0b0",600020:"989898"},o={f1958e:"faf1f1",d3565c:"faf1f1",c00020:"f5dfdf",600020:"eecaca"};this.superSpriteSheetLoaders||(this.superSpriteSheetLoaders=this.png.ready.then(()=>this.superSpriteSheets=[this.png.recolor(n).toUrl(),this.png.recolor(o).toUrl()])),this.hyperSheet=0;const l={f1958e:"fcfcfc",d3565c:"fcfcfc",c00020:"fcfcfc",600020:"fcd8d8"},h={f1958e:"fcfcfc",d3565c:"fcfcfc",c00020:"fcfcfc",600020:"fcd8fc"},g={f1958e:"d8fcfc",d3565c:"d8fcfc",c00020:"fcfcfc",600020:"b4d8fc"},c={f1958e:"d8d8ff",d3565c:"d8d8ff",c00020:"b4b4d8",600020:"a4a4d8"},d={f1958e:"d8fcfc",d3565c:"d8fcfc",c00020:"d8fcd8",600020:"b4fcb4"},u={f1958e:"d8fcfc",d3565c:"d8fcfc",c00020:"d8fcb4",600020:"d8fc48"},p={f1958e:"ffffff",d3565c:"ffffff",c00020:"fcfcfc",600020:"d8d8d8"};this.hyperSpriteSheetLoader||(this.hyperSpriteSheetLoader=this.png.ready.then(()=>this.hyperSpriteSheets=[this.png.recolor(l).toUrl(),this.png.recolor(g).toUrl(),this.png.recolor(h).toUrl(),this.png.recolor(p).toUrl(),this.png.recolor(d).toUrl(),this.png.recolor(c).toUrl(),this.png.recolor(u).toUrl()]))}update(){if(this.isSuper){this.isHyper?(this.viewport.args.frameId%15==0&&(this.hyperSheet++,this.hyperSheet>=this.hyperSpriteSheets.length&&(this.hyperSheet=0)),this.hyperSpriteSheet=this.hyperSpriteSheets[this.hyperSheet],this.args.spriteSheet=`url(${this.hyperSpriteSheet})`):(this.viewport.args.frameId%15==0&&(this.superSheet++,this.superSheet>=this.superSpriteSheets.length&&(this.superSheet=0)),this.superSpriteSheet=this.superSpriteSheets[this.superSheet],this.args.spriteSheet=`url(${this.superSpriteSheet})`);const t=this.isHyper?30:60;this.viewport.args.frameId%t==0&&(this.args.rings<2&&(this.isHyper=!1,this.setProfile()),this.args.rings>0?this.args.rings--:(this.isSuper=!1,this.isHyper=!1,this.setProfile()))}if(this.args.isSuper=this.isSuper,this.args.isHyper=this.isHyper,(!this.args.falling&&this.groundTime>3||this.args.falling&&this.fallTime>90)&&(this.args.twistRamp=!1),this.args.bellySliding&&(this.xAxis=0),this.args.wasHanging&&(this.args.flying=!1),this.args.flying){const t=this.getMapSolidAt(this.args.x+this.args.xSpeed,this.args.y+-18),e=this.getMapSolidAt(this.args.x+this.args.xSpeed,this.args.y),s=this.getMapSolidAt(this.args.x,this.args.y+1);if(e&&!t&&!s)for(;this.getMapSolidAt(this.args.x+this.args.xSpeed,this.args.y);)this.args.y--;this.isHyper&&this.yAxis<-.55&&(this.args.ySpeed-=1.1*this.args.slowGravity),this.args.gravity=this.args.slowGravity,this.flyTime++}else this.args.didBoost=!1,this.args.gravity=this.args.normalGravity,this.flyTime=0;this.args.dead&&(this.punching=!1),1===this.groundTime&&this.punching&&(this.punching=!1,this.readyStart(0,1));const t=this.args.falling,e=this.args.gSpeed;if(this.box){if(!this.args.falling&&this.readyTime&&this.viewport.args.frameId-this.readyTime>36?(this.punched=!1,this.readying=!1,this.willPunch=!1,this.punchTime=!1,this.readyTime=!1,this.punching=!1,Math.sign(this.args.punchMomentum)===Math.sign(this.xAxis)&&(this.args.gSpeed=this.args.punchMomentum),this.args.punchMomentum=0):this.readyTime&&this.xAxis&&Math.abs(this.args.punchMomentum)<20&&(this.args.punchMomentum+=.05*this.xAxis),this.throwing&&this.viewport.args.frameId-this.throwing>20){this.throwing=!1,this.holdBomb=!1;const t=new n.KnuxBomb({x:this.args.x,y:this.args.y-16,owner:this,xSpeed:10*this.args.direction+(2*Math.random()-1),ySpeed:-2*Math.random()});this.viewport.spawn.add({object:t})}if(this.readying=!1,this.punchTime&&this.viewport.args.frameId-this.punchTime>15&&(this.readying=!0),this.punchTime&&this.viewport.args.frameId-this.punchTime>10&&(this.punching=!0),this.punching&&(this.args.rolling=!1),this.punching&&Math.abs(this.args.gSpeed)>10?(this.auraVisible=!0,this.viewport.onFrameOut(6,()=>{this.punchAura.style({display:"none"}),this.auraVisible=!1}),this.punchAura.style({display:"initial"})):(this.auraVisible=!1,this.punchAura.style({display:"none"})),this.stayStuck=!1,this.willStick=!1,this.args.mercy&&(this.args.flying=!1),0===this.yAxis&&(this.args.lookTime=0,this.args.cameraBias=0),t)if(this.args.climbing=!1,this.springing&&(this.args.groundAngle=0),this.args.flying){let t=!1;this.viewport.regionsAtPoint(this.args.x,this.args.y-36);for(const e of this.regions)e.isWater&&(t=!0);if(Math.abs(this.args.xSpeed)>6||Math.abs(this.xAxis)<.55||Math.sign(this.xAxis)===Math.sign(this.args.xSpeed)?this.args.animation=t?"swimming":"flying":Math.sign(this.xAxis)!==Math.sign(this.args.xSpeed)&&(Math.abs(this.args.xSpeed)>3?this.args.animation="flying-turning":this.args.animation="flying-stalled"),this.bMap("checkBelow",this.x,this.y).get(r.Platformer)&&!this.args.climbing&&(this.args.bellySliding=!0,this.args.float=1),this.yAxis>.55)return this.args.flying=!1,void(this.args.ySpeed=8);this.xAxis&&(this.args.flyDirection=Math.sign(this.xAxis)),this.args.direction=Math.sign(this.args.xSpeed),this.args.direction<0?this.args.facing="left":this.args.facing="right";const e=(16+8*Math.abs(this.xAxis))*(t?.5:1);this.args.flyDirection&&Math.abs(this.args.xSpeed)<e&&(this.args.flyDirection!==Math.sign(this.args.xSpeed)?this.args.xSpeed+=.15625*Math.sign(this.args.flyDirection)*4:this.args.xSpeed+=.15625*Math.sign(this.args.flyDirection)),!this.args.didBoost&&Math.abs(this.args.xSpeed)>e&&(this.args.xSpeed-=.1*(this.args.xSpeed-e*Math.sign(this.args.xSpeed))),this.args.ySpeed>2&&Math.abs(this.args.xSpeed)<4&&(this.args.xSpeed+=.1*Math.sign(this.args.xSpeed)),t&&this.args.ySpeed>1&&(this.args.ySpeed=1),!t&&this.args.ySpeed>.5&&(this.args.ySpeed=.5),this.willStick=!0,this.stayStuck=!0,this.args.groundAngle=0}else this.args.jumping&&((Math.abs(this.args.punchMomentum)>8||this.readyTime)&&(this.willPunch||this.punching)?(this.args.animation="uppercut",this.punched++,this.punchAura.style({display:"initial"}),this.auraVisible=!0,this.viewport.onFrameOut(15,()=>{this.punchAura.style({display:"none"}),this.auraVisible=!1})):(this.punched=!1,this.punching=!1,this.args.bellySliding||(this.args.animation="jumping")));else{this.bombsDropped=0,this.springing=!1;const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;if(this.args.knucklesFlyCoolDown=15,this.args.flying=!1,this.args.bellySliding)this.args.animation="flying";else if(this.args.rolling)this.args.animation="rolling";else if(this.args.climbing){const t=3===this.args.mode?-1:1;if(!this.getMapSolidAt(this.args.x+-t,this.args.y+1))return this.args.direction=-t,this.args.climbing=!1,this.args.facing=t>0?"left":"rigjt",this.args.animation="dropping",this.args.x+=.5*this.args.width*t,this.args.groundAngle=0,this.args.falling=!0,this.args.ySpeed=this.gSpeedLast*(3===this.args.mode?-1:1),this.args.gSpeed=0,void(this.args.mode=0);const e=1===this.args.mode?-1:1,s=16;if(this.args.modeTime<2||0===this.yAxis)this.climbOverCancel||(this.args.animation="climbing",this.args.gSpeed=0);else if(this.yAxis<-.55)if(this.getMapSolidAt(this.args.x+1*e,this.args.y-s)||this.getMapSolidAt(this.args.x+18*e,this.args.y-s)){if(this.args.animation="climbing-up",Math.abs(this.args.gSpeed)<this.climbSpeedMax){const t=[0,1,0,-1][this.args.mode];this.args.direction=t,this.args.gSpeed+=-t}}else this.args.animation="climbing-over",this.climbOverCancel||(this.args.ignore=12,this.args.gSpeed=0,this.climbOverCancel=this.viewport.onFrameOut(12,()=>{this.args.falling?this.climbOverCancel=!1:(this.args.x+=.5*this.args.width*e,this.args.y-=s,this.args.direction=e,this.args.facing=e>0?"right":"left",this.args.climbing=!1,this.climbOverCancel=!1)}));else this.yAxis>.55&&(this.args.animation="climbing-down",Math.abs(this.args.gSpeed)<this.climbSpeedMax&&(this.args.direction=1===this.args.mode?1:-1,this.args.gSpeed+=this.args.direction),this.getMapSolidAt(this.args.x+8*-e,this.args.y+16)&&(this.args.x+=.5*this.args.width*-e,this.args.facing=-e>0?"right":"left",this.args.mode=0,this.args.groundAngle=0,this.args.falling=!0,this.args.animation="standing",this.args.y+=8))}else Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.args.animation="skidding":this.holdBomb?this.args.animation="hold-bomb":this.throwing?this.args.animation="throw-bomb":this.readying||this.willPunch?this.args.animation="readying":!this.readying&&this.punched?this.punched%2?this.args.animation="jabbing":this.args.animation="punching":s>.75*i?this.args.animation="running":this.args.moving&&this.args.gSpeed?this.args.animation="walking":this.args.teeter?(this.args.animation="teeter",this.idleTime>56&&(this.args.animation="teeter-2")):this.args.animation="standing";this.args.grinding&&(this.args.rolling=!1,this.args.animation="grinding")}if(this.args.flying?this.springing=!1:(this.args.mode%2==0||this.args.groundAngle)&&(this.args.flyDirection=0),this.args.knucklesFlyCoolDown>0&&this.args.knucklesFlyCoolDown--,super.update(),this.willPunch&&!e&&(this.args.gSpeed=0),0!==this.args.mode&&2!==this.args.mode||(this.args.climbing&&2===this.args.mode&&(this.args.groundAngle=0,this.args.falling=!0,this.args.y+=this.args.height),this.args.climbing=!1),this.args.grinding&&!this.args.falling&&this.args.gSpeed){this.args.bellySliding=!1;const t=new a.Tag('<div class = "particle-sparks">'),e=new a.Tag('<div class = "envelope-sparks">');e.appendChild(t.node);const s=this.rotatePoint(1.75*-this.args.gSpeed*this.args.direction,8),i=Math.sign(this.args.gSpeed);e.style({"--x":s[0]+this.x,"--y":s[1]+this.y+-3*Math.random,"z-index":0,"animation-delay":.25*-Math.random()+"s","--xMomentum":Math.max(Math.abs(this.args.gSpeed),4)*i,"--flip":i,"--angle":this.realAngle,opacity:2*Math.random()}),e.particle=t,this.viewport.particles.add(e),this.sparks.add(e),this.viewport.onFrameOut(30,()=>{this.viewport.particles.remove(e),this.sparks.delete(e)})}if(this.args.grinding&&(this.args.rolling=!1,this.args.animation="grinding"),this.args.falling&&this.springing&&this.args.ySpeed>=0?this.args.animation="dropping":this.args.falling&&this.springing&&(this.args.animation="springdash"),this.args.hangingFrom&&(this.args.animation="hanging"),this.args.standingOn&&this.args.standingOn.isVehicle&&(this.args.animation=this.args.standingOn.ridingAnimation||"standing"),this.sparks.size)for(const t of this.sparks){const e=this.rotatePoint(1.75*this.args.direction,8);t.style({opacity:2*Math.random(),"--x":e[0]+this.x,"--y":e[1]+this.y})}this.args.dead&&(this.args.animation="dead"),this.args.twistRamp&&(this.args.animation="side-flip")}else super.update()}updateEnd(){!this.args.falling&&this.punchTime&&this.viewport.args.frameId-this.punchTime>(this.willPunch?90:30)&&(this.args.punchMomentum=0,this.punchTime=!1,this.willPunch=!1,this.punching=!1,this.punched=0),this.args.falling||(this.args.bellySliding?(this.args.rolling=!1,this.args.animation="sliding",this.alwaysSkidding=!0,this.slideTime++):(this.alwaysSkidding=!1,this.slideTime=0),Math.abs(this.args.gSpeed)<1&&(this.args.bellySliding=!1)),super.updateEnd(),this.args.falling||(this.dashed=!1)}startle(){this.args.climbing=!1,this.willStick=!1,this.stayStuck=!1,super.startle(),this.onNextFrame(()=>this.args.animation="startle")}dropBomb(){this.args.falling&&(this.args.ySpeed=-8);const t=new n.KnuxBomb({x:this.args.x,y:this.args.y-16,owner:this,xSpeed:this.args.xSpeed,ySpeed:-3});this.viewport.spawn.add({object:t})}release_0(){this.args.flying&&(this.args.flying=!1,this.args.ySpeed*=.25)}command_0(){this.args.bellySliding=!1,super.command_0(),!this.args.hangingFrom&&this.args.jumping&&!this.willPunch&&this.args.falling&&(this.args.wasHanging||(this.args.falling&&(this.args.punchMomentum=0,this.punching=!1),this.args.ignore||(this.args.direction=Math.sign(this.args.xSpeed)||("left"===this.args.facing?-1:1),this.args.willJump=!1,this.args.flying=!0,this.args.xSpeed=Math.max(4,Math.abs(this.args.xSpeed))*this.args.direction,this.args.ySpeed=Math.max(0,this.args.ySpeed))))}readyStart(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.readyTime&&this.viewport.args.frameId-this.readyTime>20)return;if(this.readyTime=this.viewport.args.frameId,this.args.flying||this.args.climbing||this.args.falling)return;if(this.readyButton=e,this.punchTime&&this.viewport.args.frameId-this.punchTime<9)return this.args.punchMomentum=0,this.willPunch=!1,this.punchTime=!1,void(this.punched=0);this.willPunch=!0;const s=Math.sign(this.xAxis||t||this.args.direction);if(this.args.direction=Math.sign(s||this.args.punchMomentum),this.args.facing=s<0?"left":"right",this.punchTime)return this.args.gSpeed=0,void(this.punchTime=!1);this.args.punchMomentum=Math.abs(this.args.punchMomentum||this.args.gSpeed||4)*Math.sign(s||this.xAxis),this.args.gSpeed=0}damage(t,e){if(this.readyTime)return!1;super.damage(t,e)}readyStop(t,e){if(this.readyTime=!1,this.readyButton!==e)return;if(this.readyButton=!1,this.args.flying||this.args.climbing||this.args.falling)return;if(this.punchTime&&this.viewport.args.frameId-this.punchTime<64)return this.willPunch=!1,void(this.punched=0);this.args.direction="left"===this.args.facing?-1:1;const s=this.args.direction;if(s&&Math.sign(s)!==Math.sign(this.args.punchMomentum)?s&&(this.args.punchMomentum=Math.abs(this.args.punchMomentum)*s,this.args.gSpeed=1*(s?Math.abs(this.args.punchMomentum)*s:this.args.punchMomentum)):this.args.gSpeed=s?Math.abs(this.args.punchMomentum)*s:this.args.punchMomentum,this.args.direction=Math.sign(s||this.args.punchMomentum),this.args.facing=s<0?"left":"right",this.punchTime=this.viewport.args.frameId,this.willPunch=!1,!this.args.falling&&this.args.gSpeed){const t=new a.Tag('<div class = "particle-dust">'),e=Math.sign(this.args.gSpeed)*this.dustDist||0,s=this.rotatePoint(this.args.gSpeed,0);t.style({"--x":s[0]+e+this.x,"--y":s[1]+this.y,"z-index":0,opacity:Math.random()**2*.5+.5}),viewport.particles.add(t),viewport.onFrameOut(20,()=>{viewport.particles.remove(t)})}this.throwing||this.args.climbing||this.punched++}command_1(){if(this.args.climbing)return this.args.x+=this.args.width/2*(1===this.args.mode?1:-1),void this.bMap("doJump",0);if(this.args.falling)this.readyStart(0,1);else{if(this.cancelReady&&(this.cancelReady(),this.cancelReady=!1),this.args.direction="left"===this.args.facing?-1:1,this.args.punchMomentum=this.args.punchMomentum||this.args.gSpeed||3*(this.args.direction||1),!this.args.gSpeed||!this.punched)return this.readyButton=1,this.punching=!0,this.readyStop(Math.sign(this.args.punchMomentum),1),void(this.cancelReady=this.viewport.onFrameOut(20,()=>this.readyStart(this.args.direction,1)));this.args.gSpeed>10&&(this.punchAura.style({display:"initial"}),this.auraVisible=!0),this.punched=this.punched||1,this.args.gSpeed=0,this.readyStart(0,1)}}release_1(){this.args.falling||(this.willPunch?this.readyStop(0,1):this.punchTime&&this.viewport.args.frameId-this.punchTime<220||this.punchTime&&this.viewport.args.frameId-this.punchTime>320||this.args.gSpeed||this.cancelReady||(this.cancelReady=this.viewport.onFrameOut(40,()=>this.readyStart(this.args.direction,1))))}command_4(){this.readyStart(-1,4)}release_4(){this.readyStop(-1,4)}command_5(){this.readyStart(1,5)}release_5(){this.readyStop(1,5)}command_2(){}release_2(){this.args.falling||this.args.climbing||Math.abs(this.args.gSpeed)>3||this.holdBomb&&(this.args.ignore=4,this.holdBomb=!1,this.throwing=this.viewport.args.frameId)}setCameraMode(){this.args.climbing?this.args.cameraMode="climbing":super.setCameraMode()}collideA(t){t instanceof l.Spring&&this.onNextFrame(()=>{this.args.falling&&!this.args.hangingFrom&&(this.springing=!0,this.args.animation="springdash")}),t.pop&&this.isHyper&&t.pop(this)}rotateMainColor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i={f1958e:new p.Color("f1958e").rotate(t,e,s).toString(),d3565c:new p.Color("d3565c").rotate(t,e,s).toString(),c00020:new p.Color("c00020").rotate(t,e,s).toString(),600020:new p.Color("600020").rotate(t,e,s).toString()};this.png.ready.then(()=>{const t=this.png.recolor(i);this.args.rotatedSpriteSheet=this.rotatedSpriteSheet=this.spriteSheet=t.toUrl(),this.args.spriteSheet=`url('${this.args.rotatedSpriteSheet}')`})}setProfile(){this.isHyper?(this.args.spriteSheet=`url('${this.hyperSpriteSheet}')`,this.args.gSpeedMax=this.gSpeedMaxHyper,this.args.jumpForce=this.jumpForceHyper,this.climbSpeedMax=this.climbSpeedMaxSuper,this.args.accel=this.accelSuper):this.isSuper?(this.args.spriteSheet=`url('${this.superSpriteSheet}')`,this.args.gSpeedMax=this.gSpeedMaxSuper,this.args.jumpForce=this.jumpForceSuper,this.climbSpeedMax=this.climbSpeedMaxSuper,this.args.accel=this.accelSuper):(this.args.spriteSheet=`url('${this.rotatedSpriteSheet}')`,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.climbSpeedMax=this.climbSpeedMaxNormal,this.args.accel=this.accelNormal)}command_3(){}get solid(){return!1}get canRoll(){return!this.args.climbing}get canFly(){return!0}get isEffect(){return!1}get controllable(){return!this.args.npc}}}),require.register("actor/KnuxBomb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KnuxBomb=void 0;var i=e("./PointActor"),r=(e("../actor/Explosion"),e("curvature/base/Tag"));e("../region/Region"),e("./Spring");t.KnuxBomb=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-knux-bomb",this.args.width=16,this.args.height=16,this.removeTimer=null}update(){this.removed||(super.update(),this.args.xSpeed||this.args.ySpeed||this.args.gSpeed||(this.removeTimer=this.onTimeout(250,()=>this.explode())),this.removeTimer||(this.removeTimer=this.onTimeout(1500,()=>this.explode())))}explode(){const t=this.viewport;if(!t)return;const e=new r.Tag('<div class = "particle-explosion">');e.style({"--x":this.x,"--y":this.y}),t.particles.add(e),setTimeout(()=>t.particles.remove(e),350),this.viewport.actors.remove(this),this.remove()}get canStick(){return!1}get solid(){return!1}}}),require.register("actor/LavaBall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LavaBall=void 0;var i=e("./PointActor");t.LavaBall=class extends i.PointActor{constructor(){super(...arguments),this.args.width=16,this.args.height=16,this.args.float=0,this.args.type="actor-item actor-lava-ball",this.args.jumpForce=7.25,this.args.gravity=.2,this.args.density=25}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-color"]="color"}update(){super.update(),(this.viewport.args.frameId+(this.args.offset||0))%45==0&&(this.willJump=!0),this.args.hidden=!this.willJump&&!this.args.falling}collideA(t,e){return t.controllable&&this.args.falling&&t.damage(this),super.collideA(t,e)}}}),require.register("actor/LayerController.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayerController=void 0;var i=e("./PointActor");t.LayerController=class extends i.PointActor{constructor(t,e){var s,i;super(t,e),this.args.activated=!1,this.args.xLayer=0,this.args.yLayer=0,this.args.xLayerSpeed=0,this.args.yLayerSpeed=0,this.args.yLayerSpeedMax=this.args.yLayerSpeedMax||9,this.args.fall=null===(s=this.args.fall)||void 0===s||s,this.args.xLayerLimit=this.args.xLayerLimit||null,this.args.yLayerLimit=this.args.yLayerLimit||null,this.args.yQuake=null!==(i=this.args.yQuake)&&void 0!==i?i:5,this.args.static=!0,this.args.hidden=!0}updateStart(){if(!this.viewport)return;this.args.activated&&this.args.fall&&(this.args.yLayerSpeed+=.25),this.args.activated&&this.args.swim&&(this.args.xLayerSpeed+=1),this.args.yLayerSpeed>this.args.yLayerSpeedMax&&this.args.yLayerSpeedMax>0&&(this.args.yLayerSpeed=this.args.yLayerSpeedMax),this.args.xLayerSpeed>this.args.xLayerSpeedMax&&this.args.xLayerSpeedMax>0&&(this.args.xLayerSpeed=this.args.xLayerSpeedMax),this.args.yLayerSpeed&&(this.args.yLayer=Math.round(this.args.yLayer+this.args.yLayerSpeed||0)),this.args.xLayerSpeed&&(this.args.xLayer=Math.round(this.args.xLayer+this.args.xLayerSpeed||0));const t=this.viewport.tileMap.mapData.tileheight,e=this.viewport.tileMap.mapData.width,s=this.viewport.tileMap.mapData.height,i=this.viewport.tileMap.meta.wrapX?1/0:e*t,r=this.viewport.tileMap.meta.wrapY?1/0:s*t;if(this.args.yLayerLimit>0&&this.args.yLayer>r&&this.args.yLayer>this.args.yLayerLimit){if(this.args.yLayerSpeed=0,this.args.yLayer=this.args.yLayerLimit,this.args.target){const t=this.viewport.actorsById[this.args.target];this.viewport.auras.delete(t)}this.viewport.auras.delete(this)}if(this.args.xLayerLimit>0&&(this.args.xLayer>i||this.args.xLayer>this.args.xLayerLimit)){if(this.args.xLayerSpeed=0,this.args.xLayer=this.args.xLayerLimit,this.args.target){const t=this.viewport.actorsById[this.args.target];this.viewport.auras.delete(t)}this.viewport.auras.delete(this)}}activate(t,e){var s;if(!this.args.activated&&(t&&(this.args.x=t.x,this.args.y=t.y),this.viewport.auras.add(this),this.viewport.args.shakeY=this.args.yQuake,this.viewport.onFrameOut(90,()=>{this.args.activated=!0}),this.args.yLayerLimit=null!==(s=this.args.yLayerLimit)&&void 0!==s?s:4096,this.args.target&&this.viewport.actorsById[this.args.target])){const e=this.viewport.actorsById[this.args.target];this.viewport.auras.add(e),e.activate(t,this)}}}}),require.register("actor/LayerSwitch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayerSwitch=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LayerSwitch=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}onAttach(t){return t&&t.preventDefault(),!1}constructor(){var t,e;super(...arguments),r(this,"float",-1),this.args.type="actor-item actor-layer-switch",this.args.width=32,this.args.height=32,this.args.static=!0,this.args.fromLayer=null!==(t=this.args.fromLayer)&&void 0!==t?t:1,this.args.toLayer=null!==(e=this.args.toLayer)&&void 0!==e?e:2}collideA(t,e){let s=t.args.gSpeed||t.args.xSpeed||t.args.direction||t.xAxis,i=!!Number(this.args.back),r=!!Number(this.args.roll);2===t.args.mode||t.args.mode;const a=this.args.width/2,n=this.args.x,o=this.args.y,l=t.args.x,h=t.args.y;if(l<n+-a+0||l>n+a+-0)return;if(h<o+-this.args.height||t.y>o)return;if(this.args.allow||this.args.disallow)return this.args.allow&&t.doorMap.set(Number(this.args.allow),!1),void(this.args.disallow&&t.doorMap.set(Number(this.args.disallow),!0));if(r&&(!t.args.rolling||t.args.height>28))return t.args.layer=g===this.args.fromLayer?this.args.toLayer:this.args.fromLayer,!1;i&&t.args.falling&&(s=t.args.xSpeed||t.args.direction,i=!i);let g=t.args.layer,c=this.args.fromLayer;s>0&&(g=i?this.args.fromLayer:this.args.toLayer,c=i?this.args.toLayer:this.args.fromLayer),s<0&&(g=i?this.args.toLayer:this.args.fromLayer,c=i?this.args.fromLayer:this.args.toLayer),this.viewport.tileMap.getSolid(l,h,g)?this.viewport.onFrameOut(1,()=>{this.viewport.tileMap.getSolid(l,h,g)||(t.args.layer=g)}):t.args.layer&&t.args.layer!==c||(t.args.layer=g)}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/LightSource.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightSource=void 0;var i=e("./PointActor");t.LightSource=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return t.polygon&&(e.args.polygon=t.polygon.map(t=>Object.assign({},t))),e}constructor(){super(...arguments),this.args.type="actor-item actor-light-source",this.args.hidden=!0,this.args.static=!0,this.args.float=-1}get solid(){return!1}}}),require.register("actor/Magnet.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Magnet=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/Constrainable");t.Magnet=class extends(r.Mixin.from(i.PointActor,a.Constrainable)){constructor(){super(...arguments),this.args.gravity=.8,this.args.width=48,this.args.height=28,this.args.type="actor-item actor-magnet"}collideA(t,e){}collideB(t){t.controllable}update(){super.update(),this.setPos()}}}),require.register("actor/MarbleBlock.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarbleBlock=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer");t.MarbleBlock=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-block-marble",this.args.width=32,this.args.height=32,this.args.spriteSheet=this.args.spriteSheet||"/Sonic/marble-zone-block.png"}collideA(t,e){if(super.collideA(t,e),t.isEffect)return!1;if(!this.isPushable)return!0;let s=Math.ceil(Math.abs(t.args.gSpeed||t.args.xSpeed))*Math.sign(t.args.gSpeed||t.args.xSpeed);if(!this.args.falling&&1===e&&s<=0)return!1;if(!this.args.falling&&3===e&&s>=0)return!1;const i=this.y-this.args.height;if((1===e||3===e)&&(t.y>=this.y||t.y>i)){if(!s)return!0;if(this.args.pushed=Math.sign(t.args.gSpeed)||this.args.pushed,this.args.pushed<0&&this.getMapSolidAt(this.x-Math.ceil(this.args.width/2)-1,this.y+-4))return!0;if(this.args.pushed>0&&this.getMapSolidAt(this.x+Math.ceil(this.args.width/2)+1,this.y+-4))return!0;const i=this.viewport.tileMap,a=1===e?1:3===e&&-1;if(i.getSolid(this.x+Math.ceil(this.args.width/2)*a,this.y+-4))return!0;if(this.args.width,!this.args.falling){const e=this.bMap("findNextStep",a).get(r.Platformer);if(e[2]){const t=this.scanBottomEdge(a);t&&t<=.5*(this.args.width+this.args.width%2)&&(this.args.xSpeed=Math.sign(a),this.args.x+=t*Math.sign(a))}else if(!e[3]){const s=t.args.width/2,i=this.args.width/2;if(Math.trunc(Math.abs(this.x-t.x))<=1+s+i){this.args.x+=e[0],this.args.y-=e[1];const s=Math.sign(t.args.gSpeed);Math.sign(this.x-t.x)===s&&(t.args.pushing=s);const i=this.args.weight/t.args.weight;t.args.gSpeed-=.005*i*Math.sign(t.args.gSpeed)}return!1}return!0}}return!(t.args.ySpeed<0)}onAttach(){this.args.spriteSheet=this.args.spriteSheet||"/Sonic/marble-zone-block.png",this.viewport&&this.setTile()}get isPushable(){return!0}get canStick(){return!1}get solid(){return!0}get rotateLock(){return!0}}}),require.register("actor/Marker.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;var i=e("./PointActor");t.Marker=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-marker",this.args.width=64,this.args.height=64,this.args.float=-1}get solid(){return!1}}}),require.register("actor/Meanie.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meanie=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop"),o=e("../ObjectPalette");t.Meanie=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s,i;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-meanie",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=16,this.args.height=29,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:40,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:140,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1,this.args.hatType=null!==(i=this.args.hatType)&&void 0!==i?i:"pumpkin",this.args.maxBoost=0}wakeUp(t){this.viewport&&!this.hat&&o.ObjectPalette[this.args.hatType]&&(this.hat=new o.ObjectPalette[this.args.hatType],this.viewport.spawn.add({object:this.hat}),this.hat.args.float=-1,this.hat.noClip=!0,this.hat.args.x=this.args.x,this.hat.args.y=this.args.y+14,this.viewport.setColCell(this.hat),this.args.hatType&&(this.hat.args.face=!0))}update(){this.args.maxBoost=Math.max(this.args.ySpeed,this.args.maxBoost),this.args.direction,this.args.shotTelegraph,this.args.patrolBeat,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.groundAngle=0,this.args.mode=0,this.args.direction=Math.sign(this.args.xSpeed||this.args.gSpeed),this.args.falling||this.jumpTimer||(this.jumpTimer=this.viewport.onFrameOut(2,()=>{this.args.ySpeed=-Math.min(this.args.maxBoost,9),this.args.xSpeed=this.args.gSpeed,this.args.falling=!0,this.fallTime=0,this.jumpTimer=!1})),this.hat&&(this.hat.args.direction=this.args.direction,this.hat.args.x=this.args.x,this.hat.args.y=this.args.y,this.fallTime>9||this.fallTime<5?this.hat.args.y+=-14:this.hat.args.y+=-10,this.hat.args.z=this.args.z+1,this.viewport&&this.viewport.setColCell(this.hat))}effect(t){super.effect(t)}pop(t){if(!t||t.controllable){if(this.hat){const e=this.hat;if(this.viewport.onFrameOut(3,()=>{t?(this.args.xSpeed+=-2*(Math.sign(t.args.xSpeed||t.args.gSpeed)||1),e.args.xSpeed=-4*(Math.sign(t.args.xSpeed||t.args.gSpeed)||1),e.args.ySpeed=Math.min(-4,-Math.abs(t.args.ySpeed)),e.args.float=1):e.args.float=10,e.noClip=!1,this.hat=null}),!t.args.rolling)return void(t&&(this.ignores.set(t,10),t.args.gSpeed*=-1,t.args.xSpeed*=-1,t.args.ySpeed=-4,t.args.xSpeed=Math.min(Math.abs(t.args.xSpeed),6)*Math.sign(t.args.xSpeed)))}return super.pop(t)}}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/MechaFroggy.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MechaFroggy=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("../behavior/SkidDust");e("../actor/Explosion"),e("../actor/Projectile");t.MechaFroggy=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.args.type="actor-item actor-mecha-froggy",this.args.animation="standing",this.args.accel=.7,this.args.decel=.5,this.args.gSpeedMax=10,this.args.jumpForce=15,this.args.gravity=.5,this.args.width=15,this.args.height=32,this.willStick=!1,this.stayStuck=!1}update(){const t=this.args.direction;this.flame||(this.flame=new r.Tag('<div class = "mecha-froggy-flame">'),this.sprite.appendChild(this.flame.node)),this.args.jumping&&!this.args.falling||(Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","skidding"):this.args.moving&&this.args.gSpeed&&Math.abs(this.args.gSpeed)>=10?this.box.setAttribute("data-animation","running"):this.args.moving&&this.args.gSpeed&&Math.abs(this.args.gSpeed)?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),this.args.jumping&&this.box.setAttribute("data-animation","jumping"),super.update()}get solid(){return!1}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/MechaSonic.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MechaSonic=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer"),a=(e("./Vehicle"),e("curvature/base/Tag")),n=e("../audio/Sfx"),o=e("../behavior/SkidDust");t.MechaSonic=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new o.SkidDust("particle-sparks")),this.args.type="actor-item actor-mecha-sonic",this.args.accel=.1,this.args.decel=.3,this.args.skidTraction=2,this.args.gSpeedMax=18,this.args.jumpForce=11,this.args.gravity=.5,this.args.takeoffPlayed=!1,this.args.rollingHeight=28,this.args.normalHeight=44,this.args.width=18,this.args.height=this.args.normalHeight,this.args.bindTo("falling",t=>{t||this.landSound()})}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite")}update(){if(!this.sprite)return;const t=this.args.falling;this.args.accel=.1;const e=this.args.direction,s=this.args.gSpeed,i=Math.abs(s),r=.5*this.args.gSpeedMax;this.flame||(this.sparks=new a.Tag('<div class = "mecha-sonic-sparks">'),this.flame=new a.Tag('<div class = "mecha-sonic-flame">'),this.sprite.appendChild(this.sparks.node),this.sprite.appendChild(this.flame.node)),this.viewport.args.audio&&!this.thrusterSound&&(this.thrusterSound=new Audio("/Sonic/mecha-sonic-thruster.wav"),this.scrapeSound=new Audio("/Sonic/mecha-sonic-scrape.wav"),this.scrapeSound.volume=.1,this.thrusterSound.loop=!0,this.scrapeSound.loop=!0),this.thrusterSound&&(this.thrusterSound.volume=.15+-.05*Math.random(),this.thrusterSound.currentTime>1.5&&(this.thrusterSound.currentTime=.5),this.scrapeSound.currentTime>1.5&&(this.scrapeSound.currentTime=.5)),t||(this.dashed=!1),this.args.rolling||t?this.args.rolling?(this.scrapeSound&&this.scrapeSound.pause(),"curling"!==this.args.animation&&"uncurling"!==this.args.animation&&"rolling"!==this.args.animation&&"jumping"!==this.args.animation&&(this.args.animation="crouching",this.onTimeout(200,()=>{this.args.rolling&&(this.args.animation="rolling",this.closeThruster())}))):(this.scrapeSound&&this.scrapeSound.pause(),this.dashed?this.args.animation="running2":"rolling"!==this.args.animation&&"jumping"!==this.args.animation&&"uncurling"!==this.args.animation&&"curling"!==this.args.animation&&"crouching"!==this.args.animation?(this.args.animation="curling",this.onTimeout(200,()=>{n.Sfx.play("MECHASONIC_SLAP"),this.args.falling&&(this.dashed?this.args.animation="running2":this.args.jumping&&(this.args.animation="jumping"),this.closeThruster())})):this.args.jumping||(this.args.animation="crouching")):(this.yAxis>0?this.args.crouching=!0:this.args.crouching=!1,Math.sign(this.args.gSpeed)!==e&&Math.abs(this.args.gSpeed-e)>5?(this.scrapeSound&&this.scrapeSound.play(),this.args.animation="skidding"):i>=r?(this.scrapeSound&&this.scrapeSound.pause(),this.args.animation="running2",this.thrusterSound&&this.thrusterSound.play(),this.args.takeoffPlayed||(this.args.takeoffPlayed=!0,n.Sfx.play("MECHASONIC_TAKEOFF")),this.args.accel=.75,i>75&&(this.args.accel=.03)):i>=10?(this.scrapeSound&&this.scrapeSound.play(),this.args.animation="running"):this.args.moving&&s?(this.scrapeSound&&this.scrapeSound.play(),"curling"===this.args.animation||"jumping"===this.args.animation||"rolling"===this.args.animation?(this.args.animation="uncurling",this.onTimeout(128,()=>{this.args.animation="walking"})):"standing"!==this.args.animation&&"running"!==this.args.animation&&"running2"!==this.args.animation||(this.args.animation="walking")):this.args.crouching||this.standingOn&&this.standingOn.isVehicle?this.args.animation="crouching":(this.scrapeSound&&this.scrapeSound.pause(),"curling"===this.args.animation||"jumping"===this.args.animation||"rolling"===this.args.animation?(this.args.animation="uncurling",this.onTimeout(128,()=>{this.args.animation="standing"})):"walking"!==this.args.animation&&"running"!==this.args.animation&&"running2"!==this.args.animation&&"skidding"!==this.args.animation&&"crouching"!==this.args.animation&&"rolling"!==this.args.animation||(this.args.animation="standing")),i<r&&this.closeThruster()),super.update()}closeThruster(){this.args.takeoffPlayed&&this.landSound(),this.args.takeoffPlayed=!1,this.thrusterSound&&this.thrusterSound.pause()}landSound(){n.Sfx.play("MECHASONIC_SLAP")}sleep(){this.thrusterSound&&this.thrusterSound.pause(),this.scrapeSound&&this.scrapeSound.pause()}command_5(){this.args.falling&&this.airDash(1)}command_4(){this.args.falling&&this.airDash(-1)}airDash(t){if(this.dashed||this.args.ignore&&-2!==this.args.ignore)return;t<0?(this.args.direction=-1,this.args.facing="left"):(this.args.direction=1,this.args.facing="right");let e=7*t;this.args.float=3,this.args.mode=0,this.args.float=2,this.args.rolling=!1,this.args.height=this.args.normalHeight,this.args.xSpeed&&Math.sign(this.args.xSpeed)!==Math.sign(t)&&(e=11*t,this.args.float=6,this.args.xSpeed=0),this.args.falling=!0;const s=this.args.xSpeed+e,i=this.bMap("scanForward",e,.5).get(r.Platformer);i&&Math.abs(s)>Math.abs(i)&&(e=i*Math.sign(s)),this.args.xSpeed=s,this.args.ySpeed=0,this.dashTimer=0,this.dashed=!0,this.args.mode=0,this.args.groundAngle=0,this.args.takeoffPlayed=!0,this.takeoffSound&&n.Sfx.play("MECHASONIC_TAKEOFF")}get canRoll(){return!0}get controllable(){return!0}}}),require.register("actor/MegaMace.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MegaMace=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/Constrainable");e("../behavior/SkidDust");t.MegaMace=class extends(r.Mixin.from(i.PointActor,a.Constrainable)){constructor(){super(...arguments),this.args.decel=0,this.args.width=64,this.args.height=52,this.args.type="actor-item actor-mega-mace",this.args.ropeLength=this.args._tiedTo?this.args.ropeLength:8,this.args.gravity=.8,this.args.xSpeedMax=256,this.args.ySpeedMax=256}update(){this.args.tiedTo||super.update()}updateEnd(){this.viewport&&!this.viewport.auras.has(this)&&this.viewport.auras.add(this),this.args.tiedTo&&(super.update(),this.args._tiedTo||(this.args._tiedTo=this.viewport.actorsById[this.args.tiedTo]),this.args.tiedTo&&this.args._tiedTo.args.hitPoints?this.setPos():this.noClip=!0),super.updateEnd()}collideA(t){if(this.args._tiedTo&&!this.args._tiedTo===t)return!1}collideB(t){const e=this.others.tiedTo;if(e&&!e===t)return!1;e&&!e.args.hitPoints||(t.controllable||t.damage)&&t.damage()}}}),require.register("actor/MiniBoss.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiniBoss=void 0;var i=e("curvature/base/Tag"),r=e("../behavior/Platformer"),a=e("./PointActor"),n=e("curvature/base/Mixin"),o=(e("../mixin/CanPop"),e("./CutScene"),e("../audio/Sfx")),l=e("./EggCapsule"),h=e("./SpikeBomb");t.MiniBoss=class extends(n.Mixin.from(a.PointActor)){constructor(t,e){super(t,e),this.args.type="actor-item actor-mini-boss",this.args.width=48,this.args.height=48,this.args.float=-1,this.args.damagers=new Map,this.args.phase="idle",this.args.hitPoints=8,this.args.noseAngle=Math.PI/2*3,this.args.drillPush=0,this.args.phaseFrameId=0,this.args.frameId=0,this.args.direction=-1,this.args.facing="left",this.args.bindTo("phase",t=>this.args.phaseFrameId=0)}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-phase"]="phase",this.attractor=null}update(){if(this.args.phaseFrameId++,this.args.frameId++,!this.viewport)return;const t=this.viewport;if(t.auras.add(this),this.viewport.controlActor){switch(this.attractor||(this.attractor={},this.attractor.x=this.x,this.attractor.y=this.y),Math.abs(this.x-this.attractor.x),Math.abs(this.y-this.attractor.y),Math.sign(this.x-this.attractor.x),Math.sign(this.y-this.attractor.y),this.args.phase){case"stalking":const e=this.viewport.controlActor.args.x-this.args.x;this.args.xSpeed=Math.sign(e)*Math.min(4.5,Math.abs(e));case"idle":if(this.args.phaseFrameId%60==0){const t=new h.SpikeBomb({x:this.args.x,y:this.args.y+16,owner:this,xSpeed:this.args.xSpeed});this.viewport.spawn.add({object:t})}break;case"damaged":case"knocked":this.args.hitPoints>0?this.args.phaseFrameId>20&&(this.args.phase="stalking"):this.args.phaseFrameId>6&&(this.args.phase="dead");break;case"dead":this.args.float=0;break;case"exploding":if(90===this.args.phaseFrameId){this.args.falling=!0,this.args.ySpeed=-14,this.args.xSpeed=0,this.args.gSpeed=0,this.noClip=!0,this.viewport.auras.delete(this),this.args.phase="exploded",o.Sfx.play("OBJECT_DESTROYED");const t=this.viewport,e=t.controlActor;t.onFrameOut(60,()=>{const s=new l.EggCapsule({x:e.args.x,y:e.args.y-384,xSpeed:e.args.gSpeed||e.args.xSpeed});t.spawn.add({object:s})})}if(this.args.phaseFrameId>90)return;if(t&&t.args.frameId%3==0){const e=new i.Tag('<div class = "particle-explosion">');o.Sfx.play("BOSS_DAMAGED");const s=this.args.width*Math.random()-this.args.width/2,r=this.args.height*Math.random()-this.args.height/2;e.style({"--x":this.x+s,"--y":this.y+r+-16}),t.particles.add(e),setTimeout(()=>t.particles.remove(e),512)}}"knocked"!==this.args.phase&&this.args.ySpeed<0&&!this.pointIsSafe(this.x,this.y+-this.args.height+this.args.ySpeed+-1)&&(this.args.ySpeed=0),super.update()}}updateEnd(){if(super.updateEnd(),!this.viewport)return;const t=this.viewport.controlActor;if(t)switch(Math.abs(this.x-t.x),Math.abs(this.y-t.y),Math.sign(this.x-t.x),Math.sign(this.y-t.y),this.args.xSpeed<0?this.args.facing="left":this.args.xSpeed>0&&(this.args.facing="right"),this.args.groundAngle=0,this.args.phase){case"attacking":case"swooping":case"stalking":case"ready":this.bMap("checkBelow",this.x,this.y+1).get(r.Platformer)&&(this.args.falling=!0,this.args.ySpeed=-4,this.args.y--)}}collideA(t,e){if(!t.controllable)return;const s=Math.sign(this.x-t.x);if(Math.sign(this.y-t.y),Math.max(Math.abs(t.args.xSpeed),5),Math.sign(t.args.xSpeed),"dead"===this.args.phase){if(t.args.rolling&&(t.args.gSpeed=-s*Math.abs(t.args.gSpeed)),!(t.args.jumping||t.args.rolling||t.dashed))return!0;this.args.explodeFrame=this.viewport.args.frameId,this.args.phase="exploding"}if(1!==e&&3!==e||(this.onNextFrame(()=>{t.args.xSpeed=-s*Math.max(5,Math.abs(t.xSpeedLast))}),t.args.falling?this.ignores.set(t,15):(t.args.gSpeed=4*-Math.sign(this.x-t.x),t.args.rolling&&this.onNextFrame(()=>{t.args.gSpeed=-Math.sign(this.x-t.x),t.args.rolling=!0,t.args.direction=Math.sign(t.args.gSpeed)})),this.args.ySpeed=Math.min(0,this.args.ySpeed),this.damage(t)),2===e&&(this.viewport.args.audio&&o.Sfx.play("BOSS_DUDHIT"),t.args.falling&&(this.hitPoints<=0&&(this.args.ySpeed=2.5*-Math.abs(t.args.ySpeed)),t.controllable&&(t.args.ySpeed=Math.max(7,Math.abs(t.args.ySpeed)))),this.args.xSpeed=0,this.args.hitPoints>0&&(this.args.phase="knocked"),this.ignores.set(t,15)),0===e){if(t.args.falling&&this.ignores.set(t,15),t.controllable){t.args.y=this.y-this.args.height,t.args.animation;const e=t.args.ySpeed;this.onNextFrame(()=>{t.args.ySpeed=-Math.floor(Math.abs(e))||-4})}this.args.xSpeed=0,this.damage(t)}return t.args.ignore=6,this.args.hitPoints||(t.args.ignore=-2),!0}damage(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.args.hitPoints<=0)return void(this.viewport.controlActor.screenLock=null);const e=this.args.damagers.get(t);this.args.frameId-e<45||(this.args.hitPoints--,this.args.xSpeed=0,this.args.hitPoints<=0&&(this.viewport.controlActor.screenLock=null),this.args.damagers.set(t,this.args.frameId),this.onNextFrame(()=>this.args.phase="damaged"),o.Sfx.play("BOSS_DAMAGED"))}pointIsSafe(t,e){return!this.viewport.actorsAtPoint(t,e).filter(t=>t.hazard).length}wakeUp(){this.viewport.controlActor.screenLock={xMin:this.args.x-768,xMax:this.args.x+768},"idle"===this.args.phase&&(this.args.phase="stalking")}get solid(){return this.args.hitPoints>0}get rotateLock(){return!0}}}),require.register("actor/MiniMace.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiniMace=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../mixin/Constrainable");t.MiniMace=class extends(r.Mixin.from(i.PointActor,a.Constrainable)){constructor(){super(...arguments),this.args.width=32,this.args.height=32,this.args.type="actor-item actor-mini-mace",this.args.ropeLength=this.args._tiedTo?this.args.ropeLength:8,this.args.gravity=.6}update(){this.args.tiedTo||super.update()}updateEnd(){this.viewport&&!this.viewport.auras.has(this)&&this.viewport.auras.add(this),this.args.tiedTo&&(super.update(),this.args._tiedTo||(this.args._tiedTo=this.viewport.actorsById[this.args.tiedTo]),this.args.tiedTo&&this.args._tiedTo.args.hitPoints?this.setPos():this.noClip=!0),super.updateEnd()}collideA(t){if(this.args._tiedTo&&!this.args._tiedTo===t)return!1}collideB(t){if(this.args._tiedTo&&!this.args._tiedTo===t)return!1;this.args._tiedTo&&!this.args._tiedTo.args.hitPoints||t.controllable&&t.damage()}}}),require.register("actor/Monitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Monitor=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=(e("../actor/Explosion"),e("../actor/Projectile")),n=(e("../actor/BrokenMonitor"),e("../actor/Block")),o=e("../actor/Marker"),l=e("../audio/Sfx"),h=e("../lib/Analytic");t.Monitor=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-monitor",this.args.width=30,this.args.height=32,this.args.decel=.25,this.args.canHide=!0,this.args.platform=!0,this.args.gone=!1}onRendered(t){super.onRendered(t),!this.screen&&this.sprite&&(this.screen=new r.Tag('<div class = "monitor-screen">'),this.sprite.appendChild(this.screen.node))}update(){super.update(),this.viewport}collideA(t,e){return t.knocked&&this.pop(t.knocked),!!t.args.static||(t.punching?(this.pop(t),!1):!(!t.args.moving&&!t.args.falling)&&!(t instanceof n.Block)&&(t instanceof o.Marker&&(t=t.owner),super.collideA(t,e),t.passPop&&t.occupant&&!t.args.dead?(t=t.occupant,void this.pop(t)):2===e&&this.args.float&&t.controllable?(t.args.ySpeed*=-1,this.args.ySpeed=-4,this.args.float=0,this.ignores.set(t,15),!0):2===e||!(t.args.ySpeed>0&&t.y<this.y||(t.args.rolling||t.args.bellySliding)&&!t.args.grinding)||this.args.falling&&-1!==this.args.float||this.args.gone||!this.viewport||!t.args.spinning?1!==e&&3!==e||!((t.args.rolling||t.args.bellySliding)&&!t.args.grinding||t instanceof a.Projectile)||this.args.gone||!this.viewport?void 0:(this.pop(t),!1):void this.pop(t)))}pop(t){const e=this.viewport;if(!e||this.args.gone)return;const s=new r.Tag('<div class = "particle-explosion">');if(t){const e={label:this.name||this.args.name,points:10,multiplier:1};if(!t.isVehicle&&t.args.ySpeed>5&&t.args.ySpeed<25&&Math.abs(t.args.ySpeed)>Math.abs(t.args.xSpeed)&&(t.args.cameraMode="popping"),t.args.popChain.push(e),t.args.popCombo+=1,t.args.ySpeed>25&&!t.args.bouncing){const e={label:"BIG AIR!!!",points:1e3,multiplier:1.5};t.args.popChain.push(e),t.args.popCombo+=1,!t.airReward&&Math.abs(t.args.xSpeed)>10&&(t.args.x=this.args.x-(this.args.gSpeed||this.args.xSpeed),t.args.y=this.args.y+-8,this.viewport.onFrameOut(1,()=>this.viewport.args.frozen=25),this.viewport.args.invert="invert",this.viewport.onFrameOut(25,()=>this.viewport.args.invert=""),l.Sfx.play("SICK_TRICK"),l.Sfx.play("SICK_TRICK")),t.airReward=e}l.Sfx.play("OBJECT_DESTROYED")}s.style({"--x":this.x,"--y":this.y-16});const i=document.createElement("div");i.classList.add("particle-score"),i.classList.add("score-10");const a=new r.Tag(i);if(a.style({"--x":this.args.x,"--y":this.args.y-16}),e.particles.add(a),e.particles.add(s),setTimeout(()=>e.particles.remove(s),512),setTimeout(()=>e.particles.remove(a),768),setTimeout(()=>this.screen&&this.screen.remove(),1024),this.args.gone=!0,this.box&&this.box.setAttribute("data-animation","broken"),t&&(t.occupant&&(t=t.occupant),t.args.owner&&(t=t.args.owner),t.controllable&&this.effect(t)),"function"==typeof ga&&h.Analytic.report({eventCategory:"monitor",eventAction:"popped",eventLabel:`${this.viewport.args.actName}::${this.args.id}`}),t){const s=Math.min(t.args.ySpeed,t.ySpeedLast);if(t.args.doubleSpin&&(t.args.doubleSpin=2),t.dashed=!1,t&&t.dashed&&Math.abs(t.args.xSpeed)>Math.abs(t.args.ySpeed))t.args.gSpeed=0,t.args.xSpeed=-1.5*Math.sign(t.args.xSpeed),t.args.ySpeed=-10;else if(t&&t.args.falling){const i=t.args.spinning,r=t.args.jumping,a=t.args.flying,n=t.args.xSpeed||t.args.gSpeed;t.args.xSpeed=0,t.args.ySpeed=0,e.onFrameOut(1,()=>{s>=0?t.flyTime<5?t.args.ySpeed=Math.min(-s,-7):t.args.ySpeed=Math.min(-s,-2):t.args.ySpeed+=8,t.args.spinning=t.args.spinning||i,t.args.jumping=t.args.jumping||r,t.args.flying=t.args.flying||a,t.args.xSpeed=n,t.args.falling=!0})}}t&&this.viewport.settings.rumble&&t.controller&&t.controller.rumble&&(t.controller.rumble({duration:40,strongMagnitude:0,weakMagnitude:1}),this.viewport.onTimeout(40,()=>{t.controller.rumble({duration:110,strongMagnitude:.75,weakMagnitude:1})}))}effect(){}get canStick(){return!1}get solid(){return!1}}}),require.register("actor/Motobug.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Motobug=void 0;var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.Motobug=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-motobug",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=3,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:10,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:120,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1}update(){super.update(),this.args.moving&&this.args.gSpeed?this.args.animation="walking":this.args.animation="standing",this.args.direction=Math.sign(this.args.gSpeed)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/MouseIndicator.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MouseIndicator=void 0;var i=e("./Cursor"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.MouseIndicator=class extends i.Cursor{constructor(){super(...arguments),a(this,"endPoint",null),a(this,"lastMouseX",null),a(this,"lastMouseY",null)}onRendered(t){super.onRendered(t),this.args.type="point-actor actor-generic actor-mouse-indicator",this.autoStyle.get(this.box)["--magnitude"]="magnitude",this.magnitudeLabel=new r.CharacterString({value:0}),this.angleLabel=new r.CharacterString({value:0}),this.colorLabel=new r.CharacterString({value:0}),Object.assign(this.args.charStrings,[this.magnitudeLabel,this.angleLabel,this.colorLabel])}update(){this.viewport&&!this.viewport.args.plot&&(this.viewport.args.plot=new Plot);const t=this.viewport.mouse;if(t.buttons[0]||this.endPoint)if(1===t.buttons[0]&&this.endPoint)this.endPoint=null;else if(1!==t.buttons[0]||this.endPoint){const e=Math.hypot(this.args.y-t.position[1],this.args.x-t.position[0]),s=Math.atan2(t.position[1]-this.args.y,t.position[0]-this.args.x);if(this.args.airAngle=s,this.lastMouseX!==t.position[0]||this.lastMouseY!==t.position[1]){window.logPoints=((t,e,s)=>this.viewport.args.plot.addPoint(t,e,"main-scan "+s));const t=this.castRayQuick(e,s);this.args.falling=!0,this.endPoint.args.x=this.args.x+Math.cos(s)*t,this.endPoint.args.y=this.args.y+Math.sin(s)*t;const i=this.viewport.tileMap.getColor(Math.trunc(this.endPoint.args.x),Math.trunc(this.endPoint.args.y),0);this.magnitudeLabel.args.value=!1!==t&&Number(t).toFixed(2),this.angleLabel.args.value=Number(s).toFixed(2),this.colorLabel.args.value=Number(i).toString(16).padStart(8,"0")}this.lastMouseX=t.position[0],this.lastMouseY=t.position[1]}else this.endPoint=new i.Cursor({x:this.args.x,y:this.args.y});else this.args.x=t.position[0],this.args.y=t.position[1]}}}),require.register("actor/Mushroom.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mushroom=void 0;var i=e("./PointActor"),r=e("../behavior/Liftable");t.Mushroom=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-mushroom",this.args.width=24,this.args.height=24,this.args.size=4,this.args.nourishment=.1,this.behaviors.add(new r.Liftable)}onRendered(t){super.onRendered(t);const e=this.viewport;this.onRemove(()=>e.spawnFromDef(this.objDef)),this.autoStyle.get(this.box)["--size"]="size"}lift(t){this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null}get solid(){return!1}get rotateLock(){return!0}sleep(){this.viewport&&this.viewport.actors.remove(this)}}}),require.register("actor/NeverBetter.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NeverBetter=void 0;var i=e("./PointActor");t.NeverBetter=class extends i.PointActor{constructor(t,e){super(t,e),this.args.type="actor-item actor-never-better-sign",this.args.width=84,this.args.height=78}get solid(){return!1}}}),require.register("actor/NitroBooster.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NitroBooster=void 0;var i=e("./PointActor");t.NitroBooster=class extends i.PointActor{constructor(){super(...arguments),this.args.width=64,this.args.height=8,this.args.float=-1,this.args.type="actor-item actor-nitro-booster"}onRendered(){super.onRendered()}update(){super.update(),Math.trunc(this.viewport.args.frameId/6)%6<2&&this.viewport.args.frameId%3?(this.castRayQuick(60,-Math.PI/2,[0,-16]),this.args.animation="boosting"):this.args.animation="idle"}collideA(t,e){if(t.controllable)return"boosting"===this.args.animation&&(t.args.y-=16,t.args.ySpeed=-16,t.args.falling=!0),super.collideA(t,e)}get solid(){return!0}}}),require.register("actor/NotchSpring.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotchSpring=void 0;var i=e("./PointActor"),r=(e("./Block"),e("../audio/Sfx"));t.NotchSpring=class extends i.PointActor{constructor(){super(...arguments),this.args.width=8,this.args.height=32,this.args.type="actor-item actor-notch-spring",this.noClip=!0,this.args.float=-1,this.args.animation="idle",this.launching=new Set}collideA(t){t.controllable&&t.args.falling&&(this.launching.add(t),this.args.animation="springing",r.Sfx.play("NOTCH_SPRING_HIT"),this.viewport.onFrameOut(1,()=>this.args.animation="idle"))}updateEnd(){super.updateEnd(),this.launching.forEach(t=>{t.args.animation="flip",t.args.jumping=!1,t.dashed=!1,t.args.x+=this.args.direction,t.args.flying=!1,t.impulse(12,-Math.PI/2+Math.PI/4*this.args.direction,!0),t.args.xSpeed=0,t.args.ySpeed=0,t.args.ignore=8,this.launching.delete(t)})}get solid(){return!1}}}),require.register("actor/NuclearSuperball.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NuclearSuperball=void 0;var i=e("./PointActor");e("curvature/base/Tag");t.NuclearSuperball=class extends i.PointActor{constructor(){super(...arguments),this.args.gSpeedMax=150,this.args.accel=2,this.args.jumpForce=20,this.willStick=!0,this.stayStuck=!0}get solid(){return!1}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/Orb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Orb=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin");e("../mixin/Pushable");t.Orb=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-orb",this.args.width=18,this.args.height=48,this.args.rolled=0,this.args.accel=0,this.args.decel=0,this.args.bindTo("x",(t,e,s,i,r)=>this.args.rolled+=.5*Number(t-r||0)),this.args.gravity=1.35,this.args.maxFollow=this.args.maxFollow||null}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--rolled"]="rolled"}updateStart(){super.updateStart();const t=this.viewport.controlActor;this.otherSpacing=this.distanceFrom(t),this.otherSpeed=t.args.gSpeed||t.args.xSpeed||t.gSpeedLast||t.xSpeedLast}update(){}updateEnd(){if(!this.viewport||!this.viewport.controlActor)return;const t=this.viewport.controlActor;this.args.falling&&t.args.fallTime<15&&this.args.ySpeed<0&&(this.args.xSpeed=.995);const e=this.viewport;this.args.falling?this.viewport.onFrameOut(10,()=>{this.args.falling&&e.auras.delete(this)}):this.viewport.auras.add(this);const s=Math.max(0,this.otherSpeed),i=Math.sign(this.args.gSpeed||this.gSpeedLast||t.args.gSpeed||t.args.xSpeed);if((this.args.gSpeed||this.args.xSpeed||this.args.x<t.args.x-160)&&(!this.args.maxFollow||this.x<this.args.maxFollow)){const e=64;let r=s*i;(this.otherSpacing<e||t.args.falling&&t.args.ySpeed>=0)&&(r*=.975),r&&this.args.groundAngle>0&&(r+=1.5*Math.sign(r)),this.args.gSpeed=r}super.update(),super.updateEnd()}collideA(t){t.isHyper||t.isSuper||t.controllable&&t.loseRings(),t.controllable&&t.die()}get controllable(){return!1}get solid(){return!1}}}),require.register("actor/OrbSmall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrbSmall=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin"),a=e("../audio/Sfx");t.OrbSmall=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-orb-small",this.args.width=18,this.args.height=24,this.args.rolled=0,this.gSpeedLast=0,this.args.accel=.2,this.args.decel=this.args.decel||0,this.args.gravity=.4,this.args.maxFollow=this.args.maxFollow||null,this.args.friction=this.args.friction||.75,this.args.bounce=this.args.bounce||.5,this.args.rollSpeed=0,this.args.rolled=0}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--rolled"]="rolled"}update(){if(!this.viewport||!this.viewport.controlActor)return;this.args.x<-16+this.viewport.controlActor.args.x&&(this.args.falling||(this.args.xSpeed=this.args.gSpeed),this.args.falling=!0,this.noClip=!0);const t=this.ySpeedLast-this.args.gravity;if(super.update(),this.args.falling?this.args.ySpeed>0&&(this.args.rollSpeed*=.975):this.args.rollSpeed=this.args.gSpeed*Math.PI,this.args.rolled+=this.args.rollSpeed,!this.args.falling&&t>3){const e=Math.max(.5,Math.min(t,16)/16);a.Sfx.play("HEAVY_THUD",{volume:e}),this.args.bounce&&(this.args.xSpeed*=this.args.friction,this.args.x+=this.args.xSpeed),this.args.ySpeed=-t*this.args.bounce,this.args.falling=!0,this.args.y-=1}}collideA(t){if(t.controllable){const e=Math.max(.5,Math.min(this.args.ySpeed,16)/16);t.args.startled||(this.args.gSpeed=0,this.noClip=!0,this.args.falling=!0,this.args.xSpeed=0,this.args.ySpeed=-3,this.args.float=10,this.args.rollSpeed*=2,a.Sfx.play("HEAVY_THUD",{volume:e})),t.args.rings?t.damage():t.startle()}this.args.x<this.viewport.controlActor.args.x-8?this.noClip=!0:this.noClip&&t.break&&!t.broken&&(this.args.ySpeed*=-1,a.Sfx.play("HEAVY_THUD"),t.break(this))}sleep(){this.viewport.actors.remove(this)}get controllable(){return!1}get solid(){return!1}}}),require.register("actor/Panel.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Panel=void 0;var i=e("./PointActor");e("curvature/base/Bindable");t.Panel=class extends i.PointActor{constructor(t,e){super(t,e),this.args.type="actor-item actor-panel",this.args.width=64,this.args.height=8,this.args.static=1,this.args.float=-1,this.leaving=new Set,this.holding=new Set,this.cancels=new Map}collideA(t,e){if(t.args.flying)return!1;if(this.leaving.has(t))return this.holding.has(t)&&(t.stayStuck=!1,t.willStick=!1,t.willJump=!1,t.args.gSpeed=0,this.holding.delete(t)),this.cancels.has(t)&&(this.cancels.get(t)(),this.cancels.delete(t)),this.cancels.set(t,this.viewport.onFrameOut(25,()=>{this.holding.delete(t),this.leaving.delete(t)})),!1;if(!t.args.jumping&&!this.holding.has(t))return!1;if(this.holding.has(t)){if(t.args.mode=0,t.args.groundAngle=this.args.groundAngle,t.lastAngles.length=0,t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=0,t.args.falling=!1,(this.args.next||this.args.mode)&&this.holding.has(t)&&t.willJump){const e=this.viewport.actorsById[this.args.next];if(t.args.falling=!0,e||this.args.mode){if(t.stayStuck=!0,t.willStick=!0,e){const s=e.rotatePoint(0,0),i=t.angleTo({x:s[0]+e.x,y:s[1]+e.y});t.args.x-=16*Math.cos(i),t.args.y-=16*Math.sin(i),t.args.xSpeed=42*-Math.cos(i),t.args.ySpeed=42*-Math.sin(i),t.args.ignore=-2}t.args.gSpeed=0,t.args.falling=!0,t.args.jumping=!0,t.args.float=e?45:0,this.leaving.add(t),this.holding.delete(t),t.args.ignore=e?45:0}else this.leaving.add(t),this.holding.delete(t),t.stayStuck=!1,t.willStick=!1,t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=0,t.args.falling=!0,t.args.float=0,t.args.ignore=15;return!1}const e=this.rotatePoint(0,8);return t.args.x=this.x+e[0],t.args.y=this.y+e[1],t.args.ignore=0,!1}return!this.others.next&&!this.args.mode||(this.holding.add(t),t.args.ignore=10,this.cancels.has(t)&&(this.cancels.get(t)(),this.cancels.delete(t)),this.cancels.set(t,this.viewport.onFrameOut(20,()=>{this.holding.has(t)&&(this.holding.delete(t),this.leaving.add(t))})),!1)}sleep(){this.leaving.clear(),this.holding.clear()}get solid(){return!1}}}),require.register("actor/PlatformFlare.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformFlare=void 0;var i=e("./PointActor"),r=e("./Block"),a=e("../audio/Sfx");t.PlatformFlare=class extends i.PointActor{constructor(){super(...arguments),this.args.width=32,this.args.height=8,this.args.power=this.args.power||18,this.args.type="actor-item actor-platform-flare",this.args.static=1}collideA(t){t.args.float||t.args.static||(t.controllable&&this.args.active&&t.damage(this,"fire"),(this.viewport.args.frameId-this.viewport.args.startFrameId)/60%3||(this.args.active=!0,this.viewport.onFrameOut(30,()=>this.args.active=!1),t instanceof r.Block&&(a.Sfx.play("LID_POP"),t.args.ySpeed=-this.args.power,t.args.y+=-1,t.args.falling=!0)))}}}),require.register("actor/Platformer.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Platformer=void 0;var i=e("./PointActor");t.Platformer=class extends i.PointActor{get controllable(){return!0}}}),require.register("actor/PogoEgg.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PogoEgg=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=e("curvature/base/Tag"),n=e("./EggCapsule");t.PogoEgg=class extends i.PointActor{constructor(){super(...arguments),this.args.width=65,this.args.height=63,this.args.type="actor-item actor-pogo-egg",this.args.gravity=.5,this.args.jumpForce=10,this.args.decel=0,this.targetPoint=null,this.xTarget=19216,this.yTarget=1280,this.args.expectedAirTime=0,this.args.hp=8,this.args.bounceCount=0}onRendered(){super.onRendered(),this.autoStyle.get(this.box)["--stem-length"]="stemLength"}update(){super.update();for(const t of this.standingUnder)t.args.falling=!0,t.args.ySpeed=-Math.abs(t.ySpeedLast),t.args.y--,this.args.ySpeed<0&&(t.args.ySpeed+=this.args.ySpeed);const t=this.def.get("x");if(this.screenLock=this.screenLock||{xMin:t+-624,xMax:t+497},this.args.hp>=0&&(this.viewport.controlActor&&Math.abs(this.viewport.controlActor.args.x-this.args.x)<386&&(this.viewport.controlActor.args.dead||(this.viewport.controlActor.screenLock=this.viewport.controlActor.screenLock||{xMin:t+-624,xMax:t+497})),this.args.animation="idle",this.args.damaged>0&&(this.args.damaged--,this.args.animation="damaged")),this.args.hp>0){const t=this.castRayQuick(32,Math.PI/2,[-16,0],!1)||32,e=this.castRayQuick(32,Math.PI/2,[16,0],!1)||32;this.args.stemLength=Math.min(t,e)}else this.args.stemLength=0;let e=this.otherDefs.pointA,s=this.age%800;if(s>600?e=this.otherDefs.pointB:s>400?e=this.otherDefs.pointC:s>200&&(e=this.otherDefs.pointB),this.targetPoint!==e&&(this.args.bounceCount=0),this.xTarget=e.x,this.yTarget=e.y,this.targetPoint=e,this.args.bounceCount&&(this.args.bounceCount%2?this.xTarget=this.targetPoint.x-32:this.xTarget=this.targetPoint.x+32),this.args.hp>0)if(this.args.falling){if(0===this.fallTime){const t=this.args.gravity,e=this.args.jumpForce,s=-(this.yTarget-this.args.y),i=t+2*e,r=(-i-Math.sqrt(i**2+8*t*-s))/(-2*t);if(!isNaN(r)&&r>0){const t=this.xTarget-this.args.x;this.args.xSpeed=t/r,this.args.expectedAirTime=r}else this.args.xSpeed=0}}else this.args.bounceCount++,this.willJump=!0;else this.args.hp<0&&"exploding"!==this.args.animation&&"exploded"!==this.args.animation&&(this.args.xSpeed=0,this.args.animation="exploding",viewport.onFrameOut(80,()=>{this.args.animation="exploded",this.args.falling=!0,this.args.ySpeed=-16,this.noClip=!0,r.Sfx.play("OBJECT_DESTROYED")}),viewport.onFrameOut(160,()=>{const t=new n.EggCapsule({x:this.otherDefs.pointB.x,y:this.otherDefs.pointB.y-384});viewport.spawn.add({object:t})}));if("exploding"===this.args.animation&&(viewport=this.viewport,viewport&&viewport.args.frameId%3==0)){const t=new a.Tag('<div class = "particle-explosion">');r.Sfx.play("BOSS_DAMAGED");const e=this.args.width*Math.random()-this.args.width/2,s=this.args.height*Math.random()-this.args.height/2;t.style({"--x":this.x+e,"--y":this.y+s+-32}),viewport.particles.add(t),setTimeout(()=>viewport.particles.remove(t),512)}}collideA(t,e){if(t.controllable)return!(this.args.hp<=-1&&this.args.falling)&&(this.args.hp>0&&!t.args.falling&&t.groundTime>1&&!this.args.damaged&&!this.standingUnder.has(t)&&!t.args.mercy?(t.damage(this),!1):(0===e&&t.args.falling?(this.args.ySpeed=Math.abs(t.ySpeedLast),t.args.ySpeed=-Math.abs(t.ySpeedLast),t.args.y=this.args.y+-this.args.height,t.args.ySpeed>-6&&(t.args.ySpeed=-6),r.Sfx.play("BOSS_DAMAGED"),this.args.damaged||(this.args.damaged=30,this.args.hp--)):2===e&&t.args.falling?(this.args.ySpeed=Math.abs(t.args.ySpeed),t.args.ySpeed=-Math.abs(t.args.ySpeed),t.args.y=this.args.y+t.args.height,r.Sfx.play("BOSS_DUDHIT")):Math.abs(this.args.x-t.args.x)>this.args.width/2&&t.args.falling&&(t.args.x=this.args.x+.5*(this.args.width+t.args.width)*Math.sign(t.args.x-this.args.x||t.args.xSpeed),t.args.xSpeed*=-1,Math.abs(t.args.xSpeed)<4&&(t.args.xSpeed=4*Math.sign(t.args.x-this.args.x)),Math.abs(this.args.xSpeed)<4&&(this.args.xSpeed=4*-Math.sign(t.args.x-this.args.x)),r.Sfx.play("BOSS_DAMAGED"),this.args.damaged||(this.args.damaged=30,this.args.hp--),this.args.ySpeed=-5*Math.sign(t.args.y-this.args.y)),this.args.hp<=0&&(this.args.xSpeed=0),super.collideA(t,e)))}get solid(){return!1}get canStick(){return!1}}}),require.register("actor/PogoSpring.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PogoSpring=void 0;var i=e("./Vehicle"),r=e("../audio/Sfx");e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class n extends i.Vehicle{constructor(){super(...arguments),a(this,"quickDrop",!0),a(this,"passPop",!0),this.args.type="actor-item actor-pogo-spring",this.args.width=32,this.args.height=32,this.removeTimer=null,this.args.gSpeedMax=20,this.args.decel=.45,this.args.accel=.45,this.args.gravity=.6,this.args.seatHeight=16,this.args.seatForward=-2,this.args.skidTraction=.05,this.args.jumpForce=8,this.dustCount=0,this.args.particleScale=2,this.args.started=!1,this.args.cameraMode="locked",this.args.bound=0,this.bindTo("occupant",(t,e,s,i,r)=>{r&&!t&&(this.args.dead=!0,this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0)})}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--bound"]="bound"}update(){if(this.args.active=!!this.occupant,this.args.falling||this.occupant||(this.args.dead=!1),this.occupant&&!this.args.falling&&this.args.ySpeed>0&&(this.args.bound=-Math.floor(this.args.ySpeed||0)),!this.occupant||this.frameout||this.args.falling)this.occupant||(this.args.gSpeed=0,this.args.xSpeed=0);else{this.args.height=16+this.occupant.args.height,this.frameout=this.viewport.onFrameOut(1,()=>{this.args.falling=!0,this.frameout=!1,this.args.ySpeed=this.args.bound,this.args.ySpeed>-3&&(this.args.ySpeed-=3),this.args.ySpeed>-13&&(this.args.ySpeed-=3),this.args.ySpeed<-24&&(this.args.ySpeed=-24)}),this.args.xSpeed*=.3;const t=this.xAxis||this.xSpeedLast||0;this.args.direction=Math.sign(t),this.args.facing=Math.sign(t)<0?"left":"right",r.Sfx.play("POGO_BOUNCE")}this.occupant||(this.args.height=32,this.args.bound=-4),this.noClip=this.args.dead,super.update()}collideA(t,e){t instanceof n||(t.args.falling&&t.args.ySpeed>0&&(this.args.bound=-t.args.ySpeed),super.collideA(t,e))}sleep(){this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.args.dead=!1,this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0,this.args.bound=0,super.sleep(),this.args.facing="right"}get solid(){return!this.occupant}get rotateLock(){return!1}}t.PogoSpring=n}),require.register("actor/PointActor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointActor=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/View"),a=e("curvature/base/Tag"),n=e("../effects/Twist"),o=e("../effects/Droop"),l=e("../effects/Pinch"),h=e("../ui/CharacterString"),g=e("../Classifier"),c=e("../controller/Controller"),d=e("../powerups/Sheild"),u=e("../powerups/FireSheild"),p=e("../powerups/SuperSheild"),f=e("../powerups/BubbleSheild"),m=e("../powerups/NormalSheild"),v=e("../powerups/ElectricSheild"),y=e("../powerups/StarSheild"),b=(e("./LayerSwitch"),e("../viewport/Layer"),e("../behavior/Platformer")),S=e("../audio/Sfx");function w(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const x=0,k=1,M=2,P=3,C=100,j=1/0,A=1,T=Symbol("BOUNDS");class O extends r.View{static fromDef(t){var e;const s={x:t.x+Math.floor(t.width/2),y:t.y-1,visible:t.visible,name:t.name,id:t.id},i=new Map;for(const t in s)"object"!=typeof s[t]&&i.set(t,s[t]);const r={};for(const e in t.properties){const a=t.properties[e];"object"===t.properties[e].type&&(r[a.name]=a.value),s[a.name]=a.value,i.set(a.name,a.value)}s.tileId=t.gid;const a=new this(Object.assign({},s));return a.others=r,a.def=i,a.objDef=t,a.args.float=null!==(e=a.float)&&void 0!==e?e:a.args.float,a}constructor(){var t,e,s,r,a,n;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;o[i.Bindable.NoGetters]=!0,super(o,l),w(this,"template",'<div class  = "point-actor [[type]]">\n\t\t<div class = "sprite" cv-ref = "sprite"></div>\n\t</div>'),w(this,"profiles",{normal:{height:1,width:1,decel:.85,accel:.2,gravity:.65,airAccel:.3,jumpForce:14,gSpeedMax:100}}),this[i.Bindable.NoGetters]=!0,Object.defineProperty(this.nodes,i.Bindable.NoGetters,{value:!0}),this.defaultDisplay="initial",this.others={},this.otherDefs={},this.args.knocked=!1,this.springing=!1,this.isGhost=!1,this.stepsTaken=0,this.fallTime=0,this.idleTime=0,this.groundTime=0,this.locked=0,this.xHold=12,this.yHold=12,this.args.weight=null!==(t=this.args.weight)&&void 0!==t?t:100,this.args.score=0,this.args.rings=0,this.args.mercy=!1,this.args.stuck=!1,this.args.R=0,this.args.popChain=[],this.args.canHide=!1,this.collisionMap=null,this.doorMap=new Map,this.args.opacity=null!==(e=this.args.opacity)&&void 0!==e?e:1,this.args.pushing=!1,this.autoStyle=new Map,this.autoAttr=new Map,this.hanging=new Map,this.ignores=new Map,this.regions=new Set,this.powerups=new Set,this.behaviors=new Set,this.args.lookTime=0,this.behaviors.add(new b.Platformer),this.carrying=new Set,this.inventory=new g.Classifier([d.Sheild,u.FireSheild,f.BubbleSheild,v.ElectricSheild,m.NormalSheild]),this.splashes=new Set,this.noClip=!1,this.sheild=null,this.inventory.addEventListener("adding",t=>{let e=t.detail.object;if(this.inventory.has(e.constructor))return this.args.currentSheild instanceof y.StarSheild||(e=[...this.inventory.get(e.constructor)][0],this.args.currentSheild=e,e.equip&&e.equip(this)),void t.preventDefault();if(this.powerups.add(e),this.controllable){const t=`has${e.type[0].toUpperCase()+e.type.substr(1)}`;this.viewport.args[t]=t}e.acquire&&e.acquire(this),this.args.currentSheild instanceof y.StarSheild||(this.args.currentSheild=e,e.equip&&e.equip(this))}),this.inventory.addEventListener("removing",t=>{const e=t.detail.object;if(this.powerups.delete(e),this.controllable){const t=`has${e.type[0].toUpperCase()+e.type.substr(1)}`;this.viewport.args[t]=null}i.Bindable.make(e)===this.args.currentSheild&&(this.args.currentSheild=null)}),this.args.bindTo("isGhost",(t,e,s,i,r)=>this.isGhost=t),this.args.bindTo("currentSheild",(t,e,s,i,r)=>{r&&r.unequip&&r.unequip(this);for(const t of this.inventory.get(d.Sheild))t instanceof p.SuperSheild||t.detach();t&&t.equip&&t.equip(this),t&&t.render(this.sprite)}),this.args.type="actor-generic",this.args.modeTime=0,this.args.charStrings=[],this.args.display=this.args.display||"initial",this.args.rings=0,this.args.coins=0,this.args.emeralds=0,this.args.emblems=[],this.args.emblemsCurrent=[],this.args.dead=!1,this.args.respawning=!1,this.ringSet=new Set,this.ringDoc=new DocumentFragment,this.args.yMargin=0,this.args.cameraMode="normal",this.args.cameraBias=0,this.args.layer=null!==(s=this.args.layer)&&void 0!==s?s:1,this.args.active=null!==(r=this.args.active)&&void 0!==r&&r,this.args.moving=!1,this.args.flySpeedMax=40,this.args.x=this.args.x||1280,this.args.y=this.args.y||32,this.args.z=this.args.z||0,this.args.xOff=0,this.args.yOff=0,this.args.jumpArced=!1,this.args.width=this.args.width||1,this.args.height=this.args.height||1,this.args.direction=Number(this.args.direction)||1,this.args.heading=0,this.args.gSpeed=this.args.gSpeed||0,this.args.hSpeed=0,this.args.xSpeed=this.args.xSpeed||0,this.args.ySpeed=this.args.ySpeed||0,this.args.angle=this.args.angle||0,this.args.groundAngle=this.args.groundAngle||0,this.args.displayAngle=0,this.args.seatAngle=0,this.args.airAngle=0;const h=[];Object.defineProperty(h,i.Bindable.NoGetters,{value:!0}),this.lastAngles=h,this.angleAvg=16,this.args.xSpeedMax=512,this.args.ySpeedMax=512,this.args.gSpeedMax=C,this.args.rollSpeedMax=23,this.args.gravity=null!==(a=this.args.gravity)&&void 0!==a?a:.65,this.args.decel=.85,this.args.accel=.2,this.args.airAccel=.3,this.args.jumpForce=14,this.args.airTimeTotal=0,this.args.groundTimeTotal=0,this.args.jumping=!1,this.args.jumpedAt=null,this.args.deepJump=!1,this.args.highJump=!1,this.maxStep=11,this.backStep=0,this.frontStep=0,this.args.rolling=!1,this.args.sliding=!1,this.args.skidTraction=2.25,this.args.skidTraction=5,this.args.fgFilter="none",this.args.bgFilter="none",this.args.falling=!0,this.args.running=!1,this.args.crawling=!1,this.args.climbing=!1,this.args.rotateFixed=!1,this.args.mode=this.args.mode||x,this.xAxis=0,this.yAxis=0,this.aAxis=0,this.bAxis=0,this.lAxis=0,this.rAxis=0,this.buttons={},this.stayStuck=!1,this.willStick=!1,this.args.startled=this.args.startled||0,this.args.antiSkid=this.args.antiSkid||0,this.args.halted=this.args.halted||0,this.args.ignore=this.args.ignore||0,this.args.float=this.args.float||0,this.colliding=!1,this.args.flyAngle=0,this.standingUnder=new Set,this[T]=!1,this.args.bindTo(["mode","falling"],()=>{this.args.modeTime=0,this[T]=!1}),this.moved=!1,this.args.bindTo(["x","y","direction"],(t,e,s)=>{this[T]=!1,isNaN(t)&&console.trace(e,t),this.idleTime=0,this.moved=!0}),this.args.bindTo(["width","height"],(t,e,s)=>{this[T]=!1,this.moved=!0}),this.args.bindTo(["xSpeed","ySpeed"],(t,e,s)=>{isNaN(t)&&console.trace(e,t)}),this.args.bindTo("gSpeed",t=>{this.gSpeedLast=t||this.gSpeedLast}),this.args.bindTo("xSpeed",t=>{this.airAngle=this.args.airAngle=Math.atan2(this.args.ySpeed,t),this.xSpeedLast=t||this.xSpeedLast}),this.args.bindTo("ySpeed",t=>{this.airAngle=this.args.airAngle=Math.atan2(t,this.args.xSpeed),this.ySpeedLast=t||this.ySpeedLast}),this.impulseMag=null,this.impulseDir=null,this.args.stopped=0,this.args.particleScale=1,this.dropDashCharge=0;const S=i.Bindable.make(this);return this.debindGroundX=null,this.debindGroundY=null,this.debindGroundA=null,this.debindGroundL=null,this.args.name=null!==(n=this.args.name)&&void 0!==n?n:"",this.controllable&&(this.controller=new c.Controller({deadZone:.2}),this.controller.zero()),this.debindGroundX=new Set,this.debindGroundY=new Set,this.debindGroundA=new Set,this.debindGroundL=new Set,this.args.bindTo("standingOn",(t,e,s,i)=>{if(this.isGhost)return;if(this.args.standingOn===t)return;for(const t of this.debindGroundX)this.debindGroundX.delete(t),t();for(const t of this.debindGroundY)this.debindGroundY.delete(t),t();for(const t of this.debindGroundA)this.debindGroundA.delete(t),t();for(const t of this.debindGroundL)this.debindGroundL.delete(t),t();const r=s[e];r&&(r.isVehicle&&(r.occupant=null,r.stayStuck=!1,r.willStick=!1,r.xAxis=0,r.yAxis=0),r.standingUnder&&r.standingUnder.delete(this));const a=this.viewport.objectPalette.switch;if(this.controllable&&(!r||r instanceof a||this.viewport.auras.delete(r)),t){if(t.standingUnder.add(this),this.controllable&&t.isVehicle&&!t.dead){this.args.gSpeed||(this.args.pushing=!1);const e=t.args.bindTo("x",(e,s)=>{const i=t.args.direction*t.args.seatForward||0,r=t.args.seatHeight||t.args.height||0,[a,n]=t.rotatePoint(i,r);this.args.x=a+e,this.args.y=n+t.y,this.args.direction=t.args.direction}),s=t.args.bindTo("y",(e,s)=>{if(this.args.jumping)return;const i=t.args.direction*t.args.seatForward||0,r=t.args.seatHeight||t.args.height||0,[a,n]=t.rotatePoint(i,r);this.args.x=a+t.x,this.args.y=n+e}),i=t.args.bindTo("layer",(t,e)=>{this.args.layer=t});this.debindGroundX.add(e),this.debindGroundY.add(s),this.debindGroundL.add(i);const r=t.occupant;t.args.yMargin=this.args.height,r&&r!==this&&(r.args.standingOn=null,r.args.y-=32,r.args.gSpeed=0,r.args.xSpeed=-5*this.args.direction,r.args.ySpeed=-8,r.args.falling=!0),this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0,this.args.falling=!1,t.occupant=this}else if(!t.isVehicle&&this.args.y<=1+t.args.y-t.args.height){const e=t.args.bindTo("x",(e,s)=>{t.getMapSolidAt(this.args.x+e+-t.args.x,this.args.y)||(this.args.x+=e+-t.args.x)}),s=t.args.bindTo("y",(e,s)=>{const i=e+-t.args.height+(t.args.falling||!this.controllable&&!this.isPushable?0:-1);t.getMapSolidAt(this.args.x,i)||(this.args.y=i)}),i=t.args.bindTo("layer",(t,e)=>{this.args.layer=t});this.debindGroundX.add(e),this.debindGroundY.add(s),this.debindGroundL.add(i),t.args.treadmill||(this.args.gSpeed-=t.args.gSpeed)}r&&r.isVehicle&&(r.occupant===this&&(r.occupant=null,r.stayStuck=!1,r.willStick=!1),r.xAxis=0,r.yAxis=0),t.standBelow(this)}else this.viewport.auras.delete(this.args.standingOn)}),this.age=0,S}onRendered(){if(this.sprite=this.findTag("div.sprite"),this.box=this.findTag("div"),this.autoStyle.set(this.box,{display:"display","--animation-bias":"animationBias","--bg-filter":"bgFilter","--sprite-sheet":"spriteSheetUrl","--direction":"direction","--sprite-x":"spriteX","--sprite-y":"spriteY","--angle":"angle","--palletShift":"palletShift","--fly-angle":"flyAngle","--display-angle":"groundAngle8","--ground-angle":"groundAngle8","--seat-angle":"seatAngle","--ground-angle8":"groundAngle8","--air-angle":"airAngle","--corkscrew":"corkscrew","--opacity":"opacity","--height":"height","--width":"width","--x":"x","--y":"y","--z":"z"}),this.autoAttr.set(this.box,{"data-camera-mode":"cameraMode","data-colliding":"colliding","data-direction":"direction","data-respawning":"respawning","data-animation":" animation","data-heading":"heading","data-super":"isSuper","data-hyper":"isHyper","data-mercy":"mercy","data-selected":"selected","data-following":"following","data-carrying":"carrying","data-reversing":"reversing","data-falling":"falling","data-moving":"moving","data-pushing":"pushing","data-facing":"facing","data-filter":"filter","data-angle":"angleDeg","data-driving":"driving","data-active":"active","data-knocked":"knocked","data-layer":"layer","data-dead":"dead","data-mode":"mode","data-condition":"condition","data-netplayer":"netplayer","data-id":"id"}),!this.init&&this.viewport){this.args.bindTo("spriteSheet",t=>{this.args.spriteSheetUrl=void 0!==t?this.urlWrap(t):void 0}),this.args.bindTo("angle",t=>this.args.angleDeg=this.rad2deg(t)),this.args.charStrings.bindTo(t=>{!this.labels&&this.args.charStrings.length?(this.labels=r.View.from('<div class = "labels" cv-ref = "labels" cv-each = "charStrings:charString:c">[[charString]]</div>',{charStrings:this.args.charStrings}),this.labels.render(this.sprite)):this.labels&&!this.args.charStrings.length&&(this.labels.remove(),this.labels=null)},{wait:0}),this.init=!0,this.args.bindTo("animation",(t,e,s,i,r)=>{this.box.setAttribute("data-animation",t)}),this.controllable&&this.sprite.parentNode.classList.add("controllable");for(const t of this.behaviors)t.rendered&&t.rendered(i.Bindable.make(this))}}updateStart(){if((this.isSuper||this.isHyper)&&!this.args.currentSheild instanceof p.SuperSheild){const t=new p.SuperSheild;t.equip(this),this.inventory.add(t)}else if(this.args.currentSheild&&this.args.currentSheild instanceof p.SuperSheild){const t=this.args.currentSheild;t&&t.unequip(this),this.args.currentSheild=null}this.args.dead&&(this.args.xSpeed=0);for(const t of this.behaviors)t.updateStart&&t.updateStart(this)}updateEnd(){const t=Math.sign(this.args.gSpeed||this.args.xSpeed||this.args.direction);t>0&&"left"===this.args.facing||t<0&&"right"===this.args.facing?this.args.reversing=!0:this.args.reversing=!1;for(const t of this.behaviors)t.updateEnd&&t.updateEnd(this);if(this.viewport&&this.viewport.args.frameId%this.viewport.settings.frameSkip!=0)return;const e=this.focused;this.args.falling;for(const t of this.regions)t.focus&&(this.viewport.auras.add(t.focus),this.focused=t.focus);e!==this&&e!==this.focused&&this.viewport&&this.viewport.auras.delete(e),this.focused&&this.focused.broken&&(this.focused=null),this.args.groundAngle8=this.args.groundAngle,!this.isVehicle&&!this.args.falling&&!this.args.grinding&&0===this.args.mode&&Math.abs(this.args.groundAngle8)<=Math.PI/8+.01&&(this.args.groundAngle8=0);for(const[t,e]of this.autoStyle){const s={};for(const[t,i]of Object.entries(e))i in this.args&&(s[t]=this.args[i]);t.style(s)}for(const[t,e]of this.autoAttr){const s={};for(const[t,i]of Object.entries(e))i in this.args&&(s[t]=this.args[i]);t.attr(s)}for(const t of this.splashes)t.x+=this.args.xSpeed*(1-t.age/30),t.style({"--x":t.x}),t.age++;this.viewport&&void 0!==this.startFrame?this.age++:this.age=0,this.screenLock&&(this.args.x<this.screenLock.xMin&&(this.args.x=this.screenLock.xMin),this.args.x>this.screenLock.xMax&&(this.args.x=this.screenLock.xMax))}update(){this.locked>0&&this.locked--;for(const[t,e]of this.ignores)e<=0?this.ignores.delete(t):this.ignores.set(t,-1+e);for(const t of this.behaviors)t.update&&t.update(this)}getLocalDrag(){if(this.args.dead)return 1;let t=1;for(const e of this.regions)e.skimmers.has(this)||e.skimmers.has(i.Bindable.make(this))||(e.args.drag||0===e.args.drag)&&e.args.drag<t&&(t=e.args.drag);return t}getLocalFriction(){let t=1;for(const e of this.regions)e.skimmers.has(this)||e.skimmers.has(i.Bindable.make(this))||(e.args.friction||0===e.args.friction)&&e.args.friction<t&&(t=e.args.friction);return t}setCameraMode(){if(this.viewport&&!this.args.cameraIgnore)if("popping"===this.args.cameraMode&&Math.abs(this.args.xSpeed)>Math.abs(this.args.ySpeed)&&(this.args.cameraMode="aerial"),this.focused)this.args.cameraMode="panning";else if(this.viewport.args.cutScene)this.args.cameraMode="cutScene";else if(this.args.bossMode)this.args.cameraMode="boss";else if(this.args.standingOn&&this.args.standingOn.isVehicle)this.args.cameraMode=this.args.standingOn.args.cameraMode;else if(this.args.localCameraMode)this.args.cameraMode=this.args.localCameraMode;else if(this.controllable)if(this.args.mode&&!this.args.falling&&this.args.rolling&&this.args.jumpBlocked)this.args.cameraMode="tube";else if(!this.args.falling||this.getMapSolidAt(this.args.x,this.args.y+24)){const t=this.getMapSolidAt(this.args.x+32*this.args.direction,this.args.y+24),e=this.getMapSolidAt(this.args.x+32*this.args.direction,this.args.y+96),s=this.getMapSolidAt(this.args.x+0*this.args.direction,this.args.y+48);if(this.args.mode===x&&0===this.args.groundAngle)if(Math.abs(this.args.groundAngle)<Math.PI/4){const i=this.args.standingOn?this.args.standingOn.args.cameraBias:0;i||s||!t||this.args.grinding||this.args.skimming?i||t||e||this.args.grinding||this.args.skimming?this.args.cameraMode="normal":this.args.cameraMode="cliff":this.args.cameraMode="bridge"}else this.args.cameraMode="normal";else this.args.cameraMode="normal"}else this.getMapSolidAt(this.args.x+0*this.args.direction,this.args.y+64)?(!this.args.falling||"popping"!==this.args.cameraMode||Math.abs(this.args.ySpeed)<Math.abs(this.args.xSpeed))&&(this.args.cameraMode="normal"):this.fallTime>15&&"panning"!==this.args.cameraMode&&("popping"!==this.args.cameraMode||this.args.ySpeed>10)&&(this.args.cameraMode="aerial"),this.viewport.onFrameOut(45,()=>{"airplane"!==this.args.cameraMode&&this.args.falling&&this.isVehicle&&Math.abs(this.args.xSpeed>25)&&!this.getMapSolidAt(this.args.x,this.args.y+480)&&(this.args.cameraMode="airplane")})}callCollideHandler(t){if(!this.viewport)return;const e=this.viewport;if(this.ignores.has(t))return!1;if(t.ignores.has(this))return!1;if(this.args.dead||t.args.dead)return;if(t===this.args.hangingFrom)return!1;if(this.isGhost||t.isGhost)return;let s;t.args.y<=this.args.y-this.args.height?(this.args.collType="collision-top",s=0):t.args.x<this.args.x-Math.floor(this.args.width/2)?(this.args.collType="collision-left",s=1):t.args.x>=this.args.x+Math.floor(this.args.width/2)?(this.args.collType="collision-right",s=3):t.args.y>=this.args.y?(this.args.collType="collision-bottom",s=2):(this.args.collType="collision-intersect",s=-1),e.collisions.has(this)||e.collisions.set(this,new Map),e.collisions.has(t)||e.collisions.set(t,new Map);const i=s>-1?(s+2)%4:s;this.collideB(t,s),t.collideB(this,i);const r=this.collideA(t,s),a=t.collideA(this,i),n=r||a;if(this.args.colliding=this.colliding=this.colliding||n||!1,!1!==n){const r=e.collisions.get(this,s),a=e.collisions.get(t,i);r.set(t,s),a.set(this,i)}return n}processInput(){if(this.controllable&&this.args.standingOn&&this.args.standingOn.isVehicle&&this===i.Bindable.make(this.args.standingOn.occupant)){if(this.args.modeTime<5)return;this.viewport.auras.add(this.args.standingOn);const t=this.args.standingOn;t.xAxis=this.xAxis,t.yAxis=this.yAxis,t.stayStuck=this.stayStuck,t.willStick=this.willStick,this.processInputVehicle(),this.args.direction=t.args.direction,this.args.facing=t.args.facing,this.args.layer=t.args.layer,this.args.mode=t.args.mode,this.args.angle=t.args.angle}else this.controllable&&this.processInputDirect()}processInputDirect(){let t=this.xAxis,e=this.yAxis,s=this.args.gSpeedMax;this.running?s=j:this.crawling&&(s=A);const i=this.getLocalDrag();if(this.noClip)this.args.ignore||(this.args.xSpeed+=t*this.args.airAccel*i,this.args.ySpeed+=e*this.args.airAccel*i,t||(this.args.xSpeed=0),e||(this.args.ySpeed=0));else if(this.args.falling)this.args.falling&&t&&Math.abs(this.args.xSpeed)<this.args.xSpeedMax&&Math.abs(this.args.xSpeed)<this.args.gSpeedMax&&!this.args.ignore&&(this.args.xSpeed+=t*this.args.airAccel*i);else{const e=!this.args.grinding||Math.sign(this.args.gSpeed)===Math.sign(this.xAxis)||Math.abs(this.args.gSpeed)>6&&Math.abs(this.args.gSpeed)<2*this.args.gSpeedMax||0===this.args.gSpeed;if(!this.args.rolling&&e&&this.yAxis<.55&&Math.abs(this.yAxis)<=Math.abs(this.xAxis)&&!this.spindashCharge){const e=Math.sign(t);let r=this.args.gSpeed;const a=Math.sign(r),n=this.getLocalFriction();if(!this.args.ignore){if(this.args.rolling||this.args.sliding||this.args.climbing||this.args.wallSticking||(e!==a&&a?!this.args.ignore&&!this.args.antiSkid&&Math.abs(r)>1&&(r+=.5*t*n*this.args.accel*i*this.args.skidTraction):Math.abs(e-a)<2&&(r+=t*n*this.args.accel*i)),Math.sign(this.args.gSpeed)&&Math.sign(this.args.gSpeed)!==Math.sign(r))return void(this.args.gSpeed=0);this.args.pushing&&Math.sign(t)!==Math.sign(this.args.pushing)?this.args.gSpeed=0:(!t||Math.abs(r)<s||Math.sign(r)!==Math.sign(t))&&(this.args.gSpeed=r)}}}t<0&&(this.args.gSpeed||this.args.stuck)&&!this.args.ignore&&(this.args.climbing||(this.args.facing="left"),(!this.args.grinding||Math.abs(this.args.gSpeed)<3)&&(this.args.direction=-1)),t>0&&(this.args.gSpeed||this.args.stuck)&&!this.args.ignore&&(this.args.climbing||(this.args.facing="right"),(!this.args.grinding||Math.abs(this.args.gSpeed)<3)&&(this.args.direction=1)),this.args.currentSheild instanceof y.StarSheild||(this.aAxis<-.75&&(this.inventory.has(v.ElectricSheild)?this.args.currentSheild=[...this.inventory.get(v.ElectricSheild)][0]:this.args.currentSheild=""),this.aAxis>.75&&(this.inventory.has(u.FireSheild)?this.args.currentSheild=[...this.inventory.get(u.FireSheild)][0]:this.args.currentSheild=""),this.bAxis<-.75&&(this.inventory.has(f.BubbleSheild)?this.args.currentSheild=[...this.inventory.get(f.BubbleSheild)][0]:this.args.currentSheild=""),this.bAxis>.75&&(this.inventory.has(m.NormalSheild)?this.args.currentSheild=[...this.inventory.get(m.NormalSheild)][0]:this.args.currentSheild=""))}processInputVehicle(){this.args.standingOn.processInputDirect()}collideA(t,e){return this.solid}collideB(t){}castRay(){let t=1,e=()=>{},s=Math.PI/2,i=[0,0];for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];switch(a.length){case 2:[t,e]=a;break;case 3:[t,s,e]=a;break;case 4:[t,s,i,e]=a}const o=new Set(viewport.actorsAtPoint(this.args.x,this.args.y+t,this.args.width+t,this.args.height+2*t));for(let r=0;r<Math.floor(t);r++){const t=e(r,[this.args.x+i[0]+r*Math.cos(s),this.args.y+i[1]+r*Math.sin(s)],o,this);if(void 0!==t)return t}return!1}castRayQuick(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.viewport||!this.viewport.tileMap)return;const a=this.args.x+s[0],n=this.args.y+s[1],o=this.viewport.tileMap.castRay(a,n,e,t,this.getCollisionMap());let l=t;o&&(l=Math.hypot(a-o[0],n-o[1]));const h=a+Math.cos(e)*l,g=n+Math.sin(e)*l,c=this.viewport.actorsAtLine(a,n,h,g);c.delete(i.Bindable.make(this)),c.delete(this);const d=new Map;if(r)for(const[t,e]of c)!1!==t.callCollideHandler(this)&&d.set(t,e);for(const[t,e]of d)if(!(e.distance>l)&&this.checkSolidActors(t))return e.distance;return!!o&&l}impulse(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.impulseMag=t,this.impulseDir=e,this.impulseFal=s}rad2deg(t){const e=180/Math.PI*t;return e>0?Math.round(Math.floor(10*e)/10):Math.round(Math.ceil(10*e)/10)}roundAngle(t,e){return e/=2,Math.round(t/(Math.PI/e))*Math.PI/e}findNearestActor(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.viewport;if(!s)return;const i=s.getNearbyColCells(this.args.x,this.args.y);let r=null,a=1/0;for(const s of i)for(const i of s){if(i===this)continue;if(i.args.gone)continue;if(!t(i))continue;const s=this.distanceFrom(i);Math.abs(s)>e||s<a&&(r=i,a=s)}return r}immune(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";const s=this.args.currentSheild;return!!(s&&s.immune&&s.immune(this,t,e))}totalCombo(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.args.popChain.length)return;this.eraseCombo&&(this.eraseCombo(),this.eraseCombo=!1),this.args.popCombo=0;let e=0,s=0;for(const t of this.args.popChain)e+=t.multiplier,s+=t.points;const i=Math.ceil(s*e);return this.args.popChain.length=0,i?(this.eraseCombo=this.viewport.onFrameOut(360,()=>{this.viewport.args.comboResult=null,this.viewport.args.comboFail=null}),t?(this.viewport.args.comboFail=new h.CharacterString({value:i,color:"red-light"}),void(this.viewport.args.comboResult=null)):(this.viewport.args.comboResult=new h.CharacterString({value:"+"+i,color:"green-light"}),this.viewport.args.comboFail=null,void(this.args.score+=i))):(this.viewport.args.comboResult=null,void(this.viewport.args.comboFail=null))}sap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";this.args.dead||(this.totalCombo(!0),S.Sfx.play("SAP_HEALTH"),this.isSuper||this.isHyper||(this.args.condition="sapped-"+e,this.viewport&&this.viewport.onFrameOut(5,()=>this.args.condition=""),this.args.rings>0?(this.args.rings-=t,this.viewport&&this.viewport.settings.rumble&&this.controller&&this.controller.rumble&&this.controller.rumble({duration:100,strongMagnitude:.5,weakMagnitude:1})):this.controllable&&(this.die(),this.viewport.settings.rumble&&this.controller.rumble({duration:450,strongMagnitude:1,weakMagnitude:1}))))}damage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";if(this.args.mercy)return;this.dashed=this.args.jumping=this.args.spinning=!1;const s=new CustomEvent("damage",{cancelable:!0,detail:{other:t,type:e}});return this.isHyper?void 0:this.isSuper?(this.onNextFrame(()=>this.startle(t)),void(this.args.mercy=30)):void(this.immune(t,e)||(this.dispatchEvent(s)?this.args.rings?(this.loseRings(),this.args.rings=0,this.onNextFrame(()=>this.startle(t)),this.args.mercy=180,this.totalCombo(!0),this.viewport.settings.rumble&&(this.controller.rumble({duration:350,strongMagnitude:1,weakMagnitude:1}),this.onTimeout(350,()=>{this.controller.rumble({duration:150,strongMagnitude:.5,weakMagnitude:1})}))):this.controllable&&(this.die(),this.totalCombo(!0),this.viewport.settings.rumble&&this.controller.rumble({duration:450,strongMagnitude:1,weakMagnitude:1})):s.detail.immune||(this.args.y-=8,this.onNextFrame(()=>this.startle(t)),this.args.mercy=180,this.viewport.settings.rumble&&this.controller.rumble({duration:350,strongMagnitude:1,weakMagnitude:1}),this.totalCombo(!0),this.lightDashReward=this.grindReward=this.airReward=null)))}startle(t){if(this.noClip)return;this.args.startled=0;const e=Math.sign(t&&(t.args.xSpeed||t.args.x-t.xLast||t.args.x-this.args.x)||this.x-this.xLast||this.args.xSpeed||this.args.gSpeed||this.args.direction);this.args.jumping=!1,this.args.falling=!0,this.args.startled=180,this.args.ignore=30,this.args.float=1,this.args.xSpeed=-2.25*e,this.args.ySpeed=-8,this.args.x+=this.args.xSpeed,this.args.flying=!1,this.args.dashed=!1,this.args.lightDashed=!1,this.args.lightDashing=!1,this.args.gSpeed=0,this.args.standingOn=!1,this.args.mode===M?(this.args.mode=0,this.args.y+=this.args.height,this.args.ySpeed=4):this.args.y-=4}checkSolidActors(t){return t.args!==this.args&&(!!t.solid&&(!t.args.platform&&!t.isVehicle||this.args.y<=t.args.y+-t.args.height&&this.args.ySpeed>=0))}scanBottomEdge(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=this.viewport.tileMap,s=this.args.width/2,i=e.getSolid(this.x-s,this.y+1,this.args.layer),r=e.getSolid(this.x+s,this.y+1,this.args.layer);if(!i||!r)return this.castRay(this.args.width,-t<0?Math.PI:0,[t*s,0],(t,e)=>{let s=this.getMapSolidAt(e[0],e[1]+1);if(Array.isArray(s)&&(s=s.filter(t=>t.callCollideHandler(this)).length),s)return this.args.width-t})}get realAngle(){const t=this.args;if(t.standingOn&&!t.mode)return t.standingOn.realAngle;if(t.falling)return-t.groundAngle-Math.PI;switch(t.mode){case 0:return-t.groundAngle-Math.PI;case 1:return-t.groundAngle-Math.PI/2;case 2:return-t.groundAngle;case 3:return-t.groundAngle+Math.PI/2}}get downAngle(){switch(this.args.mode){case x:return Math.PI/2;case P:return 0;case M:return-Math.PI/2;case k:return Math.PI}}get upAngle(){switch(this.args.mode){case x:return-Math.PI/2;case P:return Math.PI;case M:return Math.PI/2;case k:return 0}}get leftAngle(){switch(this.args.mode){case x:return Math.PI;case P:return-Math.PI/2;case M:return 0;case k:return Math.PI/2}}get rightAngle(){switch(this.args.mode){case x:return 0;case P:return Math.PI/2;case M:return Math.PI;case k:return-Math.PI/2}}get groundPoint(){switch(this.args.mode){case x:return[this.args.x+0,this.args.y+1];case P:return[this.args.x+1,this.args.y+0];case M:return[this.args.x+0,this.args.y-1];case k:return[this.args.x-1,this.args.y+0]}}rotatePoint(t,e){return[t*Math.cos(this.realAngle)-e*Math.sin(this.realAngle),e*Math.cos(this.realAngle)+t*Math.sin(this.realAngle)]}standBelow(t){}filterSolidActors(t){return t.args!==this.args&&(!!t.solid&&(!t.args.platform&&!t.isVehicle||(this.args.y>=t.args.y&&this.args.ySpeed>=0&&2===this.args.mode||this.args.y<=t.args.y+-t.args.height+1&&this.args.ySpeed>=0)))}getMapSolidAt(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this.viewport)return;if(this.screenLock&&(t<this.screenLock.xMin||t>this.screenLock.xMax))return!0;if(s){const s=this.viewport.actorsAtPoint(t,e,0,0,{nearbyActors:i}).filter(this.filterSolidActors.bind(this));if(s.length>0)return s}return this.viewport.tileMap.getSolid(t,e,this.getCollisionMap())}get canRoll(){return!1}get canFly(){return!1}get canStick(){return!1}get canSpindash(){return!1}get isEffect(){return!1}get isPushable(){return!1}get isVehicle(){return!1}get solid(){return!1}get x(){return this.args.x}get y(){return this.args.y}get point(){return[this.args.x,this.args.y]}get rotateLock(){return!1}get controllable(){return!1}get skidding(){return Math.abs(this.args.gSpeed)&&this.args.direction&&!this.args.antiSkid&&!this.args.grinding&&Math.sign(this.args.gSpeed)!==this.args.direction}effect(t){}readInput(){if(!this.controller)return;const t=this.controller;if(this.xAxis=0,this.yAxis=0,!t.axes)return;t.axes[0]&&(this.xAxis=t.axes[0].magnitude,Math.abs(this.xAxis)>.55&&(this.xAxis=Math.sign(this.xAxis)),Math.abs(this.xAxis)<.1&&(this.xAxis=0)),t.axes[1]&&(this.yAxis=t.axes[1].magnitude,Math.abs(this.yAxis)>.55&&(this.yAxis=Math.sign(this.yAxis)),Math.abs(this.yAxis)<.1&&(this.yAxis=0)),t.axes[2]&&(this.aAxis=t.axes[2].magnitude),t.axes[3]&&(this.bAxis=t.axes[3].magnitude);const e=t.buttons;this.buttons=e;for(const t in e){const s=e[t],i=`release_${t}`,r=`command_${t}`,a=`hold_${t}`;if(0==t&&1===s.delta&&(this.yAxis&&this.args.falling||this.args.standingOn&&this.args.standingOn.quickDrop)||!this.args.standingOn||!this.args.standingOn.isVehicle){if(1===s.delta){let t=!1;if(this.args.currentSheild&&r in this.args.currentSheild&&!1===this.args.currentSheild[r](this,s)&&(t=!0),!t)for(const e of[...this.behaviors].reverse())if(e[r]&&!1===e[r](this,s)){t=!0;break}t||this[r]&&this[r](s)}else if(-1===s.delta){let t=!1;for(const e of this.behaviors)e[i]&&!1===e[i](this,s)&&(t=!0);t||(this.args.currentSheild&&i in this.args.currentSheild&&this.args.currentSheild[i](this,s),this[i]&&this[i](s))}else if(s.active){let t=!1;for(const e of this.behaviors)e[a]&&!1===e[a](this,s)&&(t=!0);t||(this.args.currentSheild&&a in this.args.currentSheild&&this.args.currentSheild[a](this,s),this[a]&&this[a](s))}}else if(this.args.standingOn&&this.args.standingOn.isVehicle){this.args.jumping=!1,this.args.flying=!1;const t=this.args.standingOn;if(1===s.delta){t[r]&&t[r](s);for(const e of t.behaviors)e[r]&&e[r](t,s)}else if(-1===s.delta){t[i]&&t[i](s);for(const e of t.behaviors)e[i]&&e[i](t,s)}else if(s.active){t[a]&&t[a](s);for(const e of t.behaviors)e[a]&&e[a](t,s)}}}}distanceFrom(t){let{x:e,y:s}=t;return Math.hypot(this.x-e,this.y-s)}twist(t){if(!this.twister){const t=this.viewport.tags.bgFilters,e='<div class = "point-actor-filter twist-filter">';this.twistFilter=new a.Tag(e),t.appendChild(this.twistFilter.node),this.twister=new n.Twist({id:"twist-"+this.args.id,scale:60}),this.twister.args.bindTo(["x","y","width","height","xOff","yOff"],(t,e)=>{this.twistFilter.style({[`--${e}`]:t,filter:`url(#twist-${this.args.id})`})}),this.twister.args.yOff=16,this.twister.render(this.twistFilter.node),this.onRemove(()=>this.twistFilter.remove())}this.twister.args.scale=t}pinch(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.pincherBg){const t=this.viewport.tags.bgFilters,e=(this.args.type.split(" ").shift(),'<div class = "point-actor-filter pinch-filter">');this.pinchFilterBg=new a.Tag(e),t.appendChild(this.pinchFilterBg.node),this.pincherBg=new l.Pinch({id:"pinch-"+this.args.id,scale:60}),this.pincherBg.args.bindTo(["x","y","width","height","xOff","yOff"],(t,e)=>{this.pinchFilterBg.style({[`--${e}`]:t,filter:`url(#pinch-${this.args.id})`})}),this.pincherBg.render(this.pinchFilterBg),this.onRemove(()=>this.pinchFilterBg.remove())}this.pincherBg.args.scale=t}droop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===s&&(s=e);const i=this.args.width/2;if(!this.drooperFg)return this.drooperFg=new o.Droop({id:"droop-"+this.args.id,width:3*this.args.width,height:3*this.args.height,scale:64}),this.args.bindTo(["x","y"],(t,e)=>{this.drooperFg.args[e]=Number(t)}),this.onNextFrame(()=>{this.drooperFg.args.scale=Number(2*t),this.sprite.style({transform:`translate(-50%, calc(${t}px + calc(-100% + 1px)))`,filter:`url(#droop-${this.args.id})`}),this.drooperFg.args.dx=-e}),void this.drooperFg.render(this.sprite);this.drooperFg.args.scale=Number(2*t),this.sprite.style({transform:`translate(-50%, calc(${t}px + calc(-100% + 1px)))`,filter:`url(#droop-${this.args.id})`});const r=1-e/i;this.args.width;this.drooperFg.args.droopWidthLeft=`${51*r+1}%`,this.drooperFg.args.droopRightStart=`${51*r}%`,this.drooperFg.args.droopWidthRight=`${102+-51*r}%`}crossRegionBoundary(t){if(t&&!this.args.static&&this.viewport){const e=this.viewport;if(!this.args.gone&&this.args.moving&&Math.abs(this.args.y-(t.args.y+-t.args.height))<=Math.abs(this.args.ySpeed||this.args.gSpeed)&&t.entryParticle){const s=new a.Tag(t.entryParticle);s.node&&(s.age=0,s.x=this.args.x,s.style({"--x":this.args.x,"--y":t.args.y+-t.args.height+-8,"z-index":5,opacity:Math.random,"--particleScale":this.args.particleScale,"--time":320}),this.splashes.add(s),e.particles.add(s),e.onFrameOut(20,()=>{s.node&&e.particles.remove(s),this.splashes.delete(s)}))}}}die(){this.args.dead||(this.viewport.args.inventory.splice(0),this.args.currentSheild=null,this.totalCombo(!0),this.args.groundAngle=0,this.args.ySpeed=0,this.args.xSpeed=0,this.args.jumping=!1,this.args.falling=!0,this.args.ignore=-1,this.args.mercy=0,this.args.float=0,this.args.rings=0,this.args.standingLayer=null,this.args.standingOn=null,this.lastLayer=null,this.args.dead=!0,this.noClip=!0,this.args.ySpeed=-12,this.focused=this.cofocused=null,this.y>this.viewport.meta.deathLine&&(this.args.ySpeed=-14),this.args.xSpeed=0,this.viewport.onFrameOut(120,()=>{this.args.dead&&this.respawn()}))}respawn(){this.viewport&&(this.screenLock=null,this.args.xSpeed=0,this.args.ySpeed=0,this.args.gSpeed=0,this.args.respawning=!0,this.args.display="none",this.args.x=-this.viewport.args.x,this.args.y=-this.viewport.args.y,this.args.standingLayer=null,this.args.standingOn=null,this.lastLayer=null)}sleep(){}wakeUp(){}urlWrap(t){return`url(${t})`}get facePoint(){return this.rotatePoint(-5*this.args.direction,-14+this.args.height)}registerDebug(t){window[t]=this}loseRings(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.viewport.objectPalette.ring;this.spawnRings=this.spawnRings||0;const i=t||Math.min(this.args.rings,16);let r=0;this.spawnRings,Math.floor(i/8);this.viewport.onFrameOut(4,()=>{for(;this.spawnRings<i;){const t=new s,i=Math.ceil(r/8),a=r%8*(Math.PI/4)+Math.PI/4,n=Math.cos(a),o=Math.sin(a);t.args.x=this.x-n*(8*i),t.args.y=this.y-o*(8*i)-this.args.height/4,t.args.xSpeed=0,t.args.ySpeed=0,t.noClip=!0,t.args.static=!1,t.args.float=18,t.args.ignore=30,t.args.width=16,t.args.height=16,t.dropped=!0,this.viewport.onFrameOut(2*(1+i),()=>{this.viewport.spawn.add({object:t})}),this.spawnRings++,r++,this.viewport.onFrameOut(2*i+6,()=>{t.args.xSpeed+=3*-n,t.args.ySpeed+=3*-o,t.args.ySpeed+=.75*-(i+1)}),r%3==2?(t.args.decoration=!0,t.noClip=!0,this.viewport.onFrameOut(100,()=>{this.viewport.actors.remove(t),this.spawnRings>0&&this.spawnRings--})):(t.args.decoration=!1,t.noClip=!1,this.viewport.onFrameOut(e||360-r%5*35,()=>{this.viewport.actors.remove(t),this.spawnRings>0&&this.spawnRings--}))}})}collect(t){t.dropped&&(this.spawnRings&&this.spawnRings--,t.dropped=!1)}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}distanceTo(t){return Math.hypot(this.y-t.y,this.x-t.x)}canSee(t){if(!1===this.castRayQuick(this.distanceTo(t),t.angleTo({x:this.args.x,y:this.args.y-this.args.height}),[0,-this.args.height],!1))return!0}setTile(){const t=this.viewport.tileMap;t.ready.then(e=>{const s=t.getTile(this.args.tileId-1);s&&(this.args.spriteX=s[0],this.args.spriteY=s[1],this.args.spriteSheet=s[2]||this.args.spriteSheet)})}halt(t){const e=this.args.hSpeed=this.args.gSpeed;this.args.gSpeed=0,this.viewport.onFrameOut(t,()=>{this.args.gSpeed=e,this.args.hSpeed=0})}setAutoAttr(t,e){this.autoAttr.get(this.box)[e]=t}invoke(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];this.behaviors.forEach(e=>{"function"==typeof e[t]&&e[t](this,...s)})}bMap(t){const e=new Map;for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];for(const s of this.behaviors)"function"==typeof s[t]&&e.set(s.constructor,s[t](this,...i));return e}getBoundingLines(){if(this[T])return this[T];let t,e,s,i,r;switch(this.args.mode){case x:e=this.args.x-(this.isRegion?0:this.args.width/2),t=[[s=this.args.x+(this.isRegion?this.args.width:this.args.width/2),i=this.args.y-this.args.height,s,r=this.args.y],[e,i,e,r],[s,i,e,i],[s,r,e,r]];break;case M:e=this.args.x-this.args.width/2,t=[[s=this.args.x+this.args.width/2,i=this.args.y,s,r=this.args.y+this.args.height],[e,i,e,r],[s,i,e,i],[s,r,e,r]];break;case k:e=this.args.x,t=[[s=this.args.x+this.args.height,i=this.args.y-this.args.width/2,s,r=this.args.y+this.args.width/2],[e,i,e,r],[s,i,e,i],[s,r,e,r]];break;case P:e=this.args.x-this.args.height,t=[[s=this.args.x,i=this.args.y-this.args.width/2,s,r=this.args.y+this.args.width/2],[e,i,e,r],[s,i,e,i],[s,r,e,r]]}return Object.freeze(t),this[T]=t}filterSolids(t){return t.args!==this.args&&t.callCollideHandler(this)&&t.solid}onSpawned(t){for(const e of this.behaviors)e.onSpawned&&e.onSpawned(this,t)}onDespawned(t){for(const e of this.behaviors)e.onDespawned&&e.onDespawned(this,t)}getCollisionMap(){if(!this.collisionMap){this.collisionMap=this.viewport.tileMap.getCollisionMap();for(const t of this.collisionMap.keys())"Art"===t.name.substr(0,3)?this.collisionMap.delete(t):"Moving Art"===t.name.substr(0,10)&&this.collisionMap.delete(t)}if(!this.viewport)return this.collisionMap;for(const t of this.collisionMap.keys())"Collision 0"===t.name?this.collisionMap.set(t,!0):t.name==="Collision "+this.args.layer?this.collisionMap.set(t,!0):"Door"===t.name.substr(0,4)?this.doorMap.has(t.index)&&this.collisionMap.set(t,this.doorMap.get(t.index)):"Platform"===t.name.substr(0,8)||"Grinding"===t.name.substr(0,8)?(this.args.ySpeed>=0?this.collisionMap.set(t,!0):this.collisionMap.set(t,!1),this.viewport.tileMap.getSolid(this.args.x+16,this.args.y+-16,t.index)&&this.viewport.tileMap.getSolid(this.args.x-16,this.args.y+-16,t.index)?this.collisionMap.set(t,!1):t.layer&&t.layer.meta.vertical&&(this.args.xSpeed&&Math.sign(t.layer.meta.vertical)!==Math.sign(this.args.xSpeed)||this.collisionMap.set(t,!0)),(this.args.climbing&&this.viewport.tileMap.getSolid(this.args.x,this.args.y,t.index)||this.args.flying&&t.layer.meta.vertical!==Math.sign(this.args.xSpeed)&&!this.viewport.tileMap.getSolid(this.args.x+this.args.xSpeed,this.args.y+-8,t.index)&&this.viewport.tileMap.getSolid(this.args.x,this.args.y,t.index))&&this.collisionMap.set(t,!1),t.layer.meta.vertical||this.args.mode||!this.viewport.tileMap.getSolid(this.args.x,this.args.y+-16,t.index)||this.collisionMap.set(t,!1)):"Moving"===t.name.substr(0,6)&&"Moving Art"!==t.name.substr(0,10)?this.collisionMap.set(t,!0):this.collisionMap.set(t,!1);return this.collisionMap}command_0(){}command_1(){}}t.PointActor=O,w(O,"lastClick",0)}),require.register("actor/PowerupGlow.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PowerupGlow=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag");t.PowerupGlow=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-powerup-glow",this.args.width=64,this.args.height=64}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-closed"]="closed",this.icon=new r.Tag('<div class = "powerup-icon">'),this.halo=new r.Tag('<div class = "powerup-halo">'),this.tags.sprite.appendChild(this.icon.node),this.box.appendChild(this.halo.node)}collideA(t){super.collideA(t),t.controllable&&(this.onTimeout(125,()=>this.args.closed="closed"),this.onTimeout(4500,()=>this.args.closed=""))}get canStick(){return!1}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/Projectile.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projectile=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer"),a=e("../actor/Marker"),n=(e("../actor/Explosion"),e("curvature/base/Tag")),o=e("../region/Region"),l=e("./Spring"),h=e("./BreakableBlock");e("./Block");class g extends i.PointActor{constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;const i=e.gravity;super(e,s),this.args.type="actor-item actor-projectile",this.args.subType&&(this.args.type=this.args.type+" "+this.args.subType),this.args.damageType=null!==(t=this.args.damageType)&&void 0!==t?t:"normal",this.behaviors.add(new r.Platformer),this.args.width=8,this.args.height=8,this.args.strength=this.args.strength||1,this.args.gravity=null!==i&&void 0!==i?i:.15,this.removeTimer=null,this.noClip=!0,this.deflected=!1}update(){!this.removed&&this.viewport&&(this.args.falling||(this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0),super.update(),!this.args.xSpeed&&!this.args.ySpeed&&this.age>1&&this.explode(),this.viewport&&!this.removeTimer&&(this.removeTimer=this.viewport.onFrameOut(200,()=>this.explode())))}collideA(t){if(!(t instanceof g)){if(t===this.args.owner||t instanceof o.Region||t instanceof l.Spring)return!1;if(t instanceof a.Marker||this.args.owner.controllable||t.controllable)return!(this.args.strength<=1&&t instanceof h.BreakableBlock)&&(!t.args.gone&&!this.deflected&&(t instanceof a.Marker||t.args.currentSheild&&t.args.currentSheild.immune(t,this,"projectile")?(this.args.xSpeed*=-1,this.args.ySpeed*=-1,void(this.deflected=!0)):!(!t.solid&&!t.controllable)&&(this.args.xSpeed=0,this.args.ySpeed=0,this.args.float=-1,this.args.owner&&!this.args.owner.args.gone&&(t.controllable||t instanceof h.BreakableBlock)&&t.damage(this,this.args.damageType),this.explode(),!1)))}}explode(){const t=this.viewport;if(!t)return;const e=new n.Tag('<div class = "particle-explosion">');e.style({"--x":this.x,"--y":this.y}),t.particles.add(e),this.viewport.onFrameOut(20,()=>t.particles.remove(e)),this.viewport.actors.remove(this),this.remove()}get canStick(){return!1}get solid(){return!1}}t.Projectile=g}),require.register("actor/PropellerPlatform.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropellerPlatform=void 0;var i=e("./Block"),r=e("../audio/Sfx");t.PropellerPlatform=class extends i.Block{constructor(){var t;super(...arguments),this.args.maxClimb=null!==(t=this.args.maxClimb)&&void 0!==t?t:256,this.args.width=64,this.args.height=53,this.args.platform=1,this.args.type="actor-item actor-propeller-platform",this.args.static=0,this.args.gravity=.2,this.args.spinning=0,this.args.bouncing=0}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-spinning"]="spinning",this.autoAttr.get(this.box)["data-bouncing"]="bouncing"}update(){this.args.cameraBias=-.2,this.args.spinning>0?this.args.spinning--:this.args.spinning=0,this.args.bouncing>0?this.args.bouncing--:this.args.bouncing=0;const t=this.originalY+-this.args.maxClimb;this.args.y>this.originalY&&(this.args.y=this.originalY,this.args.ySpeed=0,this.args.float=-1),this.args.y<t&&(this.args.float=30,this.args.y=t,this.args.ySpeed=Math.max(0,this.args.ySpeed)),super.update()}collideA(t,e){if(!t.args.static)return t.args.falling&&t.args.y>this.args.y+-this.args.height&&t.args.y<this.args.y+-.75*this.args.height?(t.args.y=this.args.y+-this.args.height+this.args.ySpeed+3,super.collideA(t,e)):!t.args.falling||t.args.ySpeed<0?super.collideA(t,e):(this.args.ySpeed+=Math.min(-4,.5*-Math.abs(t.args.ySpeed)),this.args.float=10,this.args.spinning=30,this.args.bouncing=10,t.args.xSpeed*=.5,t.doubleSpin=!1,t.dashed?(t.dashed=!1,t.args.xSpeed=0,t.args.ySpeed=-t.args.airSpeed,t.args.ySpeed*=1.25,this.args.ySpeed*=1.75):(t.args.ySpeed>0&&(t.args.ySpeed=Math.min(-4,Math.max(-6,-Math.abs(t.args.ySpeed))),t.args.ySpeed+=this.args.ySpeed),t.args.ySpeed>this.args.ySpeed&&(t.args.ySpeed=this.args.ySpeed+-6)),r.Sfx.play("PROP_PLAT"),this.viewport.settings.rumble&&t.controller&&t.controller.rumble&&t.controller.rumble({duration:100,strongMagnitude:1,weakMagnitude:0}),this.args.y--,this.args.falling=!0,"airdash"===t.args.animation&&(t.args.animation="flip"),super.collideA(t,e))}}}),require.register("actor/Pulley.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pulley=void 0;var i=e("./PointActor");e("./Ring");t.Pulley=class extends i.PointActor{constructor(){super(...arguments),this.args.width=64,this.args.height=64,this.args.type="actor-item actor-pulley",this.args.convey=0,this.args.conveyed=0,this.args.float=-1,this.noClip=!0}update(){this.match?this.args.convey=-this.match.args.convey:this.match=this.viewport.actorsById[this.args.match],this.box&&this.box.style({"--convey":Math.abs(this.args.convey)}),this.box&&this.box.style({"--conveyDir":Math.sign(this.args.convey)}),this.args.conveyed+=this.match.args.convey,this.box&&this.box.style({"--conveyed":this.args.conveyed})}get isEffect(){return!0}}}),require.register("actor/PulleySmall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PulleySmall=void 0;var i=e("./Pulley");t.PulleySmall=class extends i.Pulley{constructor(){super(...arguments),this.args.width=32,this.args.height=32,this.args.type="actor-item actor-pulley-small",this.args.convey=0,this.args.float=-1,this.noClip=!0}}}),require.register("actor/Pumpkin.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pumpkin=void 0;var i=e("./PointActor");t.Pumpkin=class extends i.PointActor{constructor(){var t;super(...arguments),this.args.face=null!==(t=this.args.face)&&void 0!==t&&t,this.args.width=17,this.args.height=15,this.args.type="actor-item actor-pumpkin",this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),t)this.cX=t.args.bindTo("x",e=>this.args.x=e+8*t.args.direction),this.cY=t.args.bindTo("y",t=>this.args.y=t+-16),t.carrying.add(this),this.args.float=-1;else if(this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,t.carrying.delete(this),this.args.falling=!0,this.args.float=0}})}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-face"]="face"}lift(t){this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null}get solid(){return!1}}}),require.register("actor/QuestionBlock.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuestionBlock=void 0;var i=e("./PointActor"),r=(e("./monitor/RingMonitor"),e("./monitor/SheildWaterMonitor"));function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.QuestionBlock=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.x=e.originalX=t.x+Math.floor(t.width/2),e.args.y=e.originalY=t.y,e}constructor(){super(...arguments),a(this,"maxBounce",4),a(this,"float",-1),a(this,"template",'<div\n\t\tclass = "point-actor [[type]] [[collType]]"\n\t\tstyle = "\n\t\t\tdisplay:[[display]];\n\t\t\t--angle:[[angle]];\n\t\t\t--airAngle:[[airAngle]];\n\t\t\t--display-angle:[[_angle]];\n\t\t\t--height:[[height]];\n\t\t\t--width:[[width]];\n\t\t\t--x:[[x]];\n\t\t\t--y:[[y]];\n\t\t"\n\t\tdata-colliding = "[[colliding]]"\n\t\tdata-falling   = "[[falling]]"\n\t\tdata-facing    = "[[facing]]"\n\t\tdata-angle     = "[[angle|rad2deg]]"\n\t\tdata-mode      = "[[mode]]"\n\t\tdata-empty     = "[[empty]]"\n\t\tcv-ref = "box"\n\t><div cv-ref = "sprite" class = "sprite"></div></div>'),this.args.type="actor-question-block actor-item",this.args.width=32,this.args.height=32,this.initY=null,this.empty=!1}collideA(t,e){if(super.collideA(t),null===this.initY&&(this.initY=this.y),2===e){const s=Math.abs(t.args.ySpeed);if(t.args.falling=!0,t.args.ySpeed>0?t.args.ySpeed+=this.args.ySpeed:(this.args.y-=s,t.args.y+=s),this.args.ySpeed>0&&this.args.ySpeed>t.args.ySpeed&&(t.args.ySpeed=Math.abs(t.args.ySpeed),t.args.y+=this.args.ySpeed),this.args.ySpeed<0&&(this.args.ySpeed=-Math.abs(this.args.ySpeed)),this.args.ySpeed)return!0;const i=this.maxBounce;let r=2===e?-Math.abs(t.args.ySpeed):t.args.ySpeed;Math.abs(r)>i&&(r=i*Math.sign(r)),this.args.ySpeed=r,t.args.ySpeed=-t.args.ySpeed}if(2===e&&!this.args.empty&&!this.args.empty){const t=new r.SheildWaterMonitor({x:this.x,y:this.y-96});this.viewport.spawn.add({object:t}),t.onRemove(()=>this.args.empty=!1),this.args.empty=!0}return!0}update(){null!==this.initY&&(this.initY>this.y?this.args.ySpeed+=.75:this.initY<this.y&&(this.args.ySpeed-=.75),Math.abs(this.args.y-this.initY)<1&&Math.abs(this.args.ySpeed)<1&&(this.args.ySpeed=0,this.args.y=this.initY)),this.args.ySpeed*=.9,this.args.ySpeed=Math.floor(100*this.args.ySpeed)/100,this.args.y=Math.round(this.args.y);const t=this.maxBounce;Math.abs(this.args.ySpeed)>t&&(this.args.ySpeed=t*Math.sign(this.args.ySpeed)),super.update()}get canStick(){return!1}get solid(){return!0}}}),require.register("actor/RailCar.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RailCar=void 0;var i=e("./Vehicle"),r=e("curvature/base/Tag");t.RailCar=class extends i.Vehicle{constructor(){super(...arguments),this.args.type="actor-item actor-rail-car",this.args.width=32,this.args.height=48,this.removeTimer=null,this.args.cartSpeed=this.args.cartSpeed||15,this.args.gSpeedMax=20,this.args.decel=0,this.args.accel=.75,this.args.gravity=1,this.args.seatHeight=44,this.args.skidTraction=.05,this.args.jumpForce=12,this.dustCount=0,this.args.particleScale=2,this.args.started=!1}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite"),this.frontWheel=new r.Tag('<div class = "rail-car-wheel rail-car-wheel-front">'),this.backWheel=new r.Tag('<div class = "rail-car-wheel rail-car-wheel-back">'),this.frontFrag=new r.Tag('<div class = "rail-car-frag rail-car-frag-front">'),this.backFrag=new r.Tag('<div class = "rail-car-frag rail-car-frag-back">'),this.sprite.appendChild(this.frontWheel.node),this.sprite.appendChild(this.backWheel.node),this.sprite.appendChild(this.frontFrag.node),this.sprite.appendChild(this.backFrag.node)}update(){this.originalSpeed=this.args.gSpeed||this.args.xSpeed;const t=this.args.x,e=this.args.y;if(super.update(),!this.sprite)return;const s=this.x;if(0===this.args.gSpeed&&0===this.args.hSpeed&&0===this.args.xSpeed||(this.sprite.classList.add("moving"),this.args.started=!0),s!==t||this.args.broken||this.args.hSpeed||(this.sprite.classList.remove("moving"),!this.args.started)||(this.viewport,(!this.args.falling||this.args.xSpeed||this.args.ySpeed)&&(this.args.falling||this.args.hSpeed||this.args.x!==t||this.args.y!==e)||this.breakApart()),this.occupant&&!this.args.falling){const t=this.args.hSpeed||this.args.gSpeed;(Math.abs(t)<Math.abs(this.args.cartSpeed)||Math.sign(t)!==Math.sign(this.args.cartSpeed))&&(this.args.hSpeed?this.args.hSpeed+=.125*Math.sign(this.args.cartSpeed):this.args.gSpeed+=.125*Math.sign(this.args.cartSpeed),Math.abs(this.args.gSpeed)<1&&(this.args.gSpeed=Math.sign(this.args.gSpeed))),this.args.direction=Math.sign(this.args.hSpeed||this.args.gSpeed)}else this.args.hSpeed?this.args.hSpeed=this.args.xSpeed:this.args.xSpeed&&(this.args.gSpeed=this.args.xSpeed)}breakApart(){this.args.broken||(this.viewport,this.occupant&&this.occupant.startle(),this.sprite.classList.add("breaking"),this.args.broken=!0,this.args.groundAngle=0,this.args.mode=0,this.args.dead=!0)}sleep(){this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.dead=!1,this.args.groundAngle=0,this.args.gSpeed=0,this.args.xSpeed=0,this.args.ySpeed=0,this.sprite.classList.remove("breaking"),this.sprite.classList.remove("broken"),this.args.broken=!1,this.args.started=!1,super.sleep()}processInputDirect(){}get solid(){return!this.args.broken&&!this.occupant}}}),require.register("actor/Red.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Red=void 0;var i=e("./PointActor");t.Red=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new SkidDust),this.args.type="actor-item actor-red",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.width=16,this.args.height=16,this.args.float=-1}}}),require.register("actor/RedBomb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedBomb=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");e("curvature/base/Tag");t.RedBomb=class extends i.PointActor{constructor(){super(...arguments),this.args.width=8,this.args.height=8,this.args.type="actor-item actor-red-bomb",this.args.decel=0,this.noClip=!0,this.explosions=new Set}update(){this.args.falling||this.explosions.size||this.explode(),super.update();for(const t of this.explosions)t.style({"--x":this.args.x,"--y":this.args.y+-16})}collideA(t){t.controllable&&(t.damage(this),this.explode(),this.args.float=-1,this.args.xSpeed=0,this.args.ySpeed=0)}explode(){this.exploded||(this.exploded=!0,this.viewport.actors.remove(this),r.Sfx.play("OBJECT_DESTROYED"))}}}),require.register("actor/RedEyeJet.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedEyeJet=void 0;var i=e("curvature/base/Tag"),r=e("../audio/Bgm"),a=e("../audio/Sfx"),n=e("./PointActor"),o=e("./Projectile"),l=e("./MiniMace"),h=e("./MegaMace"),g=e("../lib/Analytic");t.RedEyeJet=class extends n.PointActor{constructor(t,e){super(t,e),this.args.gravity=.4,this.args.width=96,this.args.height=32,this.args.type="actor-item actor-red-eye-jet",this.args.float=-1,this.args.phase="idle",this.args.hitPoints=this.args.hitPoints||8,this.args.maxSpeed=9,this.args.bindTo("phase",t=>this.args.phaseFrameId=0)}wakeUp(){for(const[t,e]of this.hanging)for(const t of e)t.setPos()}collideA(t,e){let s;if(this.hanging.has(t))return!1;if(this.hanging.has(l.MiniMace)?s="MINI-MACE":this.hanging.has(h.MegaMace)&&(s="MEGA-MACE"),!(t.controllable||t instanceof o.Projectile))return;if(o.Projectile,this.args.hitPoints>0&&!(t.args.jumping||t.args.rolling||t.dashed||t instanceof o.Projectile))return t.damage(),!0;if(!this.args.falling&&"exploding"!==this.args.phase){if(!(t.args.jumping||t.args.rolling||t.dashed))return!0;this.box.setAttribute("data-phase","exploding"),this.args.phase="exploding",this.viewport.clearCheckpoints();const e=this.viewport;e.onFrameOut(80,()=>{this.box.setAttribute("data-phase","exploded"),this.args.falling=!0,this.args.ySpeed=-12,this.noClip=!0,a.Sfx.play("OBJECT_DESTROYED")}),e.onFrameOut(100,()=>{this.viewport.args.cutScene=!0}),e.onFrameOut(150,()=>{this.viewport.controlActor.controller.replay({axes:[1,0,0,1]}),this.viewport.controlActor.readInput()}),e.onFrameOut(210,()=>{this.viewport.controlActor.controller.replay({buttons:[1]}),this.viewport.controlActor.readInput()}),e.onFrameOut(211,()=>{this.viewport.controlActor.dropDashCharge=30}),e.onFrameOut(285,()=>{this.viewport.controlActor.controller.replay({buttons:[0,0,0,0,0,0]}),this.viewport.controlActor.readInput(),this.args.phase="done"}),e.onFrameOut(500,()=>{this.args.xSpeed=0,this.args.ySpeed=0,this.args.y=-1024})}this.ignores.set(t,15),2===e&&(a.Sfx.play("BOSS_DUDHIT"),t.args.ySpeed=Math.max(7,Math.abs(t.args.ySpeed)));const i=Math.max(Math.abs(t.args.xSpeed),Math.abs(this.args.xSpeed));this.args.hitPoints>1&&this.args.falling?this.args.xSpeed=t.args.xSpeed:this.args.xSpeed=0;let n=!1;if(1===e&&(this.handleDamage(t),n=!0,this.args.hitPoints>0?(t.args.xSpeed=1.25*-i,t.args.xSpeed=Math.min(-7,-this.args.xSpeed),this.args.hitPoints--):(t.args.xSpeed=-2,t.args.ignore=-2)),3===e&&(this.handleDamage(t),n=!0,this.args.hitPoints>0?(t.args.xSpeed=1.25*i,t.args.xSpeed=Math.max(7,-this.args.xSpeed),this.args.hitPoints--):(t.args.xSpeed=2,t.args.ignore=-2)),n&&t&&t.controller&&t.controller.rumble&&this.viewport.settings.rumble&&(t.controller.rumble({duration:120,strongMagnitude:1,weakMagnitude:1}),this.onTimeout(100,()=>{t.controller.rumble({duration:100,strongMagnitude:0,weakMagnitude:.5})})),t instanceof o.Projectile||1===e||3===e||0===e){if(["dead","exploding","damaged","done"].includes(this.args.phase)||(this.args.phase="damaged",this.args.animation="",this.args.animation="damaged",0===this.args.hitPoints&&"exploding"!==this.args.phase&&(this.box.setAttribute("data-phase","dead"),this.args.animation="",this.args.phase="dead","function"==typeof ga&&g.Analytic.report({eventCategory:"boss",eventAction:"defeated",eventLabel:`${this.viewport.args.actName}::${this.args.id}`})),this.viewport.onFrameOut(20,()=>{"intro"!==this.args.phase&&(this.args.hitPoints>0?(this.args.animation="attacking",this.args.phase="attacking"):["dead","exploding","done"].includes(this.args.phase)||(this.box.setAttribute("data-phase","dead"),this.args.animation="dead",this.args.phase="dead",this.args.xSpeed=0,t.args.score+=2e4))})),0===e){t.args.y=this.y-this.args.height;const e=t.args.animation,s=t.args.ySpeed;this.onNextFrame(()=>{t.args.animation=e,t.args.falling=!0,t.args.xSpeed=-4*Math.sign(this.x-t.x),t.args.ySpeed=-Math.floor(Math.abs(s))||-4}),a.Sfx.play("BOSS_DAMAGED")}const s=t.args.gSpeed;t.args.gSpeed=-s,t.args.rolling&&this.onNextFrame(()=>{t.args.gSpeed=-s,t.args.rolling=!0,t.args.direction,Math.sign(s)})}return t.args.ignore=1,this.args.hitPoints||(r.Bgm.stop("ZONE-BOSS"),r.Bgm.stop("ACT-BOSS"),t.args.ignore=-2),!0}handleDamage(t){if(a.Sfx.play("BOSS_DAMAGED"),t){const e={label:["LUCKY SHOT","IM GOING EASY","OKAY","NICE","WOW","JEEZ","DAMN!","STOP!"][t.args.popChain.length],points:1e3*t.args.popChain.length,multiplier:1};t.args.popChain.push(e),t.args.popCombo+=1}}update(){if(this.args.phaseFrameId++,this.args.frameId++,"idle"!==this.args.phase){if(this.viewport){if("intro"===this.args.phase){if(this.hanging.has(l.MiniMace)){for(const t of this.hanging.get(l.MiniMace))t.args.ropeLength=80;r.Bgm.play("ACT-BOSS",{loop:!0,interlude:!0})}if(this.hanging.has(h.MegaMace)){for(const t of this.hanging.get(h.MegaMace))t.args.ropeLength=96;r.Bgm.play("ZONE-BOSS",{loop:!0,interlude:!0})}this.args.maxSpeed=12,this.args.phaseFrameId>240&&(this.args.phase="attacking")}else this.hanging.has(l.MiniMace)?this.viewport.onFrameOut(45,()=>{for(const t of this.hanging.get(l.MiniMace))t.args.ropeLength=128}):this.hanging.has(h.MegaMace)&&this.viewport.onFrameOut(45,()=>{for(const t of this.hanging.get(h.MegaMace))t.args.ropeLength=176});if("attacking"===this.args.phase){if(this.args.maxSpeed=9,this.hanging.has(l.MiniMace))for(const t of this.hanging.get(l.MiniMace))t.args.float=0;if(this.hanging.has(h.MegaMace))for(const t of this.hanging.get(h.MegaMace))t.args.float=0;Math.abs(this.viewport.controlActor.x-this.x)>255&&(this.args.phase="chasing")}if("chasing"===this.args.phase&&Math.abs(this.viewport.controlActor.x-this.x)<8&&this.y<this.viewport.controlActor.y&&(this.args.phase="attacking"),"exploding"!==this.args.phase)"damaged"===this.args.phase&&(this.args.xSpeed*=.999),this.box&&(this.x-this.viewport.controlActor.x>0?Math.abs(this.x-this.viewport.controlActor.x)>128?this.box.setAttribute("data-looking","far-left"):-1===this.viewport.controlActor.args.direction?this.box.setAttribute("data-looking","far-left"):this.box.setAttribute("data-looking","left"):this.x-this.viewport.controlActor.x<0&&(this.box.setAttribute("data-looking","far-right"),Math.abs(this.x-this.viewport.controlActor.x)>128?this.box.setAttribute("data-looking","far-right"):1===this.viewport.controlActor.args.direction?this.box.setAttribute("data-looking","far-right"):this.box.setAttribute("data-looking","right")),32>this.y-this.viewport.controlActor.y?this.box.setAttribute("data-ducking","true"):this.box.setAttribute("data-ducking","false")),this.args.hitPoints&&["attacking","intro","chasing"].includes(this.args.phase)&&(Math.abs(this.x-this.viewport.controlActor.x)>384&&(this.args.x=this.viewport.controlActor.x+384*Math.sign(this.x-this.viewport.controlActor.x)),this.args.xSpeed+=.35*-Math.sign(this.x-this.viewport.controlActor.x)),this.args.hitPoints?(this.args.falling=!0,this.args.float=-1):this.args.float=0,"intro"!==this.args.phase&&"attacking"!==this.args.phase||(this.args.maxSpeed=11),"chasing"===this.args.phase?Math.abs(this.x-this.viewport.controlActor.x)<128&&(this.args.maxSpeed=Math.max(this.args.maxSpeed,this.viewport.controlActor.args.xSpeed)):Math.abs(this.args.xSpeed)>this.args.maxSpeed&&(this.args.xSpeed=Math.sign(this.args.xSpeed)*this.args.maxSpeed),super.update();else{const t=this.viewport;if(t&&t.args.frameId%3==0){const e=new i.Tag('<div class = "particle-explosion">');a.Sfx.play("BOSS_DAMAGED");const s=this.args.width*Math.random()-this.args.width/2,r=this.args.height*Math.random()-this.args.height/2;e.style({"--x":this.x+s,"--y":this.y+r+-16}),t.particles.add(e),setTimeout(()=>t.particles.remove(e),512)}super.update()}}}else this.args.phaseFrameId>120&&(this.args.phase="intro")}onRendered(t){super.onRendered(t),this.body=new i.Tag('<div class = "body-center">'),this.bodyL=new i.Tag('<div class = "body-left">'),this.bodyR=new i.Tag('<div class = "body-right">'),this.fireA=new i.Tag('<div class = "boost-fire boost-fire-left">'),this.fireB=new i.Tag('<div class = "boost-fire boost-fire-right">'),this.eye=new i.Tag('<div class = "orange-eye">'),this.box.appendChild(this.body.node),this.box.appendChild(this.bodyL.node),this.box.appendChild(this.bodyR.node),this.box.appendChild(this.fireA.node),this.box.appendChild(this.fireB.node),this.box.appendChild(this.eye.node)}get solid(){return!1}}}),require.register("actor/Redz.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Redz=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../behavior/Patrol"),o=e("../mixin/CanPop"),l=(e("../actor/Explosion"),e("../actor/SpitFire"));t.Redz=class extends(i.Mixin.from(r.PointActor,o.CanPop)){constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.behaviors.add(new n.Patrol),this.args.type="actor-item actor-redz",this.args.animation="standing",this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=18,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.patrolBeat=this.args.patrolBeat||160,this.args.patrolPause=this.args.patrolPause||60,this.args.patrolSpeed=this.args.patrolSpeed||.25}update(){super.update();const t=this.args.direction=Math.sign(this.args.gSpeed)||this.args.direction;if(this.box&&(Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","skidding"):this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","shooting")),this.age%this.args.patrolBeat==this.args.patrolBeat-this.args.patrolPause){const e=new l.SpitFire({owner:this,direction:t,x:this.x+59*t,y:this.y-3,z:this.z+1}),s=this.viewport;s.spawn.add({object:e}),this._onRemove.add(()=>s.actors.remove(e))}}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Relief.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Relief=void 0;var i=e("./PointActor"),r=(e("./Block"),e("../audio/Sfx"),e("../ObjectPalette"));t.Relief=class extends i.PointActor{constructor(){var t,e;super(...arguments),this.args.width=24,this.args.height=80,this.args.type="actor-item actor-relief",this.noClip=!0,this.args.float=-1,this.args.offset=null!==(t=this.args.offset)&&void 0!==t?t:45,this.args.animation="idle",this.args.shoots=null!==(e=this.args.shoots)&&void 0!==e?e:"spitsteam",this.launching=new Set}update(){if(super.update(),!((this.viewport.args.frameId+-this.args.offset)%60)){if(!this.shoots&&r.ObjectPalette[this.args.shoots]){var t;const e=r.ObjectPalette[this.args.shoots],s=null!==(t=this.args.direction)&&void 0!==t?t:1;this.shoots=new e({owner:this,direction:s,x:this.x,y:this.y+-24,z:this.z+1}),this.shoots.args.x+=.5*this.shoots.args.width*s+.3*this.args.width*s,this.shoots.args.y+=.5*this.shoots.args.height,this.viewport.spawn.add({object:this.shoots})}this.shoots.args.gone&&(this.shoots=null)}}collideA(t){return!0}get solid(){return!0}}}),require.register("actor/RhinoBot.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RhinoBot=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=(e("../behavior/Patrol"),e("../mixin/CanPop"));t.RhinoBot=class extends(i.Mixin.from(r.PointActor,a.CanPop)){constructor(){super(...arguments),this.args.type="actor-item actor-rhino-bot",this.args.animation="standing",this.args.accel=.75,this.args.decel=.5,this.args.gSpeedMax=15,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=44,this.args.height=32,this.chasing=!1}onRendered(t){super.onRendered(t)}update(){this.args.shotTelegraph,this.args.patrolBeat;const t=this.args.x-this.xLast;if(this.args.tailOffset+=isNaN(t)?0:t,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),this.viewport&&this.viewport.controlActor&&Math.abs(this.viewport.controlActor.args.x-this.args.x)<768&&(this.chasing=this.viewport.controlActor),this.chasing){this.args.gSpeed+=.1*(this.chasing.args.x-this.args.x);const t=Math.abs(this.chasing.args.x-this.chasing.args.x),e=Math.max(6,Math.abs(this.chasing.args.gSpeed||this.chasing.args.xSpeed)*(t>256?1.2:1));Math.abs(this.args.gSpeed)>e&&(this.args.gSpeed=Math.sign(this.args.gSpeed)*e)}super.update(),this.args.direction=Math.sign(this.args.gSpeed),this.args.facing=this.args.direction>0?"right":"left"}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Ring.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ring=void 0;var i=e("./PointActor"),r=e("./Spring"),a=e("../audio/Sfx"),n=e("../lib/Analytic");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class l extends i.PointActor{constructor(){var t,e,s;super(...arguments),o(this,"template",'<div class  = "point-actor [[type]]">\n\t\t<div class = "sprite" cv-ref = "sprite"></div>\n\t</div>'),o(this,"float",-1),this[r.Spring.WontSpring]=!0,this.args.type="actor-item actor-ring",this.args.width=32,this.args.height=32,this.args.static=null===(t=this.args.static)||void 0===t||t,this.args.dropped=null===(e=this.args.dropped)||void 0===e||e,this.args.gone=!1,this.args.gravity=.4,this.args.delay=null!==(s=this.args.delay)&&void 0!==s?s:48}update(){if(!this.viewport)return;const t=this.viewport.args.frameId-this.startFrame;this.args.noClip?this.noClip=!0:this.args.decoration?this.noClip=!0:this.args.ySpeed<0?this.noClip=!0:this.attract||(this.noClip=!1),this.args.decoration&&(this.args.type="actor-item actor-ring decoration",this.args.gravity=.36),this.dropped&&(this.args.type="actor-item actor-ring dropped",this.args.height=14);const e=this.viewport;this.dropped&&this.viewport&&!this.viewport.actorIsOnScreen(this,256)&&e.onFrameOut(15,()=>{e.actors.remove(this)}),this.args.reward&&this.args.gone&&e.onFrameOut(15,()=>{e.actors.remove(this)}),(this.args.reward||this.dropped||this.attract)&&super.update(),this.args.reward||(this.dropped&&!this.attract&&this.getMapSolidAt(this.args.x,this.args.y+-this.args.height)&&!this.getMapSolidAt(this.args.x,this.args.y)?(this.args.y+=this.args.height+1,this.args.ySpeed=Math.abs(this.args.ySpeed)||8):this.dropped&&!this.attract&&this.getMapSolidAt(this.args.x+this.args.xSpeed*this.args.direction,this.args.y+-8,!1)&&(this.args.xSpeed*=-1),!this.dropped&&!this.scattered||this.args.falling&&this.args.ySpeed||(this.args.ySpeed=Math.min(.75*-Math.abs(this.args.ySpeed||this.ySpeedLast||0),t>6?-2:0),this.args.gSpeed=0,this.args.x+=this.args.xSpeed,this.args.y+=this.args.ySpeed,this.args.falling=!0,this.args.groundAngle=0))}callCollideHandler(t){return!(t instanceof l)&&super.callCollideHandler(t)}collideA(t){if(t instanceof this.constructor)return;if(!this.viewport||this.args.gone||this.args.ignore)return!1;const e=this.viewport.args.frameId-this.startFrame;if(this.dropped&&e<this.args.delay)return!1;if(t.args.owner&&(t=t.args.owner),t.occupant&&(t=t.occupant),!t.controllable&&!t.occupant&&!t.args.owner)return!1;super.collideA(t),t.controllable&&(t.args.rings+=1),this.args.gone=!0,this.viewport.auras.delete(this),this.args.static=!0,this.args.float=-1,this.args.type="actor-item actor-ring collected",this.args.xSpeed=0,this.args.ySpeed=0,this.viewport.args.audio&&a.Sfx.play("RING_COLLECTED"),this.viewport.onFrameOut(5,()=>{this.args.type="actor-item actor-ring collected gone"});this.args.x,this.args.y,this.viewport;this.viewport.onFrameOut(4200,()=>{this.restore=!0}),t.collect&&("function"==typeof ga&&n.Analytic.report({eventCategory:"ring",eventAction:"collected",eventLabel:`${this.viewport.args.actName}::${this.args.id}`}),this.viewport.onFrameOut(1,()=>{t.collect(this)}))}wakeUp(){this.def&&this.restore&&(this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.gone=this.restore=!1,this.args.type="actor-item actor-ring")}get solid(){return!1}get rotateLock(){return!0}}t.Ring=l}),require.register("actor/RoadBarrier.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoadBarrier=void 0;var i=e("./PointActor");t.RoadBarrier=class extends i.PointActor{constructor(){super(...arguments),this.args.width=this.args.width||64,this.args.height=this.args.height||32,this.args.type="actor-item actor-road-barrier",this.args.z=0}get solid(){return!1}}}),require.register("actor/Rocket.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rocket=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("../audio/Sfx");t.Rocket=class extends i.PointActor{constructor(){var t,e;super(...arguments),this.args.width=64,this.args.height=16,this.args.xMax=null!==(t=this.args.xMax)&&void 0!==t?t:24,this.args.yMax=null!==(e=this.args.yMax)&&void 0!==e?e:24,this.args.type="actor-item actor-rocket",this.args.launched=!1,this.args.bindTo(["xSpeed","ySpeed"],t=>{!t&&this.args.launched&&this.explode()})}update(){this.viewport&&(this.thrusterSound?(this.thrusterSound.volume=.2+-.05*Math.random(),this.thrusterSound.currentTime>1.5&&(this.thrusterSound.currentTime=.5)):this.thrusterSound=new Audio("/Sonic/mecha-sonic-thruster.wav"),super.update(),this.args.launched&&Math.abs(this.args.xSpeed)<Math.abs(this.args.xMax)&&(this.args.xSpeed+=.5*Math.sign(this.args.xMax)),this.args.launched&&Math.abs(this.args.ySpeed)<Math.abs(this.args.yMax)&&(this.args.ySpeed-=.5*Math.sign(this.args.yMax)),this.args.launched&&0===this.args.xSpeed&&0===this.args.ySpeed&&this.explode())}activate(){this.viewport.auras.add(this),this.viewport.args.audio&&this.thrusterSound&&this.thrusterSound.play(),this.args.launched=!0,this.args.xMax&&(this.args.xSpeed+=.5),this.args.yMax&&(this.args.ySpeed-=.5)}sleep(){this.args.launched&&this.explode()}wakeUp(){}explode(){const t=this.viewport;if(!t)return;a.Sfx.play("OBJECT_DESTROYED"),this.thrusterSound&&this.thrusterSound.pause();const e=new r.Tag('<div class = "particle-explosion">');e.style({"--x":this.x,"--y":this.y-8}),t.particles.add(e),setTimeout(()=>t.particles.remove(e),512),this.args.xSpeed=0,this.args.ySpeed=0,this.args.opacity=0,this.args.launched=!1,this.viewport.setColCell(this),this.viewport.onFrameOut(60,()=>{});const s=new CustomEvent("exploded",{detail:{actor:this}});this.dispatchEvent(s),this.args.launched=!1,this.args.opacity=1,this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.viewport.auras.delete(this)}}}),require.register("actor/RocketPlatform.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RocketPlatform=void 0;var i=e("./Block");e("../audio/Sfx");t.RocketPlatform=class extends i.Block{constructor(){super(...arguments),this.args.width=96,this.args.height=64,this.args.platform=1,this.args.type="actor-item actor-rocket-platform",this.args.static=0,this.args.activeTime=0}update(){this.args.cameraBias=.25,this.standingUnder.size?(this.args.activeTime++,this.args.active=!0):(this.args.activeTime=0,this.args.active=!1);for(const t of this.standingUnder)t.args.dead?(this.args.ySpeed=0,this.standingUnder.delete(t)):this.args.falling||(t.args.y=Math.round(t.args.y));super.update(),this.args.activeTime>1&&(this.args.ySpeed-=.1,this.args.float=1,this.args.falling||(this.args.falling=!0,this.args.ySpeed=-1,this.args.y--))}collideA(t,e){return 0!==e?super.collideA(t,e):t.controllable?(this.args.ySpeed-=.1,this.args.float=1,this.args.ySpeed<-3&&(this.args.ySpeed=-3),super.collideA(t,e)):super.collideA(t,e)}}}),require.register("actor/Rocks.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rocks=void 0;var i=e("./PointActor"),r=e("../actor/Projectile"),a=e("curvature/base/Tag"),n=e("../audio/Sfx");t.Rocks=class extends i.PointActor{constructor(t,e){super(t,e),this.args.type="actor-item actor-rocks-tall",this.args.width=48,this.args.height=80,this.gone=!1,this.particleA=new a.Tag('<div class = "particle-rock">'),this.particleB=new a.Tag('<div class = "particle-rock">'),this.particleC=new a.Tag('<div class = "particle-rock">'),this.particleD=new a.Tag('<div class = "particle-rock">'),this.particleE=new a.Tag('<div class = "particle-rock">'),this.particleF=new a.Tag('<div class = "particle-rock">'),this.particleG=new a.Tag('<div class = "particle-rock">'),this.particleH=new a.Tag('<div class = "particle-rock">')}onRendered(t){super.onRendered(t);let e=-1;const s=this.particleA,i=this.particleB,r=this.particleC,a=this.particleD,n=this.particleE,o=this.particleF,l=this.particleG,h=this.particleH;s.style({"--x":this.x-8,"--y":this.y-8,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":40,"z-index":0}),e*=-1,i.style({"--x":this.x+8,"--y":this.y-0,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":40,"z-index":0}),e*=-1,r.style({"--x":this.x,"--y":this.y-18,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":44,"z-index":0}),e*=-1,a.style({"--x":this.x+8,"--y":this.y-10,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":44,"z-index":0}),e*=-1,n.style({"--x":this.x-8,"--y":this.y-28,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":48,"z-index":0}),e*=-1,o.style({"--x":this.x+8,"--y":this.y-20,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":48,"z-index":0}),e*=-1,l.style({"--x":this.x-8,"--y":this.y-30,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":48,"z-index":0}),e*=-1,h.style({"--x":this.x+8,"--y":this.y-30,"--fallSpeed":1550+20*Math.random(),"--xMomentum":60*e+20*Math.random(),"--yMomentum":65,"z-index":0})}collideA(t,e){return!(this.args.gone||(super.collideA(t,e),t.occupant||t.args.rolling||t.punching?(this.pop(t),1):2!==e&&(!this.args.falling||-1===this.args.float)&&t.args.ySpeed>0&&t.y<this.y&&this.viewport&&!this.args.gone?(this.args.falling&&Math.abs(t.args.ySpeed)>0&&(t.args.xSpeed*=-1),this.pop(t),1):(1===e||3===e)&&t instanceof r.Projectile&&this.viewport&&!this.args.gone&&(this.pop(t),1)))}pop(t){this.args.gone=!0;const e=this.viewport;if(!e)return;n.Sfx.play("ROCKS_DESTROYED");const s=this.particleA,i=this.particleB,r=this.particleC,a=this.particleD,o=this.particleE,l=this.particleF,h=this.particleG,g=this.particleH;e.particles.add(s),e.particles.add(i),e.particles.add(r),e.particles.add(a),e.particles.add(o),e.particles.add(l),e.particles.add(h),e.particles.add(g),setTimeout(()=>{e.particles.remove(s),e.particles.remove(i),e.particles.remove(r),e.particles.remove(a),e.particles.remove(o),e.particles.remove(l),e.particles.remove(h),e.particles.remove(g)},2500),this.onNextFrame(()=>e.actors.remove(this))}get canStick(){return!1}get solid(){return!this.args.gone}}}),require.register("actor/RollingSign.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RollingSign=void 0;var i=e("./PointActor");t.RollingSign=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}constructor(){var t;super(...arguments),this.args.width=20,this.args.height=null!==(t=this.args.height)&&void 0!==t?t:80,this.args.type="actor-item actor-rolling-sign"}get solid(){return!1}}}),require.register("actor/Scratch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scratch=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.Scratch=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-scratch",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=32,this.args.height=39,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:20,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:120,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-color"]="color"}update(){this.args.direction,this.args.shotTelegraph,this.args.patrolBeat,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.direction=Math.sign(this.args.gSpeed)}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Sean.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sean=void 0;var i=e("./PointActor"),r=(e("curvature/base/Tag"),e("../behavior/SkidDust"));t.Sean=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new r.SkidDust),this.args.type="actor-item actor-sean",this.args.normalHeight=35,this.args.rollingHeight=28,this.args.accel=.25,this.args.decel=.4,this.args.gSpeedMax=18,this.args.jumpForce=11,this.args.gravity=.5,this.args.width=18,this.args.height=35}onRendered(t){super.onRendered(t),this.box=this.findTag("div")}update(){const t=this.args.falling;if(this.box){if(t)this.args.jumping&&this.box.setAttribute("data-animation","jumping");else{this.yAxis>0?this.args.crouching=!0:this.args.crouching=!1;const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;this.args.rolling?this.box.setAttribute("data-animation","rolling"):Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.box.setAttribute("data-animation","standing"):s>.25*i?this.box.setAttribute("data-animation","running"):this.args.moving&&e?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")}super.update()}else super.update()}get solid(){return!1}get canRoll(){return!0}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/SeeSaw.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeeSaw=void 0;var i=e("./PointActor"),r=e("./Ring"),a=e("curvature/base/Tag");Symbol("Side");t.SeeSaw=class extends i.PointActor{constructor(t,e){var s,i;super(t,e),this.args.width=96,this.args.height=32,this.noClip=!0,this.args.float=-1,this.args.power=null!==(s=this.args.power)&&void 0!==s?s:20,this.tiltTime=0,this.args.power=null!==(i=this.args.power)&&void 0!==i?i:12,this.args.type="actor-item actor-see-saw",this.args.bindTo("tilt",t=>{this.args.type=`actor-item actor-see-saw ${t}`,this.tiltTime=0})}onRendered(t){super.onRendered(t),this.hub||(this.hub=new a.Tag('<div class = "see-saw-hub">'),this.box.appendChild(this.hub.node))}collideA(t,e){if(!(t instanceof r.Ring)&&t.args.falling&&!(t.args.ySpeed<=0)&&(t.args.groundAngle=0,Math.abs(t.x-this.x)>4)){const e=Math.sign(t.x-this.x);this.reflectImpulse(t,e*t.args.weight*Math.abs(t.args.ySpeed)),t.x<this.x?(this.tiltClass="tilt-left",this.tilt=-1):t.x>this.x&&(this.tiltClass="tilt-right",this.tilt=1),this.args.tilt=this.tiltClass}}reflectImpulse(t,e){this.reflectObject&&this.reflectObject.args.falling&&!t.args.falling||this.tilt!==Math.sign(e)&&(this.reflectObject=t,this.reflectForce=e)}update(){this.tiltTime++,super.update()}updateEnd(){super.updateEnd();const t=this.viewport.collisions.get(this);if(!t)return this.reflectObject=null,void(this.reflectForce=0);for(const e of t.keys()){if(e.args.falling)continue;e.args.groundAngle=0;const t=e.x-this.x,s=Math.abs(t/(this.args.width/2)),i=Math.sign(t);if(!this.reflectForce||i===Math.sign(this.reflectForce))continue;if(Math.abs(t)<4)continue;s<.75&&(e.args.x+=t/2,e.args.y-=8);const r=Math.abs(this.reflectForce/e.args.weight),a=Math.min(1,Math.ceil(3*s)/3);e.args.gSpeed=0,e.args.xSpeed=0,e.args.ySpeed=Math.min(-6.5,-r*a*1.2),e.args.y-=16,e.args.falling=!0}this.reflectObject=null,this.reflectForce=0}}}),require.register("actor/Seymour.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Seymour=void 0;var i=e("./PointActor"),r=(e("curvature/base/Tag"),e("./Spring")),a=e("../behavior/SkidDust");t.Seymour=class extends i.PointActor{constructor(){super(...arguments),this.behaviors.add(new a.SkidDust),this.args.type="actor-item actor-seymour",this.args.spriteSheet=this.spriteSheet="/secret/seymour-color-corrected.png",this.superSpriteSheet="/secret/super-seymour.png",this.args.normalHeight=44,this.args.rollingHeight=23,this.args.accel=.25,this.args.decel=.4,this.args.gSpeedMax=18,this.args.jumpForce=11,this.args.gravity=.5,this.args.width=18,this.args.height=32}onRendered(t){super.onRendered(t),this.box=this.findTag("div")}update(){const t=this.args.falling;if(this.box){if(t)this.args.jumping&&(this.args.animation="jumping");else{this.springing=!1,this.yAxis>0?this.args.crouching=!0:this.args.crouching=!1;const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;this.args.rolling?this.args.animation="rolling":Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.args.animation="standing":s>.5*i?this.args.animation="running":this.args.moving&&e?this.args.animation="walking":this.args.animation="standing"}this.args.falling&&this.springing&&(this.args.groundAngle=0,this.args.animation="springing"),super.update()}else super.update()}command_3(){this.isSuper=!this.isSuper,this.onTimeout(150,()=>{0===this.args.rings&&this.setProfile()}),this.setProfile()}setProfile(){this.isSuper?this.args.spriteSheet=this.superSpriteSheet:this.args.spriteSheet=this.spriteSheet}collideA(t){t instanceof r.Spring&&this.onNextFrame(()=>{this.args.falling&&(this.springing=!0,this.args.animation="springing")})}get solid(){return!1}get canRoll(){return!0}get isEffect(){return!1}get controllable(){return!0}}}),require.register("actor/Signpost.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signpost=void 0;var i=e("../ui/CharacterString"),r=e("./PointActor"),a=e("curvature/base/Tag");t.Signpost=class extends r.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-signpost",this.args.width=48,this.args.height=256,this.args.active=!1,this.args.follow=!1,this.args.activeTime=0,this.cleared=!1,this.willActivate=!1,this.clearedBy=null}collideA(t){if(!t.controllable||this.args.active)return;if(this.willActivate=!0,this.viewport.onFrameOut(10,()=>{this.args.active=!0,this.clearedBy=t}),this.following)return;this.viewport.clearCheckpoints(),!this.finishReward&&t.args.popChain.length&&(this.finishReward={label:"Big Finish",points:1e3,multiplier:1,color:"orange"},t.args.popChain.push(this.finishReward));const e=(t.args.gSpeed||t.args.xSpeed)/32*60*3;t.args.clearSpeed=Math.abs(e),this.args.charStrings.push(new i.CharacterString({value:`Speed: ${e.toFixed(2)} ft/sec`})),this.following=t,this.args.falling=!0,this.args.follow=!0,this.args.xSpeed=1.1*(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed=-7,this.args.y--}clear(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.cleared=!0,t.totalCombo(),this.box.setAttribute("data-cleared-by",t.args.name),this.tally=this.viewport.clearAct(`${t.args.name} GOT THROUGH\n${this.viewport.args.actName}`,e),this.viewport.onFrameOut(30,()=>{this.args.follow=!1,this.args.boss}),this.viewport.onFrameOut(600,()=>{if(!this.args.boss)return;const e=this.viewport.actorsById[this.args.boss];this.viewport.auras.add(e),e.args.x=this.x+(this.x<125e3?768:-768),e.args.y=this.y-144,this.viewport.controlActor&&this.viewport.controlActor.args.jumpForce<10.5&&(e.args.y+=48),e.args.phase="intro",t.args.clearSpeed=0})}update(){if(this.args.active&&this.args.activeTime++,this.args.follow){const t=this.following;!t.skidding||t.args.rolling||t.args.falling||(this.args.xStart||(this.skidLabel=new i.CharacterString({value:"Skid: 0"}),this.args.xStart=this.x,this.args.charStrings.push(this.skidLabel)),this.args.dragged=Math.trunc(Math.abs(this.args.xStart-this.x)),this.skidLabel.args.value=`Skid: ${this.args.dragged}`,t.args.dragBonus=this.args.dragged);const e=Math.max(this.x,this.viewport.controlActor.x+-160);if(e!==this.x){if(!this.args.falling){const t=new a.Tag('<div class = "particle-dust">'),e=this.rotatePoint(this.args.gSpeed,0);t.style({"--x":e[0]+this.x+-4,"--y":e[1]+this.y,"z-index":0,opacity:2*Math.random()});const s=this.viewport;s.particles.add(t),s.onFrameOut(30,()=>s.particles.remove(t))}for(t.args.rolling=!1,this.args.x=e;this.getMapSolidAt(this.x,this.y-1);)this.args.y--}}super.update(),this.args.active&&!this.cleared&&this.clear(this.clearedBy)}get rotateLock(){return!0}}}),require.register("actor/SkateBoard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkateBoard=void 0;var i=e("./SnowBoard"),r=e("curvature/base/Tag");t.SkateBoard=class extends i.SnowBoard{constructor(){super(...arguments),this.args.height=10,this.args.width=12,this.args.seatHeight=12,this.sparks=new Set,this.args.accelOrig=.5,this.args.decelOrig=.6,this.args.decel=.6,this.args.accel=.8,this.args.gravity=.65,this.args.skidTraction=.85,this.args.jumpForce=12.5,this.args.type="actor-item actor-snow-board actor-skate-board",this.args.trick=null,this.args.seatAngle=0,this.args.gSpeedMax=18,this.trickTimer=0,this.flipReward=!1,this.args.rotated=0,this.canGrind=!0,this.fakie=!1,this.silentSkid=!0,this.bindTo("occupant",t=>{t&&(this.args.gSpeed=t.xSpeedLast||0)}),this.args.bindTo("trick",t=>{if(!this.args.falling&&"manual"!==t)return;if(!t||this.args.grinding)return;const e={label:"",points:100,multiplier:1};switch(t){case"insult":e.label=(this.fakie?"fakie ":"")+"leanback",this.occupant.args.popChain.push(e),this.occupant.args.popCombo+=1;break;case"handstand":e.label=(this.fakie?"fakie ":"")+"handstand",this.occupant.args.popChain.push(e),this.occupant.args.popCombo+=1;break;case"manual":this.occupant.args.popCombo&&(e.label=(this.fakie?"fakie ":"")+"manual",this.occupant.args.popChain.push(e),this.occupant.args.popCombo+=1)}})}update(){if(this.args.falling?(this.args.jumping&&1===this.fallTime&&(this.args.groundAngle+=Math.PI/8),this.args.rolling=!1):this.args.rolling=1===this.args.mode&&this.args.gSpeed>0||3===this.args.mode&&this.args.gSpeed<0||Math.sign(this.args.gSpeed)===Math.sign(this.args.direction)&&!this.xAxis,this.args.falling||(this.flipReward=!1),this.occupant?(this.args.width=24,this.args.height=40):(this.args.width=64,this.args.height=12),this.trickTimer>0?this.trickTimer--:(this.args.trick=null,this.trickTimer=0),super.update(),this.args.falling?this.args.rotated=this.args.groundAngle:this.fakie=this.args.reversing,this.occupant&&!this.trickTimer&&!this.args.grinding&&this.groundTime>1&&"manual"!==this.args.trick&&(this.occupant.totalCombo(),this.args.trick=null),this.ridingAnimation=this.args.gSpeed||this.args.xSpeed||this.args.ySpeed?"grinding":"standing",this.idleTime>30&&(this.ridingAnimation="idle"),this.crouching=!1,this.yAxis>.55&&!this.args.falling&&(this.ridingAnimation="grinding-crouching",this.crouching=!0),this.args.accel=this.args.accelOrig,this.args.decel=this.args.decelOrig,this.crouching&&(this.args.decel=.1),this.args.animation="idle-2","handstand"===this.args.trick&&(this.ridingAnimation="handstand",(this.trickTimer>20||this.trickTimer<10)&&(this.ridingAnimation="flip")),!this.args.grinding&&this.grindReward&&(this.grindReward=null),this.args.grinding){if(this.ridingAnimation="board-grinding",this.args.animation="grinding",this.occupant&&this.occupant.args.popCombo)if(this.grindReward)this.grindReward.points+=10;else{const t={label:(this.fakie?"fakie ":"")+"rail grind",points:100,multiplier:1};this.grindReward=t,this.occupant.args.popChain.push(t),this.occupant.args.popCombo+=1}}else"manual"!==this.args.trick||this.args.falling?"insult"===this.args.trick&&(this.ridingAnimation="insult"):(this.ridingAnimation="manual",this.args.animation="manual");if(this.args.grinding&&!this.args.falling){const t=document.createElement("div");t.classList.add("particle-sparks");const e=new r.Tag(t),s=document.createElement("div");s.classList.add("envelope-sparks");const i=new r.Tag(s);i.appendChild(e.node);const a=this.rotatePoint(17.5*this.args.direction,8),n=Math.sign(this.args.gSpeed);i.style({"--x":a[0]+this.args.x,"--y":a[1]+this.args.y+-3*Math.random(),"z-index":0,"animation-delay":.25*-Math.random()+"s","--xMomentum":Math.max(Math.abs(this.args.gSpeed),4)*n,"--flip":n,"--angle":this.realAngle,opacity:2*Math.random()}),i.particle=e,this.viewport.particles.add(i),this.sparks.add(i);const o=this.viewport;this.viewport.onFrameOut(30,()=>{o.particles.remove(i),this.sparks.delete(i)})}}command_1(){this.args.grinding||this.trickTimer>10||(this.args.trick="insult",this.trickTimer=30)}hold_1(){this.trickTimer>10||"insult"!==this.args.trick||(this.trickTimer=Math.max(15,this.trickTimer),this.idleTime=10)}release_1(){"insult"===this.args.trick&&(this.args.trick="insult",this.trickTimer=10)}command_2(){this.trickTimer>10||(this.args.trick="handstand",this.trickTimer=30)}hold_2(){this.trickTimer>10||"handstand"!==this.args.trick||(this.args.trick="handstand",this.trickTimer=Math.max(15,this.trickTimer),this.idleTime=10)}release_2(){"handstand"===this.args.trick&&(this.trickTimer=10)}command_3(){this.args.grinding||this.args.trick&&this.args.falling&&"manual"!==this.args.trick||this.trickTimer>10||(this.args.trick="manual",this.trickTimer=30)}hold_3(){this.args.falling&&"manual"===this.args.trick?this.trickTimer=Math.max(15,this.trickTimer):this.args.falling||"manual"!==this.args.trick||this.trickTimer>10&&"manual"!==this.args.trick||(this.args.trick="manual",this.trickTimer=Math.max(15,this.trickTimer),this.idleTime=10)}release_3(){"manual"===this.args.trick&&(this.args.trick="manual",this.trickTimer=10)}}}),require.register("actor/Skorp.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Skorp=void 0;var i=e("curvature/base/Tag"),r=(e("./Flickie"),e("curvature/base/Mixin")),a=e("./PointActor"),n=e("../behavior/Patrol"),o=e("../mixin/CanPop"),l=e("../actor/Projectile"),h=e("../audio/Sfx");t.Skorp=class extends(r.Mixin.from(a.PointActor,o.CanPop)){constructor(){var t,e,s,i;super(...arguments),this.behaviors.add(new n.Patrol),this.args.type="actor-item actor-skorp",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.args.color=null!==(t=this.args.color)&&void 0!==t?t:"green",this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(e=this.args.patrolPause)&&void 0!==e?e:20,this.args.patrolBeat=null!==(s=this.args.patrolBeat)&&void 0!==s?s:120,this.args.patrolSpeed=null!==(i=this.args.patrolSpeed)&&void 0!==i?i:1,this.args.segmentCount=5,this.args.segmentAngle=Math.PI/2,this.aggroCount=0,this.coolDown=0,this.args.shooting=0}onRendered(){if(super.onRendered(),this.autoAttr.get(this.box)["data-color"]="color",this.autoAttr.get(this.box)["data-shooting"]="shooting",this.autoAttr.get(this.box)["data-aiming"]="aimDirection",this.autoStyle.get(this.box)["--segments"]="segmentCount",this.autoStyle.get(this.box)["--segmentAngle"]="segmentAngle",this.autoStyle.get(this.box)["--aim-direction"]="aimDirection",this.autoStyle.get(this.box)["--tail-angle"]="tailAngle",!this.tail){this.tail=new i.Tag('<div class = "tail">');const t=[new i.Tag('<div   class = "segment" style = "--index:0">'),new i.Tag('<div class = "segment" style = "--index:1">'),new i.Tag('<div class = "segment" style = "--index:2">'),new i.Tag('<div class = "segment" style = "--index:3">'),new i.Tag('<div class = "segment" style = "--index:4">'),new i.Tag('<div class = "end gun" style = "--index:5">')];let e;for(const s of t)e?e.append(s.node):this.tail.append(s.node),e=s;this.box.appendChild(this.tail.node)}}update(){this.args.direction,this.args.shotTelegraph,this.args.patrolBeat,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing"));const t=this.castRayQuick(256,Math.PI,[0,-16],!1)||256,e=this.castRayQuick(256,0,[0,-16],!1)||256,s=this.viewport.actorsAtLine(this.x,this.y-16,this.x-t,this.y+-16),i=this.viewport.actorsAtLine(this.x,this.y-16,this.x+e,this.y+-16),r=[...s.keys()].filter(t=>t.controllable),a=[...i.keys()].filter(t=>t.controllable);if(r.length?this.args.aimDirection=-1:a.length?this.args.aimDirection=1:this.args.aimDirection=0,this.args.aimDirection?(this.args.aimDirection!==this.args.direction?this.args.tailAngle=-19*this.args.aimDirection:this.args.tailAngle=-21*this.args.aimDirection,this.coolDown=30,this.aggroCount++):(this.coolDown<=0?(this.args.tailAngle=-8*this.args.direction,this.args.gSpeed||(this.args.tailAngle=0)):this.coolDown--,this.aggroCount=0),this.aggroCount>20)if(this.args.aimDirection!==this.args.direction){const t=new l.Projectile({x:this.args.x+60*this.args.aimDirection,y:this.args.y-28,xSpeed:4*this.args.aimDirection,ySpeed:.55,float:-1,owner:this});this.viewport.spawn.add({object:t}),this.aggroCount=10,this.args.shooting=6,h.Sfx.play("SHOT_FIRED")}else{const t=new l.Projectile({x:this.args.x+54*this.args.aimDirection,y:this.args.y-42,xSpeed:4*this.args.aimDirection,ySpeed:.55,float:-1,owner:this});this.viewport.spawn.add({object:t}),this.aggroCount=10,this.args.shooting=6,h.Sfx.play("SHOT_FIRED")}else this.args.shooting>0&&this.args.shooting--;super.update(),this.args.direction=Math.sign(this.args.gSpeed)||this.args.direction}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Skull.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Skull=void 0;var i=e("./PointActor");t.Skull=class extends i.PointActor{constructor(){super(...arguments),this.args.width=17,this.args.height=15,this.args.type="actor-item actor-skull",this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),t)this.cX=t.args.bindTo("x",e=>this.args.x=e+8*t.args.direction),this.cY=t.args.bindTo("y",t=>this.args.y=t+-16),t.carrying.add(this),this.args.float=-1;else if(this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,t.carrying.delete(this),this.args.falling=!0,this.args.float=0}})}lift(t){this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null}get solid(){return!1}}}),require.register("actor/SlotMachine.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SlotMachine=void 0;var i=e("curvature/base/Tag"),r=e("../audio/Sfx"),a=e("./PointActor"),n=e("./Ring"),o=e("./AntiRing");t.SlotMachine=class extends a.PointActor{constructor(){super(...arguments),this.args.width=96,this.args.height=32,this.args.type="actor-item actor-slot-machine",this.args.float=-1}onRendered(t){super.onRendered(t),this.boxes||(this.boxes=[new i.Tag('<div class = "slot-panel slot-panel-a">'),new i.Tag('<div class = "slot-panel slot-panel-b">'),new i.Tag('<div class = "slot-panel slot-panel-c">')],this.boxes.forEach(t=>this.box.appendChild(t.node)))}dropDelay(t){if(!t.controllable)return;this.args.type="actor-item actor-slot-machine actor-slot-machine-rolling";const e=Symbol,s=Array(8).fill(0);return this.boxes.map(t=>{t[e]=t[e]||0;const s=32+t[e]+Math.floor(8*Math.random());return t.style({"--scrollTo":32*s+"px"}),t[e]=s,t[e]%8}).forEach(t=>s[t]++),new Promise(e=>{this.viewport.onFrameOut(85,()=>(this.args.type="actor-item actor-slot-machine",1===s[0]?(this.onTimeout(30,()=>r.Sfx.play("FAIL")),t.args.rings>50?this.punish(t,10).then(e):e()):2===s[0]?this.punish(t,50).then(e):3===s[0]?t.args.rings>0?(t.args.rings=0,e()):this.punish(t,100).then(e):2===s[5]?this.reward(t,25).then(e):3===s[5]?this.reward(t,100).then(e):2===s[6]?this.reward(t,50).then(e):3===s[6]?this.reward(t,75).then(e):2===s[7]?this.reward(t,15).then(e):3===s[7]?this.reward(t,20).then(e):3===s[2]||3===s[3]||3===s[4]?this.reward(t,50).then(e):1===s[1]?this.reward(t,2).then(e):2===s[1]?this.reward(t,30).then(e):3===s[1]?this.reward(t,60).then(e):void e()))})}reward(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const s=this.viewport;let i=-1.57;for(let r=0;r<e;r++){const e=Math.cos(i),a=Math.sin(i),o=new n.Ring({x:t.x+288*e,y:t.y+288*a,xSpeed:7*-e,ySpeed:7*-a,static:!1,reward:!0,noClip:!0,float:-1});o.noClip=!0,s.spawn.add({object:o,frame:3*r+s.args.frameId}),i+=Math.PI+(r%2?.3:0)}return new Promise(t=>s.onFrameOut(3*(16+e),()=>t()))}punish(t,e){r.Sfx.play("FAIL");const s=this.viewport;let i=-1.57;for(let r=0;r<e;r++){const e=Math.cos(i),a=Math.sin(i),n=new o.AntiRing({x:t.x+288*e,y:t.y+288*a,xSpeed:7*-e,ySpeed:7*-a,static:!1,reward:!0,noClip:!0,float:-1});s.spawn.add({object:n,frame:3*r+s.args.frameId}),i-=Math.PI+(r%2?.3:0)}return new Promise(t=>s.onFrameOut(3*(16+e),()=>t()))}get solid(){return!1}}}),require.register("actor/SnailBot.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnailBot=void 0;var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.SnailBot=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-snailbot",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:20,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:100,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1}update(){super.update(),this.args.moving&&this.args.gSpeed?this.args.animation="walking":this.args.animation="standing",this.args.direction=Math.sign(this.args.gSpeed)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/SnowBoard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnowBoard=void 0;var i=e("./Vehicle"),r=(e("curvature/base/Tag"),e("../behavior/SkidDust"));t.SnowBoard=class extends i.Vehicle{constructor(){super(...arguments),this.behaviors.add(new r.SkidDust("particle-dust")),this.args.type="actor-item actor-snow-board",this.args.width=24,this.args.height=32,this.removeTimer=null,this.args.gSpeedMax=15,this.args.decel=.25,this.args.accel=.75,this.args.gravity=.75,this.args.seatHeight=1,this.args.skidTraction=.5,this.args.jumpForce=9.5,this.dustCount=0,this.args.particleScale=2,this.args.started=!1,this.ridingAnimation="grinding",this.dustDist=-16,this.dustFreq=1,this.broad=!0,this.slowSpin=!0,this.addEventListener("jump",t=>{this.args.groundAngle+=.125*Math.PI*Math.sign(this.args.gSpeed||this.args.direction)})}update(){this.originalSpeed=this.args.gSpeed||this.args.xSpeed,super.update(),this.occupant&&(this.args.z=this.occupant.args.z-1),0===this.args.gSpeed&&0===this.args.xSpeed||(this.sprite.classList.add("moving"),this.args.started=!0)}get solid(){return!this.occupant}}}),require.register("actor/Sonic.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sonic=void 0;var i=e("./PointActor"),r=e("../behavior/Platformer"),a=e("../audio/Sfx"),n=e("curvature/base/Tag"),o=e("curvature/base/View"),l=(e("../effects/Twist"),e("../effects/Pinch"),e("../sprite/Png")),h=e("./Ring"),g=e("./Spring"),c=(e("../powerups/FireSheild"),e("../powerups/BubbleSheild"),e("../powerups/ElectricSheild"),e("../region/GrindingRegion")),d=e("./Marker"),u=e("../behavior/SkidDust"),p=e("../behavior/SuperForm"),f=e("../behavior/EmeraldHalo"),m=e("../lib/Color");e("curvature/base/Router");function v(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const y=0;t.Sonic=class extends i.PointActor{constructor(){super(...arguments),v(this,"png",new l.Png("/Sonic/sonic.png")),window.sonic=this,this.behaviors.add(new u.SkidDust),this.behaviors.add(new p.SuperForm),this.behaviors.add(new f.EmeraldHalo),this.args.canonical="Sonic",this.args.type="actor-sonic actor-item",this.accelNormal=.15,this.accelSuper=.24,this.markers=new Set,this.springing=!1,this.args.boltCount=0,this.args.accel=this.accelNormal,this.args.decel=.4,this.gSpeedMaxNormal=18,this.gSpeedMaxSuper=20,this.gSpeedMaxHyper=23,this.jumpForceNormal=11,this.jumpForceSuper=13,this.jumpForceHyper=15,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.gravity=.5,this.args.width=16,this.args.height=40,this.args.normalHeight=40,this.args.rollingHeight=28,this.sparks=new Set,this.spindashCharge=0,this.dropDashCharge=0,this.willStick=!1,this.stayStuck=!1,this.lightDashed=!0,this.dashed=!1,this.airControlCard=o.View.from(e("../cards/sonic-air-controls.html")),this.controlCard=o.View.from(e("../cards/sonic-controls.html")),this.moveCard=o.View.from(e("../cards/basic-moves.html")),this.args.spriteSheet=this.spriteSheet="/Sonic/sonic.png",this.hyperSheet=0,this.costumes={Santiago:{h:-30,s:1.5,v:1.25},Sequel:{h:-10,s:1.5,v:1.25},White:{h:0,s:0,v:1.25},RedHot:{h:115,s:1.75,v:1},Brown:{h:125,s:1.15,v:.5}},this.args.bindTo("falling",t=>{t||(!this.willStick||1!==this.args.mode&&3!==this.args.mode?this.onNextFrame(()=>{this.args.wallSticking=!1}):(this.args.wallSticking=!0,this.onNextFrame(()=>{this.dashed=!1})))}),this.transformTime=0,this.args.minRingsSuper=50,this.args.minRingsHyper=75}shiftColor(t,e,s,i){return new m.Color(t).rotate(e,s,i)}onRendered(t){super.onRendered(t);const e={"8080e0":"e0e080","6060c0":"e0e000","4040a0":"e0e001",202080:"a0a000"},s={"8080e0":"fcfcfc","6060c0":"fcfcfc","4040a0":"fcd8d8",202080:"fcb4b4"},i={"8080e0":"fcfcfc","6060c0":"fcfcfc","4040a0":"fcd8fc",202080:"d8b4d8"},r={"8080e0":"d8fcfc","6060c0":"fcfcfc","4040a0":"b4d8fc",202080:"90b4fc"},a={"8080e0":"d8d8ff","6060c0":"b4b4d8","4040a0":"a4a4d8",202080:"6c6cb4"},o={"8080e0":"d8fcfc","6060c0":"d8fcd8","4040a0":"b4fcb4",202080:"00fc24"},l={"8080e0":"d8fcfc","6060c0":"d8fcb4","4040a0":"d8fc48",202080:"d8d800"},h={"8080e0":"ffffff","6060c0":"fcfcfc","4040a0":"d8d8d8",202080:"b4b4b4"};this.rotatedSpriteSheet=this.spriteSheet;const g=()=>{var t,e,s;let i=Number(null!==(t=this.viewport.customColor.h)&&void 0!==t?t:0),r=Number(null!==(e=this.viewport.customColor.s)&&void 0!==e?e:1),a=Number(null!==(s=this.viewport.customColor.v)&&void 0!==s?s:1);this.rotateMainColor(i,r,a),this.box.node.style.setProperty("--sprite-sheet",`url(${this.args.rotatedSpriteSheet})`)},c=this.viewport.customColor.bindTo("h",g,{wait:0}),d=this.viewport.customColor.bindTo("s",g,{wait:0}),u=this.viewport.customColor.bindTo("v",g,{wait:0});if(this.onRemove(c),this.onRemove(d),this.onRemove(u),this.viewport.args.networked)if(this.args.netplayer){const t="Santiago";Object.assign(this.viewport.customColor,this.costumes[t])}else{const t="Sequel";Object.assign(this.viewport.customColor,this.costumes[t])}else this.viewport.args.mainPallet&&this.costumes[this.viewport.args.mainPallet]&&Object.assign(this.viewport.customColor,this.costumes[this.viewport.args.mainPallet]);this.superSpriteSheetLoader||(this.superSpriteSheetLoader=this.png.ready.then(()=>{const t=this.png.recolor(e);this.superSpriteSheet=t.toUrl()})),this.hyperSpriteSheetLoader||(this.hyperSpriteSheetLoader=this.png.ready.then(()=>this.hyperSpriteSheets=[this.png.recolor(s).toUrl(),this.png.recolor(r).toUrl(),this.png.recolor(i).toUrl(),this.png.recolor(h).toUrl(),this.png.recolor(o).toUrl(),this.png.recolor(a).toUrl(),this.png.recolor(l).toUrl()])),this.arm||(this.arm=new n.Tag('<div class = "rear-arm">'),this.box.appendChild(this.arm.node)),this.swoosh||(this.swoosh=new n.Tag('<div class = "double-spin">'),this.box.appendChild(this.swoosh.node)),this.autoAttr.get(this.box)["data-doublespin"]="doubleSpin"}updateStart(){this.args.grinding&&this.args.falling&&this.args.ySpeed>0&&(this.args.animation="airdash",this.args.grinding=!1),super.updateStart(),this.args.dead&&(this.args.animation="dead")}updateEnd(){!this.args.falling&&this.pinchFilterBg&&this.pinch(0,0),super.updateEnd()}update(){if(this.args.falling&&this.isHyper&&this.dashed&&this.yAxis<-.5&&(this.args.ySpeed-=.6),(!this.args.falling&&this.groundTime>3||this.args.falling&&this.fallTime>90)&&(this.args.trickRamp=!1,this.args.twistRamp=!1),this.args.dead)return this.args.animation="dead",void super.update();if(this.isSuper){const t=this.isHyper?30:60;this.viewport.args.frameId%t==0&&(this.args.rings<2&&(this.isHyper=!1,this.setProfile()),this.args.rings>0?this.args.rings--:(this.isSuper=!1,this.isHyper=!1,this.setProfile()))}this.args.isSuper=this.isSuper,this.args.isHyper=this.isHyper,this.isHyper&&this.viewport.args.frameId%45==0&&(this.args.spriteSheet=this.hyperSpriteSheets[this.hyperSheet++],this.hyperSheet>=this.hyperSpriteSheets.length&&(this.hyperSheet=0)),this.args.falling?(this.args.wallSticking&&!this.dashed&&(1===this.args.mode?(this.args.direction=-1,this.args.facing="left"):3===this.args.mode&&(this.args.direction=1,this.args.facing="right"),this.args.animation="wall-dropping-start",this.onTimeout(150,()=>{this.args.falling&&this.args.wallDropping&&(this.args.animation="wall-dropping")}),this.args.wallDropping=!0,this.args.groundAngle=0,this.args.ignore=30),this.args.wallDropping&&(this.args.groundAngle=0),"hanging"===this.args.animation&&this.args.ySpeed>-3&&(this.args.animation="wall-dropping"),this.args.wallSticking=!1):(this.args.wallDropping=!1,this.swing=!1,this.springing&&(this.args.groundAngle=0),this.springing=!1,this.args.doubleSpin=this.dashed=!1,this.args.mode%2==0&&(this.args.wallSticking=!1),this.args.wallSticking||(this.willStick=!1)),this.lightDashingCoolDown>0&&this.lightDashingCoolDown--,this.dashTimer>0&&this.dashTimer--;const t=this.args.falling;if(t&&(this.args.cameraBias=0),this.args.wallSticking){this.args.animation="wall-stick";let t=3;this.yAxis<0?(this.args.animation="wall-stick-brake",this.stayStuck=!0,t=0):this.yAxis>0&&(t=6),this.args.modeTime<15&&(t=0),1===this.args.mode?(this.args.facing="left",this.args.direction=1,Math.abs(this.args.gSpeed)<t?this.args.gSpeed+=1:this.args.gSpeed=t):3===this.args.mode&&(this.args.facing="right",this.args.direction=-1,Math.abs(this.args.gSpeed)<t?this.args.gSpeed-=1:this.args.gSpeed=-t);const e=Math.ceil(this.args.width/2),s=Math.sign(this.args.gSpeed),i=this.rotatePoint(e*-s,this.args.height);this.getMapSolidAt(this.x+i[0],this.y+i[1])&&this.bMap("doJump",0)}else if(this.lightDashing){const e=Math.sign(this.args.xSpeed)||Math.sign(this.args.gSpeed);e<0?this.args.animation="lightdash-back":e>0&&(this.args.animation="lightdash"),t&&(this.args.direction=Math.sign(this.args.xSpeed)||this.args.direction,this.args.mode=y)}else if(t)this.dashed?t&&!this.args.jumping&&this.isSuper&&this.args.ySpeed>0&&(this.args.animation="dropping",this.onTimeout(150,()=>{this.args.falling&&(this.args.animation="dropping")})):(this.args.height=this.args.rollingHeight,this.args.jumping?this.args.animation="jumping":!this.args.xSpeed&&this.args.ySpeed);else{const t=this.gSpeedMaxNormal/(this.isSuper?2:1),e=this.getLocalFriction(),s=this.args.direction,i=this.args.gSpeed,r=Math.abs(i)/e**2;if(this.args.gSpeedMax,this.dashed=!1,this.lightDashed=!1,this.lightDashReward=null,this.args.height=this.args.normalHeight,this.spindashCharge)if(this.spindashCharge<1)this.spindashCharge=0;else{this.args.animation="spindash",this.spindashCharge-=.2,this.dashDust&&this.dashDust.style({"--dashCharge":this.spindashCharge});let t=this.spindashCharge/20;t>1&&(t=1),this.twist(120*t*this.args.direction)}else if(!this.args.rolling)if(this.args.crouching=!1,e>.5&&Math.sign(s)&&Math.sign(i)&&Math.sign(i)!==Math.sign(s)&&!this.args.antiSkid)this.args.animation="skidding";else if(this.args.moving&&r>.75*t)this.xAxis||e>=.5?this.isSuper&&this.args.moving&&r>1.85*t?this.args.animation="super-run":this.args.moving&&r>2.25*t?this.args.animation="running-4":this.args.moving&&r>1.75*t?this.args.animation="running-3":this.args.moving&&r>1.25*t?this.args.animation="running-2":this.args.animation="running":this.args.animation="sliding";else if(this.args.moving&&this.args.gSpeed)this.xAxis||e>.5?this.args.animation="walking":this.args.animation="sliding";else if(this.xAxis&&0===e)this.args.animation="running",this.args.facing=-1===this.xAxis?"left":"right";else if(this.args.moving&&this.args.gSpeed)this.args.pushing=Math.sign(this.args.gSpeed);else if(this.yAxis>.5&&!this.args.ignore&&!this.carrying.size)this.args.animation="crouching",this.args.crouching=!0,this.args.lookTime--,this.args.lookTime<-45&&(this.args.cameraBias=-.5);else if(this.yAxis&&this.yAxis<-.5&&!this.args.ignore)this.args.animation="looking-up",this.args.lookTime++,this.args.lookTime>45&&(this.args.cameraBias=.25);else{const t=this.viewport.meta.fieldType;this.args.teeter?(this.args.animation="teeter",-1===this.args.teeter&&(this.args.animation="teeter--1"),2===this.args.teeter&&(this.args.animation="teeter-2")):"garden"===t||"adventure"===t?this.args.animation="standing":this.idleTime>18e3?this.args.animation="idle-3":this.idleTime>250?this.args.animation="idle-2":this.idleTime>200?this.args.animation="idle":this.args.animation="standing",this.args.cameraBias=0,this.args.lookTime=0}!this.spindashCharge&&this.dashDust&&(this.dashDust.remove(),this.dashDust=null),this.dropDashCharge&&(this.args.animation="spindash",this.args.rolling=!0)}if(t&&"standing"===this.args.animation&&(this.args.animation="walking"),"skidding"===this.args.animation&&this.fallTime>16&&(Math.abs(this.args.groundAngle)>Math.PI/2?this.args.animation="walking":this.args.animation="skidding-falling"),this.args.hangingFrom?this.args.animation="hanging":this.swing&&(this.args.animation="jumping"),this.args.rolling&&("spindash"!==this.args.animation?this.args.animation="rolling":(this.viewport.onFrameOut(14,()=>this.args.animation="rolling"),this.args.animation="spindash")),!this.skidding||this.args.rolling||this.args.falling||this.spindashCharge)this.spindashCharge||this.twister&&(this.twister.args.scale=0);else{this.args.xOff=8*-this.args.direction,this.args.yOff=32;let t=22*-this.args.gSpeed;Math.abs(t)>256&&(t=256*Math.sign(t)),this.twist(t)}if(this.args.standingOn&&this.args.standingOn.isVehicle&&(this.args.animation=this.args.standingOn.ridingAnimation||"standing"),this.viewport.args.frameId%this.viewport.settings.frameSkip==0&&this.args.grinding&&!this.args.falling){const t=document.createElement("div");t.classList.add("particle-sparks");const e=new n.Tag(t),s=document.createElement("div");s.classList.add("envelope-sparks");const i=new n.Tag(s);i.appendChild(e.node);const r=this.rotatePoint(1.75*-this.args.gSpeed*this.args.direction,8),a=Math.sign(this.args.gSpeed);i.style({"--x":r[0]+this.args.x,"--y":r[1]+this.args.y+-3*Math.random(),"z-index":0,"animation-delay":.25*-Math.random()+"s","--xMomentum":Math.max(Math.abs(this.args.gSpeed),4)*a,"--flip":a,"--angle":this.realAngle,opacity:2*Math.random()}),i.particle=e,this.viewport.particles.add(i),this.sparks.add(i);const o=this.viewport;this.viewport.onFrameOut(30,()=>{o.particles.remove(i),this.sparks.delete(i)})}if(this.pincherBg&&(this.pincherBg.args.scale*=.85,Math.abs(this.pincherBg.args.scale)),this.twister||this.twist(0),this.args.grinding&&(this.args.rolling=!1,this.yAxis>.5?this.args.animation="grinding-crouching":this.args.animation="grinding"),super.update(),!this.yAxis&&this.spindashCharge&&this.spindash(),this.args.falling&&this.springing&&this.args.ySpeed>=0&&(this.args.groundAngle=0,this.args.animation="dropping-start",this.springing=!1,this.onTimeout(150,()=>{this.args.falling&&"dropping-start"===this.args.animation&&(this.args.animation="dropping")})),this.args.boltDash){const t=new n.Tag('<div class = "particle particle-bolt">'),e=this.args.falling?this.args.airSpeed:this.args.gSpeed,s=this.rotatePoint(e<0?8:-8,this.args.falling?this.dashed?e<0?28:32:14:28);this.args.boltCount++;const i=Math.sign(this.args.gSpeed||this.args.xSpeed);t.attr({"data-direction":i}),t.style({"--x":this.args.x+s[0],"--y":this.args.y+s[1],"--index":this.args.boltCount,"--direction":i,"--mod":this.viewport.args.frameId%4,"--wipe":Math.abs(e),"--angle":this.args.falling?this.args.airAngle:this.realAngle,"--dashCharge":0}),this.viewport.particles.add(t),Math.abs(e)<20&&this.args.falling&&(this.args.boltDash=!1),this.viewport.onFrameOut(30,()=>{this.viewport.particles.remove(t)})}if([...this.regions].filter(t=>t.isWater).length&&!this.bMap("checkBelow",this.args.x,this.args.y+16).get(r.Platformer)&&this.args.falling&&this.dashed&&(this.yAxis<0&&(this.args.xSpeed=.95*this.args.xSpeed,this.args.ySpeed-=.05*Math.abs(this.args.xSpeed)),this.yAxis>0&&(this.args.xSpeed+=.05*Math.abs(this.args.ySpeed)*Math.sign(this.args.xSpeed),this.args.ySpeed=.95*this.args.ySpeed)),this.viewport.args.frameId%this.viewport.settings.frameSkip==0&&this.args.grinding&&!this.args.falling&&this.args.gSpeed)for(const t of this.sparks){const e=this.rotatePoint(1.75*this.args.direction,8);t.style({opacity:2*Math.random(),"--x":e[0]+this.x,"--y":e[1]+this.y})}if(Math.abs(this.ySpeedLast)>16){const t=Math.min(8,this.ySpeedLast/3)*(this.args.rolling?.5:1);this.groundTime&&this.groundTime>2&&this.groundTime<t&&this.ySpeedLast&&(this.args.animation="landing")}this.args.sliding&&(this.args.animation="sliding"),this.args.trickRamp&&(this.args.animation="adventure-pose"),this.args.twistRamp&&(this.args.animation="side-flip")}readInput(){this.lightDashing||super.readInput()}airDash(t){if(this.args.stuck||this.carrying.size)return;if(this.dashed||this.args.ignore&&-2!==this.args.ignore)return;let e=t*(this.isSuper||this.isHyper?13:8);this.args.wallSticking&&(this.args.x+=e,e=t*(this.isSuper||this.isHyper?18:9)),this.args.mode=0,this.args.float=2,this.args.rolling=!1,this.args.height=this.args.normalHeight,this.args.xSpeed&&Math.sign(this.args.xSpeed)!==Math.sign(t)&&(e=t*Math.abs(e),this.args.float=4,this.args.xSpeed=0),this.args.falling=!0,this.args.mercy&&(e*=.75);const s=this.args.xSpeed+e;this.args.animation="rolling",this.viewport.onFrameOut(3,()=>this.args.animation="airdash"),this.args.xSpeed=s,this.args.ySpeed=0,this.args.gSpeed=0,this.dashTimer=0,this.dashed=!0,this.args.mode=0,this.args.groundAngle=0}command_0(){if(this.args.crouching&&!this.args.rolling&&this.yAxis){this.spindashCharge+=10;let t=this.spindashCharge/20;return t>1&&(t=1),this.args.xOff=5*-this.args.direction,this.args.yOff=32,this.twist(120*t*this.args.direction),this.dashDust?this.dashDust&&this.dashDust.style({"--dashCharge":this.spindashCharge}):this.showDashDust(),void(this.willJump=!1)}if(this.dropDashCharge=0,this.args.jumping&&!this.args.wasHanging&&!this.dashed&&(!this.args.doubleSpin||2===this.args.doubleSpin)&&(!this.args.currentSheild||"normal"===this.args.currentSheild.type||"super"===this.args.currentSheild.type)){this.args.mercy<120&&(this.args.mercy=0),this.args.doubleSpin=!0,this.args.xOff=0,this.args.yOff=32,this.viewport.onFrameOut(5,()=>this.pinch(-600,50));const t=new d.Marker({x:this.args.x,y:this.args.y});t.owner=this,this.markers.add(t),this.viewport.spawn.add({object:t});const e=this.args.bindTo("x",(e,s)=>t.args[s]=e),s=this.args.bindTo("y",(e,s)=>t.args[s]=e+18);this.viewport.onFrameOut(25,()=>{this.viewport.actors.remove(t),e(),s()})}super.command_0()}command_4(){this.args.ignore||this.args.falling&&(this.airDash(-1),this.willStick=2,this.stayStuck=!0)}hold_4(t){this.args.ignore||(this.args.jumping||this.dashed)&&(this.dropDashCharge=0,this.willStick=2,this.stayStuck=!0)}release_4(){if(this.onNextFrame(()=>{this.willStick=!1,this.stayStuck=!1}),this.args.wallSticking&&!this.dashed){this.args.falling=!0,this.args.ySpeed>128||(this.args.ySpeed=0);const t=this.args.mode;this.airDash(1===t?1:-1),this.args.facing=1===t?"left":"right",this.args.mode=0,this.dashed=!0}}command_5(){this.args.ignore||this.args.falling&&(this.airDash(1),this.willStick=2,this.stayStuck=!0)}hold_5(t){this.args.ignore||(this.args.jumping||this.dashed&&2!==this.args.mode)&&(this.dropDashCharge=0,this.willStick=2,this.stayStuck=!0)}release_5(){if(this.onNextFrame(()=>{this.willStick=!1,this.stayStuck=!1}),this.args.wallSticking&&!this.dashed){this.args.falling=!0,this.args.ySpeed=0;const t=this.args.mode;this.airDash(1===t?1:-1),this.args.facing=1===t?"left":"right",this.args.mode=0,this.dashed=!0}}command_1(){if(!this.args.ignore&&(this.args.wallSticking&&(this.args.x+=this.args.width/2*(1===this.args.mode?1:-1),this.bMap("doJump",0)),this.args.gSpeed&&!this.args.falling&&!this.args.rolling&&Math.sign(this.args.gSpeed)===this.args.direction)){this.args.rolling=!0;const t=()=>{const e=[this.args.width/2,this.args.height+4];if(this.getMapSolidAt(this.x-e[0],this.y-e[1]))return this.viewport.onFrameOut(10,t),this.args.gSpeed=this.args.gSpeed||4*this.args.direction||4,void(this.args.rolling=!0);this.args.rolling=!1};this.viewport.onFrameOut(20,t)}}release_1(){this.dropDashCharge=0,this.spindashCharge&&(this.yAxis||(this.args.crouching=!1))}spindash(){this.spindashCharge<5&&(this.args.modeTime<45||this.args.skidding)&&(this.spindashCharge=15);const t="left"===this.args.facing?-1:1;let e=this.spindashCharge/40;e>1&&(e=1),this.args.rolling=!0;const s=32*e;this.castRayQuick(s*Math.sign(t),[Math.PI,0,0][1+Math.sign(t)],[0,this.args.height/2]),Math.sign(t)!==Math.sign(this.args.gSpeed)?this.args.gSpeed=s*Math.sign(t):this.args.gSpeed+=s*Math.sign(t),this.args.ignore=1,this.args.rolling=!0,this.spindashCharge=0,this.dashDust&&this.dashDust.remove()}hold_1(t){if(this.args.mercy)return;if(this.carrying.size)return;if(this.yAxis=this.yAxis||1,this.args.ignore||this.args.rolling)return;if(this.args.jumping&&this.dropDashCharge<15)return void this.dropDashCharge++;if(0===this.args.modeTime)return;if(this.dropDashCharge)return;if(this.args.falling||this.willJump||this.args.gSpeed&&!this.skidding)return void(this.skidding||(this.spindashCharge=0));if(!this.spindashCharge&&t.time>6)return;this.args.ignore=1;let e=this.spindashCharge/20;e>1&&(e=1),this.spindashCharge=this.spindashCharge||1,this.yAxis>.5&&(this.spindashCharge=this.spindashCharge||10),this.args.crouching=!0,this.dashDust?this.dashDust&&this.dashDust.style({"--dashCharge":this.spindashCharge}):this.showDashDust(),this.spindashCharge++,this.args.xOff=5*-this.args.direction,this.args.yOff=32,this.twist(120*e*this.args.direction),this.args.animation="spindash",this.args.direction<0?this.args.facing="left":this.args.direction>0&&(this.args.facing="right")}showDashDust(){const t=this.viewport,e=new n.Tag('<div class = "particle-spindash-dust">'),s=this.rotatePoint(0,0);e.style({"--x":s[0]+this.args.x,"--y":s[1]+this.args.y,"--direction":this.args.direction,"--dashCharge":this.spindashCharge}),e.setAttribute("data-facing",this.args.facing),t.particles.add(e),this.dashDust=e}hold_2(){if(this.args.stuck||!this.args.falling)return;if(this.lightDashing)return;if(this.lightDashingCoolDown>0)return;const t=this.findDashableRing(48);return t?(this.lightDash(t),void(this.lightDashingCoolDown=9)):void 0}command_2(){if(this.viewport.collisions.has(this)){const t=this.viewport.collisions.get(this);for(const e of t.keys())this.carrying.size&&!this.carrying.has(e)||"function"==typeof e.lift&&e.lift(this)}this.onNextFrame(()=>{const t=this.args.falling?this.args.airSpeed:this.args.gSpeed;if(this.isSuper&&!this.lightDashing&&!this.args.boltDash&&Math.abs(t)>6){const t=this.args.xSpeed,e=this.args.ySpeed,s=this.args.gSpeed;this.args.falling?(this.args.xSpeed=Math.max(-64,Math.min(this.args.xSpeed,64)),this.args.ySpeed=Math.max(-64,Math.min(this.args.ySpeed,64)),this.args.float=5,this.args.xSpeed*=5,this.args.ySpeed*=5):(this.args.gSpeed*=3,this.args.gSpeed=Math.max(-128,Math.min(this.args.gSpeed,128))),this.args.boltCount=0,this.args.boltDash=!0,a.Sfx.play("LIGTNING_STRIKE"),this.args.opacity=0,this.viewport.onFrameOut(35,()=>{this.args.opacity=1,this.args.boltDash=!1,this.args.xSpeed=this.args.xSpeed?t:0,this.args.ySpeed=this.args.ySpeed?e:0,this.args.gSpeed=this.args.gSpeed?s:0})}})}release_2(){this.args.boltDash&&(this.args.opacity=1,this.args.boltDash=!1,this.args.xSpeed/=2,this.args.ySpeed/=2,this.args.gSpeed/=3)}command_3(){}setProfile(){this.isHyper?(this.args.spriteSheet=this.superSpriteSheet,this.args.gSpeedMax=this.gSpeedMaxHyper,this.args.jumpForce=this.jumpForceHyper,this.args.accel=this.accelSuper):this.isSuper?(this.args.spriteSheet=this.superSpriteSheet,this.args.gSpeedMax=this.gSpeedMaxSuper,this.args.jumpForce=this.jumpForceSuper,this.args.accel=this.accelSuper):(this.args.spriteSheet=this.rotatedSpriteSheet,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.accel=this.accelNormal)}findNearestRing(){return this.findDashableRing(64)}findDashableRing(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;const e=t=>{if(!(t instanceof h.Ring))return!1;const e=Math.sign(this.args.xSpeed);return!(e>0&&t.x<this.x||e<0&&t.x>this.x)},s=this.findNearestActor(e,t);if(!s)return;const i=s.findNearestActor(e,t);if(!i)return;const r=Math.atan2(this.y-s.y,this.x-s.x),a=Math.atan2(s.y-i.y,s.x-i.x);return Math.abs(r-a)>Math.PI/2?void 0:s}lightDash(t){if(!this.args.falling)return this.lightDashing=!1,!1;let e;this.args.popChain.length&&(this.lightDashReward?this.lightDashReward.points+=10:(this.lightDashReward={label:"lightdash",points:10,multiplier:1},this.args.popChain.push(this.lightDashReward))),this.lightDashed=!0,this.spindashCharge=0;let s=Math.atan2(t.y-this.y+8,t.x-this.x);e=this.args.groundAngle;const i=Math.abs(e-s);let r=4*this.distanceFrom(t)*(Math.PI/2/i);r>55&&(r=55),Math.sign(this.args.xSpeed)||Math.sign(this.args.gSpeed),this.args.direction<0?this.args.animation="lightdash-back":this.args.direction>0&&(this.args.animation="lightdash"),Math.PI,this.lightDashing=!0,this.args.xSpeed=r*Math.cos(s)*.5,this.args.ySpeed=r*Math.sin(s)*.5,this.lightDashTimeout()}collect(t){if(super.collect(t),t instanceof h.Ring&&this.lightDashing){const t=this.findNearestActor(t=>t instanceof h.Ring,128);t?this.lightDash(t):(this.lightDashing=!1,this.args.float=0)}}lightDashTimeout(){this.clearLightDash&&(this.clearLightDash(),this.clearLightDash=!1),this.clearLightDash=this.viewport.onFrameOut(9,()=>{this.lightDashing=!1,this.args.float=0})}setCameraMode(){if(!this.args.falling&&this.regions)for(const t of this.regions)if(t.args.perspective)return void(this.args.cameraMode="perspective");this.args.boltDash?this.args.cameraMode="draggable":this.args.wallSticking?"panning"!==this.args.cameraMode&&("popping"!==this.args.cameraMode||Math.abs(this.args.ySpeed)<Math.abs(this.args.xSpeed))&&(this.args.cameraMode="aerial"):super.setCameraMode()}startle(t){super.startle(t),this.onNextFrame(()=>this.args.animation="startle")}die(){super.die(),this.onNextFrame(()=>this.args.animation="dead"),this.pinch(0,0),this.twist(0),a.Sfx.play("PLAYER_DAMAGED")}loseRings(t,e){super.loseRings(t,e),a.Sfx.play("RINGS_SCATTERED")}collideA(t){t instanceof g.Spring&&this.onNextFrame(()=>{this.args.falling&&(this.springing=!0,this.args.animation="springdash")}),t.pop&&this.isHyper&&t.pop(this)}get solid(){return!1}get canRoll(){return!this.args.wallSticking}get isEffect(){return!1}get controllable(){return!this.args.npc}get facePoint(){return this.args.wallSticking?this.rotatePoint(0,-5):super.facePoint}crossRegionBoundary(t,e){if(t instanceof c.GrindingRegion&&!e){for(const e of this.regions)if(e!==t&&e instanceof c.GrindingRegion)return;this.args.wasGrinding&&this.args.falling?this.args.animation="springdash":this.args.grinding=!1}super.crossRegionBoundary(t,e)}rotateMainColor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i={"8080e0":new m.Color("8080e0").rotate(t,e,s).toString(),"6060c0":new m.Color("6060c0").rotate(t,e,s).toString(),"4040a0":new m.Color("4040a0").rotate(t,e,s).toString(),202080:new m.Color("202080").rotate(t,e,s).toString()};this.png.ready.then(()=>{const t=this.png.recolor(i);this.args.rotatedSpriteSheet=this.rotatedSpriteSheet=this.args.spriteSheet=this.spriteSheet=t.toUrl()})}}}),require.register("actor/Sparkle.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sparkle=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/base/Tag"),a=(e("./Flickie"),e("./PointActor")),n=(e("../behavior/SkidDust"),e("../mixin/CanPop")),o=(e("../actor/Explosion"),e("../actor/Projectile"));t.Sparkle=class extends(i.Mixin.from(a.PointActor,n.CanPop)){constructor(){var t;super(...arguments),this.args.type="actor-item actor-sparkle",this.args.animation="standing",this.args.width=24,this.args.height=24,this.willStick=!0,this.stayStuck=!0,this.args.float=-1,this.args.static=!0,this.args.invincible=!0,this.args.offset=null!==(t=this.args.offset)&&void 0!==t?t:0}collideA(t,e){if(t instanceof o.Projectile)return!1;super.collideA(t,e)}update(){if(!this.viewport)return;const t=this.viewport;this.lightning||(this.lightning=new r.Tag('<div class = "particle-sparkle-lightning">'),t.particles.add(this.lightning),this.lightning.style({"--x":this.args.x,"--y":this.args.y+-64}));const e=t.args.frameId+-this.args.offset;this.args.animation=e%180>150?"flicker-fast":e%180>120?"flicker":"standing";const s=0===this.args.mode?1:-1,i=-Math.PI/2*s;if(e%180>168){const e=this.castRayQuick(2048,i);this.args.invincible=!0,this.lightning.style({height:`${e-this.args.height}px`});const s=this.args.x+Math.round(Math.cos(i)*(e+-1)),r=this.args.y+Math.round(Math.sin(i)*(e+-1)),a=t.actorsAtLine(this.args.x,this.args.y,s,r);a.delete(this);for(const[t,e]of a)t.controllable&&(t.damage(this,"electric"),t.pop&&t.pop(this))}else this.lightning.style({height:"0px"}),this.args.invincible=!1;if(e%180==0){const e=this.castRayQuick(2048,i);this.lightning.style({"--x":this.args.x,"--y":this.args.y+.5*-e+(2===this.args.mode?e:0)+s*this.args.height*.5});const r=this.args.x+Math.round(Math.cos(i)*(e+-1)),a=this.args.y+Math.round(Math.sin(i)*(e+-1));if(this.args.x=r,this.args.y=a,this.args.facing=s>0?"right":"left",this.args.mode=0===this.args.mode?2:0,this.vizi){const e=.25,i=new o.Projectile({owner:this,subType:"spark",damageType:"electric",gravity:0,ySpeed:e*s,xSpeed:-e,x:this.args.x,y:this.args.y}),r=new o.Projectile({owner:this,subType:"spark",damageType:"electric",gravity:0,ySpeed:e*s,xSpeed:e,x:this.args.x,y:this.args.y});t.spawn.add({object:i}),t.spawn.add({object:r})}}super.update()}effect(t){super.effect(t)}pop(t){const e=this.viewport;super.pop(t),this.args.gone&&e.particles.remove(this.lightning)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Spawner.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spawner=void 0;var i=e("./PointActor"),r=e("../ObjectPalette");t.Spawner=class extends i.PointActor{constructor(){super(...arguments),this.args.width=16,this.args.height=32,this.args.type="actor-item actor-spawner"}activate(){if(!this.args.spawn||!this.args.point)return;const t=this.viewport.objDefs.get(this.args.point),e=r.ObjectPalette[this.args.spawn];if(!t||!e)return;const s=new e({x:t.x,y:t.y});for(const[t,e]of this.def)"point"!==t&&"type"!==t&&(s.args[t]=e);s.args[name]=this.args.spawn,this.viewport.spawn.add({object:s}),this.viewport.setColCell(s)}get solid(){return!1}}}),require.register("actor/SpikeBomb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpikeBomb=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=(e("curvature/base/Tag"),e("./RedBomb"));t.SpikeBomb=class extends i.PointActor{constructor(){super(...arguments),this.args.width=24,this.args.height=24,this.args.type="actor-item actor-spike-bomb",this.args.decel=0,this.explosions=new Set}update(){!this.args.falling&&this.groundTime>1&&this.explode(),super.update();for(const t of this.explosions)t.style({"--x":this.args.x,"--y":this.args.y+-16})}collideA(t){t.controllable&&(t.damage(this),this.explode(),this.args.float=-1)}explode(){if(this.exploded)return;this.exploded=!0,this.args.type="actor-item actor-air-bomb hide";const t=new a.RedBomb({x:this.args.x,y:this.args.y+-1,owner:this}),e=new a.RedBomb({x:this.args.x,y:this.args.y+-1,owner:this});t.args.ySpeed=.5*-this.ySpeedLast,e.args.ySpeed=.5*-this.ySpeedLast,t.args.xSpeed=.35*-this.ySpeedLast,e.args.xSpeed=.35*+this.ySpeedLast,this.viewport.spawn.add({object:t}),this.viewport.spawn.add({object:e}),this.viewport.actors.remove(this),r.Sfx.play("OBJECT_DESTROYED")}}}),require.register("actor/SpikeRing.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpikeRing=void 0;var i=e("./PointActor");t.SpikeRing=class extends i.PointActor{constructor(){super(...arguments),this.args.width=64,this.args.height=32,this.args.type="actor-item actor-spike-ring",this.args.float=-1,this.oscMode=0}collideA(t){t.controllable&&t.damage(this)}update(){this.oscMode?(this.args.y-=1.75*Math.sign(this.args.y-this.objDef.y),Math.abs(this.args.y-this.objDef.y)<1.75&&(this.args.y=this.objDef.y,this.oscMode=0)):(this.args.y-=1.75*Math.sign(this.args.y-this.args.riseTo),Math.abs(this.args.y-this.args.riseTo)<1.75&&(this.args.y=this.args.riseTo,this.oscMode=1))}}}),require.register("actor/Spikes.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spikes=void 0;var i=e("./PointActor"),r=e("../audio/Sfx"),a=e("./Block");t.Spikes=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.x=e.originalX=t.x+Math.floor(t.width/2),e}constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e,arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-spikes",this.args.width=e.width||32,this.args.height=e.height||32,this.args.pointing=this.args.pointing||0,this.args.retractible=null!==(t=this.args.retractible)&&void 0!==t&&t,this.args.retracted=!1,this.args.offset=this.args.offset||0,this.args.beat=this.args.beat||90,this.hazard=!0}updateStart(){if(this.args.retractible){this.args.wasRetracted=this.args.retracted;const t=this.viewport.args.frameId+-this.viewport.args.startFrameId+-this.args.offset;if(this.args.retracted=!!(Math.floor(t/this.args.beat)%2),!this.args.retracted&&this.args.wasRetracted){this.vizi&&r.Sfx.play("SPIKES_OUT");const t=this.viewport.actorsAtPoint(this.args.x,this.args.y,this.args.width,this.args.height);for(const e of t)if(e!==this&&!e.isRegion&&!e.args.static)switch(this.args.pointing){case 0:e.args.y=this.args.y+-this.args.height+-1;break;case 1:e.args.x=this.args.x+-this.args.width/2+-e.args.width/2+-1,e.damage(this);break;case 2:e.args.y=this.args.y+other.args.height;break;case 3:e.args.x=this.args.y+this.args.width/2+e.args.width/2+1,e.damage(this)}}this.args.retracted&&!this.args.wasRetracted&&this.vizi&&r.Sfx.play("SPIKES_IN")}super.updateStart()}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-pointing"]="pointing",this.autoAttr.get(this.box)["data-retracted"]="retracted"}startle(){}damage(){}collideA(t,e){return!this.args.retracted&&(t.isRegion?void 0:this.args.static||!this.args.falling||this.args.float?(t instanceof a.Block||e!==this.args.pointing||(3===this.args.pointing?(t.args.xSpeed||t.args.gSpeed*(2===t.args.mode?-1:1))<=0&&(t.noClip||this.args.retracted||!this.args.wasRetracted||(t.args.x=this.args.x+this.args.width/2+t.args.width/2+4),t.damage(this)):1===this.args.pointing?(t.args.xSpeed||t.args.gSpeed*(2===t.args.mode?-1:1))>=0&&(t.noClip||this.args.retracted||!this.args.wasRetracted||(t.args.x=this.args.x+-this.args.width/2+-t.args.width/2+-4),t.damage(this)):2===this.args.pointing?(t.args.ySpeed||t.args.gSpeed*(1===t.args.mode?-1:1))<=0&&(t.noClip||this.args.retracted||!this.args.wasRetracted||(t.args.y=this.args.y+t.args.height),t.damage(this)):0===this.args.pointing&&(t.args.ySpeed||t.args.gSpeed*(3===t.args.mode?-1:1))>=0&&(t.noClip||this.args.retracted||!this.args.wasRetracted||(t.args.y=this.args.y+-this.args.height+0),t.damage(this))),!0):(t.damage(!1),!0))}get solid(){return!this.args.retracted&&!this.args.wasRetracted}}}),require.register("actor/SpikesSmall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpikesSmall=void 0;var i=e("curvature/base/Tag"),r=e("../audio/Sfx"),a=(e("./PointActor"),e("./Spikes"));t.SpikesSmall=class extends a.Spikes{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=10,e.args.x=e.originalX=t.x+Math.floor(t.width/2),e}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t,arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-spikes actor-spikes-small",this.args.width=t.width||32,this.args.height=10,this.args.pointing=this.args.pointing||0,this.hazard=!0,this.args.width<16&&(this.args.narrow=!0)}update(){super.update(),this.sprite&&!this.graphic&&(this.graphic=new i.Tag(`<svg style  = "--breakSplit: 4;" data-narrow = "${this.args.narrow}">\n\t\t\t\t<defs>\n\t\t\t\t\t<pattern\n\t\t\t\t\t\tid     = "spikes-${this._id}"\n\t\t\t\t\t\twidth  = "${16/this.args.width}"\n\t\t\t\t\t\theight = "1"\n\t\t\t\t\t\tx      = "0"\n\t\t\t\t\t\ty      = "0"\n\t\t\t\t\t>\n\t\t\t\t\t\t<image href = "/Sonic/spikes-small-single.png">\n\t\t\t\t\t</pattern>\n\t\t\t\t</defs>\n\t\t\t\t<rect fill = "url(#spikes-${this._id})"></rect>\n\t\t\t\t<rect fill = "url(#spikes-${this._id})"></rect>\n\t\t\t</svg>`),this.sprite.appendChild(this.graphic.node))}collideA(t,e){if(this.args.broken||t instanceof a.Spikes||t.args.static)return!1;if(t.isVehicle){this.args.broken=!0,this.args.gravity=.4,t.halt(10);const e=8+(t.args.width+this.args.width)/2;return t.args.x=this.x+-e*Math.sign(this.x-t.x),this.args.type="actor-item actor-spikes actor-spikes-small actor-spikes-breaking",this.viewport.onFrameOut(7,()=>{this.args.falling=!0,this.args.xSpeed=.25*t.args.hSpeed+1*Math.random()**2,this.args.ySpeed=-5*Math.random()**2-5,this.args.type="actor-item actor-spikes actor-spikes-small actor-spikes-broken",r.Sfx.play("BLOCK_DESTROYED")}),this.args.float=8,this.noClip=!0,!1}return super.collideA(t,e)}activate(){this.args.float=0,this.noClip=!0}get solid(){return!this.args.broken&&!this.noClip}}}),require.register("actor/SpinBridge.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpinBridge=void 0;var i=e("./Block");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Block{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),r(this,"segments",new Set),this.args.offset=this.args.offset||0,this.args.speed=this.args.speed||1}initialize(){if(super.initialize(),!this.getMapSolidAt(this.args.x+this.args.width,this.args.y)){const t=this.args.prevSegment?this.args.prevSegment.args.firstSegment:this;if(this.args.segmentIndex||(this.args.segmentIndex=0,this.args.firstSegment=this,this.segments.add(t)),this.args.segmentIndex>=7)return;const e=new this.constructor({platform:this.args.platform,segmentIndex:this.args.segmentIndex+1,prevSegment:this,firstSegment:t,float:-1,width:this.args.width,height:this.args.height,tileId:this.args.tileId,speed:this.args.speed,offset:this.args.offset,x:this.args.x+this.args.width,y:this.args.y+4});t.segments.add(e),this.args.nextSegment=e,this.viewport.spawn.add({object:e}),t.args.platform=!0}}updateEnd(){const t=this.viewport.args.frameId*this.args.speed+this.args.offset,e=this.args.firstSegment.args.x,s=this.args.firstSegment.args.y,i=16*this.args.segmentIndex;this.args.x=e+Math.cos(t/120*Math.PI)*i,this.args.y=s+Math.sin(t/120*Math.PI)*i,super.updateEnd()}collideA(t,e){return!(t instanceof a)&&super.collideA(t,e)}}t.SpinBridge=a}),require.register("actor/Sping.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sping=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Tag"),e("./PointActor")),a=e("../behavior/SkidDust"),n=e("../mixin/CanPop"),o=(e("../actor/Explosion"),e("../actor/Projectile"));function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Sping=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){super(...arguments),l(this,"name","Spiny"),this.behaviors.add(new a.SkidDust),this.args.type="actor-item actor-sping",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=48,this.args.height=22,this.willStick=!1,this.stayStuck=!1}update(){if(this.args.direction,this.age%90<65&&(Math.floor(this.age/90)%2?this.args.gSpeed=-.125:this.args.gSpeed=.125),this.box&&(this.box.setAttribute("data-animation","walking"),(this.age%90<15||this.age%90>85)&&this.box.setAttribute("data-animation","shooting")),super.update(),this.age%90==87){const t=this.x-2,e=this.y-12,s=-1,i=-1.5*Math.sign(this.gSpeedLast),r=-3,a=this,n=new o.Projectile({x:t,y:e,z:s,owner:a});if(!this.viewport)return;this.viewport.onFrameOut(2,()=>{Object.assign(n.args,{xSpeed:i,ySpeed:r})}),this.viewport.spawn.add({object:n})}}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Spinner.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spinner=void 0;var i=e("./PointActor"),r=e("./Block"),a=e("../audio/Sfx");Symbol("Boosted");class n extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-spinner",this.args.width=64,this.args.height=24,this.args.direction=this.args.direction||1,this.args.static=!0}update(){super.update()}collideA(t){if(t.isRegion||t.args.static||t instanceof r.Block)return;if(t instanceof n)return;if(t.args.gSpeed,t.args.falling||Math.sign(t.args.gSpeed)===Math.sign(this.args.direction)&&Math.abs(t.args.gSpeed)>this.args.toSpeed)return;this.ignores.set(t,30);const e=this.args.toSpeed||40;t.args.ignore=2,t.args.direction=this.args.direction,t.args.facing=this.args.direction>0?"right":"left",t.args.gSpeed=Math.max(Math.abs(t.args.gSpeed),e)*Math.sign(this.args.direction||1),t.xAxis=0,a.Sfx.play("SPEEDPAD_HIT")}}t.Spinner=n}),require.register("actor/SpinningFloat.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpinningFloat=void 0;var i=e("./Block");e("../audio/Sfx"),e("../region/Region");t.SpinningFloat=class extends i.Block{constructor(){super(...arguments),this.hitBlocks=!0,this.invertsBias=!0,this.args.width=64,this.args.height=64,this.args.platform=1,this.args.type="actor-item actor-spinning-float",this.args.static=0,this.args.gravity=.4,this.args.spinning=0,this.args.bouncing=0,this.args.treadmill=!0,this.args.trackX=!0,this.args.particleScale=1.25,this.lastConvey=0}collideA(t,e){return!t.args.platform&&super.collideA(t,e)}update(){super.update(),this.args.moving=this.args.falling||this.args.gSpeed;let t=!1,e=!1;const s=this.viewport.regionsAtPoint(this.args.x,this.args.y-36);for(const e of this.regions)e.isWater&&(t=!0);for(const t of s)t.isWater&&(e=!0);e&&(this.args.ySpeed-=this.args.gravity,this.args.falling=!0,this.args.ySpeed>0&&(this.args.ySpeed*=.95));const i=.25+3.5*Math.abs(this.args.convey/20);t&&this.args.falling&&Math.abs(this.args.ySpeed)<i&&(this.args.ySpeed>0||this.args.convey)&&(!e&&this.args.ySpeed>0||e&&this.args.ySpeed<0)&&(this.args.ySpeed=Math.sign(this.args.ySpeed)*i),this.standingUnder.forEach(e=>{e.args.xSpeed=this.args.xSpeed||this.args.gSpeed,e.xAxis&&Math.abs(e.args.gSpeed)>1&&(this.args.falling?t||(e.args.gSpeed*=.99):e.args.gSpeed*=.9),Math.abs(e.args.gSpeed)>14&&(e.args.gSpeed=14*Math.sign(e.args.gSpeed)),Math.abs(this.args.convey)>8?e.args.x=this.args.x:(e.groundTime<2&&(e.args.gSpeed=0,e.args.xSpeed=0,this.args.convey=0),Math.abs(this.args.x-e.args.x)<1&&(e.args.x=this.args.x),e.args.x+=.2*(this.args.x-e.args.x))}),!this.args.falling&&Math.abs(this.args.gSpeed)<Math.abs(this.args.convey)?(this.args.gSpeed=this.args.convey,this.args.xSpeed=this.args.gSpeed):t&&(!this.args.xSpeed&&this.gSpeedLast&&(this.args.xSpeed=this.gSpeedLast,this.gSpeedLast=0),e&&this.getMapSolidAt(this.x,this.y+1)&&this.args.y--,Math.abs(this.args.xSpeed)<8&&(this.args.xSpeed+=.005*this.args.convey),this.args.falling?this.args.xSpeed*=.99:this.args.gSpeed=this.args.xSpeed)}sleep(){this.args.y=this.originalY}}}),require.register("actor/SpitFire.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpitFire=void 0;var i=e("./PointActor");t.SpitFire=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-spitfire",this.args.width=99,this.args.height=32,this.args.float=-1,this.noClip=!0}update(){if(this.age>45)return this.args.gone=!0,this.viewport.actors.remove(this),void this.remove();super.update()}collideA(t){this.age<10||t.immune(this,"fire")||this.args.owner&&!this.args.owner.args.gone&&t.controllable&&t.damage(this,"fire")}}}),require.register("actor/SpitSteam.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpitSteam=void 0;var i=e("./PointActor");t.SpitSteam=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-spitsteam",this.args.width=79,this.args.height=16,this.args.float=-1,this.noClip=!0}update(){if(this.age>30)return this.args.gone=!0,this.viewport.actors.remove(this),void this.remove();super.update()}collideA(t){this.age<8||t.controllable&&this.args.owner&&!this.args.owner.args.gone&&(t.args.ignore=3,t.args.antiSkid=8,t.args.x+=this.args.direction,t.args.xSpeed=12*this.args.direction,t.args.falling=!0)}}}),require.register("actor/Splats.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Splats=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.Splats=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-splats",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=5,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=24,this.args.height=48,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:40,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:140,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1}update(){this.args.direction,this.args.shotTelegraph,this.args.patrolBeat,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.direction=Math.sign(this.args.xSpeed||this.args.gSpeed),this.args.falling||this.jumpTimer||(this.jumpTimer=this.onNextFrame(()=>{this.args.ySpeed=Math.max(-this.ySpeedLast,-12)||-6,this.args.xSpeed=this.args.gSpeed,this.args.falling=!0,this.jumpTimer=!1,this.args.y-=32}))}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Spring.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spring=void 0;var i=e("./LayerSwitch"),r=e("./PointActor"),a=e("./BreakableBlock"),n=e("../region/Region"),o=e("../audio/Sfx"),l=e("./Projectile");function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const g=Symbol("WillSpring"),c=Symbol("WontSpring");class d extends r.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.angle=Number(e.args.angle),e.args.width=t.width||32,e.args.height=t.height||32,e}constructor(){var t;super(...arguments),h(this,"float",-1),h(this,"keepAngle",!0),h(this,"template",'<div\n\t\tclass = "point-actor actor-item [[type]] [[collType]] [[active]]"\n\t\tstyle = "\n\t\t\tdisplay:[[display]];\n\t\t\t--angle:[[angle]];\n\t\t\t--airAngle:[[airAngle]];\n\t\t\t--ground-angle:[[groundAngle]];\n\t\t\t--height:[[height]];\n\t\t\t--width:[[width]];\n\t\t\t--x:[[x]];\n\t\t\t--y:[[y]];\n\t\t"\n\t\tdata-colliding = "[[colliding]]"\n\t\tdata-diagonal  = "[[diagonal]]"\n\t\tdata-falling   = "[[falling]]"\n\t\tdata-facing    = "[[facing]]"\n\t\tdata-angle     = "[[angle|rad2deg]]"\n\t\tdata-mode      = "[[mode]]"\n\t>\n\t\t<div\n\t\t\tdata-color = "[[color]]"\n\t\t\tdata-type  = "[[base]]"\n\t\t\tclass      = "spring-pad"\n\t\t\tstyle = "--color:[[color]]deg"\n\t\t></div>\n\t\t<div class = "sprite"></div>\n\t</div>'),this.args.type="actor-item actor-spring",this.args.width=this.args.width||32,this.args.height=this.args.height||32,this.args.color=this.args.color||0,this.args.static=null===(t=this.args.static)||void 0===t||t,this.args.standingOn&&(this.args.static=!1,this.args.float=0),this.args.actingOn=new Set,this.args.blocked=!1,this.holding=new Set}updateEnd(){if(super.updateEnd(),this.args.blocked=!1,this.viewport.collisions.has(this))for(const[t,e]of this.viewport.collisions.get(this))-1===e&&!t.broken&&t instanceof a.BreakableBlock&&(this.args.blocked=!0);if(this.args.blocked)return!1;for(const t of this.holding)this.springActor(t),this.viewport.onFrameOut(5,()=>{this.holding.delete(t)})}collideA(t,e){return!(t instanceof l.Projectile)&&(!this.args.blocked&&(!t.carriedBy&&(t.args.hangingFrom&&t.args.hangingFrom.unhook(t),!t[g]&&!t[c]&&(!t.args.static&&(!(t instanceof this.constructor)&&(!(t instanceof i.LayerSwitch)&&(super.collideA(t,e),!this.args.actingOn.has(t)&&(!t.args.platform&&(!(t instanceof n.Region)&&(t.args.falling=!0,this.holding.add(t),t.controllable&&(this.args.gSpeed=0),!1))))))))))}springActor(t){if(t[g])return!1;o.Sfx.play("SPRING_HIT");const e=this.roundAngle(this.args.angle,8,!0);if(t.args.x=this.args.x+4*Math.cos(e),t.args.y=this.args.y+4*Math.sin(e),this.args.actingOn.add(t),this.viewport.onFrameOut(1,()=>{this.args.active=!0}),this.viewport.onFrameOut(5,()=>{delete t[g],this.args.active=!1,this.args.actingOn.delete(t)}),t.noClip)return!1;t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=0,t[g]=!0,t.args.mercy=0,this.viewport.settings.rumble&&t.controller&&t.controller.rumble&&(t.controller.rumble({duration:120,strongMagnitude:1,weakMagnitude:1}),this.onTimeout(100,()=>{t.controller.rumble({duration:500,strongMagnitude:0,weakMagnitude:.25})})),t.locked=2,t.args.jumping=!1,t.args.ignore=t.args.ignore||(t.args.falling?12:2),t.args.float=Math.max(2,t.args.float),this.viewport.onFrameOut(1,()=>{t.args.float=Math.max(2,t.args.float),t.args.mode=0,t.args.direction=Math.sign(s)||t.args.direction,t.args.flying=!1,t.impulse(this.args.power,e,![0,Math.PI].includes(this.args.angle)&&Math.abs(Math.PI-this.args.angle)>.01)});const s=Number(Number(1*Math.cos(e)).toFixed(3)),i=Number(Number(1*Math.sin(e)).toFixed(3)),r=t.args.rolling;![0,Math.PI].includes(this.args.angle)&&Math.abs(Math.PI-this.args.angle)>.01||t.args.falling||0!==t.args.mode?(t.args.falling=!0,t.args.mode=0):this.viewport.onFrameOut(1,()=>t.args.rolling=r),Math.abs(t.args.xSpeed)<3||Math.sign(t.args.xSpeed)!==Math.sign(s)?t.args.xSpeed=s:t.args.xSpeed+=s,Math.abs(t.args.ySpeed)<3||Math.sign(t.args.ySpeed)!==Math.sign(i)?t.args.ySpeed=i:t.args.ySpeed+=i,t.args.airAngle=this.args.angle,t.args.displayAngle=0,t.args.groundAngle=0,t.args.airAngle=-Math.PI/2,t.args.mode=0}sleep(){this.args.actingOn.clear(),this.args.active=!1}get canStick(){return!1}get solid(){return!1}}t.Spring=d,h(d,"WontSpring",c)}),require.register("actor/SpringTurtle.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpringTurtle=void 0;var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");e("./Ring");t.SpringTurtle=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-spring-turtle",this.args.animation="standing",this.args.accel=.1,this.args.decel=.5,this.args.gSpeedMax=3,this.args.gravity=.5,this.args.width=24,this.args.height=32,this.willStick=!1,this.stayStuck=!1,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:10,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:120,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:1,this.args.lastSpring=0}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-spring"]="springing"}collideA(t,e){if(!t.args.static)return 0===e||t.args.falling?(this.ignores.set(t,15),t.args.ySpeed=-20,t.args.xSpeed=0,void(this.args.lastSpring=10)):super.collideA(t,e)}update(){super.update(),this.args.lastSpring>0&&this.args.lastSpring--,this.args.springing=!!this.args.lastSpring,this.args.moving&&this.args.gSpeed?this.args.animation="walking":this.args.animation="standing",this.args.direction=Math.sign(this.args.gSpeed)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Springboard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Springboard=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");t.Springboard=class extends i.PointActor{constructor(){super(...arguments),this.args.type="actor-item actor-springboard",this.args.width=56,this.args.height=16,this.args.animation="idle"}collideA(t,e){if(this.args.ignore)return;let s=Math.min(1,Math.max(0,1+(-this.x-26+t.x)/56));if(s<.5&&(s*=.5),this.args.animation="depressed",t.args.jumping&&"idle"!==this.args.animation&&t.args.ySpeed<0){this.args.ignore=6,this.args.animation="idle";const e=Math.max(t.args.gSpeed/2,t.args.xSpeed);this.onNextFrame(()=>{t.args.xSpeed=e,t.args.ySpeed+=-12*s}),r.Sfx.play("SPRING_HIT")}if(-this.x+t.x<=-26&&(this.args.animation="idle"),(-this.x+t.x>=26||Math.abs(t.args.gSpeed)>13)&&0===t.args.mode){this.args.ignore=6;const e=Math.max(t.args.gSpeed/2,t.args.xSpeed);this.onNextFrame(()=>{t.args.falling=!0,t.args.xSpeed=e,t.args.ySpeed=-8}),this.viewport.onFrameOut(5,()=>this.args.animation="idle"),r.Sfx.play("SPRING_HIT")}t.args.ySpeed<0&&(this.args.animation="idle")}}}),require.register("actor/StarBalloon.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarBalloon=void 0;var i=e("./Balloon"),r=e("./Spring");t.StarBalloon=class extends i.Balloon{constructor(){super(...arguments),this.args.type="actor-item actor-balloon actor-star-balloon",this.args.target=this.args.target||0,this.args.gravity=.475,this[r.Spring.WontSpring]=!0}update(){super.update(),this.popped||(this.launched?(this.args.ySpeed||(this.args.ySpeed=-1),this.args.ySpeed>-8&&(this.args.ySpeed-=.08),this.args.y<this.args.target&&(this.args.y=this.args.target,this.args.ySpeed=0)):this.args.ySpeed=Math.sin(this.viewport.args.frameId/10)/5),this.args.groundAngle=0}activate(){this.args.ySpeed=2,this.viewport.onFrameOut(20,()=>this.launched=!0)}collideA(t){return!(!t.controllable||t.args.hangingFrom)&&!this.popped&&void((t.args.ySpeed>=0||t.args.spinning)&&(t.args.ySpeed=-14,this.pop()))}sleep(){this.viewport&&(this.tags.sprite&&this.tags.sprite.classList.remove("popped"),this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.xSpeed=0,this.args.ySpeed=0,this.args.float=-1,this.popped=this.launched=!1,this.args.falling=!0,this.viewport.setColCell(this),this.noClip=!1)}damage(){this.pop()}pop(){const t=new CustomEvent("exploded",{detail:{actor:this}});this.dispatchEvent(t),this.tags.sprite.classList.add("popped"),this.popped=!0,this.args.float=0,this.noClip=!0}}}),require.register("actor/StarPost.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarPost=void 0;e("../ui/CharacterString");var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("../audio/Sfx"),n=(e("./Monitor"),e("./monitor/RingMonitor")),o=e("./monitor/SheildElectricMonitor"),l=e("./monitor/SheildWaterMonitor"),h=e("./monitor/SheildFireMonitor"),g=e("../lib/Analytic");t.StarPost=class extends i.PointActor{constructor(){var t;super(...arguments),this.args.type="actor-item actor-star-post",this.args.width=16,this.args.height=48,this.args.active=null!==(t=this.args.active)&&void 0!==t&&t,this.args.static=!0,this.spinning=!1}update(){if(super.update(),this.args.wasActive){const t=new n.RingMonitor({direction:0,ySpeed:-4,x:this.x-10,y:this.y-48});this.viewport.onFrameOut(12,()=>{this.viewport.spawn.add({object:t})}),this.args.wasActive=!1}}onRendered(){super.onRendered(),this.headBox=new r.Tag('<div class = "star-post-head-box">'),this.head=new r.Tag('<div class = "star-post-head">'),this.headBox.appendChild(this.head.node),this.box.appendChild(this.headBox.node)}collideA(t){if(super.collideA(t),t.args.owner&&(t=t.args.owner),(t.controllable||t.occupant)&&this.box&&!this.args.active){this.args.active=!0,this.box.setAttribute("data-direction",t.args.direction),this.box.setAttribute("data-active","true"),this.box.setAttribute("data-spin","true"),a.Sfx.play("STARPOST_HIT");let e=t.args.gSpeed||t.args.xSpeed;Math.abs(e)>20&&(e+=3);const s=this.viewport.args.frameId+-this.viewport.args.startFrameId,i=t.args.rings>50?[n.RingMonitor,h.SheildFireMonitor,l.SheildWaterMonitor,o.SheildElectricMonitor]:[n.RingMonitor],r=new(0,i[s%i.length])({direction:t.args.direction,xSpeed:e,ySpeed:-5,x:this.x-10,y:this.y-48});this.viewport.storeCheckpoint(t.args.canonical,this.oid||this.args.id),this.viewport.spawn.add({object:r}),this.spinning=!0,this.viewport.onFrameOut(36,()=>{this.spinning=!1}),"function"==typeof ga&&g.Analytic.report({eventCategory:"starpost",eventAction:"activated",eventLabel:`${this.viewport.args.actName}::${this.args.id}`})}}get solid(){return!1}}}),require.register("actor/SteelCrate.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SteelCrate=void 0;var i=e("./Block"),r=e("./BreakableBlock"),a=e("./Projectile");t.SteelCrate=class extends r.BreakableBlock{constructor(){var t;super(...arguments),this.args.type="actor-item actor-breakable-block actor-steel-crate",this.args.width=64,this.args.height=64,this.args.static=null!==(t=this.args.static)&&void 0!==t&&t}collideA(t,e){return t instanceof i.Block||(t instanceof a.Projectile&&!this.broken?(this.break(),!0):t.args.bouncing&&!this.broken?(this.break(),!0):t.punching&&!this.broken?(this.break(),!1):!(!t.args.rolling||this.broken)||!(0!==e||!t.controllable)||1!==e&&3!==e||t.y<=this.y-this.args.height||!!this.viewport&&(-1!==e&&!t.args.rolling||super.collideA(t,e)))}setTile(){this.args.spriteSheet="/custom/steel-crate.png"}}}),require.register("actor/StoneAltar.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoneAltar=void 0;var i=e("./Block"),r=e("./WindStone");t.StoneAltar=class extends i.Block{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),this.args.float=-1,this.args.static=!0,this.args.hidden=!0,this.args.platform=!0,this.args.activated=!1}update(){super.update(),this.args.active=!1;for(const t of this.standingUnder)t instanceof r.WindStone&&(t.args.inPlace=!0,this.args.active=!0)}}}),require.register("actor/Stopper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stopper=void 0;var i=e("./BreakableBlock");t.Stopper=class extends i.BreakableBlock{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-breakable-block actor-stopper",this.args.height=16,this.args.float=-1}collideA(t,e){return!!t.isVehicle||!this.broken&&(!this.broken&&2===e||Math.abs(t.args.ySpeed)>20&&0===e?!(t.args.ySpeed>0||t.ySpeedLast>0)||(t.args.groundAngle=0,t.args.x=this.args.x,t.args.xSpeed=0,t.args.ySpeed=Math.abs(t.args.gSpeed),t.args.falling=!0,t.args.bouncing=!1,t.args.jumping=!1,t.args.mode=0,this.break(),!1):!(t.args.jumping&&t.args.ySpeed>0||t.args.rolling)||(t.args.x=this.args.x,t.args.y=this.args.y,this.viewport.onFrameOut(1,()=>{t.args.groundAngle=0,t.args.falling=!0,t.args.animation="rolling",t.args.x=this.args.x,t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=Math.abs(t.args.gSpeed)}),t.args.jumping&&(t.args.gSpeed=0,t.args.xSpeed=0,t.args.ySpeed=0,t.args.ignore=30,t.args.float=30,this.viewport.onFrameOut(30,()=>{t.args.xSpeed=0,t.args.ySpeed=10})),super.collideA(t,e)))}}}),require.register("actor/SuperRing.js",function(t,e,s){"use strict"}),require.register("actor/Switch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Switch=void 0;var i=e("./PointActor"),r=e("../audio/Sfx");t.Switch=class extends i.PointActor{constructor(){var t;super(...arguments),this.args.type="actor-item actor-switch",this.args.width=32,this.args.height=10,this.removeTimer=null,this.args.active=!1,this.args.latch=this.args.latch||!1,this.activator=null,this.args.bindTo("active",t=>{this.box&&this.box.setAttribute("data-active",t?"true":"false")}),this.args.threshold=null!==(t=this.args.threshold)&&void 0!==t?t:100,this.ignore=0,this.args.activeTime=0}update(){super.update(),this.ignore>0?this.ignore--:this.args.latch||(this.args.active?this.args.activeTime++:this.args.activeTime=0,this.args.activeTime>2&&(!this.activator||this.activator.args.standingOn!==this||this.activator.y===this.args.y)&&(this.args.active=!1,this.activator=null))}updateEnd(){super.updateEnd(),this.args.active}onRendered(t){super.onRendered(t),this.box=this.findTag("div")}collideA(t,e){if(t.args.y>=this.args.y)return!1;if(this.activator===t&&t.y>this.args.y)return this.ignore=8,!0;if(t.args.ySpeed<0)return!1;if(this.args.active&&t.y<this.y)return!0;if(!t.isEffect&&!t.isRegion){if(t.y>this.y-this.args.height+0)return!1;if(this.args.threshold&&t.args.weight<this.args.threshold)return!0;if(t.onRemove(()=>this.activator=null),t.y<=this.y-this.args.height){if(this.args.active||this.activate(t),this.ignore=8,this.args.active=!0,this.activator=t,t.args.falling&&t.args.ySpeed>1&&(t.args.ySpeed=1),this.activator&&Math.abs(this.activator.args.x-this.args.x)>4&&this.args.activeTime<1){const t=this.activator.args.xSpeed;this.viewport.onFrameOut(1,()=>{this.activator.args.gSpeed=t,this.activator.args.groundAngle=0})}return!0}return!1}}activate(t){if(this.beep(),this.args.target&&this.viewport.actorsById[this.args.target]&&this.viewport.actorsById[this.args.target].activate(t,this),this.args.destroyLayer){const t=this.args.destroyLayer,e=this.viewport.args.layers[t];e&&(e.args.destroyed=!0)}if(this.args.water){var e,s;const t=this.viewport.actorsById[this.args.water],i=this.viewport.objDefs.get(this.args.setPoint);t.target=Number(t.y||0)-Number(i.y||0),t.args.fillSpeed=null!==(e=this.args.fillSpeed)&&void 0!==e?e:t.args.fillSpeed,t.args.drainSpeed=null!==(s=this.args.drainSpeed)&&void 0!==s?s:t.args.drainSpeed}const i=this.viewport.objDefs.get(this.args.point),r=this.viewport.objectPalette[this.args.spawn];r&&i&&this.viewport.spawn.add({object:new r({x:i.x,y:i.y})}),this.args.active=!0}beep(){this.viewport&&(this.args.silent||r.Sfx.play("SWITCH_HIT"))}sleep(){this.viewport&&this.def&&(this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.onNextFrame(()=>{this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.args.xSpeed=0,this.args.ySpeed=0,this.args.pushed=0,this.args.float=0}))}get solid(){return this.args.active}}}),require.register("actor/Tails.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tails=void 0;var i=e("./PointActor"),r=e("curvature/base/Tag"),a=e("./Spring"),n=e("../behavior/SkidDust"),o=e("../behavior/Spindash"),l=e("../behavior/Crouch"),h=e("../behavior/LookUp"),g=e("../behavior/EmeraldHalo"),c=e("../behavior/SuperForm"),d=e("../lib/Color"),u=e("../sprite/Png");function p(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Tails=class extends i.PointActor{constructor(){super(...arguments),p(this,"png",new u.Png("/Sonic/tails.png")),p(this,"pngTails",new u.Png("/Sonic/tails-tails.png")),this.args.canonical="Tails",this.behaviors.add(new n.SkidDust),this.behaviors.add(new o.Spindash),this.behaviors.add(new l.Crouch),this.behaviors.add(new h.LookUp),this.behaviors.add(new c.SuperForm),this.behaviors.add(new g.EmeraldHalo),this.args.type="actor-item actor-tails",this.accelNormal=.15,this.accelSuper=.24,this.args.accel=this.accelNormal,this.args.decel=.4,this.args.flySpeedMax=25,this.gSpeedMaxNormal=18,this.gSpeedMaxSuper=20,this.gSpeedMaxHyper=23,this.jumpForceNormal=11,this.jumpForceSuper=13,this.jumpForceHyper=15,this.args.maxFlyTimeNormal=350,this.args.maxFlyTimeSuper=600,this.args.maxFlyTimeHyper=1/0,this.args.flyBoostNormal=-1.5,this.args.flyBoostSuper=-1.75,this.args.flyBoostHyper=-2,this.args.flyBoost=this.args.flyBoostNormal,this.args.maxFlyTime=this.args.maxFlyTimeNormal,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.gravity=.5,this.args.normalGravity=this.args.gravity,this.args.slowGravity=.125*this.args.gravity,this.args.width=16,this.args.height=34,this.args.weight=80,this.args.normalHeight=32,this.args.rollingHeight=28,this.willStick=!1,this.stayStuck=!1,this.flyTime=0,this.sparks=new Set,this.spriteSheet="/Sonic/tails.png",this.args.spriteSheet=`url('${this.args.spriteSheet}')`,this.spriteSheetTails="/Sonic/tails-tails.png",this.args.spriteSheetTails=`url('${this.spriteSheetTails}')`,this.costumes={SkyCamo:{h:120,s:.8,v:1},Copper:{h:-45,s:1,v:1},Patina:{h:90,s:.8,v:.85},Arctic:{h:0,s:0,v:.85}},this.args.minRingsSuper=40,this.args.minRingsHyper=60,this.transformTime=0}onRendered(t){if(super.onRendered(t),this.tails)return;this.tails=new r.Tag('<div class = "tails-tails">'),this.sprite.appendChild(this.tails.node),this.flyingSound=new Audio("/Sonic/tails-flying.wav"),this.flyingSound.volume=.35+-.3*Math.random(),this.flyingSound.loop=!0,this.rotatedSpriteSheet=this.spriteSheet,this.rotatedSpriteSheetTails=this.spriteSheetTails,this.autoStyle.get(this.box)["--sprite-sheet"]="spriteSheet",this.autoStyle.get(this.box)["--sprite-sheet-tails"]="spriteSheetTails";const e=()=>{var t,e,s;let i=Number(null!==(t=this.viewport.customColor.h)&&void 0!==t?t:0),r=Number(null!==(e=this.viewport.customColor.s)&&void 0!==e?e:1),a=Number(null!==(s=this.viewport.customColor.v)&&void 0!==s?s:1);this.rotateMainColor(i,r,a).then(()=>{this.box.node.style.setProperty("--sprite-sheet",`url(${this.args.rotatedSpriteSheet})`),this.box.node.style.setProperty("--sprite-sheet-tails",`url(${this.args.rotatedSpriteSheetTails})`)})},s=this.viewport.customColor.bindTo("h",e,{wait:0}),i=this.viewport.customColor.bindTo("s",e,{wait:0}),a=this.viewport.customColor.bindTo("v",e,{wait:0});this.onRemove(s),this.onRemove(i),this.onRemove(a),this.viewport.args.mainPallet&&this.costumes[this.viewport.args.mainPallet]&&Object.assign(this.viewport.customColor,this.costumes[this.viewport.args.mainPallet]),this.superSheet=0;const n={ffb691:"efefef",fcb400:"ebebeb",fc9000:"d4d4d4",b46c48:"b8b8b8"},o={ffb691:"fff79e",fcb400:"fefb00",fc9000:"fef500",b46c48:"ceae30"};this.superSpriteSheetLoaders||(this.superSpriteSheetLoaders=this.png.ready.then(()=>this.superSpriteSheets=[this.png.recolor(n).toUrl(),this.png.recolor(o).toUrl()]),this.superSpriteSheetTailsLoaders=this.pngTails.ready.then(()=>this.superSpriteSheetsTails=[this.pngTails.recolor(n).toUrl(),this.pngTails.recolor(o).toUrl()])),this.hyperSheet=0;const l={ffb691:"fcfcfc",fcb400:"fcfcfc",fc9000:"fcd8d8",b46c48:"fcb4b4"},h={ffb691:"fcfcfc",fcb400:"fcfcfc",fc9000:"fcd8fc",b46c48:"d8b4d8"},g={ffb691:"d8fcfc",fcb400:"fcfcfc",fc9000:"b4d8fc",b46c48:"90b4fc"},c={ffb691:"d8d8ff",fcb400:"b4b4d8",fc9000:"a4a4d8",b46c48:"6c6cb4"},d={ffb691:"d8fcfc",fcb400:"d8fcd8",fc9000:"b4fcb4",b46c48:"00fc24"},u={ffb691:"d8fcfc",fcb400:"d8fcb4",fc9000:"d8fc48",b46c48:"d8d800"},p={ffb691:"ffffff",fcb400:"fcfcfc",fc9000:"d8d8d8",b46c48:"b4b4b4"};this.hyperSpriteSheetLoader||(this.hyperSpriteSheetLoader=this.png.ready.then(()=>this.hyperSpriteSheets=[this.png.recolor(l).toUrl(),this.png.recolor(g).toUrl(),this.png.recolor(h).toUrl(),this.png.recolor(p).toUrl(),this.png.recolor(d).toUrl(),this.png.recolor(c).toUrl(),this.png.recolor(u).toUrl()]),this.hyperSpriteSheetLoaderTails=this.pngTails.ready.then(()=>this.hyperSpriteSheetsTails=[this.pngTails.recolor(l).toUrl(),this.pngTails.recolor(g).toUrl(),this.pngTails.recolor(h).toUrl(),this.pngTails.recolor(p).toUrl(),this.pngTails.recolor(d).toUrl(),this.pngTails.recolor(c).toUrl(),this.pngTails.recolor(u).toUrl()]))}startle(){super.startle(),this.args.animation="startle",this.onNextFrame(()=>this.args.animation="startle")}updateStart(){this.args.grinding&&this.args.falling&&this.args.ySpeed>0&&(this.args.animation="springdash",this.args.grinding=!1),super.updateStart(),this.args.dead&&(this.args.animation="dead")}update(){if(this.isSuper){this.isHyper?(this.viewport.args.frameId%15==0&&(this.hyperSheet++,this.hyperSheet>=this.hyperSpriteSheets.length&&(this.hyperSheet=0)),this.hyperSpriteSheet=this.hyperSpriteSheets[this.hyperSheet],this.hyperSpriteSheetTails=this.hyperSpriteSheetsTails[this.hyperSheet],this.args.spriteSheet=`url(${this.hyperSpriteSheet})`,this.args.spriteSheetTails=`url(${this.hyperSpriteSheetTails})`):(this.viewport.args.frameId%15==0&&(this.superSheet++,this.superSheet>=this.superSpriteSheets.length&&(this.superSheet=0)),this.superSpriteSheet=this.superSpriteSheets[this.superSheet],this.superSpriteSheetTails=this.superSpriteSheetsTails[this.superSheet],this.args.spriteSheet=`url(${this.superSpriteSheet})`,this.args.spriteSheetTails=`url(${this.superSpriteSheetTails})`);const t=this.isHyper?30:60;this.viewport.args.frameId%t==0&&(this.args.rings<2&&(this.isHyper=!1,this.setProfile()),this.args.rings>0?this.args.rings--:(this.isSuper=!1,this.isHyper=!1,this.setProfile()))}this.args.isSuper=this.isSuper,this.args.isHyper=this.isHyper,(!this.args.falling&&this.groundTime>3||this.args.falling&&this.fallTime>90)&&(this.args.twistRamp=!1),0===this.yAxis&&(this.args.lookTime=0,this.args.cameraBias=0);const t=this.args.falling;if(this.viewport)if((this.args.bouncing||this.args.wasHanging)&&(this.args.flying=!1,this.flyingSound&&this.flyingSound.pause()),this.args.flying?(this.args.gravity=this.args.slowGravity,this.args.ySpeed=Math.min(3,this.args.ySpeed)):this.args.gravity=this.args.normalGravity,this.viewport.args.audio&&this.flyingSound&&(this.flyingSound.paused||(this.flyingSound.volume=.35+-.3*Math.random()),this.flyingSound.currentTime>.2&&(this.flyingSound.currentTime=0)),this.box){if(this.args.tailFlyCoolDown>0&&this.args.tailFlyCoolDown--,this.args.tailFlyCoolDown<0&&this.args.tailFlyCoolDown++,this.args.tailFlyCoolDown,t)this.args.flying&&!this.args.startled?this.yAxis>0&&this.args.flying?(this.flyingSound.pause(),this.args.animation="jumping",this.args.float=0,this.args.flying=!1,this.args.ySpeed=this.args.ySpeed>this.args.jumpForce?this.args.ySpeed:this.args.jumpForce):(this.viewport.args.audio&&this.flyingSound.play(),this.args.animation="flying",this.flyTime>this.args.maxFlyTime&&(this.args.animation="flying-tired")):this.args.jumping&&(this.flyingSound.pause(),this.args.animation="jumping");else{this.args.tailFlyCoolDown=0,this.flyingSound.pause();const t=this.args.direction,e=this.args.gSpeed,s=Math.abs(e),i=this.args.gSpeedMax;this.args.grinding?(this.args.animation="grinding",this.args.rolling=!1):this.args.rolling?this.args.animation="rolling":Math.sign(this.args.gSpeed)!==t&&Math.abs(this.args.gSpeed-t)>5?this.args.animation="skidding":s>i?this.args.animation="running-2":s>i/2?this.args.animation="running":this.args.moving&&this.args.gSpeed?this.args.animation="walking":this.args.teeter?this.args.animation="teeter":this.idleTime>60?this.args.animation="idle":this.args.animation="standing"}if(this.args.startled&&(this.flyingSound.pause(),this.args.flying=!1),super.update(),this.args.hangingFrom&&(this.args.flying=!1,this.flyTime=0,this.args.animation="hanging"),this.args.grinding&&!this.args.falling&&this.args.gSpeed){const t=new r.Tag('<div class = "particle-sparks">'),e=new r.Tag('<div class = "envelope-sparks">');e.appendChild(t.node);const s=this.rotatePoint(1.75*-this.args.gSpeed*this.args.direction,8),i=Math.sign(this.args.gSpeed);e.style({"--x":s[0]+this.x,"--y":s[1]+this.y+-3*Math.random,"z-index":0,"animation-delay":.25*-Math.random()+"s","--xMomentum":Math.max(Math.abs(this.args.gSpeed),4)*i,"--flip":i,"--angle":this.realAngle,opacity:2*Math.random()}),e.particle=t,this.viewport.particles.add(e),this.sparks.add(e),this.viewport.onFrameOut(30,()=>{this.viewport.particles.remove(e),this.sparks.delete(e)})}if(this.sparks.size)for(const t of this.sparks){const e=this.rotatePoint(1.75*this.args.direction,8);t.style({opacity:2*Math.random(),"--x":e[0]+this.x,"--y":e[1]+this.y})}this.args.flying&&this.flyTime++,this.args.falling?"springdash"===this.args.animation&&this.args.ySpeed>=0&&(this.args.animation="dropping"):(this.flyTime=0,this.args.flying=!1),this.args.twistRamp&&(this.args.animation="side-flip"),this.args.falling||(this.dashed=!1)}else super.update()}updateEnd(){super.updateEnd()}command_0(t){this.args.hangingFrom?super.command_0():(super.command_0(t),this.args.jumping&&(this.args.wasHanging||(this.args.falling?this.args.flying&&0===this.args.tailFlyCoolDown?this.args.tailFlyCoolDown=80:this.args.flying&&(this.flyTime>this.args.maxFlyTime||this.args.float)||(this.args.flying&&!this.args.float&&(this.args.ySpeed=this.args.flyBoost,this.args.float=8),this.args.tailFlyCoolDown=80,this.args.flying=!0,this.flyingSound.volume=.35+-.3*Math.random(),this.viewport.args.audio&&this.flyingSound.paused&&this.flyingSound.play()):this.args.tailFlyCoolDown=-80)))}hold_0(t){this.args.flying&&t.time>10&&t.time<30&&this.flyTime<400&&(this.args.ySpeed*=.99,this.args.float=16)}sleep(){this.flyingSound&&this.flyingSound.pause()}collideA(t){t instanceof a.Spring&&this.onNextFrame(()=>{this.args.falling&&(this.springing=!0,this.args.animation="springdash")}),t.pop&&this.isHyper&&t.pop(this)}damage(){this.args.flying=!1,this.flyingSound&&this.flyingSound.pause(),super.damage()}rotateMainColor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i={ffb691:new d.Color("ffb691").rotate(t,e,s).toString(),fcb400:new d.Color("fcb400").rotate(t,e,s).toString(),fc9000:new d.Color("fc9000").rotate(t,e,s).toString(),b46c48:new d.Color("b46c48").rotate(t,e,s).toString()};return this.png.ready.then(()=>{const t=this.png.recolor(i);this.args.rotatedSpriteSheet=this.rotatedSpriteSheet=this.spriteSheet=t.toUrl(),this.args.spriteSheet=`url(${this.spriteSheet})`}),this.pngTails.ready.then(()=>{const t=this.pngTails.recolor(i);this.args.rotatedSpriteSheetTails=this.rotatedSpriteSheetTails=this.spriteSheetTails=t.toUrl(),this.args.spriteSheetTails=`url(${this.spriteSheetTails})`}),Promise.all([this.png.ready,this.pngTails.ready])}setProfile(){this.isHyper?(this.args.spriteSheet=`url('${this.hyperSpriteSheet}')`,this.args.spriteSheetTails=`url('${this.hyperSpriteSheetTails}')`,this.args.maxFlyTime=this.args.maxFlyTimeHyper,this.args.flyBoost=this.args.flyBoostHyper,this.args.gSpeedMax=this.gSpeedMaxHyper,this.args.jumpForce=this.jumpForceHyper,this.args.accel=this.accelSuper):this.isSuper?(this.args.spriteSheet=`url('${this.superSpriteSheet}')`,this.args.spriteSheetTails=`url('${this.superSpriteSheetTails}')`,this.args.maxFlyTime=this.args.maxFlyTimeSuper,this.args.flyBoost=this.args.flyBoostSuper,this.args.gSpeedMax=this.gSpeedMaxSuper,this.args.jumpForce=this.jumpForceSuper,this.args.accel=this.accelSuper):(this.args.spriteSheet=`url('${this.rotatedSpriteSheet}')`,this.args.spriteSheetTails=`url('${this.rotatedSpriteSheetTails}')`,this.args.maxFlyTime=this.args.maxFlyTimeNormal,this.args.flyBoost=this.args.flyBoostNormal,this.args.gSpeedMax=this.gSpeedMaxNormal,this.args.jumpForce=this.jumpForceNormal,this.args.accel=this.accelNormal)}command_2(){if(this.viewport.collisions.has(this)){const t=this.viewport.collisions.get(this);for(const e of t.keys())this.carrying.size&&!this.carrying.has(e)||"function"==typeof e.lift&&e.lift(this)}}command_3(){}get solid(){return!1}get canRoll(){return!0}get canFly(){return!0}get isEffect(){return!1}get controllable(){return!this.args.npc}}}),require.register("actor/TechnoSqueak.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TechnoSqueak=void 0;e("./Flickie");var i=e("curvature/base/Mixin"),r=e("./PointActor"),a=e("../behavior/Patrol"),n=e("../mixin/CanPop");t.TechnoSqueak=class extends(i.Mixin.from(r.PointActor,n.CanPop)){constructor(){var t,e,s;super(...arguments),this.behaviors.add(new a.Patrol),this.args.type="actor-item actor-techno-squeak",this.args.animation="standing",this.args.accel=.75,this.args.decel=.5,this.args.gSpeedMax=15,this.args.jumpForce=5,this.args.gravity=.5,this.args.width=24,this.args.height=14,this.willStick=!0,this.stayStuck=!0,this.args.patrolPause=null!==(t=this.args.patrolPause)&&void 0!==t?t:20,this.args.patrolBeat=null!==(e=this.args.patrolBeat)&&void 0!==e?e:120,this.args.patrolSpeed=null!==(s=this.args.patrolSpeed)&&void 0!==s?s:4,this.args.tailOffset=0,this.stayStuck=!0}onRendered(t){super.onRendered(t),this.autoStyle.get(this.box)["--tailOffset"]="tailOffset",this.autoAttr.get(this.box)["data-color"]="color"}update(){this.args.shotTelegraph,this.args.patrolBeat;const t=this.args.x-this.xLast;this.args.tailOffset+=isNaN(t)?0:t,this.box&&(this.args.moving&&this.args.gSpeed?this.box.setAttribute("data-animation","walking"):this.box.setAttribute("data-animation","standing")),super.update(),this.args.direction=Math.sign(this.args.gSpeed)}effect(t){super.effect(t)}get solid(){return!1}get isEffect(){return!1}}}),require.register("actor/Tester.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tester=void 0;var i=e("./PointActor"),r=(e("./Cursor"),e("../ObjectPalette"));function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}window.testRuns=[];t.Tester=class extends i.PointActor{constructor(){super(...arguments),a(this,"count",0),a(this,"char",null)}update(){if(this.char){const t=this.char.controller,e=4;5===this.char.age&&t.press(e,1),6===this.char.age&&t.press(e,0),this.char.readInput()}else{const t=r.ObjectPalette.sonic,e=this.count;this.char=new t({name:`Test #${e}`,x:this.x+-e%160+80,y:this.y});const s=this.char.args.bindTo("falling",()=>{const t=this.char.x;this.viewport.onFrameOut(5,()=>{console.log({count:e,landed:t,groundAngle:this.char.args.groundAngle,gSpeed:this.char.args.gSpeed})}),s()},{now:!1,frame:1});window.testRuns[e]=this.char,this.count++,this.viewport.spawn.add({object:this.char})}if(this.char.args.dead){const t=this.char;this.char=null,this.viewport.onFrameOut(100,()=>this.viewport.actors.remove(t))}else this.char.age>30&&(this.char.xAxis=1)}updateEnd(){this.char}}}),require.register("actor/TextActor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextActor=void 0;var i=e("./PointActor"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.TextActor=class extends i.PointActor{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;super(t,e),a(this,"float",-1),this.args.type="actor-item actor-text-actor",this.args.float=-1,this.args.static=!0,this.text=new r.CharacterString({value:""}),this.args.bindTo("content",e=>{this.text.args.value=e,this.text.args.color=t.color,this.args.width=e?18*e.length:0,this.args.height=18})}onRendered(t){super.onRendered(t),this.sprite=this.findTag("div.sprite"),this.text.render(this.sprite)}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/TilesetSwapper.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetSwapper=void 0;var i=e("./PointActor"),r=e("../effects/ScreenFire"),a=e("../BackdropPalette");t.TilesetSwapper=class extends i.PointActor{constructor(t,e){if(super(t,e),this.args.hidden=!0,new Image("../Sonic/tiles/azure-lake/azure-lake-burnt.png"),a.BackdropPalette[this.args.backdrop]){const t=a.BackdropPalette[this.args.backdrop];this.args.backdrop=new t}}activate(t,e){this.activated||(this.activated=!0,this.viewport.onFrameOut(15,()=>{const t=new r.ScreenFire;this.viewport.args.screenEffects.add(t),this.viewport.onFrameOut(300,()=>{this.viewport.args.screenEffects.remove(t),t.remove()}),this.viewport.onFrameOut(90,()=>{this.viewport.tileMap.replacements.set("/map/../Sonic/tiles/azure-lake/azure-lake.png","/map/../Sonic/tiles/azure-lake/azure-lake-burnt.png"),this.viewport.args.backdrop=this.args.backdrop,this.viewport.tileMap.replacements.set("/map/../Sonic/tiles/azure-lake/azure-lake-shapes.png","/map/../Sonic/tiles/azure-lake/azure-lake-burnt-shapes.png"),this.viewport.tileMap.replacements.set("/map/../Sonic/tiles/azure-lake/rolling.png","/map/../Sonic/tiles/azure-lake/rolling-burnt.png"),this.viewport.tileMap.replacements.set("/map/../Sonic/tiles/azure-lake/giant-loop.png","/map/../Sonic/tiles/azure-lake/giant-loop-burnt.png"),this.viewport.tileMap.replacements.set("/map/../Sonic/azure-lake-platform.png","/map/../Sonic/azure-lake-platform-burnt.png")})}))}}}),require.register("actor/Torch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Torch=void 0;var i=e("./PointActor");t.Torch=class extends i.PointActor{constructor(){super(...arguments),this.args.width=16,this.args.height=32,this.args.type="actor-item actor-torch",this.args.float=-1}get solid(){return!1}}}),require.register("actor/Tornado.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tornado=void 0;var i=e("./Vehicle"),r=e("curvature/base/Tag");t.Tornado=class extends i.Vehicle{constructor(){super(...arguments),this.args.type="actor-item actor-tornado",this.args.width=96,this.args.height=48,this.removeTimer=null,this.args.xSpeedMaxThrusting=64,this.args.xSpeedMaxOriginal=32,this.args.xSpeedMax=this.args.xSpeedMaxOriginal,this.args.gSpeedMax=5,this.args.decel=.15,this.args.accel=.5,this.args.seatHeight=14,this.args.seatForward=-32,this.args.skidTraction=.95,this.dustCount=0,this.args.flyAngle=-.25,this.args.particleScale=2,this.args.float=-1,this.args.thrusting=!1,this.args.landingGear=!0,this.args.jumpForce=8,this.args.fuelLevel=100,this.args.thrusterFill=0,this.args.noThrust=0,this.plane=new r.Tag('<div class = "plane">'),this.fuselage=new r.Tag('<div class = "fuselage">'),this.propeller=new r.Tag('<div class = "propeller">'),this.thruster=new r.Tag('<div class = "thruster">'),this.fuelMeter=new r.Tag('<div class = "fuel-meter">'),this.frontGear=new r.Tag('<div class = "front-landing-gear">'),this.rearGear=new r.Tag('<div class = "rear-landing-gear">')}onRendered(t){super.onRendered(t),this.box=this.findTag("div"),this.sprite=this.findTag("div.sprite"),this.sprite.appendChild(this.plane.node),this.thruster.appendChild(this.fuelMeter.node),this.plane.appendChild(this.thruster.node),this.plane.appendChild(this.propeller.node),this.plane.appendChild(this.frontGear.node),this.plane.appendChild(this.rearGear.node),this.plane.appendChild(this.fuselage.node),this.args.bindTo("landingGear",t=>{this.plane&&this.plane.setAttribute("data-landing-gear",t)}),this.args.bindTo("thrusting",t=>{this.plane&&this.plane.setAttribute("data-thrusting",t)})}update(){if(this.occupant&&this.args.falling||(this.args.flyAngle=this.args.falling?.26:-.26,this.args.flying=!1,this.args.float=0),!this.args.thrusting&&Math.abs(this.args.xSpeed)<8?(this.args.float=0,this.args.flying=!1):this.args.falling&&(this.args.float=-1,this.args.flying=!0),!this.args.jumping&&0===this.args.xSpeed&&this.args.falling)return this.args.flying=!1,this.args.float=0,this.args.thrusting&&(this.args.crashed=!0,this.args.thrusting=!1,this.args.noThrust=Date.now()+500),void super.update();const t=this.args.xSpeedMaxThrusting;if(this.args.thrusting&&this.args.fuelLevel<=0&&(this.args.thrusting=!1,this.args.noThrust=Date.now()+500,this.args.thrusterFill=Date.now()+500),this.args.thrusting?(this.args.xSpeedMax=this.args.xSpeedMaxThrusting,this.args.fuelLevel>0&&(this.args.fuelLevel-=.1)):(this.args.xSpeedMax=this.args.xSpeedMaxOriginal,this.args.thrusterFill<Date.now()&&this.args.fuelLevel<100&&(this.args.fuelLevel+=.25)),this.fuelMeter.style({"--fuelLevel":this.args.fuelLevel/100}),!this.args.thrusting&&Math.abs(this.args.xSpeed)>t&&(this.args.xSpeed-=.2*Math.sign(this.args.xSpeed)),this.args.thrusting&&(Math.sign(this.args.xSpeed)!==this.args.direction||Math.abs(this.args.xSpeed)<t)&&(this.args.falling||0!==this.args.xSpeed||(this.args.flyAngle=-.26,this.args.falling=!0,this.args.flying=!0,this.args.ySpeed=-5),this.args.xSpeed+=4*Math.sign(this.args.direction)),Math.abs(this.args.xSpeed)>this.args.xSpeedMax/2&&!this.args.thrusting&&!this.xAxis&&(this.args.xSpeed*=.95),Math.abs(this.args.xSpeed)>t&&(this.args.xSpeed=t*Math.sign(this.args.direction)),this.args.flying){if(0===this.args.ySpeed&&(this.args.flyAngle=0),this.args.landingGear?!this.args.thrusting&&this.args.flyAngle<Math.PI/4?this.args.flyAngle+=.005:this.args.thrusting&&this.args.flyAngle>-Math.PI/4&&(this.args.flyAngle-=.005):Math.abs(this.args.flyAngle)>.00125?this.args.flyAngle-=.00125*Math.sign(this.args.flyAngle):this.args.flyAngle=0,!this.args.xSpeed)return void(this.args.flying=!1);const t=this.args.flyAngle+.035*Math.sign(this.yAxis);if(this.args.flyAngle>0?this.args.xSpeed*=1.025:this.args.flyAngle>0&&(this.args.xSpeed/=1.025),this.yAxis&&Math.abs(t)<Math.PI/2&&(this.args.flyAngle=t),Math.sign(this.args.xSpeed)===this.args.direction){const t=this.args.xSpeed||this.args.gSpeed;this.args.ySpeed=Math.sin(this.args.flyAngle)*t*(this.args.direction||Math.sign(t))*2}}else!this.args.thrusting&&this.args.flyAngle<Math.PI/2&&this.args.ySpeed>0&&(this.args.flyAngle+=.025);this.args.flying&&(this.args.airAngle=this.args.flyAngle,this.args.jumping=!1),this.args.falling||(this.args.landingGear=!0,this.args.flyAngle=-.26),super.update(),this.args.flying&&(this.args.cameraMode="airplane")}command_1(){this.args.falling&&(this.args.landingGear=!this.args.landingGear)}hold_2(){!this.args.thrusting&&this.args.fuelLevel<=1||this.args.fuelLevel<=0||(this.args.crashed||this.args.noThrust>Date.now()?this.args.false=!0:this.args.thrusting=!0)}release_2(){this.args.thrusting=!1,this.args.crashed=!1}get solid(){return!this.occupant}}}),require.register("actor/ToxicBarrel.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToxicBarrel=void 0;var i=e("./MarbleBlock"),r=e("./BarnacleTrap"),a=e("../audio/Sfx");t.ToxicBarrel=class extends i.MarbleBlock{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.args.type="actor-item actor-toxic-barrel",this.args.density=this.args.density||9.5,this.played=!1,this.args.width=23,this.args.height=32,this.args.weight=0}collideA(t,e){return!(t instanceof r.BarnacleTrap)&&(this.args.falling&&t.pop&&this.pop(),"exploding"===this.args.animation?(t.damage&&t.damage(this,"explosion"),t.pop&&t.pop(this),!1):(this.args.falling&&t.args.modeTime<3&&(t.args.gSpeed=0),!this.args.falling&&super.collideA(t,e)))}update(){"exploding"===this.args.animation&&(this.args.float=-1,this.args.xSpeed=0,this.args.ySpeed=0,this.castRayQuick(32,0,[0,-16]),this.castRayQuick(32,Math.PI,[0,-16]),this.castRayQuick(32,Math.PI/2,[0,-16]),this.castRayQuick(32,Math.PI/-2,[0,-16])),super.update(),!this.args.falling&&this.ySpeedLast>3&&this.pop()}pop(){this.args.animation="exploding";const t=this.viewport;t.onFrameOut(20,()=>t.actors.remove(this)),this.played||(a.Sfx.play("BARREL_EXPLODE"),this.played=!0)}sleep(){this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.ySpeedLast=0,this.onNextFrame(()=>{this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.viewport.setColCell(this),this.args.xSpeed=0,this.args.ySpeed=0,this.args.pushed=0,this.args.float=0})}get solid(){return!this.args.falling&&!this.args.hangingFrom}}}),require.register("actor/Tree.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;var i=e("./PointActor"),r=e("./Coconut"),a=e("curvature/base/Tag");t.Tree=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.height=t.height,e}constructor(){super(...arguments),this.args.type="actor-item actor-tree",this.args.z=-1,this.args.width=80,this.args.lean=0,this.args.coconutCount=4,this.args.shakeTime=0}updateEnd(){super.updateEnd();const t=this.viewport.collisions.get(this);let e=!1;if(t)for(const s of t.keys())"shakingTree"===s.args.currentState&&(e=Math.sign(this.args.x-s.args.x));this.args.shaking=e}update(){this.viewport.args.frameId,this.args.shaking?(this.args.lean=Math.trunc(this.args.shakeTime/10)%2*2+-1*this.args.shaking,this.args.shakeTime++):(this.viewport.args.frameId-this.args.lastChange>1200&&this.args.coconutCount<4&&(this.args.coconutCount++,this.args.lastChange=this.viewport.args.frameId),this.args.shakeTime=0,this.args.lean=0),this.args.shakeTime>120&&(this.args.shakeTime=-60,this.dropFruit()),super.update()}onRendered(t){super.onRendered(t),this.box&&!this.top&&(this.top=new a.Tag('<div class = "tree-top">'),this.box.appendChild(this.top.node)),this.autoStyle.get(this.box)["--count"]="coconutCount",this.autoStyle.get(this.box)["--lean"]="lean"}collideA(t,e){t.controllable&&(Math.abs(t.args.x-this.args.x)>20||t.args.y>this.args.y+-this.args.height+64||(this.ignores.set(t,45),this.dropFruit(t)))}dropFruit(t){if(this.args.coconutCount){this.args.coconutCount--,this.args.lastChange=this.viewport.args.frameId;const e=new r.Coconut;e.args.x=this.args.x,e.args.y=this.args.y+-this.args.height+48,this.viewport.spawn.add({object:e}),t?(this.viewport.onFrameOut(1,()=>e.args.xSpeed=t.args.xSpeed||t.args.direction*Math.random()*2),this.args.lean=5*Math.sign(t.args.xSpeed)):this.viewport.onFrameOut(1,()=>e.args.xSpeed=.5*this.args.lean+2.5*this.args.lean*Math.random()),this.viewport.onFrameOut(10,()=>this.args.lean=0)}}sleep(){this.args.coconutCount=4}get solid(){return!1}}}),require.register("actor/TrickRamp.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrickRamp=void 0;var i=e("./PointActor");t.TrickRamp=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}constructor(){super(...arguments),this.args.type="actor-item actor-trick-ramp",this.args.width=this.args.width||64,this.args.height=this.args.height||64,this.args.float=-1,this.args.static=1,this.args.power=this.args.power||24}collideA(t){if(!(t.args.x<this.args.x)&&!(Math.abs(t.args.gSpeed)<8&&t.willJump)&&(!(Math.abs(t.args.gSpeed)<14&&t.args.rolling)||t.willJump)&&(t.willJump||t.args.rolling)){if(!t.args.falling){const e={label:"OFF THE RAMP",points:100,multiplier:1,color:"orange",special:!0};t.args.popChain.push(e),t.args.popCombo+=1}const e=Math.sign(t.args.gSpeed||t.gSpeedLast);t.args.trickRamp=!0,t.args.ignore=5,t.args.xSpeed=this.args.power*e,t.args.ySpeed=.65*-this.args.power,t.args.float=18,t.args.y-=5,t.args.rolling=!0,t.args.falling=!0,t.willJump=!1,t.dashed=!0}}}}),require.register("actor/TruckBody.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TruckBody=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin");t.TruckBody=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-truck-body",this.args.width=145,this.args.height=48,this.args.gravity=.4,this.args.float=-1,this.noClip=1,this.args.driver=this.args.driver||null,this.args.ramming=!0}collideA(t,e){this.args.destroyed||(t.break?t.break(this):t.pop?t.pop(this):t.controllable&&t.damage(this))}}}),require.register("actor/TruckCab.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TruckCab=void 0;var i=e("./PointActor"),r=e("curvature/base/Mixin");t.TruckCab=class extends(r.Mixin.from(i.PointActor)){constructor(){super(...arguments),this.args.type="actor-item actor-truck-cab",this.args.width=49,this.args.height=51,this.args.gravity=.4,this.args.float=-1,this.noClip=1,this.args.driver=this.args.driver||null,this.args.ramming=!0}collideA(t,e){this.args.destroyed||(t.break?t.break(this):t.pop?t.pop(this):t.controllable&&t.damage(this))}}}),require.register("actor/Tumbler.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tumbler=void 0;var i=e("./PointActor");t.Tumbler=class extends i.PointActor{constructor(){super(...arguments),this.args.decel=.1,this.args.width=96,this.args.height=35,this.args.type="actor-item actor-tumbler",this.args.color=this.args.color||["red","green","blue"][Math.trunc(3*Math.random())],this.tumbling=!1,this.bounced=0}onRendered(t){super.onRendered(t),this.autoAttr.get(this.box)["data-color"]="color",this.autoAttr.get(this.box)["data-model"]="model"}update(){this.tumbling&&!this.args.falling&&(this.args.xSpeed=this.xSpeedLast,this.args.ySpeed=Math.max(-10,-this.ySpeedLast),this.args.y--,this.args.falling=!0,this.bounced++),this.tumbling,this.noClip=!!this.bounced,this.noClip&&(this.args.xSpeed=this.args.gSpeed=0),super.update()}collideA(t,e){if(!t.controllable&&!t.isVehicle||this.args.falling)return;const s=t.args.gSpeed||t.args.xSpeed;Math.abs(s)>8&&(this.args.animation="tumbling",this.args.xSpeed=s+5*Math.random(),this.args.ySpeed=Math.max(-10,-Math.abs(.25*s)+-2*Math.random()),this.args.falling=!0,this.tumbling=!0,this.isGhost=!0),super.collideA(t,e)}}}),require.register("actor/Turtloid.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Turtloid=void 0;var i=e("./Block");e("../audio/Sfx");t.Turtloid=class extends i.Block{constructor(){super(...arguments),this.args.width=56,this.args.height=24,this.args.platform=1,this.args.float=-1,this.args.type="actor-item actor-turtloid",this.args.static=0,this.args.pathSpeed=4}updateStart(){!this.standingUnder.size||this.others.guard&&!this.others.guard.removed?this.otherDefs.path=null:this.otherDefs.path=this.otherDefs.ridePath,super.updateStart(),this.xLast&&(this.args.direction=Math.sign(this.args.x-this.xLast)||this.args.direction);const t=this.xLast-this.args.x,e=this.yLast-this.args.y;this.args.animation=t?"swimming":e?"sinking":"idle"}}}),require.register("actor/TwistRamp.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TwistRamp=void 0;var i=e("./PointActor");t.TwistRamp=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}constructor(){super(...arguments),this.args.type="actor-item actor-twist-ramp",this.args.width=this.args.width||64,this.args.height=this.args.height||64,this.args.float=-1,this.args.static=1,this.args.power=this.args.power||24}collideA(t){if(!(t.args.x<this.args.x)&&!(Math.abs(t.args.gSpeed)<8&&t.willJump)&&(!(Math.abs(t.args.gSpeed)<14&&t.args.rolling)||t.willJump)&&Math.abs(t.args.gSpeed)>8){const e=Math.sign(t.args.gSpeed||t.gSpeedLast);t.args.twistRamp=!0,t.args.ignore=5,0===t.args.mode?(t.args.xSpeed=this.args.power*e,t.args.ySpeed=.65*-this.args.power,t.args.y-=5):2===t.args.mode?(t.args.xSpeed=-this.args.power*e,t.args.ySpeed=.65*this.args.power,t.args.y+=5):3===t.args.mode?(t.args.xSpeed=.65*-this.args.power,t.args.ySpeed=-this.args.power*e,t.args.x-=5):1===t.args.mode&&(t.args.xSpeed=.65*this.args.power,t.args.ySpeed=this.args.power*e,t.args.x+=5),t.args.float=18,t.args.rolling=!0,t.args.falling=!0,t.willJump=!1,t.dashed=!0}}}}),require.register("actor/Umbrella.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Umbrella=void 0;var i=e("./PointActor");t.Umbrella=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e}constructor(){var t;super(...arguments),this.args.width=20,this.args.height=null!==(t=this.args.height)&&void 0!==t?t:80,this.args.type="actor-item actor-umbrella"}get solid(){return!1}}}),require.register("actor/UnbreakableCrate.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnbreakableCrate=void 0;e("./PointActor");var i=e("./Block");t.UnbreakableCrate=class extends i.Block{constructor(t,e){super(t,e),this.args.type="actor-item actor-unbreakable-crate",this.args.width=64,this.args.height=64,this.args.static=!1}update(){this.viewport&&this.args.gate&&(this.viewport.actorsById[this.args.gate].args.hitPoints||this.viewport.actors.remove(this)),super.update()}collideA(t,e){return!0}damage(t,e){return!0}}}),require.register("actor/Vehicle.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vehicle=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Vehicle=class extends i.PointActor{constructor(){super(...arguments),r(this,"dead",!1)}update(){this.occupant&&(this.running=this.occupant.running,this.crawling=this.occupant.crawling),super.update()}collideA(t,e){if(t.noClip)return!1;if(t.controllable){if(t.args.falling&&this.y+-t.y+24<=this.args.seatHeight)return!1;if(t.args.ySpeed>0&&!this.occupant){const e=this.args.seatHeight||0;return t.args.ySpeed=0,t.args.y=this.y+-e+1,t.args.x=this.x,t.args.standingOn=this,!0}return!1}return!(t.y>=this.y||(t.args.float||(t.args.ySpeed=-t.args.ySpeed,t.args.xSpeed=t.args.xSpeed||5*t.args.direction,t.args.ySpeed>-5&&(t.args.ySpeed=-5)),1))}standBelow(t){t.controllable||(t.args.ySpeed=-t.args.ySpeed,t.args.xSpeed=t.args.xSpeed||5*t.args.direction,t.args.ySpeed>-5&&(t.args.ySpeed=-5))}get isVehicle(){return!0}sleep(){super.sleep(),this.dead&&this.viewport.actors.remove(this)}}}),require.register("actor/Voltorb.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Voltorb=void 0;var i=e("../actor/GohlaBall");t.Voltorb=class extends i.GohlaBall{constructor(){super(...arguments),this.args.type="actor-item actor-gohla-ball actor-voltorb"}update(){if(super.update(),!this.viewport)return;if(!this.viewport.controlActor)return;const t=this.viewport.controlActor;this.direction=Math.sign(this.x-t.x),this.args.facing=this.direction<0?"left":"right",Math.abs(t.y-this.y)<=16&&Math.abs(t.x-this.x)<34?(this.args.animation="sparking",t.damage(this,"electric")):t.args.dead||t.args.mercy||(this.args.animation="standing")}}}),require.register("actor/WaterController.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterController=void 0;var i=e("./PointActor");t.WaterController=class extends i.PointActor{constructor(t,e){super(t,e),this.args.activated=!1,this.args.levelLimit=this.args.levelLimit||0,this.args.levelSpeed=this.args.levelSpeed||1,this.args.level=this.args.level||0,this.args.static=!0,this.args.hidden=!0}updateStart(){super.updateStart(),this.args.switch&&!this.switch&&(this.switch=this.viewport.actorsById[this.args.switch]),this.switch&&this.switch.args.active>0&&this.activate(this.switch.activator,this.switch)}update(){if(this.args.level<this.args._levelLimit&&(this.args.level+=this.args.levelSpeed||0),this.args.level>this.args._levelLimit){this.args.levelSpeed=0,this.args.level=this.args._levelLimit;const t=this.viewport;t.onFrameOut(30,()=>{if(t.auras.delete(this),void 0!==this.args.target){const e=t.actorsById[this.args.target];t.auras.delete(e)}})}}activate(t,e){if(!this.args.activated&&(this.args._levelLimit=this.args.levelLimit||4096,this.viewport.auras.add(this),this.args.activated=!0,void 0!==this.args.target&&this.viewport.actorsById[this.args.target])){const e=this.viewport.actorsById[this.args.target];this.viewport.auras.add(e),e.activate(t,this)}}}}),require.register("actor/WaterFall.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterFall=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WaterFall=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.toHeight=t.toHeight||0,e.args.x=t.x+32,e.args.yOriginal=t.y,e}constructor(){var t;super(...arguments),r(this,"float",-1),this.args.width=this.args.width||32,this.args.height=this.args.height||64,this.args.upward=null!==(t=this.args.upward)&&void 0!==t&&t,this.args.type="actor-item actor-water-fall",this.args.active=!1,this.args.static=!0}onRendered(){super.onRendered(),this.autoAttr.get(this.box)["data-upward"]="upward"}wakeUp(){this.switch=this.viewport.actorsById[this.args.switch]}update(){if(super.update(),this.args.toHeight!==this.args.height){const t=this.args.toHeight-this.args.height,e=32*Math.sign(t);t<=e?(this.args.height=this.args.toHeight,this.args.y=this.args.yOriginal+this.args.toHeight):(this.args.height+=e,this.args.y+=e)}this.switch&&this.switch.args.active>0&&!this.args.active&&(this.args.active=!0,this.args.toHeight=this.args.openHeight,this.args.y-=this.args.openOffset)}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/WaterJet.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterJet=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WaterJet=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.x=t.x+t.width/2,e}constructor(){super(...arguments),r(this,"float",-1),this.args.width=this.args.width||32,this.args.height=this.args.height||64,this.args.type="actor-item actor-water-jet",this.args.active=!1,this.args.static=!0}wakeUp(){this.switch=this.viewport.actorsById[this.args.switch]}update(){super.update(),this.viewport&&this.args.switch&&this.switch&&this.switch.args.active&&!this.args.active&&(this.args.active=!0,this.onNextFrame(()=>{this.args.x+=.5*this.args.openWidth+-.5*this.args.width,this.args.width=this.args.openWidth}))}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/WaterSpout.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterSpout=void 0;var i=e("./PointActor");t.WaterSpout=class extends i.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.rotation=t.rotation,e.args.height=t.height,e}constructor(){var t,e;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(s,arguments.length>1?arguments[1]:void 0),this.args.type="actor-item actor-water-spout",this.args.float=null!==(t=this.args.float)&&void 0!==t?t:-1,this.args.static=null===(e=this.args.static)||void 0===e||e,this.args.width=s.width||32,this.args.height=s.height||64}get solid(){return!1}}}),require.register("actor/WindStone.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WindStone=void 0;var i=e("../ui/CharacterString"),r=e("./PointActor");t.WindStone=class extends r.PointActor{constructor(){super(...arguments),this.args.width=8,this.args.height=24,this.args.type="actor-item actor-wind-stone",this.args.inPlace=!1,this.label=new i.CharacterString({value:""}),this.args.charStrings=[this.label],this.args.bindTo("inPlace",t=>{t?this.args.charStrings.splice(0):this.args.charStrings[0]=this.label}),this.bindTo("carriedBy",t=>{if(this.cX&&(this.cX(),this.cX=null),this.cY&&(this.cY(),this.cY=null),t)this.cX=t.args.bindTo("x",e=>this.args.x=e+8*t.args.direction),this.cY=t.args.bindTo("y",t=>this.args.y=t+-16),t.carrying.add(this),this.args.float=-1,this.args.charStrings.splice(0);else if(this.carriedBy){const t=this.carriedBy;this.carriedBy=null,this.args.xSpeed=t.args.xSpeed,this.args.ySpeed=t.args.ySpeed,this.args.xSpeed+=4*Math.sign(t.args.gSpeed||t.args.xSpeed),this.args.ySpeed-=4,t.carrying.delete(this),this.args.falling=!0,this.args.float=0,this.args.inPlace||(this.args.charStrings[0]=this.label)}})}lift(t){this.args.inPlace||(this.carriedBy!==t?this.carriedBy=t:this.carriedBy=null)}update(){super.update(),this.args.inPlace&&(this.args.x+=Math.sign(this.args.standingOn.args.x-this.args.x))}get solid(){return!1}}}),require.register("actor/Window.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Window=void 0;var i=e("./PointActor");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Window=class extends i.PointActor{constructor(){super(...arguments),r(this,"float",-1),this.args.type="actor-item actor-window",this.args.width=64,this.args.height=160}get solid(){return!1}get isEffect(){return!0}}}),require.register("actor/WoodenCrate.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WoodenCrate=void 0;var i=e("./BreakableBlock"),r=e("../behavior/Platformer"),a=e("./Projectile"),n=e("./Spring"),o=e("./Block"),l=e("../audio/Sfx"),h=e("./OrbSmall");t.WoodenCrate=class extends i.BreakableBlock{constructor(){super(...arguments),this.args.type="actor-item actor-breakable-block actor-wooden-crate",this.args.width=64,this.args.height=64,this.args.static=!1,this[n.Spring.WontSpring]=!0}updateStart(){this.args.static?this.args.static=!!this.bMap("checkBelow",this.x,this.y+1).get(r.Platformer):this.args.static=!this.args.falling,(this.args.gSpeed||this.args.xSpeed)&&(this.args.static=!1),super.updateStart()}update(){const t=this.args.falling;super.update(),t&&!this.args.falling&&this.ySpeedLast>9&&l.Sfx.play("WOOD_THUD")}collideA(t,e){return!t.args.ramming&&(t instanceof o.Block||!(0!==e||!t.controllable)||(t instanceof h.OrbSmall&&!this.broken?(this.break(t),!1):t instanceof a.Projectile&&!this.broken?(this.break(t),!0):1!==e&&3!==e||t.y<=this.y-this.args.height||(t.args.rolling||2===e?(this.args.gSpeed=0,this.args.xSpeed=0,this.break(t),!1):t.punching&&!this.broken?(this.args.gSpeed=0,this.args.xSpeed=0,this.break(t),!1):!!this.viewport&&(-1!==e&&!t.args.rolling||super.collideA(t,e)))))}setTile(){this.args.spriteSheet="/Sonic/wooden-crate.png"}}}),require.register("actor/Zipline.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Zipline=void 0;var i=e("./PointActor");t.Zipline=class extends i.PointActor{constructor(){super(...arguments),this.args.width=1,this.args.height=1,this.args.type="actor-item actor-zipline",this.args.z=128,this.args.static=!1,this.breakable=!1,this.args.decel=0,this.args.accel=0}activate(){this.viewport.auras.add(this),this.args.launched=!0}update(){if(this.args.launched){this.args.gSpeed<1&&(this.args.gSpeed=1),this.args.gSpeed+=.1;const t=1/0;this.args.gSpeed>t&&(this.args.gSpeed=t)}super.update()}collideA(t,e){return!this.breakable||super.collideA(t,e)}}}),require.register("actor/monitor/InfoMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InfoMonitor=void 0;var i=e("../Monitor");e("../../audio/Sfx");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.InfoMonitor=class extends i.Monitor{constructor(){super(...arguments),r(this,"name","Info Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"info"})}effect(t){this.args.target&&this.viewport.actorsById[this.args.target]&&(this.viewport.actorsById[this.args.target].activate(t,this,!0),t.args.xSpeed*=.25,t.dropDashCharge=0)}}}),require.register("actor/monitor/RingMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RingMonitor=void 0;var i=e("../Monitor"),r=e("../../audio/Sfx");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.RingMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Ring Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"ring"})}effect(t){t.args.rings+=10,r.Sfx.play("RING_COLLECTED")}}}),require.register("actor/monitor/SheildElectricMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheildElectricMonitor=void 0;var i=e("../Monitor"),r=e("../../powerups/ElectricSheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SheildElectricMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Lightning Monitor")}onRendered(t){super.onRendered(t),this.box&&this.box.attr({"data-monitor":"sheild-electric"})}effect(t){if(!t.controllable)return;const e=new r.ElectricSheild;t.inventory.add(e)}}}),require.register("actor/monitor/SheildFireMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheildFireMonitor=void 0;var i=e("../Monitor"),r=e("../../powerups/FireSheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SheildFireMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Fire Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"sheild-fire"})}effect(t){if(!t.controllable)return;const e=new r.FireSheild;t.inventory.add(e)}}}),require.register("actor/monitor/SheildNormalMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheildNormalMonitor=void 0;var i=e("../Monitor"),r=e("../../powerups/NormalSheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SheildNormalMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Shield Monitor")}onRendered(t){super.onRendered(t),this.box&&this.box.attr({"data-monitor":"sheild-normal"})}effect(t){if(!t.controllable)return;const e=new r.NormalSheild;t.inventory.add(e)}}}),require.register("actor/monitor/SheildStarMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheildStarMonitor=void 0;var i=e("../Monitor"),r=e("../../powerups/StarSheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SheildStarMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Star Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"sheild-star"})}effect(t){if(!t.controllable)return;const e=new r.StarSheild;t.inventory.add(e)}}}),require.register("actor/monitor/SheildWaterMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheildWaterMonitor=void 0;var i=e("../Monitor"),r=e("../../powerups/BubbleSheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SheildWaterMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Bubble Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"sheild-water"})}effect(t){if(!t.controllable)return;const e=new r.BubbleSheild;t.inventory.add(e)}}}),require.register("actor/monitor/TripleRingMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TripleRingMonitor=void 0;var i=e("../Monitor"),r=e("../../audio/Sfx");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.TripleRingMonitor=class extends i.Monitor{constructor(){super(...arguments),a(this,"name","Triple Ring Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"triple-ring"})}effect(t){t.args.rings+=30,this.viewport.onFrameOut(6,()=>r.Sfx.play("RING_COLLECTED")),this.viewport.onFrameOut(18,()=>r.Sfx.play("RING_COLLECTED")),this.viewport.onFrameOut(32,()=>r.Sfx.play("RING_COLLECTED"))}}}),require.register("actor/monitor/WebMonitor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebMonitor=void 0;var i=e("../HtmlFrame"),r=e("../Monitor");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WebMonitor=class extends r.Monitor{constructor(){super(...arguments),a(this,"name","Web Monitor")}onRendered(t){super.onRendered(t),this.box.attr({"data-monitor":"web-monitor"})}effect(t){const e=new i.HtmlFrame({x:this.x,y:this.y,width:240,height:180});this.viewport.spawn.add({object:e})}}}),require.register("audio/AudioManager.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioManager=void 0;var i=e("curvature/base/Pool"),r=e("curvature/net/Elicit"),a=e("curvature/base/Mixin"),n=e("curvature/mixin/EventTargetMixin");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.AudioManager=class extends(a.Mixin.with(n.EventTargetMixin)){constructor(){super(...arguments),o(this,"volume",1),o(this,"theme","/Sonic/carnival-night-zone-act-2-beta.mp3"),o(this,"overlay","/audio/leslie-wai/feel-the-sunshine.mp3"),o(this,"tracks",new Map),o(this,"plays",new Map),o(this,"tags",new Map),o(this,"factors",new Map),o(this,"stack",[]),o(this,"playing",null),o(this,"id3",new Map),o(this,"request",[]),o(this,"pool",new i.Pool({max:2,init:t=>(t.open(),t)})),o(this,"throttle",new Map),o(this,"tracksPlaying",new Set),o(this,"tracksPaused",new Set)}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.volume=Math.max(0,Math.min(t,1)),this.playing&&(this.playing.volume=this.volume)}register(t,e){let{maxConcurrent:s=1,volume:i=1,fudgeFactor:a=0,startTime:n=0,throttle:o=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=new r.Elicit(e,{defer:!0});l.addEventListener("error",t=>t.preventDefault()),this.pool.add(l),"mp3"===e.substr(-3)?this.request.push(l.buffer().then(r=>{const o=Array(s).fill().map(t=>new Audio(e));this.tracks.set(t,o);for(const t of o)this.factors.set(t,{volume:i,fudgeFactor:a,startTime:n});const l=new Uint8Array(r);if("ID3"!==String.fromCharCode(...l.slice(0,3)))return;l[3],l[4],l[5];const h=l[6]<<21|l[7]<<14|l[8]<<7|l[9];let g=10;const c={};for(;g<h;){const t=String.fromCharCode(...l.slice(g,g+4)),e=10+(l[g+4]<<21|l[g+5]<<14|l[g+6]<<7|l[g+7]);if(10===e)break;if(g+e>h)break;const s=String.fromCharCode(...l.slice(g+11,g+e));if(!t)break;if(g+=e,!t)break;c[t]=s}for(const t of o)this.id3.set(t,c)})):l.objectUrl().then(e=>{const r=Array(s).fill().map(t=>new Audio(e));this.tracks.set(t,r);for(const t of r)this.factors.set(t,{volume:i,fudgeFactor:a,startTime:n,throttle:o})})}play(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={loop:e};if("object"==typeof e&&(s=e,e=e.loop),this.playing||(this.playing=this.stack[this.stack.length-1]),!this.tracks.has(t))return;const i=new Map,r=this.tracks.get(t);let a=null;for(const t of r){if(!this.plays.has(t)){a=t;break}i.set(t,this.plays.get(t))}if(!a){const t=[...i].sort((t,e)=>Math.sign(t[1]-e[1]));a=t[0][0]}if(a){let{volume:i,fudgeFactor:r,startTime:n,throttle:o}=this.factors.get(a);if(o&&Date.now()-this.throttle.get(t)<o)return;"volume"in s&&(i=s.volume);const l=this.volume*(i+r*(Math.random()+-.5));a.playbackRate=1,a.currentTime=n,a.volume=Math.max(0,Math.min(1,l)),a.loop=e,this.plays.set(a,Date.now()),this.playing=a,this.stack.push(this.playing);const h=t=>{this.playing=this.stack[this.stack.length-1],this.tracksPlaying.delete(a),this.stack.pop(),this.play()};this.tags.set(a,t);const g=new CustomEvent("play",{cancelable:!0});if(this.dispatchEvent(g))try{a.play(),e||this.playing.addEventListener("ended",h,{once:!0}),this.throttle.set(t,Date.now())}catch(t){console.warn(t)}return Promise.all(this.request).then(()=>{}),this.tracksPlaying.add(a),!0}}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===t&&this.playing&&(this.playing.pause(),this.playing=null);for(const e of Object.keys(this.stack)){const s=this.stack[e];if(this.tags.has(s)){if(null===t||this.tags.get(s)===t){const t=!0,i=this.id3.get(this.playing),r=new CustomEvent("stop",{detail:i,cancelable:t});this.dispatchEvent(r)&&(s.paused||s.pause(),this.stack.splice(e,1))}}else this.stack.splice(e,1)}e&&(this.playing=this.stack[this.stack.length-1],this.playing&&this.play(this.tags.get(this.playing)))}pause(){if(!this.playing||this.playing.paused)return;const t=this.id3.get(this.playing),e=new CustomEvent("pause",{detail:t,cancelable:!0});if(this.dispatchEvent(e))for(const t of this.tracksPlaying)this.tracksPaused.add(t),t.pause()}unpause(){if(!this.playing||!this.playing.paused)return;const t=this.id3.get(this.playing),e=new CustomEvent("unpause",{detail:t,cancelable:!0});if(this.dispatchEvent(e))for(const t of this.tracksPaused)this.tracksPaused.delete(t),t.played&&t.played<1?t.play():this.tracksPaused.delete(t)}fadeOut(t){return new Promise(e=>{let s,i,r,a;a=setInterval(()=>{if(!(s=this.playing))return;i||(r=s.volume,i=Date.now());const n=Date.now(),o=1-Math.min(1,(n-i)/t);s.volume=o*r,o||(this.stop(this.tags.get(s)),clearInterval(a),e())},16)})}}}),require.register("audio/Bgm.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BgmHandler=t.Bgm=void 0;var i=e("curvature/base/Pool"),r=e("curvature/net/Elicit"),a=e("curvature/base/Mixin"),n=e("curvature/mixin/EventTargetMixin");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class l extends(a.Mixin.with(n.EventTargetMixin)){constructor(){super(...arguments),o(this,"volume",1),o(this,"tracks",new Map),o(this,"plays",new Map),o(this,"tags",new Map),o(this,"stack",[]),o(this,"playing",null),o(this,"id3",new Map),o(this,"request",[]),o(this,"pool",new i.Pool({max:3,init:t=>(t.open(),t)})),o(this,"downloads",new Map),o(this,"cancels",new Map)}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.volume=Math.max(0,Math.min(t,1)),this.playing&&(this.playing.volume=this.volume)}register(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=new r.Elicit(e,{defer:!0});i.addEventListener("error",t=>t.preventDefault());const a=i.blob();this.pool.add(i);const n=a.then(t=>Promise.all([t.arrayBuffer(),URL.createObjectURL(t)])).then(e=>{let[i,r]=e;this.downloads.delete(t);const a=Array(s).fill().map(t=>new Audio(r));this.tracks.set(t,a);const n=new Uint8Array(i);if("ID3"!==String.fromCharCode(...n.slice(0,3)))return;n[3],n[4],n[5];const o=n[6]<<21|n[7]<<14|n[8]<<7|n[9];let l=10;const h={};for(;l<o;){const t=String.fromCharCode(...n.slice(l,l+4)),e=10+(n[l+4]<<21|n[l+5]<<14|n[l+6]<<7|n[l+7]);if(10===e)break;if(l+e>o)break;const s=String.fromCharCode(...n.slice(l+11,l+e));if(!t)break;if(l+=e,!t)break;h[t]=s}h.COMM&&"XXXComment\0"===h.COMM.substr(0,"XXXComment\0".length)?h.COMM=h.COMM.slice("XXXComment\0".length):h.COMM&&"xxxComment\0"===h.COMM.substr(0,"xxxComment\0".length)&&(h.COMM=h.COMM.slice("xxxComment\0".length));for(const t of a)this.id3.set(t,h)});this.request.push(n),this.downloads.set(t,n)}play(t){let{loop:e=!1,interlude:s=!1,dontClear:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.downloads.has(t))return void this.downloads.get(t).then(()=>{this.downloads.delete(t),this.play(t,{loop:e,interlude:s,dontClear:i})});if(this.tags.get(this.playing)!==t&&!s&&!i){for(const t of this.stack)t.pause();this.stack.length=0,this.playing=!1}if(this.playing||(this.playing=this.stack[this.stack.length-1]),this.playing&&this.tags.get(this.playing)===t){if(this.playing.paused){const t=!0,e=this.id3.get(this.playing),s=new CustomEvent("play",{detail:e,cancelable:t});if(!this.dispatchEvent(s))return;return this.unpause()}}else this.playing&&this.playing.pause();if(!this.tracks.has(t))return;const r=new Map,a=this.tracks.get(t);let n=null;for(const t of a){if(!this.plays.has(t)){n=t;break}r.set(this.plays.get(t),t)}if(!n){const t=[...r].sort((t,e)=>Math.sign(t[0]-e[0]));n=t[0][1]}if(n&&n!==this.playing){n.playbackRate=1,n.currentTime=0,n.volume=this.volume,n.loop=e,this.plays.set(n,Date.now()),this.playing=n,this.stack.push(this.playing);const s=t=>{this.stack.pop(),this.playing=this.stack[this.stack.length-1]};e||this.playing.addEventListener("ended",s,{once:!0}),this.tags.set(n,t),Promise.all(this.request).then(()=>{const t=this.id3.get(n),e=new CustomEvent("play",{detail:t,cancelable:!0});if(this.dispatchEvent(e))try{n.play()}catch(t){console.warn(t)}})}}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t&&this.playing&&(this.playing.pause(),this.playing=null);for(const e of Object.keys(this.stack)){const s=this.stack[e];if(this.tags.has(s)){if(null===t||this.tags.get(s)===t){const t=!0,i=this.id3.get(this.playing),r=new CustomEvent("stop",{detail:i,cancelable:t});this.dispatchEvent(r)&&(s.paused||s.pause(),this.stack.splice(e,1))}}else this.stack.splice(e,1)}this.playing=this.stack[this.stack.length-1],this.playing&&this.play(this.tags.get(this.playing),{dontClear:!0})}pause(){if(!this.playing||this.playing.paused)return;const t=this.id3.get(this.playing),e=new CustomEvent("pause",{detail:t,cancelable:!0});this.dispatchEvent(e)&&this.playing.pause()}unpause(){if(!this.playing||!this.playing.paused)return;const t=this.id3.get(this.playing),e=new CustomEvent("unpause",{detail:t,cancelable:!0});this.dispatchEvent(e)&&this.playing&&this.playing.play()}fadeOut(t){return new Promise(e=>{let s,i,r,a;s=this.playing;a=setInterval(()=>{if(!s)return void clearInterval(a);i||(r=s.volume,i=Date.now());const n=Date.now(),o=1-Math.min(1,(n-i)/t);s.volume=o*r,o||(this.stop(this.tags.get(s)),clearInterval(a),e())},16)})}}t.BgmHandler=l;const h=new l;t.Bgm=h}),require.register("audio/Sfx.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sfx=void 0;const i=new(e("./AudioManager").AudioManager);t.Sfx=i}),require.register("backdrop/AngelIsland.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AngelIsland=void 0;var i=e("./Backdrop");const r=[{990099:"fcfcfc",770077:"0048fc",550055:"90fcfc"},{990099:"90fcfc",770077:"fcfcfc",550055:"90fcfc"},{990099:"6c90fc",770077:"90fcfc",550055:"90fcfc"},{990099:"0048fc",770077:"6c90fc",550055:"90fcfc"},{990099:"fcfcfc",770077:"0048fc",550055:"6c90fc"},{990099:"90fcfc",770077:"fcfcfc",550055:"0048fc"},{990099:"6c90fc",770077:"90fcfc",550055:"fcfcfc"},{990099:"0048fc",770077:"6c90fc",550055:"90fcfc"}];t.AngelIsland=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="angel-island",this.args.strips=[{autoscroll:-.23,parallax:.005,url:"/Sonic/backdrop/angel-island/sky-0.png",height:196},{autoscroll:-.23,parallax:.005,url:"/Sonic/backdrop/angel-island/reflection.png",height:33},{autoscroll:0,parallax:.009,url:"/Sonic/backdrop/angel-island/water-1.png",interval:12,timeout:100,frame:0,recolor:r,height:-16},{autoscroll:0,parallax:.011,url:"/Sonic/backdrop/angel-island/water-2.png",height:8,interval:14,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.013,url:"/Sonic/backdrop/angel-island/water-3.png",height:8,interval:16,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.015,url:"/Sonic/backdrop/angel-island/water-4.png",height:16,interval:16,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.017,url:"/Sonic/backdrop/angel-island/water-5.png",height:8,interval:16,timeout:100,frame:4,recolor:r},{autoscroll:0,parallax:.019,url:"/Sonic/backdrop/angel-island/water-6.png",height:8,interval:13,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.021,url:"/Sonic/backdrop/angel-island/water-7.png",height:16,interval:11,timeout:100,frame:1,recolor:r},{autoscroll:0,parallax:.023,url:"/Sonic/backdrop/angel-island/water-8.png",height:8,interval:12,timeout:100,frame:2,recolor:r},{autoscroll:0,parallax:.025,url:"/Sonic/backdrop/angel-island/water-9.png",height:8,interval:11,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.028,url:"/Sonic/backdrop/angel-island/water-10.png",height:8,interval:13,timeout:100,frame:3,recolor:r},{autoscroll:0,parallax:.03,url:"/Sonic/backdrop/angel-island/water-11.png",height:16,interval:13,timeout:100,frame:4,recolor:r},{autoscroll:0,parallax:.033,url:"/Sonic/backdrop/angel-island/water-12.png",height:8,interval:11,timeout:100,frame:5,recolor:r},{autoscroll:0,parallax:.035,url:"/Sonic/backdrop/angel-island/water-13.png",height:7,interval:15,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.037,url:"/Sonic/backdrop/angel-island/water-14.png",height:8,interval:17,timeout:100,frame:1,recolor:r},{autoscroll:0,parallax:.039,url:"/Sonic/backdrop/angel-island/water-15.png",height:8,interval:19,timeout:100,frame:2,recolor:r},{autoscroll:0,parallax:.041,url:"/Sonic/backdrop/angel-island/water-16.png",height:6,interval:11,timeout:100,frame:3,recolor:r},{autoscroll:0,parallax:.044,url:"/Sonic/backdrop/angel-island/water-17.png",height:10,interval:13,timeout:100,frame:4,recolor:r},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/angel-island/water-18.png",height:32}]}}}),require.register("backdrop/Backdrop.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Backdrop=void 0;var i=e("curvature/base/View"),r=e("../sprite/Png");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Backdrop=class extends i.View{constructor(){super(...arguments),a(this,"template",'<div class = "backdrop [[name]]">\n\t\t<div cv-ref = "backdrop" class = "parallax"></div>\n\t</div>'),a(this,"layers",[]),a(this,"urls",[]),a(this,"stacked",0)}onAttached(t){if(this.alreadyAttached)return;this.alreadyAttached=!0;const e=this.tags.backdrop,s=this.args.strips.reverse(),i=[],a=[],n=[];let o=0;for(const t in s){const e=[],l=s[t];i.push(`calc(100% - calc(1px * ${o}))`);let h="calc(var(--xOffset, 0px) * 1px)";if(l.parallax&&(h=`calc(${h} + calc(1px * calc(${l.parallax} * var(--xPan))))`),l.autoscroll&&(h=`calc(${h} + calc(1px * calc(${l.autoscroll} * var(--frame) )) )`),a.push(h),n.push(s[t].url),o+=s[t].height-1,l.recolor){const t=new r.Png(l.url);for(const s of l.recolor)e.push(t.ready.then(()=>t.recolor(s).toDataUri()));Promise.all(e).then(t=>l.frames=t)}}this.urls=n,this.stacked=o;const l=a.join(", "),h=i.join(", "),g=this.urls.map(t=>`url(${t})`).join(", ");this.args.xOffset=0,e.style({"background-position-y":h,"background-position-x":l,"background-repeat":"repeat-x","background-image":g,"--stackHeight":o}),this.args.bindTo(["x","y","xPan","yPan","bX","bY","width","height","right","xMax","yMax","frame","stacked","top","bottom","xOffset"],(t,s)=>e.style({[`--${s}`]:t})),this.args.bindTo("frame",(t,e)=>{for(const t in this.args.strips){const e=this.args.strips[t];e.frames&&0==e.timeout--&&(e.timeout=e.interval,e.frame++,e.frame>=e.frames.length&&(e.frame=0),this.urls[t]=e.frames[e.frame],this.refreshLayers())}})}refreshLayers(){this.tags.backdrop.style({"background-image":this.urls.map(t=>`url(${t})`).join(", ")})}}}),require.register("backdrop/City.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.City=void 0;var i=e("./Backdrop");t.City=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="city",this.args.strips=[{autoscroll:0,parallax:.128,url:"/bttf2/city/sky.png",height:85},{autoscroll:0,parallax:.096,url:"/bttf2/city/sky.png",height:85},{autoscroll:0,parallax:.064,url:"/bttf2/city/sky.png",height:85},{autoscroll:0,parallax:.048,url:"/bttf2/city/sky.png",height:85},{autoscroll:0,parallax:.032,url:"/bttf2/city/sky.png",height:85},{autoscroll:0,parallax:.05,url:"/bttf2/city/buildings-bg.png",height:76},{autoscroll:0,parallax:.1,url:"/bttf2/city/bushes.png",height:144},{autoscroll:0,parallax:.2,url:"/bttf2/city/buildings-fg-recolor.png",height:64}]}}}),require.register("backdrop/DarkClouds.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DarkClouds=void 0;var i=e("./Backdrop");t.DarkClouds=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="dark-clouds",this.args.strips=[{autoscroll:.14,parallax:.02,url:"/Sonic/backdrop/west-side/clouds--1.png",height:64},{autoscroll:.14,parallax:.02,url:"/Sonic/backdrop/west-side/clouds-0.png",height:33},{autoscroll:.13,parallax:.014,url:"/Sonic/backdrop/west-side/clouds-1.png",height:32},{autoscroll:.12,parallax:.013,url:"/Sonic/backdrop/west-side/clouds-2.png",height:24},{autoscroll:.11,parallax:.012,url:"/Sonic/backdrop/west-side/clouds-3.png",height:16},{autoscroll:.1,parallax:.011,url:"/Sonic/backdrop/west-side/clouds-4.png",height:5},{autoscroll:.09,parallax:.01,url:"/Sonic/backdrop/west-side/clouds-5.png",height:3},{autoscroll:.08,parallax:.009,url:"/Sonic/backdrop/west-side/clouds-6.png",height:8},{autoscroll:.07,parallax:.008,url:"/Sonic/backdrop/west-side/clouds-7.png",height:5},{autoscroll:.06,parallax:.007,url:"/Sonic/backdrop/west-side/clouds-8.png",height:3},{autoscroll:.05,parallax:.006,url:"/Sonic/backdrop/west-side/clouds-9.png",height:8},{autoscroll:.04,parallax:.005,url:"/Sonic/backdrop/west-side/clouds-10.png",height:8},{autoscroll:.03,parallax:.004,url:"/Sonic/backdrop/west-side/clouds-11.png",height:32},{autoscroll:.02,parallax:.003,url:"/Sonic/backdrop/west-side/clouds-12.png",height:8},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/west-side/clouds-13.png",height:32},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/west-side/empty.png",height:120}],this.args.bindTo("frame",t=>{this.args.ligtening||Math.random()>.995&&(this.args.name="dark-clouds lightning",this.args.lightning=!0,this.onTimeout(1e3,()=>{this.args.name="dark-clouds",this.args.lightning=!1}))})}}}),require.register("backdrop/Desert.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Desert=void 0;var i=e("./Backdrop");t.Desert=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="desert",this.args.strips=[{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sky.png",height:32},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sky.png",height:32},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sky.png",height:32},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sky.png",height:32},{autoscroll:0,parallax:.3,url:"/Sonic/backdrop/desert-palace/dunes.png",height:28},{autoscroll:0,parallax:.4,url:"/Sonic/backdrop/desert-palace/dunes-fg.png",height:12},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:.5,url:"/Sonic/backdrop/desert-palace/dunes-fg.png",height:12},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:.6,url:"/Sonic/backdrop/desert-palace/dunes-fg.png",height:12},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/desert-palace/sand-color.png",height:8}]}}}),require.register("backdrop/IceCap.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IceCap=void 0;var i=e("./Backdrop");t.IceCap=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="ice-cap",this.args.strips=[{autoscroll:0,parallax:0,url:"/Sonic/backdrop/ice-cap/mountains-13.png",height:64},{autoscroll:0,parallax:.01,url:"/Sonic/backdrop/ice-cap/mountains-12.png",height:4},{autoscroll:0,parallax:.02,url:"/Sonic/backdrop/ice-cap/mountains-11.png",height:12},{autoscroll:0,parallax:.025,url:"/Sonic/backdrop/ice-cap/mountains-10.png",height:11},{autoscroll:0,parallax:.03,url:"/Sonic/backdrop/ice-cap/mountains-9.png",height:13},{autoscroll:0,parallax:.03,url:"/Sonic/backdrop/ice-cap/mountains-8.png",height:24},{autoscroll:0,parallax:.045,url:"/Sonic/backdrop/ice-cap/mountains-7.png",height:80},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/ice-cap/mountains-6.png",height:3},{autoscroll:0,parallax:.06,url:"/Sonic/backdrop/ice-cap/mountains-5.png",height:7},{autoscroll:0,parallax:.07,url:"/Sonic/backdrop/ice-cap/mountains-4.png",height:14},{autoscroll:0,parallax:.08,url:"/Sonic/backdrop/ice-cap/mountains-3.png",height:24},{autoscroll:0,parallax:.09,url:"/Sonic/backdrop/ice-cap/mountains-2.png",height:32},{autoscroll:0,parallax:.9,url:"/Sonic/backdrop/ice-cap/mountains-1.png",height:32}]}}}),require.register("backdrop/Industrial.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Industrial=void 0;var i=e("./Backdrop");e("curvature/base/Tag");t.Industrial=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="industrial",this.args.sunrise=0,this.args.bindTo("sunrise",t=>{this.nodes[1]&&this.nodes[1].style.setProperty("--sunrise",t)}),this.args.strips=[{autoscroll:.7,parallax:.055,url:"/Sonic/backdrop/labrynth-industrial/0.png",height:24},{autoscroll:.65,parallax:.05,url:"/Sonic/backdrop/labrynth-industrial/1.png",height:24},{autoscroll:.6,parallax:.045,url:"/Sonic/backdrop/labrynth-industrial/0.png",height:24},{autoscroll:.55,parallax:.04,url:"/Sonic/backdrop/labrynth-industrial/1.png",height:24},{autoscroll:.5,parallax:.035,url:"/Sonic/backdrop/labrynth-industrial/0.png",height:24},{autoscroll:.4,parallax:.03,url:"/Sonic/backdrop/labrynth-industrial/1.png",height:24},{autoscroll:.35,parallax:.025,url:"/Sonic/backdrop/labrynth-industrial/0.png",height:24},{autoscroll:.3,parallax:.02,url:"/Sonic/backdrop/labrynth-industrial/1.png",height:24},{autoscroll:.25,parallax:.015,url:"/Sonic/backdrop/labrynth-industrial/2.png",height:24},{autoscroll:.2,parallax:.01,url:"/Sonic/backdrop/labrynth-industrial/3.png",height:24},{autoscroll:0,parallax:.02,url:"/Sonic/backdrop/labrynth-industrial/4-dist.png",height:70},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/labrynth-industrial/4.png",height:0},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/labrynth-industrial/flame-0.png",height:1,interval:1,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/flame-0a.png","/Sonic/backdrop/labrynth-industrial/flame-1.png","/Sonic/backdrop/labrynth-industrial/flame-1.png","/Sonic/backdrop/labrynth-industrial/flame-2.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-2.png","/Sonic/backdrop/labrynth-industrial/flame-2.png","/Sonic/backdrop/labrynth-industrial/flame-2.png","/Sonic/backdrop/labrynth-industrial/flame-3.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-3.png","/Sonic/backdrop/labrynth-industrial/flame-3.png","/Sonic/backdrop/labrynth-industrial/flame-4.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-4.png","/Sonic/backdrop/labrynth-industrial/flame-5.png","/Sonic/backdrop/labrynth-industrial/flame-6.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-6.png","/Sonic/backdrop/labrynth-industrial/flame-6.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png","/Sonic/backdrop/labrynth-industrial/flame-0.png"]},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/labrynth-industrial/flame-0.png",height:1,interval:1,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/flame-b-0a.png","/Sonic/backdrop/labrynth-industrial/flame-b-1.png","/Sonic/backdrop/labrynth-industrial/flame-b-1.png","/Sonic/backdrop/labrynth-industrial/flame-b-2.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-2.png","/Sonic/backdrop/labrynth-industrial/flame-b-2.png","/Sonic/backdrop/labrynth-industrial/flame-b-2.png","/Sonic/backdrop/labrynth-industrial/flame-b-3.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-3.png","/Sonic/backdrop/labrynth-industrial/flame-b-3.png","/Sonic/backdrop/labrynth-industrial/flame-b-4.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-4.png","/Sonic/backdrop/labrynth-industrial/flame-b-5.png","/Sonic/backdrop/labrynth-industrial/flame-b-6.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-6.png","/Sonic/backdrop/labrynth-industrial/flame-b-6.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png","/Sonic/backdrop/labrynth-industrial/flame-b-0.png"]},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/labrynth-industrial/flame-0.png",height:1,interval:1,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/flame-c-0a.png","/Sonic/backdrop/labrynth-industrial/flame-c-1.png","/Sonic/backdrop/labrynth-industrial/flame-c-1.png","/Sonic/backdrop/labrynth-industrial/flame-c-2.png","/Sonic/backdrop/labrynth-industrial/flame-c-0.png","/Sonic/backdrop/labrynth-industrial/flame-c-2.png","/Sonic/backdrop/labrynth-industrial/flame-c-2.png","/Sonic/backdrop/labrynth-industrial/flame-c-2.png","/Sonic/backdrop/labrynth-industrial/flame-c-3.png","/Sonic/backdrop/labrynth-industrial/flame-c-0.png","/Sonic/backdrop/labrynth-industrial/flame-c-3.png","/Sonic/backdrop/labrynth-industrial/flame-c-3.png","/Sonic/backdrop/labrynth-industrial/flame-c-4.png","/Sonic/backdrop/labrynth-industrial/flame-c-0.png","/Sonic/backdrop/labrynth-industrial/flame-c-4.png","/Sonic/backdrop/labrynth-industrial/flame-c-5.png","/Sonic/backdrop/labrynth-industrial/flame-c-6.png","/Sonic/backdrop/labrynth-industrial/flame-c-0.png","/Sonic/backdrop/labrynth-industrial/flame-c-6.png","/Sonic/backdrop/labrynth-industrial/flame-c-6.png","/Sonic/backdrop/labrynth-industrial/flame-c-0.png"]},{autoscroll:0,parallax:.125,url:"/Sonic/backdrop/labrynth-industrial/5-bw-small.png",height:10},{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/labrynth-industrial/5-bw-small.png",height:10},{autoscroll:0,parallax:.275,url:"/Sonic/backdrop/labrynth-industrial/5-dim.png",height:50},{autoscroll:0,parallax:.275,url:"/Sonic/backdrop/labrynth-industrial/5-pink-lights.png",height:1,interval:20,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/5-lights-0.png","/Sonic/backdrop/labrynth-industrial/5-lights-0.png","/Sonic/backdrop/labrynth-industrial/5-lights-1.png","/Sonic/backdrop/labrynth-industrial/5-lights-1.png","/Sonic/backdrop/labrynth-industrial/5-lights-2.png","/Sonic/backdrop/labrynth-industrial/5-lights-2.png"]},{autoscroll:0,parallax:.275,url:"/Sonic/backdrop/labrynth-industrial/5-signals-0.png",height:1,interval:10,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/5-signals-0.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-0.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png"]},{autoscroll:0,parallax:.35,url:"/Sonic/backdrop/labrynth-industrial/5.png",height:40},{autoscroll:0,parallax:.35,url:"/Sonic/backdrop/labrynth-industrial/5-pink-lights.png",height:1},{autoscroll:0,parallax:.35,url:"/Sonic/backdrop/labrynth-industrial/5-signals-0.png",height:1,interval:20,timeout:0,frame:0,frames:["/Sonic/backdrop/labrynth-industrial/5-signals-0.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-2.png","/Sonic/backdrop/labrynth-industrial/5-signals-0.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png","/Sonic/backdrop/labrynth-industrial/5-signals-1.png"]},{autoscroll:0,parallax:.4,url:"/Sonic/backdrop/labrynth-industrial/6-half.png",height:88}]}}}),require.register("backdrop/MarbleGarden.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarbleGarden=void 0;var i=e("./Backdrop");t.MarbleGarden=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="marble-garden",this.args.strips=[{autoscroll:-1.25,parallax:.015,url:"/Sonic/backdrop/marble-garden/0.png",height:32},{autoscroll:-1,parallax:.015,url:"/Sonic/backdrop/marble-garden/1.png",height:24},{autoscroll:-.9,parallax:.015,url:"/Sonic/backdrop/marble-garden/2.png",height:8},{autoscroll:-.8,parallax:.015,url:"/Sonic/backdrop/marble-garden/3.png",height:24},{autoscroll:-.7,parallax:.015,url:"/Sonic/backdrop/marble-garden/4.png",height:8},{autoscroll:-.6,parallax:.0125,url:"/Sonic/backdrop/marble-garden/5.png",height:24},{autoscroll:-.5,parallax:.0125,url:"/Sonic/backdrop/marble-garden/6.png",height:16},{autoscroll:-.45,parallax:.0125,url:"/Sonic/backdrop/marble-garden/7.png",height:8},{autoscroll:-.45,parallax:.0125,url:"/Sonic/backdrop/marble-garden/8.png",height:16},{autoscroll:-.4,parallax:.0125,url:"/Sonic/backdrop/marble-garden/9.png",height:8},{autoscroll:-.35,parallax:.0125,url:"/Sonic/backdrop/marble-garden/10.png",height:16},{autoscroll:-.3,parallax:.01,url:"/Sonic/backdrop/marble-garden/11.png",height:8},{autoscroll:-.25,parallax:.0075,url:"/Sonic/backdrop/marble-garden/12.png",height:8},{autoscroll:-.2,parallax:.0075,url:"/Sonic/backdrop/marble-garden/13.png",height:8},{autoscroll:-.15,parallax:.01,url:"/Sonic/backdrop/marble-garden/14.png",height:8},{autoscroll:-.1,parallax:.01,url:"/Sonic/backdrop/marble-garden/15.png",height:5},{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/marble-garden/16.png",height:30},{autoscroll:0,parallax:.125,url:"/Sonic/backdrop/marble-garden/17.png",height:12},{autoscroll:0,parallax:.125,url:"/Sonic/backdrop/marble-garden/18.png",height:6},{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/marble-garden/19.png",height:6},{autoscroll:0,parallax:.175,url:"/Sonic/backdrop/marble-garden/20.png",height:8},{autoscroll:0,parallax:.2,url:"/Sonic/backdrop/marble-garden/21.png",height:8},{autoscroll:0,parallax:.225,url:"/Sonic/backdrop/marble-garden/22.png",height:24},{autoscroll:0,parallax:.25,url:"/Sonic/backdrop/marble-garden/23.png",height:344}]}}}),require.register("backdrop/Moon.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Moon=void 0;var i=e("./Backdrop");t.Moon=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="moon",this.args.strips=[{autoscroll:.035,parallax:.0019,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-0a.png",height:13},{autoscroll:.03,parallax:.0016,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-0b.png",height:13},{autoscroll:.025,parallax:.0015,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-1.png",height:12},{autoscroll:.02,parallax:.0013,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-2.png",height:12},{autoscroll:.015,parallax:.001,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-3.png",height:8},{autoscroll:.01,parallax:9e-4,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-4.png",height:5},{autoscroll:.005,parallax:7e-4,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-5.png",height:14},{autoscroll:.0025,parallax:5e-4,url:"/Sonic/backdrop/doomsday/backdrop-inverted-0-6.png",height:140},{autoscroll:0,parallax:.03,url:"/mmpr/moon/terrain-00-00.png",height:0},{autoscroll:0,parallax:.035,url:"/mmpr/moon/terrain-00-01.png",height:2},{autoscroll:0,parallax:.045,url:"/mmpr/moon/terrain-00-02.png",height:3},{autoscroll:0,parallax:.055,url:"/mmpr/moon/terrain-00-03.png",height:4},{autoscroll:0,parallax:.065,url:"/mmpr/moon/terrain-00-04.png",height:4},{autoscroll:0,parallax:.075,url:"/mmpr/moon/terrain-00-05.png",height:10},{autoscroll:0,parallax:.085,url:"/mmpr/moon/terrain-00-06.png",height:5},{autoscroll:0,parallax:.095,url:"/mmpr/moon/terrain-00-07-b.png",height:10},{autoscroll:0,parallax:.1,url:"/mmpr/moon/terrain-00-08.png",height:10},{autoscroll:0,parallax:.105,url:"/mmpr/moon/terrain-00-09.png",height:12},{autoscroll:0,parallax:.115,url:"/mmpr/moon/terrain-00-10-b.png",height:12},{autoscroll:0,parallax:.125,url:"/mmpr/moon/terrain-00-11.png",height:5},{autoscroll:0,parallax:.1325,url:"/mmpr/moon/terrain-00-09-b.png",height:12},{autoscroll:0,parallax:.1435,url:"/mmpr/moon/terrain-00-12.png",height:22}]}}}),require.register("backdrop/MushroomHill.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MushroomHill=void 0;var i=e("./Backdrop");t.MushroomHill=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="mushroom-hill-summer",this.args.strips=[{autoscroll:0,parallax:0,url:"/Sonic/backdrop/mushroom-hill/blank.png",height:332},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/marble-garden-1/hills-recolored_1.png",height:8},{autoscroll:0,parallax:.06,url:"/Sonic/backdrop/marble-garden-1/hills-recolored_2.png",height:8},{autoscroll:0,parallax:.07,url:"/Sonic/backdrop/marble-garden-1/hills-recolored_3.png",height:8},{autoscroll:0,parallax:.08,url:"/Sonic/backdrop/marble-garden-1/hills-recolored_4.png",height:24},{autoscroll:0,parallax:.09,url:"/Sonic/backdrop/marble-garden-1/hills-recolored_5.png",height:120},{autoscroll:0,parallax:.11,url:"/Sonic/backdrop/mushroom-hill/background-trees-summer-edit.png",height:0},{autoscroll:0,parallax:.165,url:"/Sonic/backdrop/mushroom-hill/foreground-summer.png",height:224}]}}}),require.register("backdrop/MysticCave.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MysticCave=void 0;var i=e("./Backdrop");t.MysticCave=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="mystic-cave",this.args.strips=[{autoscroll:0,parallax:.27,url:"/Sonic/backdrop/mystic-cave/1.png",height:37},{autoscroll:0,parallax:.23,url:"/Sonic/backdrop/mystic-cave/2.png",height:23},{autoscroll:0,parallax:.21,url:"/Sonic/backdrop/mystic-cave/3.png",height:18},{autoscroll:0,parallax:.2,url:"/Sonic/backdrop/mystic-cave/4.png",height:7},{autoscroll:0,parallax:.19,url:"/Sonic/backdrop/mystic-cave/5.png",height:6},{autoscroll:0,parallax:.18,url:"/Sonic/backdrop/mystic-cave/6.png",height:1},{autoscroll:0,parallax:.17,url:"/Sonic/backdrop/mystic-cave/7.png",height:1},{autoscroll:0,parallax:.16,url:"/Sonic/backdrop/mystic-cave/8.png",height:1},{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/mystic-cave/9.png",height:1},{autoscroll:0,parallax:.14,url:"/Sonic/backdrop/mystic-cave/10.png",height:1},{autoscroll:0,parallax:.13,url:"/Sonic/backdrop/mystic-cave/11.png",height:48},{autoscroll:0,parallax:.14,url:"/Sonic/backdrop/mystic-cave/12.png",height:13},{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/mystic-cave/13.png",height:19},{autoscroll:0,parallax:.17,url:"/Sonic/backdrop/mystic-cave/14.png",height:34},{autoscroll:0,parallax:.2,url:"/Sonic/backdrop/mystic-cave/15.png",height:62},{autoscroll:0,parallax:.17,url:"/Sonic/backdrop/mystic-cave/16.png",height:32},{autoscroll:0,parallax:.14,url:"/Sonic/backdrop/mystic-cave/16.5.png",height:19},{autoscroll:0,parallax:.13,url:"/Sonic/backdrop/mystic-cave/17.png",height:13},{autoscroll:0,parallax:.12,url:"/Sonic/backdrop/mystic-cave/18.png",height:48},{autoscroll:0,parallax:.13,url:"/Sonic/backdrop/mystic-cave/19.png",height:1},{autoscroll:0,parallax:.14,url:"/Sonic/backdrop/mystic-cave/20.png",height:1},{autoscroll:0,parallax:.16,url:"/Sonic/backdrop/mystic-cave/21.png",height:1},{autoscroll:0,parallax:.18,url:"/Sonic/backdrop/mystic-cave/22.png",height:1},{autoscroll:0,parallax:.2,url:"/Sonic/backdrop/mystic-cave/23.png",height:1},{autoscroll:0,parallax:.22,url:"/Sonic/backdrop/mystic-cave/24.png",height:6},{autoscroll:0,parallax:.24,url:"/Sonic/backdrop/mystic-cave/25.png",height:7},{autoscroll:0,parallax:.28,url:"/Sonic/backdrop/mystic-cave/26.png",height:32},{autoscroll:0,parallax:.33,url:"/Sonic/backdrop/mystic-cave/27.png",height:18},{autoscroll:0,parallax:.35,url:"/Sonic/backdrop/mystic-cave/28.png",height:23},{autoscroll:0,parallax:.37,url:"/Sonic/backdrop/mystic-cave/29.png",height:37}]}}}),require.register("backdrop/Overcast.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Overcast=void 0;var i=e("./Backdrop");t.Overcast=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="overcast",this.args.strips=[{autoscroll:.14,parallax:.06,url:"/Sonic/backdrop/stardust-speedway/sky-0.png",height:32},{autoscroll:.13,parallax:.055,url:"/Sonic/backdrop/stardust-speedway/sky-1.png",height:32},{autoscroll:.12,parallax:.05,url:"/Sonic/backdrop/stardust-speedway/sky-2.png",height:16},{autoscroll:.11,parallax:.045,url:"/Sonic/backdrop/stardust-speedway/sky-3.png",height:16},{autoscroll:.1,parallax:.05,url:"/Sonic/backdrop/stardust-speedway/sky-4.png",height:16},{autoscroll:.09,parallax:.05,url:"/Sonic/backdrop/stardust-speedway/sky-5.png",height:32},{autoscroll:.08,parallax:.04,url:"/Sonic/backdrop/stardust-speedway/sky-6.png",height:32},{autoscroll:.07,parallax:.03,url:"/Sonic/backdrop/stardust-speedway/sky-7.png",height:16},{autoscroll:.06,parallax:.02,url:"/Sonic/backdrop/stardust-speedway/sky-8.png",height:32},{autoscroll:.05,parallax:.01,url:"/Sonic/backdrop/stardust-speedway/sky-9.png",height:16},{autoscroll:.04,parallax:.005,url:"/Sonic/backdrop/stardust-speedway/sky-10.png",height:16},{autoscroll:.03,parallax:.004,url:"/Sonic/backdrop/stardust-speedway/sky-11.png",height:16},{autoscroll:.02,parallax:.003,url:"/Sonic/backdrop/stardust-speedway/sky-12.png",height:16},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/stardust-speedway/sky-13.png",height:8},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/stardust-speedway/sky-14.png",height:51},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/west-side/empty.png",height:51}]}}}),require.register("backdrop/PhazonMines.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhazonMines=void 0;var i=e("./Backdrop");t.PhazonMines=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="scrap-brain",this.args.strips=[{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/tidal-tempest/phazon-mines.png",height:512}]}}}),require.register("backdrop/ProtoLabrynth.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProtoLabrynth=void 0;var i=e("./Backdrop");t.ProtoLabrynth=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="proto-labrynth",this.args.strips=[{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/protolabrynth/0.png",height:48},{autoscroll:0,parallax:.125,url:"/Sonic/backdrop/protolabrynth/1.png",height:24},{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/protolabrynth/2.png",height:8},{autoscroll:0,parallax:.075,url:"/Sonic/backdrop/protolabrynth/3.png",height:68},{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/protolabrynth/4.png",height:18},{autoscroll:0,parallax:.125,url:"/Sonic/backdrop/protolabrynth/5.png",height:27},{autoscroll:0,parallax:.15,url:"/Sonic/backdrop/protolabrynth/5.png",height:27},{autoscroll:0,parallax:.175,url:"/Sonic/backdrop/protolabrynth/6.png",height:76}]}}}),require.register("backdrop/ScrapBrainDark.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScrapBrainDark=void 0;var i=e("./Backdrop");t.ScrapBrainDark=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="scrap-brain",this.args.strips=[{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/scrap-brain/indoors-dark.png",height:1024}]}}}),require.register("backdrop/SouthRidge.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SouthRidge=void 0;var i=e("./Backdrop");t.SouthRidge=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="south-ridge",this.args.strips=[{autoscroll:-.03,parallax:.11,url:"/Sonic/backdrop/south-ridge/clouds-10.png",height:10},{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/south-ridge/ridge.png",height:10},{autoscroll:-.06,parallax:.12,url:"/Sonic/backdrop/south-ridge/clouds-9.png",height:0},{autoscroll:-.06,parallax:.12,url:"/Sonic/backdrop/south-ridge/clouds-9b.png",height:8},{autoscroll:-.065,parallax:.13,url:"/Sonic/backdrop/south-ridge/clouds-8.png",height:11},{autoscroll:0,parallax:.11,url:"/Sonic/backdrop/south-ridge/ridge-b.png",height:20},{autoscroll:-.07,parallax:.14,url:"/Sonic/backdrop/south-ridge/clouds-7.png",height:-9},{autoscroll:-.075,parallax:.15,url:"/Sonic/backdrop/south-ridge/clouds-6.png",height:9},{autoscroll:-.08,parallax:.16,url:"/Sonic/backdrop/south-ridge/clouds-5.png",height:8},{autoscroll:-.09,parallax:.18,url:"/Sonic/backdrop/south-ridge/clouds-4.png",height:16},{autoscroll:-.1,parallax:.2,url:"/Sonic/backdrop/south-ridge/clouds-3.png",height:13},{autoscroll:-.1125,parallax:.22,url:"/Sonic/backdrop/south-ridge/clouds-2.png",height:17},{autoscroll:-.15,parallax:.21,url:"/Sonic/backdrop/south-ridge/clouds-1.png",height:15},{autoscroll:-.175,parallax:.21,url:"/Sonic/backdrop/south-ridge/clouds-0.png",height:16},{autoscroll:-.15,parallax:.22,url:"/Sonic/backdrop/south-ridge/clouds-1.png",height:15},{autoscroll:-.175,parallax:.23,url:"/Sonic/backdrop/south-ridge/clouds-0.png",height:16}]}}}),require.register("backdrop/Underground.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Underground=void 0;var i=e("./Backdrop");t.Underground=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="underground",this.args.strips=[{autoscroll:.045,parallax:.075,url:"/Sonic/backdrop/wing-fortress/sky-1b-recolor.png",height:32},{autoscroll:.043,parallax:.07,url:"/Sonic/backdrop/wing-fortress/sky-0-recolor.png",height:48},{autoscroll:.041,parallax:.065,url:"/Sonic/backdrop/wing-fortress/sky-1-recolor.png",height:32},{autoscroll:.039,parallax:.06,url:"/Sonic/backdrop/wing-fortress/sky-2-recolor.png",height:48},{autoscroll:0,parallax:.075,url:"/Sonic/backdrop/aquatic-ruin/mountains-0-recolor.png",height:0},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/aquatic-ruin/mountains-1-recolor.png",height:48},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/aquatic-ruin/mountains-1-recolor.png",height:48},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/aquatic-ruin/mountains-1-recolor.png",height:24}]}}}),require.register("backdrop/WestSide.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WestSide=void 0;var i=e("./Backdrop");t.WestSide=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="west-side",this.args.strips=[{autoscroll:.001,parallax:.001,url:"/Sonic/backdrop/west-side/stars-before.png",height:64},{autoscroll:.001,parallax:.001,url:"/Sonic/backdrop/west-side/stars.png",height:205},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-0.png",height:3},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-1.png",height:3},{autoscroll:0,parallax:.004,url:"/Sonic/backdrop/west-side/water-night.png",height:144},{autoscroll:.001,parallax:.001,url:"/Sonic/backdrop/west-side/stars-reflected.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark-reflected.png",height:0},{autoscroll:0,parallax:.03,url:"/Sonic/backdrop/launch-base/bushes-0-night.png",height:0},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-1-night.png",height:0},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-2-night.png",height:48},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-3-night.png",height:128}]}}}),require.register("backdrop/WestSideCloudy.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WestSideCloudy=void 0;var i=e("./Backdrop");t.WestSideCloudy=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="west-side-cloudy",this.args.strips=[{autoscroll:.14,parallax:.02,url:"/Sonic/backdrop/west-side/clouds--1.png",height:64},{autoscroll:.14,parallax:.02,url:"/Sonic/backdrop/west-side/clouds-0.png",height:33},{autoscroll:.13,parallax:.014,url:"/Sonic/backdrop/west-side/clouds-1.png",height:32},{autoscroll:.12,parallax:.013,url:"/Sonic/backdrop/west-side/clouds-2.png",height:24},{autoscroll:.11,parallax:.012,url:"/Sonic/backdrop/west-side/clouds-3.png",height:16},{autoscroll:.1,parallax:.011,url:"/Sonic/backdrop/west-side/clouds-4.png",height:5},{autoscroll:.09,parallax:.01,url:"/Sonic/backdrop/west-side/clouds-5.png",height:3},{autoscroll:.08,parallax:.009,url:"/Sonic/backdrop/west-side/clouds-6.png",height:8},{autoscroll:.07,parallax:.008,url:"/Sonic/backdrop/west-side/clouds-7.png",height:5},{autoscroll:.06,parallax:.007,url:"/Sonic/backdrop/west-side/clouds-8.png",height:3},{autoscroll:.05,parallax:.006,url:"/Sonic/backdrop/west-side/clouds-9.png",height:8},{autoscroll:.04,parallax:.005,url:"/Sonic/backdrop/west-side/clouds-10.png",height:8},{autoscroll:.03,parallax:.004,url:"/Sonic/backdrop/west-side/clouds-11.png",height:32},{autoscroll:.02,parallax:.003,url:"/Sonic/backdrop/west-side/clouds-12.png",height:8},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/west-side/clouds-13.png",height:32},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-cloudy.png",height:2},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark-cloudy.png",height:0},{autoscroll:.015,parallax:.002,url:"/Sonic/backdrop/west-side/reflected-clouds-0.png",height:32},{autoscroll:.02,parallax:.003,url:"/Sonic/backdrop/west-side/reflected-clouds-1.png",height:8},{autoscroll:.03,parallax:.004,url:"/Sonic/backdrop/west-side/reflected-clouds-2.png",height:32},{autoscroll:.04,parallax:.005,url:"/Sonic/backdrop/west-side/reflected-clouds-3.png",height:8},{autoscroll:.05,parallax:.006,url:"/Sonic/backdrop/west-side/reflected-clouds-4.png",height:8},{autoscroll:.06,parallax:.007,url:"/Sonic/backdrop/west-side/reflected-clouds-5.png",height:3},{autoscroll:.07,parallax:.008,url:"/Sonic/backdrop/west-side/reflected-clouds-6.png",height:5},{autoscroll:.08,parallax:.009,url:"/Sonic/backdrop/west-side/reflected-clouds-7.png",height:16},{autoscroll:.09,parallax:.01,url:"/Sonic/backdrop/west-side/reflected-clouds-8.png",height:24},{autoscroll:.1,parallax:.011,url:"/Sonic/backdrop/west-side/reflected-clouds-9.png",height:20},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark-cloudy-reflected.png",height:0},{autoscroll:0,parallax:.004,url:"/Sonic/backdrop/west-side/water-cloudy.png",height:46},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/west-side/water-cloudy-after.png",height:128}],this.args.bindTo("frame",t=>{this.args.ligtening||Math.random()>.995&&(this.args.name="west-side-cloudy lightning",this.args.lightning=!0,this.onTimeout(1e3,()=>{this.args.name="west-side-cloudy",this.args.lightning=!1}))})}}}),require.register("backdrop/WestSideDay.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WestSideDay=void 0;var i=e("./Backdrop");const r=[,{e0e0e5:"afafc1"},{e0e0e5:"afafc1"},{e0e0e5:"afafc1"},{e0e0e5:"afafc1"},{e0e0e5:"afafc1"},{e0e0e5:"e0e0e5"},{e0e0e5:"afafc1"},{e0e0e5:"e0e0e5"},{e0e0e5:"e0e0e5"}];t.WestSideDay=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="west-side-day",this.args.strips=[{autoscroll:.001,parallax:.001,url:"/Sonic/backdrop/west-side/empty.png",height:64},{autoscroll:.001,parallax:.001,url:"/Sonic/backdrop/west-side/empty.png",height:205},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-day.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-0.png",height:3},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-1.png",height:3},{autoscroll:0,parallax:.004,url:"/Sonic/backdrop/west-side/water.png",height:144},{autoscroll:0,parallax:0,url:"/Sonic/backdrop/west-side/empty.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-day-reflected.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-shine.png",height:1,interval:26,timeout:100,frame:0,recolor:r},{autoscroll:0,parallax:.03,url:"/Sonic/backdrop/launch-base/bushes-0.png",height:0},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-1.png",height:0},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-2.png",height:48},{autoscroll:0,parallax:.05,url:"/Sonic/backdrop/launch-base/bushes-3.png",height:128}]}}}),require.register("backdrop/WestSideNight.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WestSideNight=void 0;var i=e("./Backdrop");t.WestSideNight=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="west-side",this.args.strips=[{autoscroll:0,parallax:.001,url:"/Sonic/backdrop/west-side/stars.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-0.png",height:3},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/water-shine-1.png",height:3},{autoscroll:0,parallax:4e-4,url:"/Sonic/backdrop/west-side/water-shine-2.png",height:3},{autoscroll:0,parallax:.004,url:"/Sonic/backdrop/west-side/water.png",height:142},{autoscroll:0,parallax:.001,url:"/Sonic/backdrop/west-side/stars-reflected.png",height:0},{autoscroll:0,parallax:5e-4,url:"/Sonic/backdrop/west-side/island-dark-reflected.png",height:0}]}}}),require.register("backdrop/Wood.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wood=void 0;var i=e("./Backdrop");t.Wood=class extends i.Backdrop{constructor(t,e){super(t,e),this.args.name="wood",this.args.strips=[{autoscroll:0,parallax:.1,url:"/Sonic/backdrop/wood/forest.png",height:1600}]}}}),require.register("behavior/Behavior.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Behavior=void 0;t.Behavior=class{update(t){}}}),require.register("behavior/Crouch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Crouch=void 0;e("curvature/base/Tag");var i=e("./Behavior");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Crouch=class extends i.Behavior{constructor(){super(...arguments),r(this,"spindashCharge",0)}command_0(t,e){t.yAxis>.55&&!t.args.falling&&t.args.gSpeed}update(t){t.args.grinding?t.yAxis>.55?(t.args.animation="grinding-crouching",t.args.crouching=!0):t.args.crouching=!1:t.yAxis>.55&&!t.args.gSpeed&&!t.args.falling&&!t.spindashCharge?(t.args.lookTime--,t.args.lookTime<-45&&(t.args.cameraBias=-.5),t.args.animation="crouching",t.args.crouching=!0):t.args.crouching=!1}}}),require.register("behavior/EmeraldHalo.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmeraldHalo=void 0;var i=e("curvature/base/Tag"),r=e("./Behavior");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.EmeraldHalo=class extends r.Behavior{constructor(){super(...arguments),a(this,"emeraldColors",["red-alt","yellow","green","cyan","white","purple","pink"]),a(this,"emeraldParticles",new Set)}command_3(t,e){if((t.isSuper||!(t.args.rings<t.args.minRingsSuper))&&!(t.isSuper&&!t.isHyper&&t.args.rings<t.args.minRingsHyper)&&!t.isHyper&&t.args.falling&&t.args.jumping)for(;this.emeraldParticles.size<7;){const e=this.emeraldColors[this.emeraldParticles.size],s=t.isSuper?new i.Tag(`<img src = "/Sonic/emerald-super-${e}-mini.png">`):new i.Tag(`<img src = "/Sonic/emerald-${e}-mini.png">`);s.index=this.emeraldParticles.size,s.style({"--x":t.args.x,"--y":t.args.y,"--z":t.args.z+1,width:t.isSuper?"14px":"8px",height:t.isSuper?"10px":"8px"}),t.viewport.particles.add(s),this.emeraldParticles.add(s),t.viewport.onFrameOut(60,()=>{t.viewport.particles.remove(s),this.emeraldParticles.delete(s)})}}updateEnd(t){for(const e of this.emeraldParticles){const s=t.transformTime,i=2*Math.PI*e.index/this.emeraldParticles.size,r=s<30?Math.min(2*s,32)||3:45-s+15,a=Math.cos(i+.15*s)*r,n=-Math.sin(i+.15*s)*r,o=Math.cos(.075*s)*n;e.style({"--x":t.args.x+0+a,"--y":t.args.y+-.65*t.args.height+o,"z-index":t.args.z+-Math.sign(n)})}}}}),require.register("behavior/Liftable.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Liftable=void 0;var i=e("./Behavior");const r=Symbol("rendered");t.Liftable=class extends i.Behavior{rendered(t){t[r]||(t[r]=!0,t.bindTo("carriedBy",e=>{if(t.cX&&(t.cX(),t.cX=null),t.cY&&(t.cY(),t.cY=null),t.carriedBy){const e=t.carriedBy;t.carriedBy=null,t.args.xSpeed=e.args.xSpeed,t.args.ySpeed=e.args.falling?e.args.ySpeed:0,t.args.xSpeed+=4*Math.sign(e.args.gSpeed||e.args.xSpeed),t.args.ySpeed-=4,e.carrying.delete(t),t.args.falling=!0,t.args.float=0}e&&(t.cX=e.args.bindTo("x",s=>t.args.x=s+e.args.direction*e.xHold),t.cY=e.args.bindTo("y",s=>t.args.y=s+-e.yHold),t.args.xSpeed=0,t.args.ySpeed=0,e.carrying.add(t),t.args.standingOn=null,t.args.float=-1)}))}update(t){t.carriedBy&&(t.args.float=-1)}}}),require.register("behavior/LookUp.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LookUp=void 0;e("curvature/base/Tag");var i=e("./Behavior");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LookUp=class extends i.Behavior{constructor(){super(...arguments),r(this,"lookTime",0)}update(t){0===t.args.mode&&(t.yAxis<-.55&&!t.args.gSpeed&&!t.args.falling&&!t.spindashCharge?(t.args.animation="looking-up",t.args.lookTime++,t.args.lookTime>45&&(t.args.cameraBias=.25)):this.lookTime=0)}}}),require.register("behavior/Patrol.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Patrol=void 0;var i=e("./Behavior");t.Patrol=class extends i.Behavior{update(t){var e,s,i,r;t.args.direction;const a=null!==(e=t.args.patrolSpeed)&&void 0!==e?e:1,n=null!==(s=t.args.patrolOffset)&&void 0!==s?s:0,o=null!==(i=t.args.patrolBeat)&&void 0!==i?i:90,l=null!==(r=t.args.patrolPause)&&void 0!==r?r:25;t.age=t.age||0;const h=t.age+n;h%o<o-l?(Math.floor(h/o)%2?t.args.gSpeed=-a:t.args.gSpeed=a,t.args.direction=-Math.sign(t.args.gSpeed)||t.args.direction):t.args.direction=-Math.sign(t.gSpeedLast)||t.args.direction}}}),require.register("behavior/Platformer.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Platformer=void 0;var i=e("curvature/base/Tag"),r=e("curvature/base/Bindable"),a=e("../actor/PointActor"),n=e("../viewport/Layer"),o=(e("../ui/CharacterString"),e("../powerups/StarSheild"));function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const h=0,g=1,c=2,d=3;t.Platformer=class{constructor(){l(this,"collisionMap",null)}updateStart(t){if(t.args.wasHanging=t.args.falling&&t.args.hangingFrom,this.stepsTaken=0,t.knocked&&(t.args.knocked=Math.sign(t.args.xSpeed||t.args.gSpeed)),!t.args.falling&&t.knocked&&(t.args.ySpeedLast<3&&t.pop&&t.pop(t.knocked),t.args.ySpeed=.7*-t.ySpeedLast,t.args.falling=!0,t.args.y--),t.args.falling||(t.modeLast=t.args.mode,t.args.grinding?t.args.wasGrinding=!0:t.args.wasGrinding=!1),t.args.sliding=!1,t.lastLayer=null,t.args.localCameraMode=null,!t.args.dead){if(t.args.standingLayer&&!t.args.static){const e=t.args.standingLayer.layer;let s=!1;for(const e of t.regions)e.grind&&(s=!0);t.controllable||t.canGrind?e&&e.meta.grinding?(t.args.grinding=!0,t.args.direction=Math.sign(t.args.xSpeed||t.args.gSpeed)):s||(t.args.grinding=!1):t.args.grinding=!1,t.args.grinding&&t.args.falling&&(t.args.grinding=!1)}t.args.falling||(t.fallTime=0)}}updateEnd(t){if(t.args.falling?t.args.jumping&&(t.args.ySpeed>-3||t.args.ySpeed>=0&&t.ySpeedLast<0)&&(t.args.jumpArced=!0):t.args.jumpArced=!1,!t.args.static&&t.args.falling&&(t.args.standingLayer&&0===t.fallTime&&(t.args.xSpeed+=t.args.standingLayer.offsetXChanged||0,t.args.ySpeed+=t.args.standingLayer.offsetYChanged||0),t.args.standingLayer=null),t.controllable){if(t.args.popChain.length&&t.args.grinding&&(t.grindReward||(t.grindReward={label:"Rail Grind",points:100,multiplier:1,direction:Math.sign(t.args.gSpeed)},t.args.popChain.push(t.grindReward)),t.grindReward.points+=Math.round(t.args.gSpeed/10)*t.grindReward.direction||1),t.airReward&&t.args.falling&&(t.airReward.points+=Math.ceil(Math.abs(t.args.ySpeed)+Math.abs(t.args.xSpeed))),t.args.popChain||(t.grindReward=null,t.airReward=null),!t.args.falling&&!t.args.grinding&&t.groundTime>1&&(t.grindReward=null,t.airReward=null),t.follower){const e=t.viewport.serializePlayer(),s=t.follower;t.viewport.onFrameOut(5,()=>{e.input&&(s.controller&&s.controller.replay(e.input),s.readInput()),e.args&&(Object.assign(s.args,e.args),s.viewport&&s.viewport.setColCell(t))}),t.follower.args.dead&&(t.follower.args.dead=!1,t.follower.args.x=t.x,t.follower.args.y=t.y)}t.args.falling||t.args.rolling||t.args.hangingFrom||t.args.grinding||!(t.groundTime>1)||t.args.bouncing||t.punched||t.readyTime||!t.args.popChain.length||t.totalCombo()}}update(t){if(t.args.mercy&&(t.args.spindashCharge=0,t.args.dropDashCharge=0),"number"==typeof t.args.standingOn){const e=t.args.standingOn,s=t.viewport.actorsById[e];s&&(t.args.standingOn=s,t.args.falling=!1,t.args.x=s.args.x,t.args.y=-1+s.args.y-s.args.height)}if(t.args.jumpBlocked=!1,t.xAxis&&Math.sign(t.args.gSpeed)===t.args.pushing&&Math.sign(t.xAxis)===t.args.pushing||(t.args.pushing=!1),t.args.x,t.args.y,t.noClip&&!t.controllable){let e;switch(t.args.xSpeed&&(t.args.x+=t.args.xSpeed),t.args.ySpeed&&(t.args.y+=t.args.ySpeed),!t.args.float&&t.args.falling&&(t.args.ySpeed+=t.args.gravity),null!==t.impulseMag&&this.applyImpulse(t),t.args.float>0&&t.args.float--,t.args.mode){case c:e=viewport.actorsAtPoint(t.args.x,t.args.y+t.args.height,t.args.width,t.args.height);break;case g:e=viewport.actorsAtPoint(t.args.x-t.args.height/2,t.args.y+t.args.width/2,t.args.height,t.args.width);break;case d:e=viewport.actorsAtPoint(t.args.x+t.args.height/2,t.args.y+t.args.width/2,t.args.height,t.args.width);break;default:case h:e=viewport.actorsAtPoint(t.args.x,t.args.y,t.args.width,t.args.height)}if(e)for(const s of e)s.args!==t.args&&s.callCollideHandler(t);return}if(!t.args.falling&&!t.args.rolling&&t.args.modeTime>=1&&(t.args.spinning=!1),(t.args.rolling||t.args.jumping||t.spindashCharge)&&(t.args.spinning=!0),t.viewport&&t.args.respawning&&!t.args.npc&&!t.viewport.args.isRecording&&!t.viewport.args.isReplaying){const e=t.viewport.getCheckpoint(t.args.canonical);let s,i;if(e&&e.checkpointId){const r=t.viewport,a=r.defsByMap.get(r.currentMap)[e.checkpointId];s=a.x,i=a.y}else if(t.def)s=t.def.get("x"),i=t.def.get("y");else if(!t.canRoll&&t.viewport.defsByName.get("wide-player-start")){const e=t.viewport.defsByName.get("wide-player-start");s=e.x,i=e.y}else if(t.viewport.defsByName.has("player-start")){const e=t.viewport.defsByName.get("player-start");s=e.x,i=e.y}t.args.animation="dropping",t.args.standingLayer=null,t.args.standingOn=null,t.lastLayer=null;const r=t.args.x-s,a=t.args.y-i,n=Math.max(Math.abs(r/8),16),o=Math.max(Math.abs(a/8),16);t.args.x-=Math.sign(r)*n,t.args.y-=Math.sign(a)*o;const l=t.viewport;return Math.abs(r)<=n&&(t.args.x=s),Math.abs(a)<=o&&(t.args.y=i),Math.abs(r)<=n&&Math.abs(a)<=o&&t.viewport.onFrameOut(60,()=>{t.viewport.args.networked?(t.args.dead=!1,t.noClip=!1,t.args.respawning=!1,t.args.display="initial",t.args.ignore=4,t.args.xSpeed=0,t.args.ySpeed=-3):(l.reset(),l.startLevel(!1)),l.args.paused=!1}),void(t.viewport&&t.viewport.setColCell(t))}if(t.viewport&&t.viewport.meta.deathLine&&!t.args.dead&&t.controllable&&t.y>t.viewport.meta.deathLine)return void t.die();if(t.controllable&&!t.args.dead){t.args.width,Math.sign(t.args.xSpeed);const e=Math.max(t.args.height,0),s=t.rotatePoint(0,.75*e);let i=t.getMapSolidAt(t.args.x+s[0],t.args.y+s[1]);if(Array.isArray(i)&&(i=!!i.filter(t=>!t.args.platform&&!t.isVehicle).length),t.args.rolling){const s=t.rotatePoint(0,e);let i=t.getMapSolidAt(t.args.x+s[0],t.args.y+s[1]);Array.isArray(i)&&(i=!!i.filter(t=>!t.args.platform&&!t.isVehicle).length,t.args.jumpBlocked=!!i),t.args.jumpBlocked=!!i}if(!t.args.hangingFrom&&!t.noClip&&!t.args.falling&&this.checkBelow(t,t.args.x,t.args.y)&&i)return void t.die();if(!t.args.falling&&0===t.args.mode){const e=t.castRay(t.maxStep,t.upAngle,this.findUpSpace);e&&(t.args.y-=e)}}if(t.args.skimming=!1,t.args.falling){if(t.args.airAngle=t.airAngle,t.args.displayAngle!==t.args.groundAngle){const e=t.args.groundAngle+-t.args.displayAngle;t.args.displayAngle+=Math.sign(e)*(Math.abs(e)>1?1:Math.abs(e))*.5}}else t.args.airAngle=0,t.args.displayAngle=t.args.groundAngle;if(t.args.halted<1&&t.args.halted>0&&(t.args.halted=0),t.args.halted>0)return void t.args.halted--;if(t.args.currentSheild&&"update"in t.args.currentSheild&&t.args.currentSheild.update(t),t.args.rolling?t.args.height=t.args.rollingHeight||t.args.height:t.args.jumping?t.args.height=t.args.rollingHeight||t.args.height:t.canRoll&&(t.args.height=t.args.normalHeight||t.args.height),t.args.dontJump>0&&t.args.dontJump--,t.args.dontJump<0&&(t.args.dontJump=0),!t.viewport||t.removed)return;if(t.args.modeTime++,!t.args.falling)if(Math.abs(t.args.gSpeed)<1&&!t.impulseMag&&t.args.modeTime>3&&(t.args.rolling=!1),Math.abs(t.args.gSpeed)<.01?t.args.gSpeed=0:t.canRoll&&t.yAxis>.55&&!t.args.ignore&&!t.carrying.size&&(t.args.rolling=!0),t.args.gSpeed||0!==t.args.mode||t.args.groundAngle)t.args.teeter=0;else{const e=t.getMapSolidAt(t.args.x+0*t.args.direction,t.args.y+4),s=t.getMapSolidAt(t.args.x+4*t.args.direction,t.args.y+4),i=t.getMapSolidAt(t.args.x+4*t.args.direction,t.args.y-4),r=t.getMapSolidAt(t.args.x+2*t.args.direction,t.args.y+4),a=t.getMapSolidAt(t.args.x-4*t.args.direction,t.args.y+4),n=t.getMapSolidAt(t.args.x-4*t.args.direction,t.args.y-4);!e||s||i?t.args.teeter=!e||a||n?0:-1:(t.args.teeter=1,r||(t.args.teeter=2))}if(t.args.driving=!1,t.args.standingOn&&t.args.standingOn.isVehicle&&!t.isVehicle){const e=t.args.standingOn;if(t.args.groundTimeTotal++,t.args.falling=!0,t.args.flying=!1,t.args.jumping=!1,t.args.driving=!0,t.processInput(),t.args.cameraMode=e.args.cameraMode,!t.args.standingOn.args.lockedIn&&t.willJump&&(t.yAxis<0||t.args.standingOn&&t.args.standingOn.quickDrop)){const s=t.args.standingOn;t.args.standingLayer=!1,t.args.standingOn=!1,t.willJump=!1,s.occupant=null,t.args.falling=!0,t.args.jumping=!0,t.args.y-=16,s&&s.quickDrop?t.args.ySpeed=-t.args.jumpForce+Math.max(s.args.ySpeed,0):(t.args.xSpeed=2*e.args.direction*-Math.sign(e.args.seatAngle||-1),t.args.ySpeed=-t.args.jumpForce),e.args.ySpeed=0}return t.args.groundAngle=(e.args.groundAngle||0)+(e.args.seatAngle||0),void(t.willJump&&t.yAxis>=0&&(t.args.standingOn.falling=!1,t.willJump=!1,t.args.standingOn.command_0()))}null!==t.impulseMag&&this.applyImpulse(t),-2===t.args.ignore&&(!1===t.args.falling||t.args.ySpeed>0)&&(t.args.ignore=0),-3===t.args.ignore&&(!t.args.falling||t.args.ySpeed>=-10)&&t.viewport.onFrameOut(1,()=>t.args.ignore=0),-4!==t.args.ignore||t.args.falling||(t.args.ignore=30),t.args.ignore<1&&t.args.ignore>0&&(t.args.ignore=0),t.args.ignore>0&&t.args.ignore--,t.args.cameraIgnore>0&&t.args.cameraIgnore--,t.args.mercy>0&&t.args.mercy--,t.args.startled>0&&t.args.startled--,t.args.antiSkid>0&&t.args.antiSkid--,t.args.float>0&&t.args.float--,t.args.standingOn instanceof a.PointActor&&t.args.standingOn.callCollideHandler(t),!t.args.float&&t.args.falling?t.args.standingOn&&t.args.standingOn.isVehicle||(t.args.standingOn=null,t.args.landed=!1,t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)),t.args.jumping&&t.args.jumpedAt<t.args.y?t.args.deepJump=!0:t.args.jumping&&t.args.jumpedAt>t.args.y+160?t.args.highJump=!0:t.args.jumping&&(t.args.deepJump=!1,t.args.highJump=!1)):t.args.jumping&&!t.args.falling&&(t.args.jumping=!1,t.args.deepJump=!1,t.args.highJump=!1,t.args.jumpedAt=null),!t.args.falling&&t.args.standingOn&&t.args.rolling&&t.args.modeTime<3&&!t.args.dropDashCharge&&t.args.standingOn.args.convey&&(t.args.gSpeed=.8*-t.args.standingOn.args.convey);const e=t.getLocalDrag();t.args.gSpeedMax;let s=new Set;if(!t.isRegion){if(!t.noClip){s=t.viewport.regionsAtPoint(t.args.x,t.args.y);for(const e of t.regions)e.updateActor(t)}for(const i of s){if(t.args.density&&i.args.density&&t.args.density<i.args.density){i.args.density,t.args.density;let r=!1,a=t.getMapSolidAt(t.x,t.y-t.args.height);if(Array.isArray(a)&&(a.filter(t=>![...s].includes(t)),a.length&&(r=!0)),!r){const s=t.y-t.args.height,r=i.y-i.args.height,a=Math.min((s+-r+4)/t.args.height,1);t.args.float=1;const n=a*e;t.args.falling=!0,a>-1?(t.args.ySpeed-=n,t.args.ySpeed*=e):a<-1&&t.args.ySpeed<0&&Math.abs(a)<.25&&Math.abs(t.args.ySpeed)<1&&(t.args.ySpeed=0,t.args.y=-1+r+t.args.height)}}t.regions.has(i)||(t.regions.add(i),t.crossRegionBoundary(i,!0),i.enter(t))}for(const e of t.regions)s.has(e)||(t.regions.delete(e),t.crossRegionBoundary(e,!1),e.leave(t))}if(t.willJump&&!t.args.dontJump&&(!t.args.falling||t.falltime<2)){t.willJump=!1,t.viewport.tileMap;const s=Math.max(t.args.height,32),i=t.rotatePoint(0,s+1);let r=t.getMapSolidAt(t.args.x+i[0],t.args.y+i[1]);if(Array.isArray(r)&&(r=!!r.filter(t=>!t.args.platform&&!t.isVehicle).length),!r){let s=t.args.jumpForce*e;t.running?s*=1.5:t.crawling&&(s*=.5),this.doJump(t,s)}return}if(t.willJump=!1,!t.viewport)return;if(t.noClip&&(t.args.falling=!0),!t.args.static){const e=t.groundPoint,s=t.controllable||t.args.pushed||t.isVehicle?t.viewport.regionsAtPoint(e[0],e[1]+1):[],i=t.getMapSolidAt(...e)||!(!t.controllable||!t.args.groundAngle)&&t.getMapSolidAt(e[0],e[1]+1);if(t.args.dead||t.isRegion||t.args.mode!==h||!s.size)t.noClip||t.args.climbing||t.args.xSpeed||t.args.ySpeed||t.args.float||(t.args.falling=!t.args.float&&!this.checkBelow(t)||t.args.falling);else{let e=!i;if(!t.args.falling||t.broad)for(const i of s)if(t.broad||!Math.round(t.args.ySpeed)&&(Math.round(t.args.y)===i.args.y-i.args.height||Math.round(t.args.y+1)===i.args.y-i.args.height||Math.round(t.args.y+2)===i.args.y-i.args.height)){if(i.skimSpeed<1/0&&(t.broad||Math.max(Math.abs(t.args.gSpeed),Math.abs(t.args.xSpeed))>=i.skimSpeed)){const s=t.args.falling?Math.abs(t.args.xSpeed):Math.abs(t.args.gSpeed);t.args.gSpeed=s*Math.sign(t.args.gSpeed||t.args.xSpeed),t.args.y-32<i.args.y-i.args.height?(t.broad&&(t.args.falling=!1),t.args.skimming=!0,t.args.y=i.y-i.args.height-1,e=!1,i.skim(t)):t.broad&&t.args.ySpeed--;break}t.args.xSpeed=t.args.gSpeed||t.args.xSpeed}i instanceof n.Layer?t.args.standingOn=i:t.args.falling=t.args.falling||e,t.args.falling?t.args.standingLayer=null:t.args.gSpeed=t.args.gSpeed||t.args.xSpeed}if(t.args.static||t.noClip||!t.args.falling||(t.args.mode=h,t.args.gSpeed=0),!t.willStick&&(t.args.falling&&t.args.ySpeed>=0||t.args.standingOn)&&!t.args.static&&!t.noClip){let e=64;const s=.5*t.args.width;for(;t.getMapSolidAt(t.args.x-s,t.args.y-.5*t.args.height)&&!t.getMapSolidAt(t.args.x+s+1,t.args.y-.5*t.args.height)&&e>0;)t.args.x+=1,e--;for(;t.getMapSolidAt(t.args.x+s+-1,t.args.y-.5*t.args.height)&&!t.getMapSolidAt(t.args.x-s,t.args.y-.5*t.args.height)&&e>0;)t.args.x-=1,e--}if(!t.viewport)return;if(t.noClip||!t.isRegion&&!t.isEffect&&t.args.falling&&t.viewport){if(t.args.grinding&&(t.args.grinding=!1),t.args.pushing=!1,(t.args.xSpeed||t.args.ySpeed)&&(t.args.hangingFrom?(t.args.groundTimeTotal++,t.args.flying=!1):(this.updateAirPosition(t),t.swing=!1,t.args.airTimeTotal++)),t.args.animationBias=Math.abs(t.args.airSpeed/t.args.flySpeedMax),t.args.animationBias>1&&(t.args.animationBias=1),!t.args.canHide&&!t.noClip){let e,s=32;for(;!t.args.static&&0===t.args.mode&&!t.getMapSolidAt(t.args.x,t.args.y-t.args.height,t.args.layer,0)&&(e=t.getMapSolidAt(t.args.x,t.args.y-1,t.args.layer,0))&&(!e.find||e.find(e=>{const s=t.viewport.collisions.get(t);return s&&s.has(e)}));){if(--s<=0)return;t.args.y--}}}else if(!t.args.static&&(!t.noClip||t.args.standingLayer||!t.isRegion&&!t.isEffect&&!t.args.falling)){if(Math.abs(t.args.xSpeed)>Math.abs(t.args.gSpeed)&&(0===t.args.mode?t.args.gSpeed=t.args.xSpeed:2===t.args.mode&&(t.args.gSpeed=-t.args.xSpeed),t.args.standingLayer&&(t.args.gSpeed-=t.args.standingLayer.layer.offsetXChanged)),t.args.xSpeed=0,t.args.ySpeed=0,t.xLast=t.args.x,t.yLast=t.args.y,t.args.grinding&&!t.args.gSpeed&&t.args.modeTime>4&&(t.args.gSpeed=Math.sign(t.args.direction||t.axis||t.xSpeedLast||t.gSpeedLast||0)),!t.args.canHide&&!t.noClip){let e,s=32;for(;!t.args.static&&0===t.args.mode&&(e=t.getMapSolidAt(t.args.x,t.args.y-1))&&(!e.find||e.find(e=>{const s=t.viewport.collisions.get(t);return s&&s.has(e)}));){if(--s<=0)return;t.args.y--}}this.updateGroundPosition(t),t.args.groundTimeTotal++,t.args.animationBias=Math.abs((.75*t.args.hSpeed||t.args.gSpeed)/t.args.gSpeedMax),t.args.animationBias>1&&(t.args.animationBias=1)}if(t.args.rolling&&t.args.pushing&&(t.args.gSpeed=0),!t.viewport)return}const i=Math.ceil(t.args.width/2),r=Math.floor(t.args.height/2);if(!t.noClip&&!t.isRegion&&t.args.pushed){let e;const s=s=>{switch(t.args.mode){case h:e=t.getMapSolidAt(t.x+i*s+(-1===s?0:-1),t.y-r);break;case c:e=t.getMapSolidAt(t.x+i*s+(-1===s?0:-1),t.y+r);break;case g:e=t.getMapSolidAt(t.x+r*(-1===s?0:2),t.y);break;case d:e=t.getMapSolidAt(t.x-r*(-1===s?0:2),t.y)}return e&&Array.isArray(e)?e.filter(t=>!t.args.platform&&!t.isVehicle):e},a=s(-1),n=s(1);n&&!a&&(t.args.xSpeed>0&&(t.args.xSpeed=0),t.args.x--),a&&!n&&(t.args.xSpeed>0&&(t.args.xSpeed=0),t.args.x++)}if(!t.viewport||t.removed)return;t.viewport.objectPalette["layer-switch"];const o=[t.viewport.objectPalette["base-region"]];if(!(t.noClip||t.isGhost||t.isStatic||t.isRegion||o.some(e=>t instanceof e))){let e;switch(t.args.mode){case c:e=viewport.actorsAtPoint(t.args.x,t.args.y+t.args.height,t.args.width,t.args.height);break;case g:e=viewport.actorsAtPoint(t.args.x+t.args.height/2,t.args.y+t.args.width/2,t.args.height,t.args.width);break;case d:e=viewport.actorsAtPoint(t.args.x-t.args.height/2,t.args.y+t.args.width/2,t.args.height,t.args.width);break;default:case h:e=viewport.actorsAtPoint(t.args.x,t.args.y,t.args.width,t.args.height)}e.forEach(e=>e.args!==t.args&&!(t.args.static&&e.args.static)&&!e.isPushable&&e.callCollideHandler(t))}if(t.viewport){if(t.viewport.tileMap,(t.args.pushing||Math.abs(t.args.gSpeed)<2)&&!t.args.falling){let e=t.stayStuck;if(t.regions.forEach(t=>{e=e||t.args.sticky}),!e&&!t.args.climbing){Math.floor(t.args.width/2);const e=t.args.mode;if(t.args.mode===h&&t.args.groundAngle<=-Math.PI/4)t.args.gSpeed=1;else if(t.args.mode===h&&t.args.groundAngle>=Math.PI/4&&t.args.groundAngle<Math.PI)t.args.gSpeed=-1;else if(e===g&&t.args.groundAngle<.05*Math.PI)t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)),t.args.mode=h,t.args.falling=!0,t.args.rolling?(t.args.x+=t.args.width,t.args.y+=t.args.height,t.args.ySpeed=t.args.gSpeed,t.args.float=1):(t.args.groundAngle=-Math.PI/2,t.args.x++),t.args.cameraIgnore=30,t.args.ignore=-4;else if(e===d&&t.args.groundAngle>.05*-Math.PI)t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)),t.args.mode=h,t.args.falling=!0,t.args.rolling?(t.args.x-=t.args.width,t.args.y+=t.args.height,t.args.ySpeed=-t.args.gSpeed,t.args.float=1):(t.args.groundAngle=Math.PI/2,t.args.x--),t.args.cameraIgnore=30,t.args.ignore=-4;else if(e===c){t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)),t.args.xSpeed=0,t.args.y++,t.args.falling=!0,t.willJump=!1;const e=t.args.gSpeed;t.args.groundAngle=Math.PI,t.args.mode=h,t.viewport.onFrameOut(1,()=>{t.args.mode=h,t.willJump=!1,t.args.xSpeed=-e}),t.args.rolling||(-1===Math.sign(t.xSpeedLast)?(t.args.direction=-1,t.args.facing="left"):1===Math.sign(t.xSpeedLast)&&(t.args.direction=1,t.args.facing="right")),t.args.cameraIgnore=30,t.args.ignore=-2}}}if(t.args.landed=!0,t.controllable&&(t.args.x=t.args.x,t.args.y=t.args.y),t.controllable&&t.processInput(),t.args.falling||t.args.gSpeed?t.args.stopped=0:t.args.stopped++,t.args.falling?t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)):t.lastAngles.length>0&&(t.args.groundAngle=t.lastAngles.map(t=>Number(t)).reduce((t,e)=>t+e)/t.lastAngles.length),isNaN(t.args.groundAngle)&&console.log(t.lastAngles,t.lastAngles.length),!t.args.float&&!t.args.static&&!t.noClip){const e=t.getMapSolidAt(...t.groundPoint);if(Array.isArray(e)&&e.length&&!t.args.float){t.args.standingLayer=!1;const s=e.filter(e=>e.args!==t.args&&e.solid&&e.callCollideHandler(t));if(s.length)for(const e of s)!e.isVehicle&&t.args.y>1+e.args.y+-e.args.height||(t.args.groundAngle=e.groundAngle||0,t.args.standingOn=e)}else e?(t.args.standingOn=null,"object"==typeof e?(Array.isArray(e)||(t.args.standingLayer=e),t.args.modeTime<1&&e.xLayerSpeed):t.args.standingLayer=null):t.args.standingOn&&!t.args.standingOn.isVehicle&&(t.args.standingOn=null)}if(t.args.static||t.isRegion||t.noClip||t.args.xSpeed||t.args.ySpeed||!this.checkBelow(t,t.args.x,t.args.y)||(t.args.falling=!1),t.args.falling&&t.args.ySpeed<t.args.ySpeedMax){if(!t.args.float){let e=1;for(const s of t.regions)(s.args.gravity||1===s.args.gravity)&&(e*=s.args.gravity);t.args.ySpeed+=t.args.gravity*e}t.args.landed=!1}t.args.falling||(this.checkDropDash(t),t.args.jumping=!1),t.twister&&(t.viewport&&t.viewport.args.frameId%t.viewport.settings.frameSkip==0&&(t.twister.args.x=t.args.x,t.twister.args.y=t.args.y),t.args.mode?t.twister.args.xOff=t.args.xOff:t.twister.args.xOff=t.args.xOff+-8*t.args.direction,t.twister.args.yOff=t.args.yOff+16,t.twister.args.width=t.args.width,t.twister.args.height=t.args.height),t.pincherBg&&(t.viewport&&t.viewport.args.frameId%t.viewport.settings.frameSkip==0&&(t.pincherBg.args.x=t.args.x,t.pincherBg.args.y=t.args.y),t.pincherBg.args.xOff=t.args.xOff,t.pincherBg.args.yOff=t.args.yOff,t.pincherBg.args.width=t.args.width,t.pincherBg.args.height=t.args.height),t.pincherFg&&(t.viewport&&t.viewport.args.frameId%t.viewport.settings.frameSkip==0&&(t.pincherFg.args.x=t.args.x,t.pincherFg.args.y=t.args.y),t.pincherFg.args.xOff=t.args.xOff,t.pincherFg.args.yOff=t.args.yOff,t.pincherFg.args.width=t.args.width,t.pincherFg.args.height=t.args.height),t.args.falling?(t.groundTime=0,t.idleTime=0,t.args.rolling=!1,t.fallTime++):(t.groundTime++,t.idleTime++,(t.yAxis||t.xAxis)&&(t.idleTime=0)),t.args.carrying=!!t.carrying.size,t.args.carrying&&(Math.abs(t.args.gSpeed)>8&&(t.args.gSpeed=8*Math.sign(t.args.gSpeed)),t.idleTime=0,t.args.rolling=!1)}}applyImpulse(t){if(!t.args.dead){if(t.args.xSpeed+=Number(Number(Math.cos(t.impulseDir)*t.impulseMag).toFixed(3)),t.args.ySpeed+=Number(Number(Math.sin(t.impulseDir)*t.impulseMag).toFixed(3)),t.impulseFal)t.args.falling=t.impulseFal||t.args.falling;else switch(t.args.mode){case h:t.args.gSpeed=Math.cos(t.impulseDir)*t.impulseMag;break;case c:t.args.gSpeed=-Math.cos(t.impulseDir)*t.impulseMag;break;case g:t.args.gSpeed=-Math.sin(t.impulseDir)*t.impulseMag;break;case d:t.args.gSpeed=Math.sin(t.impulseDir)*t.impulseMag}t.impulseMag=null,t.impulseDir=null,t.impulseFal=null}}updateGroundPosition(t){t.args.mercy&&Math.abs(t.args.gSpeed)>10&&(t.args.gSpeed=10*Math.sign(t.args.gSpeed));const e=t.getLocalDrag();let s=t.args.gSpeedMax;t.running?s=RUNNING_SPEED:t.crawling&&(s=CRAWLING_SPEED);let i=[0,0];const a=Math.ceil(t.args.width/2),n=t.paused;if(t.args.gSpeed||t.args.rolling||t.canRoll&&t.args.crouching){const s=Math.sign(t.args.gSpeed||t.args.direction),o=Math.abs(t.args.gSpeed),l=1;t.pause(!0),Math.PI;const u=e=>e.args!==t.args&&e.callCollideHandler(t)&&e.solid;for(let e=0;e<o;e+=l){if(t.args.height>8&&t.args.modeTime>1){t.args.gSpeed||(t.args.pushing=!1);const e=t.rotatePoint(a*-s,t.args.height);let i=t.getMapSolidAt(t.args.x+e[0],t.args.y+e[1]);if(Array.isArray(i)&&(i=i.filter(u).length),i){t.args.mode===c&&(t.args.x+=a*Math.sign(t.args.gSpeed),t.args.y+=t.args.height,t.args.mode=h),t.args.pushing=Math.sign(t.args.gSpeed);break}t.args.pushing=!1;let r=!1;if(!t.noClip&&t.controllable&&0===t.args.groundAngle){const e=t.rotatePoint(-a*Math.sign(t.args.gSpeed),.5*t.args.height);if(r=t.getMapSolidAt(t.args.x+e[0],t.args.y+e[1]),Array.isArray(r)&&(r=r.filter(u).length||!1),!1!==r&&r<=a){t.args.mode===c?(t.args.x+=a*Math.sign(t.args.gSpeed),t.args.y+=t.args.rollingeight||t.args.height,t.args.mode=h,t.args.gSpeed=0):t.args.mode===h&&(t.args.gSpeed=Math.min(1,r)*Math.sign(t.args.gSpeed)),t.args.gSpeed&&(t.args.pushing=Math.sign(t.args.gSpeed));break}}}for(const e of t.behaviors)e.movedGround&&e.movedGround(t);if(t.args.falling||t.locked)return;if(!(i=this.findNextStep(t,l*s)))break;if(i[3]){t.args.moving=!1,t.args.gSpeed=.15*Math.sign(t.args.gSpeed);break}if(!0===i[2]){const e=t.args.gSpeed||0,s=t.args.groundAngle||0;let i,r;switch(t.args.standingLayer=null,t.args.mode){case h:i=t.args.width/2;const a=Math.max(1,Math.abs(e)-Math.abs(this.stepsTaken))||1,n=a*Math.sign(e||0);t.args.x+=n*Math.cos(s),t.args.y+=-n*Math.sin(s),t.args.xSpeed=e*Math.cos(s),t.args.ySpeed=-e*Math.sin(s),t.args.float=t.args.float<0?t.args.float:1;let o=!!t.args.gSpeed;this.checkBelow(t,t.args.x,t.args.y)&&(t.args.gSpeed=e,t.args.xSpeed=0,t.args.ySpeed=0,o=!1,t.canRoll&&t.yAxis>.55&&(t.args.rolling=!0)),t.args.falling=o,t.args.ignore=2;break;case c:t.args.y+=t.args.height,t.args.y++,t.args.float=t.args.float<0?t.args.float:1,t.args.falling=!0,t.args.mode=h,t.args.xSpeed=-e*Math.cos(s),t.args.ySpeed=e*Math.sin(s),t.args.x+=-e*Math.cos(s),t.args.y+=e*Math.sin(s),t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(0)),t.args.direction*=-1,t.args.rolling||t.args.grinding||(t.args.facing="left"===t.args.facing?"right":"left"),t.args.ignore=3;break;case g:i=t.args.width/2,r=t.args.height/2,t.args.climbing||(Math.abs(t.args.gSpeed)<2&&!t.args.rolling?t.args.gSpeed<0||(t.args.x+=i):(t.args.ignore=-3,t.args.x+=t.controllable?i:1),t.args.xSpeed=e*Math.sin(s),t.args.ySpeed=e*Math.cos(s),t.args.x+=e*Math.sin(s),t.args.y+=e*Math.cos(s),t.isVehicle||!t.args.rolling&&!t.args.grinding?t.args.groundAngle=.5*-Math.PI:t.args.x+=i,t.args.mode=h,t.args.cameraIgnore=30),t.args.falling=!0;break;case d:i=t.args.width/2,r=t.args.height/2,t.args.climbing||(Math.abs(t.args.gSpeed)<3&&!t.args.rolling?t.args.gSpeed>0||(t.args.x-=i):(t.args.ignore=-3,t.args.x-=t.controllable?i:1),t.args.xSpeed=-e*Math.sin(s),t.args.ySpeed=-e*Math.cos(s),t.args.x+=-e*Math.sin(s),t.args.y+=-e*Math.cos(s),t.isVehicle||!t.args.rolling&&!t.args.grinding?t.args.groundAngle=.5*Math.PI:t.args.x-=i,t.args.mode=h,t.args.cameraIgnore=30),t.args.falling=!0}break}if(i[0]||i[1]){if((i[0]||i[1])&&!t.rotateLock&&(t.args.moving=!0,!t.keepAngle)){let e=i[0]?Math.atan(i[1]/i[0]):Math.sign(i[1])*Math.PI/2;if(Math.abs(t.args.angle-e)>=.38*Math.PI){const s=6,r=this.findNextStep(t,-s),a=this.findNextStep(t,s);r[1]!==i[1]&&a[1]!==i[1]||(e=0)}t.args.angle=e,t.lastAngles.unshift(t.args.angle),t.lastAngles.splice(t.angleAvg)}}else switch(t.args.moving=!1,t.args.mode){case h:case c:t.args.gSpeed=0}if(t.rotateLock)t.args.x+=i[0],t.args.y-=i[1];else{switch(t.args.mode){case h:t.args.x+=i[0],t.args.y-=i[1];break;case c:t.args.x-=i[0],t.args.y+=i[1];break;case g:t.args.x+=i[1],t.args.y+=i[0];break;case d:t.args.x-=i[1],t.args.y-=i[0]}if(t.args.angle>Math.PI/4&&t.args.angle<Math.PI/2){const e=t.lastAngles.map(t=>Number(t)-Math.PI/2);switch(Object.defineProperty(e,r.Bindable.NoGetters,{value:!0}),t.lastAngles=e,t.args.mode){case h:t.args.mode=d;break;case d:t.args.mode=c;break;case c:t.args.mode=g;break;case g:t.args.mode=h}t.args.groundAngle-=Math.PI/2}else if(t.args.angle<-Math.PI/4&&t.args.angle>-Math.PI/2){t.args.mode;const e=t.lastAngles.map(t=>Number(t)+Math.PI/2);switch(Object.defineProperty(e,r.Bindable.NoGetters,{value:!0}),t.lastAngles=e,t.args.mode){case h:t.args.mode=g;break;case d:t.args.mode=h;break;case c:t.args.mode=d;break;case g:t.args.mode=c}t.args.groundAngle=Number(t.args.groundAngle)+Math.PI/2}}}t.args.pushing&&(t.args.gSpeed=Math.sign(t.args.gSpeed));const p=Math.round(t.args.height/2);let f=16;if(!t.args.static&&t.args.mode===h){for(;(t.args.gSpeed<=0||t.args.modeTime<3)&&t.getMapSolidAt(t.args.x-a,t.args.y-p,!1)&&f>0;)t.args.x++,f--;for(;(t.args.gSpeed>=0||t.args.modeTime<3)&&t.getMapSolidAt(t.args.x+a,t.args.y-p,!1)&&f>0;)t.args.x--,f--}n||t.pause(!1);const m=t.xAxis&&Math.sign(t.xAxis)===Math.sign(t.args.gSpeed),v=t.getLocalFriction();if(t.args.mode===h||t.args.mode===c||t.args.gSpeed<0&&t.args.mode===g||t.args.gSpeed>0&&t.args.mode===d){const i=t.xAxis&&Math.sign(t.xAxis)!==Math.sign(t.args.gSpeed),r=v*t.args.decel*(t.args.rolling&&i?3:.75);if(!t.args.climbing&&t.args.gSpeed&&(!m||t.args.rolling)){if(t.args.sliding);else if(t.args.grinding)Math.abs(t.yAxis)>.5||(t.args.gSpeed-=1*r/e*.125*Math.sign(t.args.gSpeed)),Math.abs(t.args.gSpeed)>40&&(t.args.gSpeed=40*s);else if(t.args.rolling)t.args.gSpeed-=1*r/e*.06125*Math.sign(t.args.gSpeed);else if(!t.args.grinding&&!t.args.rolling&&(!t.xAxis||i&&Math.abs(t.args.gSpeed)>6)){const s=1*r/e*Math.sign(t.args.gSpeed);Math.abs(t.args.gSpeed)>Math.abs(s)?t.args.gSpeed-=s:t.args.gSpeed=0}(Math.abs(t.args.gSpeed)<.1||i&&Math.abs(t.args.gSpeed)<1)&&(t.args.gSpeed=0)}}let y=0;if(!t.args.climbing){switch(t.args.mode){case h:y=t.args.groundAngle/(Math.PI/2),s>0&&(y*=-1);break;case c:y=-t.args.groundAngle/(Math.PI/2),s>0&&(y*=-1);break;case d:s>0?(y=-1,y-=t.args.groundAngle/(Math.PI/2)):(y=1,y+=t.args.groundAngle/(Math.PI/2));break;case g:s>0?(y=1,y-=t.args.groundAngle/(Math.PI/2)):(y=-1,y+=t.args.groundAngle/(Math.PI/2))}if(t.args.grinding){const e=Math.abs(t.args.gSpeed),s=Math.sign(t.args.gSpeed);t.args.direction=s,e<6?t.args.gSpeed=6*s:e>40?t.args.gSpeed=40*s:y<0?t.args.gSpeed*=1-(0-y/2*.015):y>0?t.args.gSpeed*=1.0015*(1+y/2*.045):t.args.gSpeed+=.1*s}else if(t.args.rolling||t.canRoll&&t.args.crouching){if(y>0&&t.args.modeTime>3){(t.args.gSpeed||Math.abs(y)>.25)&&(t.args.gSpeed+=.6*y*s),Math.abs(t.args.gSpeed)<1&&(t.args.gSpeed=(1+y**2)*Math.sign(t.args.gSpeed));const e=t.controllable||t.args.pushed||t.isVehicle?t.regions:[];for(const s of e)!s.args.maxSpeed||s.args.maxSpeed<0||s.args.maxSpeed<Math.abs(t.args.gSpeed)&&(t.args.gSpeed=s.args.maxSpeed*Math.sign(t.args.gSpeed));Math.abs(y)>.25&&Math.abs(t.args.gSpeed)<2&&Math.abs(Math.sign(t.args.gSpeed)-Math.sign(s))<2&&(t.args.gSpeed=2*s)}else if(y<-.3||y<0&&t.args.gSpeed)if(Math.abs(t.args.gSpeed)<10){const e=y*s;(t.args.gSpeed||y<-.075)&&(Math.sign(e)===Math.sign(t.args.gSpeed)?t.args.gSpeed+=1.65*y*s:t.args.gSpeed+=.25*y*s)}else t.args.gSpeed+=.65*y*s}else if(!t.stayStuck){if(y>.25)Math.abs(t.args.gSpeed)<2*t.args.gSpeedMax&&(t.args.gSpeed+=.125*y*s,Math.abs(t.args.gSpeed)<2&&Math.abs(Math.sign(t.args.gSpeed)-Math.sign(s))<2&&(t.args.gSpeed=2*s));else if(y<-.075){const e=Math.sign(t.args.gSpeed);Math.abs(t.args.gSpeed)<10&&(t.args.gSpeed+=.3*y*s),Math.sign(t.args.gSpeed)!==e&&(t.args.ignore=t.args.ignore||5,t.args.antiSkid=10,t.args.gSpeed+=.5*Math.sign(t.args.gSpeed))}else y>0&&v<.75&&(Math.abs(t.args.gSpeed)<1&&(t.args.gSpeed=s),t.args.gSpeed+=s*y);Math.abs(t.args.gSpeed)}}}(!i||!1===i[0]&&!1===i[1])&&(t.args.ignore=t.args.ignore||1,t.args.falling),t.args.heading=Math.sign(t.args.gSpeed)}updateAirPosition(t){const e=t.args.xSpeed,s=t.args.ySpeed,i=t.airAngle;t.args.standingLayer=null,t.viewport;const r=Math.ceil(t.args.width/2),n=Math.sign(t.args.xSpeed),o=t.viewport.tileMap,l=Math.hypot(t.args.xSpeed,t.args.ySpeed);if(t.args.airSpeed=l,!l)return;if(t.fallTime>8&&(t.controllable||t.isVehicle)){let e=20;t.springing&&(e=125),t.args.groundAngle+=.001*-Math.sign(t.args.groundAngle)*e}if(Math.abs(t.args.groundAngle)<.08&&(t.args.groundAngle=0),t.noClip)return void(t.args.falling&&(t.xLast=t.args.x,t.yLast=t.args.y,t.args.x+=t.args.xSpeed,t.args.y+=t.args.ySpeed));t.args.jumping&&t.args.ySpeed<0&&t.args.ySpeed>-4&&(t.args.xSpeed-=t.args.xSpeed*(.078125*t.args.decel));const u=(t.args.flying?t.args.height+t.args.yMargin:t.args.height)||1;t.upScan=!0;const p=t.args.ySpeed<0?-t.args.ySpeed+u:0,f=t.castRayQuick(p,-Math.PI/2,[-.5*t.args.width+1,0]),m=t.castRayQuick(p,-Math.PI/2,[.5*t.args.width-1,0]);let v=!1;[f,m].some(t=>!1===t)||(v=Math.atan2(f-m,t.args.width));const y=!(!f&&!m)&&Math.min(...[f,m].filter(t=>!1!==t));t.upScan=!1;let b=[],S=[];if(!t.args.hLock&&!t.noClip){const e=t.args.xSpeed,s=Math.abs(t.args.groundAngle)>.5*Math.PI?Math.cos(t.args.groundAngle):1;b=(S=[!!e&&this.scanForward(t,e,.9*s),!!e&&this.scanForward(t,e,.5*s),!!e&&this.scanForward(t,e,.1*s)]).filter(t=>!1!==t)}if(t.args.ySpeed&&y&&t.lastLayer&&t.lastLayer.offsetYChanged)return t.args.y+=t.lastLayer.offsetYChanged+1,t.args.ySpeed=t.lastLayer.offsetYChanged+1,void(t.lastLayer=null);if(t.willStick||t.args.deepJump,f&&m&&y<=p&&(!t.args.flying||t.canStick)&&Math.abs(v)<Math.PI/4&&t.args.ySpeed<=0)return t.args.y-=y-t.args.height,t.args.ySpeed&&(t.args.falling=!0),void(t.args.ySpeed=Math.max(0,t.args.ySpeed));if(t.args.ySpeed>=0&&S[2]&&S[2]<=.5*t.args.width&&!1===S[1]&&!1===S[0]){const s=Math.sign(e);if(!t.getMapSolidAt(t.args.x+.5*t.args.width*s,t.args.y+4)){for(t.args.x+=s*Math.abs(S[2]);t.getMapSolidAt(t.args.x+.5*t.args.width*s,t.args.y);)t.args.y--;return}}else if(!t.willStick&&(b.length>1||S[2])){const s=Math.sign(e),i=-1+Math.min(...b),r=.5*t.args.width,a=r+-i,n=a*-s;isNaN(n)||n&&!(Math.abs(a)<r)&&Math.sign(n)===Math.sign(t.args.xSpeed)||(t.args.x+=n,t.args.flySpeed=0,t.args.xSpeed=0,t.args.gSpeed=0,t.args.mode=h),t.viewport&&t.viewport.actorsAtPoint(t.x+(0+r)*s,t.y,t.args.width,t.args.height).forEach(e=>{e!==t&&e.callCollideHandler(t,s<0?1:3)})}const w=l;let x=t.castRayQuick(w,i);Math.abs(t.args.xSpeed)<=Math.abs(t.args.ySpeed)&&(x=!1!==(x=!1!==x?x:t.castRayQuick(w,i,[-1,0]))?x:t.castRayQuick(w,i,[1,0]));const k=!1!==x&&[Math.cos(i)*x+t.args.x,Math.sin(i)*x+t.args.y];let M=k;if(!t.rotateLock){const e=-3*Math.sign(t.args.ySpeed||1),s=t.castRayQuick(w,i,[0,e]);M=!1!==s?[Math.cos(i)*s+t.args.x,Math.sin(i)*s+t.args.y+e]:M}const P=k,C=M;t.willJump=!1;let j=!1,A=!1;if([P,C].some(t=>!1===t)||(A=Math.atan2(P[1]-C[1],P[0]-C[0])),t.xLast!==t.args.x&&(t.xLast=t.args.x),t.yLast!==t.args.y&&(t.yLast=t.args.y),!1!==P){let i=!1;if(e<0){const t=Math.abs(A-Math.PI/2)%Math.PI;i=Math.abs(P[1]-C[1])>1&&P[0]>=-1+C[0]&&t<Math.PI/4}if(e>0){const t=Math.abs(A-Math.PI/2)%Math.PI;i=Math.abs(P[1]-C[1])>1&&P[0]<=1+C[0]&&t<Math.PI/4}const r=i&&e<0,a=i&&e>0,o=this.checkBelow(t,P[0],P[1]+1);t.willStick||0!==t.args.mode||i?(P[0]=Math.round(P[0]),P[1]=Math.round(P[1])):(t.args.gSpeed=t.args.xSpeed,o&&"object"==typeof o&&(o.args&&o.args.treadmill?t.args.gSpeed=0:o.offsetXChanged&&(t.args.gSpeed-=o.offsetXChanged))),t.willStick&&(P[0]=Math.round(P[0]),P[1]=Math.round(P[1]));const l=P[0],h=P[1];if(t.removed)return;t.args.x=Math.round(l),t.args.y=Math.round(h),i&&!t.willStick&&(t.args.x-=.5*t.args.width*Math.sign(e),t.args.falling=!0,b.length>2&&(t.args.xSpeed=0)),j=t.getMapSolidAt(t.args.x+n,t.args.y),Array.isArray(j)&&((j=j.filter(e=>!1!==e.callCollideHandler(t))).length||(j=!1)),t.rotateLock||(!1!==v&&v<0?(t.args.gSpeed=0,t.args.mode=g,t.args.groundAngle=0,t.args.direction=1,t.args.facing="right"):!1!==v&&v>0?(t.args.gSpeed=0,t.args.mode=d,t.args.groundAngle=0,t.args.direction=-1,t.args.facing="left"):!t.willStick&&(r||a)||t.getMapSolidAt(t.args.x-n,t.args.y)||t.getMapSolidAt(t.args.x-n,t.args.y+1)||(r?(t.args.gSpeed=0,t.args.mode=g,t.args.direction=1,t.args.facing="right"):a?(t.args.gSpeed=0,t.args.mode=d,t.args.direction=-1,t.args.facing="left"):!1!==v&&(t.args.mode=c))),Math.floor(t.args.width/2);const u=6,p=this.findNextStep(t,.5*-u),f=this.findNextStep(t,.5*u),m=Math.trunc(t.args.xSpeed);if(m>0&&f&&f[3])t.willStick||(t.args.x-=t.args.width);else if(m<0&&p&&p[3])t.willStick||(t.args.x+=t.args.width);else if(!f||!1!==f[0]&&!1!==f[1]||!p||!1!==p[0]&&!1!==p[1]){let r=0;if(f&&p){var T,O,_,E;if(r=s<0&&v?-v:Math.atan2((null!==(T=f[1])&&void 0!==T?T:0)-(null!==(O=p[1])&&void 0!==O?O:0),(null!==(_=f[0])&&void 0!==_?_:0)-(null!==(E=p[0])&&void 0!==E?E:0)),Math.abs(r)>=.25*Math.PI){const e=this.findNextStep(t,-u),s=this.findNextStep(t,u);e[1]!==p[1]&&s[1]!==f[1]||f[3]&&s[3]&&p[3]&&e[3]||(r=0)}t.ySpeedLast<0&&(r*=-1)}if(isNaN(r))throw console.log(r),new Error("angle is NAN!");if(i&&!t.willStick);else if(!(Math.abs(r)<Math.PI/2+-Math.PI/16&&f&&p&&!1!==f[0]&&!1!==p[0]&&!1!==f[1]&&!1!==p[1])||f[2]||p[2]||f[3]&&p[3]){if(!t.args.dead&&t.args.startled<175&&t.args.ySpeed>0&&(f&&f[2]&&(!p||!p[3])||(!f||!f[3])&&p&&p[2])){const s=e;return t.args.falling=!1,t.args.gSpeed=s,t.args.float=t.args.float||1,t.args.x+=f[0],t.args.y-=f[1],void(t.viewport.settings.rumble&&!t.controller.willRumble&&t.controller.rumble&&t.controller.rumble({duration:80,strongMagnitude:0,weakMagnitude:Math.min(40,Math.max(Math.abs(10*t.args.ySpeed),10))/40}))}}else{t.canRoll&&(t.yAxis>.55||t.args.dropDashCharge)&&!t.carrying.size&&(t.args.rolling=!0),t.args.startled<175&&(t.args.falling=!1,t.viewport.settings.rumble&&!t.controller.willRumble&&t.controller.rumble&&t.controller.rumble({duration:80,strongMagnitude:0,weakMagnitude:Math.min(40,Math.max(Math.abs(10*t.args.ySpeed),10))/40}));const i=.25*Math.PI,a=r;r<-i?(t.args.mode=g,r+=i):r>i&&(t.args.mode=d,r-=i),t.args.groundAngle=r,t.lastAngles.splice(0,t.lastAngles.length,...Array(t.angleAvg).fill(r));const n=-a/(.4*Math.PI);let l=0;l+=e,l+=s*n,j&&j.length&&(l=0),t.args.mode,"object"==typeof o&&(Array.isArray(o)||(t.args.standingLayer=o),o.offsetXChanged&&(l-=o.offsetXChanged,t.args.x+=o.offsetXChanged)),!l||t.args.climbing||t.args.standingOn&&t.args.standingOn.args.treadmill||(t.args.gSpeed=l,2===t.args.mode&&(t.args.gSpeed*=-1))}Math.abs(t.args.gSpeed)}}else if(t.args.ySpeed>0){if(t.args.mode===g||t.args.mode===d){const e=t.args.mode===g?-1:1;t.args.direction=e,t.args.groundAngle=Math.PI/2*e}t.args.falling||t.args.gSpeed||(t.args.gSpeed=Math.floor(e)),P&&(yPointDir===ySpeedDir||!yPointDir&&1===ySpeedDir)&&(t.args.x=Number(P[0]),t.args.y=Number(P[1]),t.args.falling=!1,t.viewport.settings.rumble&&t.controller.rumble&&t.controller.rumble({duration:80,strongMagnitude:0,weakMagnitude:Math.min(40,Math.max(Math.abs(10*t.args.ySpeed),10))/40}))}if(o.getSolid(t.args.x+t.args.width/2*Math.sign(t.args.xSpeed),t.args.y,t.getCollisionMap())||(Math.abs(t.args.xSpeed)>t.args.xSpeedMax&&(t.args.xSpeed=t.args.xSpeedMax*Math.sign(t.args.xSpeed)),Math.abs(t.args.ySpeed)>t.args.ySpeedMax&&(t.args.ySpeed=t.args.ySpeedMax*Math.sign(t.args.ySpeed))),!1===P){if(t.args.xSpeed){const e=!t.willStick&&t.getMapSolidAt(t.args.x+(1+r)*Math.sign(t.args.xSpeed),t.args.y-t.args.height/2),s=t.getMapSolidAt(t.args.x,t.args.y-t.args.height);e||(t.args.x=Number(t.args.x)+Number(t.args.xSpeed)),s&&(t.args.y+=1)}t.args.ySpeed&&(t.args.y=Number(t.args.y)+Number(t.args.ySpeed),t.args.flying&&t.args.ySpeed<0&&y>0&&(t.args.y+=u-y+4,t.args.ySpeed=0))}else if(t.viewport&&t.ySpeedLast>0){const e=t.getCollisionMap();t.viewport.tileMap.getSolid(t.args.x,t.args.y,e)&&!t.viewport.tileMap.getSolid(t.args.x,t.args.y-1,e)&&t.args.y--}if(t.args.standingOn instanceof a.PointActor){const e=t.args.standingOn.args.y+-t.args.standingOn.args.height+-1;(t.args.y<e||t.args.ySpeed<0)&&(t.args.standingOn=null)}}checkDropDash(t){if(t.dropDashCharge&&t.args.mode===h){const e=t.dropDashCharge*Math.sign(t.args.direction);t.dropDashCharge=0,t.viewport.onFrameOut(1,()=>{t.args.gSpeed+=e,t.args.rolling=!0});const s=t.viewport,r=new i.Tag('<div class = "particle-dust">'),a=t.rotatePoint(t.args.gSpeed,0);r.style({"--x":a[0]+t.args.x,"--y":a[1]+t.args.y,"z-index":0,opacity:2*Math.random()}),s.particles.add(r),setTimeout(()=>{s.particles.remove(r)},350)}}findDownSolid(t,e,s,i){if(!i.viewport)return;const r=i.viewport,a=r.tileMap;if(i.args.mode===h&&0===i.args.groundAngle&&(i.controllable||i.args.pushed||i.isVehicle)){const r=i.viewport.regionsAtPoint(e[0],e[1],s);for(const s of r)if(-1+e[1]===s.args.y+-s.args.height&&Math.abs(i.args.gSpeed)>=s.skimSpeed)return-1+t}return a.getSolid(e[0],e[1],i.getCollisionMap())?t:r.actorsAtPoint(e[0],e[1],0,0,{nearbyActors:s}).filter(t=>t.args!==i.args&&t.callCollideHandler(i)&&t.solid).length>0?t:void 0}findUpSpace(t,e,s,i){if(!i.viewport)return;const r=i.viewport,a=r.tileMap.getSolid(e[0],e[1],i.getCollisionMap());if(a)return;const n=r.actorsAtPoint(e[0],e[1],0,0,{nearbyActors:s}).filter(t=>t.args!==i.args&&t.callCollideHandler(i)&&t.solid);if(i.args.groundAngle<=0){const r=i.controllable||i.args.pushed||i.isVehicle?i.viewport.regionsAtPoint(e[0],e[1],s):[];for(const s of r)if(0===n.length&&!a&&(i.args.mode!==h||e[1]!==1+s.args.y+-s.args.height||Math.abs(i.args.gSpeed)<=s.skimSpeed))return t}return 0!==n.length||a?void 0:t}findNextStep(t,e){if(!t.viewport)return;t.viewport.tileMap;const s=t.maxStep*(t.args.falling?2:1),i=(Math.max(t.args.width/2,1),Math.sign(e));let r=!1,a=!1,n=0,o=0,l=0;for(;l<Math.abs(e);l+=1){let e;r=!1,a=!1;const u=(1+l)*i;switch(t.args.mode){case h:e=[u,1];break;case d:e=[1,-u];break;case c:e=[-u,-1];break;case g:e=[-1,u]}if(!1===(r=t.castRay(s,t.downAngle,e,this.findDownSolid)))return[!1,!1,!0];const p=o-r;if(Math.abs(p)>=s)return[!1,!1,p<0,p>0];if(0===r){let e;switch(t.args.mode){case h:e=[u,0];break;case d:e=[0,-u];break;case c:e=[-u,0];break;case g:e=[0,u]}const i=1+s;a=t.castRay(i,t.upAngle,e,this.findUpSpace);const r=Math.abs(n-a);if(!1===a)return[!1,!1,!1,!0];if(r>=s)return[!1,!1,!1,!0];n=a}else o=r;this.stepsTaken++}return!1!==a?[l*i,a,!1]:[l*i,-r,!1]}doJump(t,e){var s;if(t.args.climbing&&t.getMapSolidAt(t.args.x,t.args.y-t.args.height)&&(t.args.y+=t.args.height),t.args.ignore||t.args.falling||!t.args.landed||t.args.float)return;const i=new CustomEvent("jump",{cancelable:!0,detail:{host:t,force:e}});if(!t.dispatchEvent(i))return;t.args.standingOn&&t.args.standingOn.args.yForce?e+=Math.max(0,.25*t.args.standingOn.args.yForce):t.args.standingOn&&t.args.standingOn.yLast&&(e+=Math.max(0,t.args.standingOn.yLast-t.args.standingOn.args.y));const r=t.args.width/2,a=Math.min(r,4),n=this.findNextStep(t,-a),o=this.findNextStep(t,+a),l=2*a;let u=Math.atan2(n[1]-o[1],Math.ceil(l));switch(t.args.pushing=!1,t.args.landed=!1,t.args.falling=!0,t.args.mode,t.args.mode){case h:t.args.y-=16;break;case d:u+=-Math.PI/2,t.args.x+=-t.args.width/2;break;case c:u+=Math.PI,t.args.y+=t.args.normalHeight||t.args.height;break;case g:u+=Math.PI/2,t.args.x+=t.args.width/2}let p=0,f=null!==(s=t.args.gSpeed)&&void 0!==s?s:0;t.args.standingOn&&t.args.standingOn.args.convey&&(f+=t.args.standingOn.args.convey),t.args.standingOn&&t.args.standingOn.args.trackX&&(p=t.args.standingOn.args.xSpeed||t.args.standingOn.args.gSpeed),t.args.standingOn=null,t.args.xSpeed=f*Math.cos(u),t.args.ySpeed=f*Math.sin(u);const m=u-Math.PI/2;let v=e*Math.cos(m),y=e*Math.sin(m);Math.abs(v)<.01&&(v=0),Math.abs(y)<.01&&(y=0),t.args.airAngle=m,t.args.xSpeed+=v,t.args.ySpeed+=y,t.args.jumpedAt=t.args.y,t.args.jumping=!0,t.viewport.tileMap.getSolid(t.args.x+t.args.width/2*Math.sign(t.args.xSpeed),t.args.y,t.getCollisionMap())&&(t.args.xSpeed=0),t.args.rolling=!1,t.args.mode=h,t.args.groundAngle=0,t.args.gSpeed=0,t.args.xSpeed+=p}impulse(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.args.dead||(t.impulseMag=e,t.impulseDir=s,t.impulseFal=i)}scanForward(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=Math.sign(e),r=t.args.width/2,a=Math.abs(e),n=t.args.falling?[0,-t.args.height*s]:t.rotatePoint(0,t.args.height*s),o=t.args.falling?[Math.PI,0,0][i+1]:t.realAngle+[0,0,Math.PI][i+1];return t.castRayQuick(t.args.falling?a+r+1:a+1,o,n)}scanBottomEdge(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=host.viewport.tileMap,s=host.args.width/2,i=host.getCollisionMap(),r=e.getSolid(host.x-s,host.y-1,i),a=e.getSolid(host.x+s,host.y-1,i);if(!r||!a)return host.castRay(host.args.width,t<0?Math.PI:0,[-t*s,0],(t,s)=>{if(!host.viewport.actorsAtPoint(s[0],s[1]).filter(t=>t.args!==host.args).length&&!e.getSolid(s[0],s[1]+1,i))return t})}checkBelow(t){var e,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i=null!==(e=i)&&void 0!==e?e:t.args.x,r=null!==(s=r)&&void 0!==s?s:t.args.y;const a=[],n=[];switch(t.args.mode){case h:a[0]=i+0,a[1]=r+1,n[0]=i-0,n[1]=r+1;break;case g:a[0]=i-1,a[1]=r+0,n[0]=i-1,n[1]=r-0;break;case c:a[0]=i-0,a[1]=r-1,n[0]=i+0,n[1]=r-1;break;case d:a[0]=i+1,a[1]=r+0,n[0]=i+1,n[1]=r-0}let o=t.getMapSolidAt(...a);return Array.isArray(o)&&(o=o.filter(e=>!1!==e.callCollideHandler(t))),o}onSpawned(t,e){if(!t.args.onLayer)return;const s=t.args.onLayer,i=e.tileMap.tileLayers;for(const e of i)if(e.name===s){t.args.standingLayer=e;break}}command_0(t,e){if(t.args.hangingFrom&&t.args.hangingFrom.unhook){const e=t.getLocalDrag();return t.args.ySpeed=-t.args.jumpForce*e*.75,t.args.hangingFrom.unhook(t),void(t.swing=!1)}if((t.args.falling||t.willJump||t.args.dontJump)&&t.args.standingOn&&!t.args.standingOn.isVehicle){if(t.args.ignore&&-4!==t.args.ignore)return;return t.viewport.auras.delete(t.args.standingOn),void(t.willJump=!0)}t.willJump||(t.args.standingOn&&t.args.standingOn.quickDrop&&(t.ignores.set(t.args.standingOn,15),t.args.ignore=0),t.willJump=!0)}release_0(t,e){t.args.float||t.args.ignore||(!t.args.jumping||t.lightDashed||t.dashed?t.args.jumping&&!t.lightDashed&&!t.dashed&&t.args.ySpeed<-4&&(t.args.ySpeed=-4):t.args.ySpeed<0&&(t.args.ySpeed*=.5))}command_1(t,e){t.canRoll&&t.args.gSpeed&&(t.args.rolling=!0)}command_11(t,e){if(t.args.currentSheild&&!(t.args.currentSheild instanceof o.StarSheild)){const e=t.args.currentSheild;e.unequip&&e.unequip(t),t.args.currentSheild=null}}}}),require.register("behavior/SkidDust.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkidDust=void 0;var i=e("curvature/base/Tag"),r=e("./Behavior");t.SkidDust=class extends r.Behavior{constructor(t){super(),this.dustType=t||"particle-dust"}update(t){if(t.args.falling||t.args.rolling||t.args.sliding||t.spindashCharge)return;if(t.args.wallSticking||t.args.climbing)return;const e=t.args.direction;if(!Math.sign(t.args.gSpeed)||!Math.sign(e))return;if(Math.abs(t.args.gSpeed-e)<5)return;if(!t.alwaysSkidding){if(Math.sign(t.args.gSpeed)===Math.sign(e))return;if(!t.skidding)return}if(t.silentSkid)return;const s=t.viewport,r=t.dustFreq||3;if(s.args.frameId%r!=0)return;const a=new i.Tag(document.createElement("div"));a.classList.add(this.dustType);const n=Math.sign(t.args.gSpeed)*t.dustDist||0,o=t.groundPoint;a.style({"--x":o[0]+n,"--y":o[1],"z-index":0,opacity:.25*Math.random()+.5}),s.particles.add(a),s.onFrameOut(20,()=>{s.particles.remove(a)})}}}),require.register("behavior/Spindash.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spindash=void 0;var i=e("curvature/base/Tag"),r=e("./Behavior");t.Spindash=class extends r.Behavior{command_0(t,e){if(!t.args.falling&&!t.args.gSpeed&&!(t.yAxis<.55&&!t.args.gSpeed||t.groundTime<5))return t.spindashCharge+=10,this.showDashDust(t),!1}update(t){if(t.spindashCharge=t.spindashCharge||0,t.spindashCharge)if(t.spindashCharge<1)t.spindashCharge=0;else{t.args.animation="spindash",t.spindashCharge-=.2,this.dashDust&&this.dashDust.style({"--dashCharge":t.spindashCharge});let e=t.spindashCharge/20;e>1&&(e=1)}if(!t.yAxis&&t.spindashCharge){t.spindashCharge<5&&(t.args.modeTime<45||t.args.skidding)&&(t.spindashCharge=15);const e="left"===t.args.facing?-1:1;let s=t.spindashCharge/40;s>1&&(s=1),t.args.rolling=!0;const i=32*s;t.castRayQuick(i*Math.sign(e),[Math.PI,0,0][1+Math.sign(e)],[0,t.args.height/2]),Math.sign(e)!==Math.sign(t.args.gSpeed)?t.args.gSpeed=i*Math.sign(e):t.args.gSpeed+=i*Math.sign(e),t.args.ignore=1,t.args.rolling=!0,t.spindashCharge=0,this.dashDust&&(this.dashDust.remove(),this.dashDust=!1)}}showDashDust(t){const e=t.rotatePoint(0,0);if(this.dashDust)return void this.dashDust.style({"--x":e[0]+t.args.x,"--y":e[1]+t.args.y,"--direction":t.args.direction,"--dashCharge":t.spindashCharge});const s=t.viewport,r=new i.Tag('<div class = "particle-spindash-dust">');r.style({"--x":e[0]+t.args.x,"--y":e[1]+t.args.y,"--direction":t.args.direction,"--dashCharge":t.spindashCharge}),r.setAttribute("data-facing",t.args.facing),s.particles.add(r),this.dashDust=r}}}),require.register("behavior/SuperForm.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SuperForm=void 0;e("curvature/base/Tag");var i=e("./Behavior");t.SuperForm=class extends i.Behavior{command_3(t,e){var s,i;if(t.args.halted)return;const r=null!==(s=t.args.minRingsSuper)&&void 0!==s?s:50,a=null!==(i=t.args.minRingsHyper)&&void 0!==i?i:75;if(t.isSuper&&!t.isHyper&&t.args.rings<a||!t.args.falling||!t.args.jumping||t.args.rings<r||t.args.ignore||t.isHyper)return t.isSuper=!1,t.isHyper=!1,void t.setProfile();t.isHyper||(t.args.halted=45,t.args.animation="transform",t.args.jumping=!1,t.args.ySpeed=Math.min(t.args.ySpeed,0),t.args.flying=!1,t.args.dashed=!1),t.isSuper?t.isHyper=!t.isHyper:t.isSuper=!t.isSuper,t.transformTime=0,t.setProfile()}updateEnd(t){"transform"===t.args.animation?t.transformTime++:t.transformTime>0&&(t.transformTime=0)}}}),require.register("cards/basic-controls.html",function(t,e,s){s.exports='<div class = "control-card">\n\t<span class = "button-index">\n\t\t<span class = "arrow button arrow-west"></span>\n\t\t/ <span class = "arrow button arrow-east"></span>\n\t\t/ <b>wasd</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-x"></span>\n\t\t<span class = "button xb xb-a"></span>\n\t\t<b>space</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-o"></span>\n\t\t<span class = "button xb xb-b"></span>\n\t\t<b>ctrl</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-s"></span>\n\t\t<span class = "button xb xb-x"></span>\n\t\t<b>shift</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-t"></span>\n\t\t<span class = "button xb xb-y"></span>\n\t\t<b>z</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-l1"></span>\n\t\t<span class = "button xb xb-lb"></span>\n\t\t<b>q</b>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-r1"></span>\n\t\t<span class = "button xb xb-rb"></span>\n\t\t<b>e</b>\n\t</span>\n</div>\n'}),require.register("cards/basic-moves.html",function(t,e,s){s.exports='<p><b>jump</b> + <b>jump</b> - fly / double jump action</p>\n\n<p><span class = "arrow-button arrow-north"></span> + <b>jump</b> - disengage vehicle</p>\n\n\x3c!-- <p><span class = "arrow-button arrow-south"></span> + <b>jump</b> - spindash</p> --\x3e\n'}),require.register("cards/plane-air-controls.html",function(t,e,s){s.exports='<div class = "control-card">\n\t<span class = "button-index">\n\t\t<span class = "arrow button arrow-west"></span>\n\t\t/ <span class = "arrow button arrow-east"></span>\n\t\t/ <b>wasd</b>\n\t\t- move\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-x"></span>\n\t\t<span class = "button xb xb-a"></span>\n\t\t<b>space</b>\n\t\t- double barrier\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-o"></span>\n\t\t<span class = "button xb xb-b"></span>\n\t\t<b>ctrl</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-s"></span>\n\t\t<span class = "button xb xb-x"></span>\n\t\t<b>shift</b>\n\t\t- <span>light dash</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-t"></span>\n\t\t<span class = "button xb xb-y"></span>\n\t\t<b>z</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-l1"></span>\n\t\t<span class = "button xb xb-lb"></span>\n\t\t<b>q</b>\n\t\t- <span>air dash left</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-r1"></span>\n\t\t<span class = "button xb xb-rb"></span>\n\t\t<b>e</b>\n\t\t- <span>air dash right</span>\n\t</span>\n\n</div>\n'}),require.register("cards/sonic-air-controls.html",function(t,e,s){s.exports='<div class = "control-card">\n\t<span class = "button-index">\n\t\t<span class = "arrow button arrow-west"></span>\n\t\t/ <span class = "arrow button arrow-east"></span>\n\t\t/ <b>wasd</b>\n\t\t- move\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-x"></span>\n\t\t<span class = "button xb xb-a"></span>\n\t\t<b>space</b>\n\t\t- double barrier\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-o"></span>\n\t\t<span class = "button xb xb-b"></span>\n\t\t<b>ctrl</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-s"></span>\n\t\t<span class = "button xb xb-x"></span>\n\t\t<b>shift</b>\n\t\t- <span>light dash</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-t"></span>\n\t\t<span class = "button xb xb-y"></span>\n\t\t<b>z</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-l1"></span>\n\t\t<span class = "button xb xb-lb"></span>\n\t\t<b>q</b>\n\t\t- <span>air dash left</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-r1"></span>\n\t\t<span class = "button xb xb-rb"></span>\n\t\t<b>e</b>\n\t\t- <span>air dash right</span>\n\t</span>\n\n</div>\n'}),require.register("cards/sonic-controls.html",function(t,e,s){s.exports='<div class = "control-card">\n\n\t<span class = "button-index">\n\t\t<span class = "arrow button arrow-west"></span>\n\t\t/ <span class = "arrow button arrow-east"></span>\n\t\t/ <b>wasd</b>\n\t\t- move\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-x"></span>\n\t\t<span class = "button xb xb-a"></span>\n\t\t<b>space</b>\n\t\t- jump\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-o"></span>\n\t\t<span class = "button xb xb-b"></span>\n\t\t<b>ctrl</b>\n\t\t- <span>spindash</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-s"></span>\n\t\t<span class = "button xb xb-x"></span>\n\t\t<b>z</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-t"></span>\n\t\t<span class = "button xb xb-y"></span>\n\t\t<b>x</b>\n\t\t- <span>super</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-l1"></span>\n\t\t<span class = "button xb xb-lb"></span>\n\t\t<b>q</b>\n\t\t- <span>no action</span>\n\t</span>\n\n\t<span class = "button-index">\n\t\t<span class = "button ps ps-r1"></span>\n\t\t<span class = "button xb xb-rb"></span>\n\t\t<b>e</b>\n\t\t- <span>no action</span>\n\t</span>\n\n</div>\n'}),require.register("console/task/Chao.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chao=void 0;e("curvature/base/Router");var i=e("subspace-console/Task"),r=e("../../actor/Chao");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class n extends i.Task{init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"list";if("function"==typeof this["command_"+t]){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];this["command_"+t](...s)}}command_list(){if(!n.viewport)return;const t=n.viewport.actors;for(const e of t.items())e instanceof r.Chao&&this.print(`${Number(e.args.id)}) Chao "${e.args.name}" is at ${e.x}, ${e.y}.`)}command_name(t,e){if(!n.viewport)return;const s=n.viewport.actorsById[t];s instanceof r.Chao&&(s.args.name=e)}command_color(t){if(!n.viewport)return;const e=n.viewport.actorsById[t];if(e instanceof r.Chao){for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];this.recolor(e,...i)}}recolor(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];for(;s.length;){const e=s.shift(),i=s.shift();t.customColors[e]=i}}command_store(t){if(!n.viewport)return;const e=n.viewport.actorsById[t];e instanceof r.Chao&&this.print(JSON.stringify(e.store()))}}t.Chao=n,a(n,"viewport",null),a(n,"helpText","List the chao in the current map.")}),require.register("console/task/Impulse.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impulse=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{constructor(){super(...arguments),r(this,"title","Impulse task"),r(this,"prompt","..")}init(t,e){if(!a.viewport.controlActor)return;let s=a.viewport.controlActor;s.standingOn&&s.standingOn.isVehicle&&(s=s.standingOn),s.impulse(t,e,!0)}write(t){this.print(t)}}t.Impulse=a,r(a,"viewport",null),r(a,"helpText","Apply an impulse to the player object."),r(a,"useText","input magnitude angle")}),require.register("console/task/Input.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Input=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{constructor(){super(...arguments),r(this,"title","Input task"),r(this,"prompt","..")}init(t){let e,s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=()=>{};if(!a.viewport.controlActor)return;const o=a.viewport.controlActor,l=o.controller;if("a"===t[0]){const a=t.substring(1);this.print(`Setting axis ${a} to ${r} for ${i} milliseconds...`),e={axes:{[a]:r}},s=setInterval(()=>{l.replay(e),o.readInput()},16),n=(()=>{e.axes[a]=0,l.replay(e),o.readInput(),clearInterval(s)})}if("b"===t[0]){const r=t.substring(1);this.print(`Pressing button ${r} for ${i} milliseconds...`),e={buttons:{[r]:1}},s=setInterval(()=>{e.buttons[r]=1,l.replay(e),o.readInput()},16),n=(()=>{e.buttons[r]=0,l.replay(e),o.readInput(),clearInterval(s)})}return e?(l.replay(e),o.readInput(),new Promise(t=>{setTimeout(()=>{n(),t()},i)})):void 0}write(t){this.print(t)}}t.Input=a,r(a,"viewport",null),r(a,"helpText","Press a button x for y milliseconds."),r(a,"useText","input x y")}),require.register("console/task/Mark.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mark=void 0;var i=e("curvature/base/Router"),r=e("subspace-console/Task");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class n extends r.Task{init(t,e){if(!n.viewport.controlActor)return;const s=n.viewport.controlActor;this.print(`Character is at ${s.x}, ${s.y}.`),i.Router.setQuery("map",n.viewport.baseMap.replace(/^\/map\//,"")),i.Router.setQuery("start",`${Math.round(s.x)},${Math.round(s.y)}`)}}t.Mark=n,a(n,"viewport",null),a(n,"helpText","Mark the current actor's position in space as a start position.")}),require.register("console/task/Move.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Move=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{constructor(){super(...arguments),r(this,"prompt","..")}init(t,e){if(!a.viewport.controlActor)return;this.print("Moving character to x, y...");const s=a.viewport.controlActor;s.args.x=parseFloat(t),s.args.y=parseFloat(e),s.viewport&&s.viewport.setColCell(s)}}t.Move=a,r(a,"viewport",null),r(a,"helpText","Move the current actor to a position in space."),r(a,"useText","move x y")}),require.register("console/task/Pos.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pos=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{init(t,e){if(!a.viewport.controlActor)return;const s=a.viewport.controlActor;this.print(`Character is at ${s.x}, ${s.y}.`)}}t.Pos=a,r(a,"viewport",null),r(a,"helpText","Check the current actor's position in space.")}),require.register("console/task/Settings.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{constructor(){super(...arguments),r(this,"prompt","..")}init(t,e){const s=a.viewport;void 0!==e&&(s.settings[t]=JSON.parse(e)),this.print(JSON.stringify(s.settings[t]))}}t.Settings=a,r(a,"viewport",null),r(a,"helpText","Get/set the values of settings variables."),r(a,"useText","set key val")}),require.register("console/task/Spawn.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spawn=void 0;var i=e("subspace-console/Task");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends i.Task{init(t){if(!a.viewport||!a.viewport.controlActor)return;const e=a.viewport.objectPalette;a.viewport.controlActor;if(!t)return void this.print(Object.keys(e).join(", "));if(!(t in e))return void this.print(`Type not found: "${t}".`);const s=e[t],i=a.viewport.mouse.position;a.viewport.spawn.add({object:new s({x:i[0],y:i[1]})})}}t.Spawn=a,r(a,"viewport",null),r(a,"helpText","Spawn an object.")}),require.register("controller/Axis.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.Axis=void 0;t.Axis=class{constructor(t){let{deadZone:e=0,proportional:s=!0}=t;i(this,"magnitude",0),i(this,"delta",0),e&&(this.proportional=s,this.deadZone=e)}tilt(t){t=this.deadZone&&Math.abs(t)>=this.deadZone?(Math.abs(t)-this.deadZone)/(1-this.deadZone)*Math.sign(t):0,this.delta=Number(t-this.magnitude).toFixed(3)-0,this.magnitude=Number(t).toFixed(3)-0}zero(){this.magnitude=this.delta=0}}}),require.register("controller/Button.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;t.Button=class{constructor(){i(this,"active",!1),i(this,"pressure",0),i(this,"delta",0),i(this,"time",0)}update(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.pressure?this.time++:!this.pressure&&this.time>0?this.time=-1:!this.pressure&&this.time<0&&this.time--,this.time<-1&&-1===this.delta&&(this.delta=0)}press(t){this.delta=Number(t-this.pressure).toFixed(3)-0,this.pressure=Number(t).toFixed(3)-0,this.active=!0,this.time=this.time>0?this.time:0}release(){this.delta=Number(-this.pressure).toFixed(3)-0,this.pressure=0,this.active=!1}zero(){this.pressure=this.delta=0,this.active=!1}}}),require.register("controller/Controller.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;var i=e("./Axis"),r=e("./Button");const a={Space:0,Enter:0,NumpadEnter:0,ControlLeft:1,ControlRight:1,ShiftLeft:2,ShiftRight:2,KeyZ:3,KeyQ:4,KeyE:5,Digit1:6,Digit3:7,KeyBackspace:8,KeyW:12,KeyA:14,KeyS:13,KeyD:15,KeyH:112,KeyJ:113,KeyK:114,KeyL:115,KeyP:1020,KeyO:1209,Pause:1020,Tab:11,ArrowUp:12,ArrowDown:13,ArrowLeft:14,ArrowRight:15,KeyMeta:16,Numpad4:112,Numpad2:113,Numpad8:114,Numpad6:115,Backquote:1010,NumpadAdd:1011,NumpadSubtract:1012,NumpadMultiply:1013,NumpadDivide:1014,PageUp:1022,PageDown:1023,Home:1024,End:1025,Escape:[1020,1050],KeyB:1201};[...Array(12)].map((t,e)=>a[`F${e}`]=2e3+e);const n={12:-1,13:1,14:-0,15:0,112:-2,113:3,114:-3,115:2},o={"-6":14,"+6":15,"-7":12,"+7":13},l={0:1200,1:1201,9:1209,4:1022,5:1023};t.Controller=class{constructor(t){let{keys:e={},deadZone:s=0,gamepad:i=null,keyboard:r=null}=t;this.deadZone=s,Object.defineProperties(this,{buttons:{value:{}},pressure:{value:{}},axes:{value:{}},keys:{value:{}}})}update(){let{gamepad:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const t in this.buttons)this.buttons[t].update();t&&this.willRumble&&("object"!=typeof this.willRumble&&(this.willRumble={duration:1e3,strongMagnitude:1,weakMagnitude:1}),t.id&&String(t.id).match(/playstation.{0,5}3/i)&&(this.willRumble.duration<100&&this.willRumble.strongMagnitude<.75&&(this.willRumble.duration=0,this.willRumble.weakMagnitude=0,this.willRumble.strongMagnitude=0),setTimeout(()=>{this.willRumble||t.vibrationActuator.playEffect("dual-rumble",{duration:0,weakMagnitude:0,strongMagnitude:0})},this.willRumble.duration+-1)),t.vibrationActuator&&t.vibrationActuator.playEffect&&t.vibrationActuator.playEffect("dual-rumble",this.willRumble),this.willRumble=!1)}rumble(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.willRumble=t}readInput(t){let{keyboard:e,gamepads:s=[]}=t;const h={},g={},c={},d=new Set;for(let t=0;t<s.length;t++){const e=s[t];if(e)for(const t in e.buttons){const s=e.buttons[t];s.pressed&&(this.press(t,s.value),g[t]=!0,d.add(e))}}if(e){for(const t in[...Array(10)])g[t]||e.getKeyCode(t)>0&&(this.press(t,1),g[t]=!0,d.add(e));for(let t in a){if(g[t])continue;let s=a[t];Array.isArray(s)||(s=a[t]=[s]);for(const i of s)e.getKeyCode(t)>0&&(this.press(i,1),g[i]=!0)}}for(const t of s)if(t)for(const e in t.buttons){if(c[e])continue;if(g[e])continue;const s=t.buttons[e];this.buttons[e]&&!s.pressed&&this.buttons[e].active&&(this.release(e),c[e]=!0)}if(e){for(const t in[...Array(10)])c[t]||g[t]||e.getKeyCode(t)<0&&(this.release(t),c[t]=!0);for(let t in a){let s=a[t];Array.isArray(s)||(s=a[t]=[s]);for(const i of s)c[i]||g[i]||e.getKeyCode(t)<0&&(this.release(i),c[t]=!0)}}for(let t=0;t<s.length;t++){const e=s[t];if(e)for(const t in e.axes){const s=e.axes[t];Math.abs(s)<this.deadZone?h[t]||this.tilt(t,0):(h[t]=!0,this.tilt(t,s))}}for(let t in n){this.buttons[t]||(this.buttons[t]=new r.Button);const e=n[t],s=Math.sign(1/e),i=Math.abs(e);h[i]||(this.buttons[t].active?(h[i]=!0,this.tilt(i,s)):h[i]||this.tilt(i,0))}for(let t in o){const e=o[t];if(c[e])continue;if(g[e])continue;const[s,r]=[t.slice(0,1),t.slice(1)];this.axes[r]||(this.axes[r]=new i.Axis({deadZone:this.deadZone}));const a=this.axes[r];if(a.magnitude&&Math.sign(t)!==Math.sign(a.magnitude))continue;const n=Math.abs(a.magnitude);n?(this.press(e,n),g[e]=!0):(this.release(e,n),c[e]=!0)}for(const t in l){const e=l[t];c[e]||g[e]||(this.buttons[e]||(this.buttons[e]=new r.Button),this.buttons[t]||(this.buttons[t]=new r.Button),this.buttons[t].active?(this.press(e,this.buttons[t].pressure),g[e]=!0):g[e]||(this.release(e,this.buttons[t].pressure),c[e]=!0))}return d}tilt(t,e){this.axes[t]||(this.axes[t]=new i.Axis({deadZone:this.deadZone})),this.axes[t].tilt(e)}press(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.buttons[t]||(this.buttons[t]=new r.Button),this.buttons[t].press(e)}release(t){this.buttons[t]||(this.buttons[t]=new r.Button),this.buttons[t].release()}serialize(){const t={};for(const e in this.buttons)t[e]=this.buttons[e].pressure;const e={};for(const t in this.axes)e[t]=this.axes[t].magnitude;return{axes:e,buttons:t}}replay(t){if(t.buttons)for(const e in t.buttons)t.buttons[e]>0?this.press(e,t.buttons[e]):this.release(e);if(t.axes)for(const e in t.axes)t.axes[e].magnitude!==t.axes[e]&&this.tilt(e,t.axes[e])}zero(){for(const t in this.axes)this.axes[t].zero();for(const t in this.buttons)this.buttons[t].zero()}buttonIsMapped(t){return t in l}keyIsMapped(t){return t in a}}}),require.register("controller/GamepadConfig.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GamepadConfig=void 0;var i=e("curvature/base/View"),r=e("../intro/SkippableCard"),a=e("./KbInput");t.GamepadConfig=class extends r.SkippableCard{constructor(t,s){switch(super(t,s),this.template=e("./gamepad-config.html"),this.args.cardName="gamepad-config-card",this.args.moves={},this.args.char=this.args.char||"Sonic",t.char){case"Sonic":this.args.moves={start:"Pause",dpad:"Move",a:"Jump",b:"Spindash / Roll / Dropdash",x:"Light Dash / Interact",y:"Super Transform",l1:"Air Dash",r1:"Air Dash",la:"Move",ra:"Switch Sheilds"};break;case"Tails":this.args.moves={start:"Pause",dpad:"Move",a:"Jump",aa:"Fly",ad:"Use Shield / Spindash",d:"Dive",x:"Interact",y:"Super Transform",la:"Move",ra:"Switch Sheilds"};break;case"Knuckles":this.args.moves={start:"Pause",dpad:"Move",a:"Jump",aa:"Fly",b:"Punch / Drop off wall",ad:"Use Shield / Spindash",d:"Dive",y:"Super Transform",la:"Move",ra:"Switch Sheilds"}}"input-xbox"===this.args.inputType?(this.gamepads={xb:i.View.from(e("./xbox360-input.svg"),this.args.moves)},this.args.type="xb"):"input-playstation"===this.args.inputType?(this.gamepads={ps:i.View.from(e("./ps3-input.svg"),this.args.moves)},this.args.type="ps"):"input-dreamcast"===this.args.inputType?(this.gamepads={ps:i.View.from(e("./dc-input.svg"),this.args.moves)},this.args.type="dc"):"input-gamecube"===this.args.inputType?(this.gamepads={ps:i.View.from(e("./gc-input.svg"),this.args.moves)},this.args.type="gc"):this.gamepads={kb:new a.KbInput({char:this.args.char,moves:this.args.moves})},this.current=0,this.buttons=[],this.sticks={}}onAttached(){this.span=this.findTag("div"),this.args.text=Object.values(this.gamepads)[this.current],this.args.type=this.args.type||Object.keys(this.gamepads)[this.current]}swap(){this.current++;const t=Object.values(this.gamepads),e=Object.keys(this.gamepads);this.current>=t.length&&(this.current=0),this.args.text=t[this.current],this.args.type=e[this.current]}exit(){this.remove()}input(t){if(super.input(t),!this.span)return;let e=0,s=0,i=0,r=0;t.axes[0]&&(e=t.axes[0].magnitude),t.axes[1]&&(s=t.axes[1].magnitude),t.axes[2]&&(i=t.axes[2].magnitude),t.axes[3]&&(r=t.axes[3].magnitude),this.span.style({"--x":e,"--y":s,"--a":i,"--b":r});for(const e in t.buttons)t.buttons[e]?this.span.style({[`--pressed-${e}`]:t.buttons[e].pressure}):this.span.style({[`--pressed-${e}`]:0})}play(t){}}}),require.register("controller/KbInput.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KbInput=void 0;var i=e("curvature/base/View"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.KbInput=class extends i.View{constructor(t,s){switch(super(t,s),a(this,"template",e("./kb-input.html")),this.args.char){case"Sonic":this.args.lines=[new r.CharacterString({font:this.font,value:`  ${this.args.moves.dpad}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.a}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.b}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.x}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.y}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.r1}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.ra}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.start}`})];break;case"Tails":this.args.lines=[new r.CharacterString({font:this.font,value:`  ${this.args.moves.dpad}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.a}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.aa}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.ad}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.d}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.x}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.y}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.start}`})];break;case"Knuckles":this.args.lines=[new r.CharacterString({font:this.font,value:`  ${this.args.moves.dpad}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.a}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.b}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.aa}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.ad}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.d}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.y}`}),new r.CharacterString({font:this.font,value:`  ${this.args.moves.start}`})]}}}}),require.register("controller/dc-input.svg",function(t,e,s){s.exports='<svg version="1.0" viewBox="0 0 512 288" xmlns="http://www.w3.org/2000/svg">\n <defs>\n  <clipPath id="a">\n   <ellipse cx="296.69" cy="214.12" rx="206.77" ry="205.42" display="none" fill="#4d4d4d"/>\n   <path class="powerclip" d="m8.0946 3.7805h575.41v590.04h-575.41zm495.36 210.34a206.77 205.42 0 0 0-206.77-205.42 206.77 205.42 0 0 0-206.77 205.42 206.77 205.42 0 0 0 206.77 205.42 206.77 205.42 0 0 0 206.77-205.42z" display="block" fill="#4d4d4d"/>\n  </clipPath>\n </defs>\n <g transform="translate(-260.34 -473.69)">\n  <path d="m437.18 546.97c0.0704-0.35215 1.3382-5.8456 1.479-6.7612 0.14086-0.91559 0.35215-1.4086 1.479-2.1833 10.576-7.2713 5.4994-7.4732 17.763-5.4952 2.1833 0.35214 5.0005 5.8456 5.0005 5.8456z" fill="#d8d8d8" fill-rule="evenodd" stroke="#000" stroke-width=".96695" data-button="button-6"/>\n  <path d="m595.5 546.97c-0.0704-0.35215-1.3382-5.8456-1.479-6.7612-0.14086-0.91559-0.35215-1.4086-1.479-2.1833-10.576-7.2713-5.4994-7.4732-17.763-5.4952-2.1833 0.35214-5.0005 5.8456-5.0005 5.8456z" fill="#d8d8d8" fill-rule="evenodd" stroke="#000" stroke-width=".96695" data-button="button-7"/>\n  <path d="m604.24 553.13c-0.0704-0.35215-1.3382-5.8456-1.479-6.7612-0.14086-0.91559-0.35215-1.4086-1.479-2.1833-10.576-7.2713-22.951-10.782-35.215-8.8037-2.1833 0.35214-5.0005 5.8456-5.0005 5.8456z" fill="#d8d8d8" fill-rule="evenodd" stroke="#000" stroke-width=".96695" data-button="button-5"/>\n  <path d="m428.44 553.13c0.0704-0.35215 1.3382-5.8456 1.479-6.7612 0.14086-0.91559 0.35215-1.4086 1.479-2.1833 10.576-7.2713 22.951-10.782 35.215-8.8037 2.1833 0.35214 5.0005 5.8456 5.0005 5.8456z" fill="#d8d8d8" fill-rule="evenodd" stroke="#000" stroke-width=".96695" data-button="button-4"/>\n  <g transform="matrix(.34401 0 0 .34401 414.97 503.95)">\n   <ellipse cx="294.98" cy="208.06" rx="205.59" ry="199.11" fill="none" stroke="#000" stroke-width="7.4"/>\n   <ellipse cx="295.57" cy="214.12" rx="206.77" ry="205.42" display="block" fill="#e6e6e6"/>\n   <rect x="255.55" y="18.994" width="93.05" height="71.373" fill="#d35f5f" stroke-width=".67124"/>\n   <rect x="234.74" y="140.67" width="129.82" height="113.54" fill="#666"/>\n   <g transform="translate(-1.12)" fill="#1a1a1a">\n    <g>\n     <path d="m243.78 111.34c0.838 0 1.818-0.043 2.687-0.135s1.481-0.397 2.167-0.636 1.377-0.643 2.02-1.261c0.637-0.618 1.157-1.316 1.548-2.099 0.392-0.784 0.673-1.659 0.845-2.632 0.171-0.967 0.239-1.952 0.196-2.95-0.042-1.12-0.343-1.953-0.648-2.907-0.306-0.955-0.881-2.154-1.671-2.803-0.869-0.716-1.493-1.224-2.387-1.481-0.894-0.251-2.154-0.637-3.599-0.637-0.881 0-2.05 0.062-2.62 0.128-0.593 0.074-1.138 0.147-1.885 0.159l0.196 17.228c1.162 0.038 2.154 0.026 3.151 0.026z" fill="#1a1a1a"/>\n     <path d="m278.33 102.96c-0.031-0.624 0-0.416-0.073-0.765-0.074-0.343-0.166-0.618-0.349-0.991-0.184-0.367-0.502-0.624-0.795-0.894-0.294-0.27-0.643-0.478-1.053-0.618-0.404-0.147-1.01-0.22-1.475-0.22-0.501 0-0.948 0.153-1.395 0.312s-0.838 0.374-1.175 0.649c-0.336 0.275-0.618 0.6-0.844 0.967-0.227 0.367-0.392 0.729-0.496 1.071-0.042 0.135-0.049 0.147-0.042 0.153 6e-3 6e-3 0.03-0.012-0.025 0.336z" fill="#1a1a1a"/>\n     <path d="m291.54 104.42c-0.3 0.27-0.441 0.343-0.587 0.453-0.147 0.11-0.361 0.171-0.551 0.269-0.19 0.092-0.447 0.116-0.68 0.202-0.226 0.085-1.022 0.11-1.346 0.153-0.691 0.086-1.15 0.159-1.426 0.27-0.6 0.214-0.955 0.275-1.298 0.496-0.342 0.22-0.612 0.551-0.838 0.808-0.227 0.257-0.312 0.49-0.404 0.747-0.104 0.318-0.092 0.655-0.073 0.998 0.018 0.538 0.434 1.132 0.734 1.523 0.293 0.398 0.3 0.257 0.679 0.526 0.379 0.263 0.918 0.404 1.518 0.404 0.374 0 0.759-0.031 1.157-0.092 0.306-0.043 0.637-0.239 1.096-0.392 0.146-0.049 0.489-0.361 0.655-0.422 0 0 0.422-0.342 0.844-1.077 0.422-0.734 0.508-1.952 0.508-1.952z" fill="#1a1a1a"/>\n     <path d="m341.81 104.23c-0.294 0.27-0.44 0.349-0.588 0.459-0.146 0.11-0.379 0.153-0.569 0.251-0.189 0.092-0.428 0.135-0.66 0.22-0.227 0.086-1.022 0.11-1.347 0.153-0.691 0.085-1.15 0.159-1.426 0.269-0.6 0.22-0.961 0.282-1.304 0.496-0.343 0.221-0.618 0.551-0.845 0.808s-0.318 0.489-0.404 0.747c-0.104 0.318-0.085 0.655-0.073 1.003 0.019 0.533 0.435 1.132 0.734 1.524 0.3 0.398 0.3 0.257 0.686 0.526 0.38 0.263 0.918 0.404 1.524 0.404 0.373 0 0.759-0.03 1.162-0.092 0.307-0.042 0.643-0.245 1.096-0.392 0.146-0.049 0.489-0.361 0.655-0.422 0 0 0.422-0.343 0.844-1.077 0.423-0.729 0.509-1.953 0.509-1.953z" fill="#1a1a1a"/>\n     <path d="m79.619 239.47c24.811 0 44.995-20.073 44.995-44.748s-20.184-44.748-44.995-44.748-44.997 20.073-44.997 44.748 20.192 44.748 44.997 44.748z" fill="#ececec"/>\n     <polygon transform="matrix(1.6291,0,0,1.6291,-178.01,-257.79)" points="318.12 444.41 293.78 403.06 269.44 444.41" fill="#fff" stroke-width=".61384"/>\n     <path d="m119.14 577.38c12.815-43.023 10.985-43.023 17.393-58.582 6.408-15.562 19.223-16.475 35.698-20.135 15.404-3.42 80.508-11.378 123.02-12.431 6e-3 0.117 0 0 0 0l11.652-0.15207-0.013-0.092s75.652 4.8914 112.49 12.675c16.476 3.66 29.291 4.578 35.698 20.135 6.407 15.564 4.578 15.564 17.394 58.582 12.814 43.018 69.554-66.818 95.184-228.83 25.631-162.01-11.848-224.91-22.222-230.4-10.373-5.49-79.382-20.404-79.382-20.404-18.269-23.911-37.871-41.377-57.039-54.199v181.14c0 53.85-43.807 97.657-97.656 97.657h-21.524c-53.85 0-97.657-43.808-97.657-97.657v-187.17c-22.156 13.194-45.296 32.319-66.624 60.232 0 0-69.009 14.908-79.382 20.404-10.374 5.49-47.853 68.385-22.222 230.4 25.624 162.01 82.375 271.85 95.19 228.83zm373.77-258.73c-13.801 0-25.031-11.223-25.031-25.024s11.23-25.031 25.031-25.031c13.8 0 25.024 11.224 25.024 25.031 1e-3 13.802-11.224 25.024-25.024 25.024zm48.207-96.432c13.801 0 25.03 11.224 25.03 25.031 0 13.801-11.229 25.025-25.03 25.025s-25.031-11.224-25.031-25.025 11.23-25.031 25.031-25.031zm-47.601-46.989c13.801 0 25.031 11.224 25.031 25.031 0 13.8-11.23 25.024-25.031 25.024s-25.03-11.224-25.03-25.024c5e-3 -13.801 11.229-25.031 25.03-25.031zm-48.207 46.383c13.801 0 25.024 11.224 25.024 25.031 0 13.801-11.224 25.025-25.024 25.025s-25.031-11.224-25.031-25.025c6e-3 -13.807 11.236-25.031 25.031-25.031zm-176.43 232.05 28.458-48.342c1.408-2.418 5.056-2.441 6.5-6e-3l28.451 48.342c0.729 1.242 0.759 2.662 0.099 3.818-0.655 1.15-1.91 1.842-3.33 1.842h-56.928c-1.426 0-2.674-0.691-3.335-1.842-0.668-1.156-0.631-2.582 0.085-3.812zm-136.01-171.33c2.699 0 4.896 2.191 4.896 4.89v26.23h26.23c2.693 0 4.89 2.191 4.89 4.891v23.801c0 2.697-2.191 4.889-4.89 4.889h-26.23v26.23c0 2.693-2.191 4.891-4.896 4.891h-23.801c-2.692 0-4.89-2.191-4.89-4.891v-26.23h-26.23c-2.693 0-4.89-2.191-4.89-4.889v-23.801c0-2.693 2.191-4.891 4.89-4.891h26.23v-26.23c0-2.699 2.191-4.89 4.89-4.89zm-54.009-133.64c24.902 0 45.166 20.263 45.166 45.166s-20.263 45.166-45.166 45.166-45.166-20.263-45.166-45.166 20.264-45.166 45.166-45.166z" clip-path="url(#b)" fill="#e6e6e6"/>\n     <path d="m371.79 133.6h-142.4v126.1h142.4zm-8.256 117.31c0 0.985-0.796 1.781-1.781 1.781h-122.33c-0.979 0-1.781-0.796-1.781-1.781v-108.51c0-0.985 0.795-1.781 1.781-1.781h122.33c0.985 0 1.781 0.795 1.781 1.781z" fill="#1a1a1a"/>\n     <path d="m289.82 316.22h21.523c50.558 0 91.537-40.985 91.537-91.536v-6.089l0.0627-180.67c-46.252-27.867-85.605-28.475-100.38-29.284-3.6348-0.19916-6.7928-0.03767-6.7928-0.03767s-2.9265-0.19568-6.6277-0.015294c-13.717 0.66851-50.54 2.3407-91.789 25.089l0.93221 184.88v6.12c0 50.552 40.986 91.537 91.537 91.537zm66.506-218.18 1.806-0.061c0.018-0.379-0.031-1.567-0.031-2.497 0-0.453-0.227-0.869-0.41-1.096 0.82-0.184 2.069-0.563 2.638-0.728-6e-3 1.469 0.099 3.556 0.117 4.321l3.684 0.055c-0.019 0.63 0.049 0.851 0.062 1.419l-1.016-0.122h-2.705l-0.05 8.103-0.024 0.679c0.024 0.723 0.123 1.641 0.282 2.001 0.159 0.361 0.385 0.496 0.679 0.655 0.3 0.159 0.637 0.196 0.949 0.196 0.22 0 0.551-6e-3 0.808-6e-3s0.435-0.019 1.071-0.202c-0.08 0.478-0.209 0.741-0.294 1.536-0.588 0.166-0.857 0.208-1.206 0.245-0.349 0.043-0.679-0.067-0.997-0.067-0.777 0-1.414-0.11-1.903-0.337-0.49-0.22-0.869-0.575-1.139-1.071-0.275-0.49-0.465-1.708-0.496-2.552-6e-3 -0.11-6e-3 -0.3-0.012-0.575 0-0.275-0.019-0.551 0-2.197l-0.056-6.402h-1.774c0.023-0.397 0.023-0.519 0.017-1.297zm-2.932 9.309c-0.135-0.184-0.643-0.618-0.899-0.838-0.257-0.227-0.937-0.557-1.824-0.924-0.899-0.379-2.044-0.74-2.46-1.089-0.416-0.355-1.175-0.759-1.475-1.132s-0.526-0.74-0.68-1.12c-0.153-0.374-0.043-0.943-0.055-1.328-0.024-0.618 0.36-1.254 0.728-1.836 0.361-0.575 0.992-0.9 1.714-1.188 0.723-0.281 1.579-0.428 2.564-0.428 1.102 0 2.166 0.214 3.501 0.471 0.073 0.753-0.099 1.273-7e-3 1.897-0.961-0.636-2.025-0.955-3.072-0.955-0.568 0-1.145 0.086-1.621 0.233-0.478 0.146-1.01 0.624-1.218 0.918-0.215 0.3-0.331 0.581-0.318 0.936 6e-3 0.233 0.079 0.618 0.165 0.833 0.086 0.214 0.648 0.808 0.942 0.937 0.404 0.177 0.245 0.153 0.612 0.232 0.416 0.092 1.444 0.618 2.423 1.083 1.017 0.483 1.946 1.089 2.265 1.408 0.324 0.318 0.637 0.759 0.931 1.438 0.165 0.38 0.257 0.826 0.257 1.145 0 0.551-0.146 0.625-0.129 0.967 0.031 0.673-0.141 0.924-0.514 1.5s-1.071 1.126-1.849 1.444c-0.777 0.318-1.604 0.582-2.576 0.582-0.416 0-1.377 0.049-1.934-6e-3 -0.558-0.049-1.035-0.239-1.427-0.312s-0.643-0.092-1.224-0.232l-0.202-0.985c-6e-3 -0.116-0.263-0.771-0.373-1.396 1.646 0.906 3.385 1.542 4.633 1.542 0.654 0 1.304-0.19 1.75-0.361 0.447-0.171 0.882-0.489 1.096-0.826 0.208-0.336 0.44-0.661 0.521-1.016 0.049-0.196 0.11-0.459 0.061-0.637-0.067-0.211-0.171-0.774-0.306-0.957zm-86.138-55.282c0.324-2.111 0.955-4.223 1.364-5.673 0.973-3.47 3.581-8.672 4.841-10.429s1.762-2.295 3.592-4.339 0.783-0.637 4.174-3.421c3.384-2.785 7.938-4.78 9.933-5.587 1.995-0.814 5.037-2.301 10.521-2.668s8.794 0.312 11.854 0.667c3.586 0.417 10.435 2.754 10.435 2.754s3.996 1.805 7.093 3.837c1.671 1.004 3.158 2.987 4.676 4.927 2.087 2.668 4.131 6.028 4.425 6.505 0.508 0.814 2.778 4.908 3.256 6.426s1.542 7.117 1.628 7.729 0.937 4.051-2.001 4.253c-3.22 0.22-3.55-3.066-3.758-4.002-0.214-0.942-2.387-8.158-3.14-9.517s-5.264-7.962-7.265-10.135-5.894-4.951-10.141-6.255c-4.063-1.254-10.961-2.479-15.6-2.276-4.076 0.177-5.416 0.459-7.191 1.022-3.629 1.157-6.812 2.993-9.015 4.382-2.203 1.383-5.899 4.357-7.515 6.383-1.916 2.405-5.166 8.354-5.888 11.64-1.334 6.114-0.502 12.014-0.502 12.014s1.506 11.579 9.015 17.521c2.938 2.332 5.336 3.562 12.02 5.379 0.937 0.257 3.978 0.471 7.778 0.496 3.801 0.019 4.957-0.11 7.124-0.869 2.16-0.759 2.852-0.894 4.504-1.75 1.659-0.857 4.505-1.799 7.559-4.811 1.707-1.689 3.837-5.006 4.719-8.329 0.514-1.946 0.189-2.552 0.122-5.104-0.019-0.783-0.092-1.493-0.153-2.167-0.146-1.524-0.397-2.938-0.93-5.178-0.771-3.231-0.539-2.387-1.292-4.449-0.52-1.42-1.107-2.577-1.523-3.25s-0.814-1.12-1.273-1.818c-3.17-4.841-9.431-8.011-15.232-8.201-1.934-0.067-4.314 0.135-6.714 0.894-1.628 0.514-3.268 1.346-4.786 2.271-0.63 0.379-1.23 0.673-1.812 1.132-0.587 0.471-0.942 0.606-1.462 1.157-0.471 0.501-1.114 1.628-1.5 2.136-4.725 6.065-3.629 11.689-3.629 11.689s-0.44 13.207 13.52 14.646c3.525 0.171 9.89-2.087 12.301-4.67 1.481-1.591 1.585-4.437 1.536-6.964-0.036-2.001-1.016-5.551-2.552-6.922-3.342-2.98-6.12-3.072-7.576-3.158-1.94-0.123-4.7 0.477-5.79 4.725-0.38 1.475 0.777 4.547 2.962 4.982 1.879 0.379 3.88 0 4.762 0.128 0.783 0.11 1.971-0.153 1.971 2.313-0.221 4.321-9.633 1.903-9.737 1.812-0.722-0.624-4.969-3.042-5.134-7.631-0.178-4.847 2.099-8.507 6.236-10.576 1.041-0.52 2.956-0.783 4.254-0.838 3.524 0.171 6.021 0.63 8.604 2.02 0.483 0.263 0.979 0.477 1.512 0.838 0.165 0.11 0.802 0.557 0.899 0.618 3.023 2.601 4.284 6.035 4.884 9.499 0.238 1.377 0.232 2.662 0.275 3.678 0.08 1.738-0.122 3.843-1.01 5.82-0.942 2.112-2.638 4.082-5 5.318-2.295 1.2-5.643 3.103-10.264 3.672-2.784 0.342-6.021 0.287-9.773-0.924-10.643-3.439-11.646-15.514-11.646-15.514s-2.173-8.898 3.69-16.916c0.618-0.844 1.322-1.928 2.129-2.735 2.644-2.644 5.012-4.015 7.185-5.166 3.99-2.111 6.916-2.595 7.779-2.595 0.618 0 2.093-0.085 3.824 0.043 1.983 0.141 4.309 0.526 6.065 0.955 1.928 0.471 3.537 0.851 4.792 1.383 1.188 0.508 2.038 1.175 2.968 1.744 1.922 1.169 4.982 3.488 6.017 5.055 1.07 1.628 2.589 3.715 3.77 7.387 0.691 2.154 1.273 5.232 1.983 8.703 1.064 5.196 0.679 10.447-0.502 13.764-0.129 0.355-1.451 4.566-5.637 8.513-4.187 3.954-9.455 6.193-11.016 6.817-1.567 0.625-3.795 2.521-12.332 2.381-7.387-0.123-12.987-2.081-14.651-2.754-1.665-0.673-6.059-2.068-10.833-7.319-4.773-5.257-5.814-8.648-6.573-10.949s-2.191-8.195-2.191-8.195 0.171-0.024-0.171-3.066c-0.129-1.359-0.111-3.133 0.159-4.908zm73.825 59.388c-0.465 0.386-0.937 0.673-1.236 0.857-0.637 0.134-1.021 0.281-1.426 0.312-0.404 0.037-0.783 0.049-1.15 0.049-1.212 0-2.1-0.367-2.791-0.686-0.691-0.318-1.261-0.875-1.622-1.523-0.36-0.649-0.44-1.243-0.471-2.008-0.019-0.446 0.11-0.905 0.22-1.279 0.104-0.379 0.251-0.716 0.447-1.022 0.189-0.306 0.33-0.539 0.691-0.851 0.361-0.306 0.575-0.478 0.979-0.673 0.403-0.202 0.777-0.288 1.315-0.483 0.539-0.196 1.524-0.263 2.785-0.441 0.385-0.098 0.71-0.073 0.979-0.177 0.27-0.104 0.509-0.208 0.717-0.306s0.385-0.214 0.538-0.349 0.294-0.3 0.416-0.49c0.129-0.196 0.215-0.141 0.27-0.336 0.055-0.196 0.024-0.294 0.019-0.496-0.019-0.489-0.043-0.765-0.337-1.107s-0.637-0.833-1.102-0.967c-0.459-0.141-1.23-0.361-1.849-0.361-0.575 0-1.046 0.073-1.646 0.178-0.6 0.104-1.114 0.232-1.549 0.373-0.429 0.147-0.918 0.361-1.561 0.649 0.062-0.435 0.013-1.065 0.062-1.922 1.053-0.306 1.609-0.453 2.387-0.563s1.928-0.178 2.674-0.178c0.796 0 1.292 0.171 1.995 0.337 0.698 0.165 1.586 0.777 1.91 1.261 0.336 0.496 0.648 0.856 0.819 1.334 0.172 0.478 0.404 1.42 0.429 1.958 0.024 0.679 0.062 0.239 0.037 1.842-0.024 1.609 0.073 4.547 0.061 5.912-6e-3 0.833 0.099 0.912 0.318 2.038-0.483-0.019-1.102 0.024-1.401 0.024-0.287 0-0.71-0.043-1.236-0.024v-1.53c7e-3 6e-3 -0.226 0.263-0.691 0.648zm-19.155-3.378c0.336 0.838 0.899 1.659 1.683 2.118s1.701 0.906 2.662 0.906c0.931 0 2.889-0.098 5.013-1.224-0.013 0.159-0.098 0.514-0.153 0.942-0.055 0.435-0.178 0.796-0.214 1.212-0.637 0.166-1.31 0.349-1.903 0.41-0.588 0.061-2.197 0.165-2.644 0.165-0.949 0-2.051-0.196-2.864-0.483-0.814-0.288-1.83-0.832-2.448-1.487-0.624-0.655-1.328-1.31-1.646-2.283s-0.545-1.909-0.581-2.993c-0.056-1.457 0.177-1.946 0.587-3.25 0.404-1.31 1.438-2.252 2.394-2.993 0.954-0.741 3.164-1.371 4.859-1.371 1.248 0 2.711 0.208 3.91 0.575 0.086 0.851 0.116 1.31 0.178 1.861-0.845-0.3-1.616-0.649-2.148-0.753s-1.199-0.202-1.652-0.202c-0.771 0-2.411 0.343-3.011 0.655-0.6 0.318-1.102 0.765-1.512 1.353-0.41 0.581-0.734 1.395-0.894 2.197s-0.221 0.869-0.189 1.702c0.04 1.125 0.23 2.104 0.573 2.943zm-6.898-5.263c-0.019-0.575-0.189-1.224-0.306-1.548-0.116-0.324-0.704-0.924-0.949-1.187-0.244-0.263-0.611-0.312-0.961-0.447-0.349-0.135-0.911-0.166-1.353-0.166-0.354 0-0.802 0.062-1.095 0.147-0.275 0.086-0.551 0.147-0.809 0.331-0.281 0.189-0.532 0.3-0.752 0.575-0.221 0.27-0.398 0.575-0.545 0.912-0.153 0.349-0.159 0.869-0.189 1.432-0.037 0.606 0.03 1.383 0.012 2.252-0.024 0.918-0.024 4.56 0 6.065l0.422 1.346c-0.514-0.018-1.272-0.03-1.529-0.03-0.239 0-0.894 6e-3 -1.457 0.03 0.043-1.224 0.19-0.11 0.196-1.407l0.024-5.594c0-1.108-0.013-2.057-0.043-2.833-0.019-0.508-0.079-0.686-0.184-1.041-0.098-0.355-0.275-0.802-0.532-1.096-0.251-0.293-0.808-0.765-1.15-0.918-0.35-0.153-0.839-0.269-1.268-0.269-0.452 0-0.746 0.049-1.138 0.22s-0.734 0.251-1.059 0.594c-0.318 0.336-0.588 0.373-0.796 0.869-0.208 0.489-0.367 0.385-0.459 1.181-0.098 0.795-0.141 3.69-0.135 5.667 6e-3 1.169 0.019 2.228 0.037 3.183 0.012 0.654 0.281 0.887 0.306 1.444-0.569-0.018-1.212-0.03-1.42-0.03-0.232 0-1.01 6e-3 -1.585 0.03l0.318-1.028c0.012-0.453 0.019-1.922 0.024-2.901l-0.147-8.292c-0.018-0.741-0.416-1.628-0.435-2.014 0.41 0.012 1.335-0.135 1.763-0.294 0.343-0.128 0.729-0.128 1.09-0.141l-6e-3 1.928c0.275-0.557 0.776-0.612 1.01-0.942 0.232-0.324 0.471-0.312 0.856-0.587s0.624-0.288 1.139-0.361c0.63-0.092 1.027-0.123 1.572-0.123 0.38 0 0.753 0.049 1.126 0.147 0.374 0.098 0.717 0.239 1.041 0.417 0.318 0.177 0.594 0.379 0.826 0.605 0.232 0.227 0.483 0.349 0.691 0.741 0.073 0.128 0.637-0.624 1.426-1.083 0.79-0.453 1.72-0.802 2.711-0.802 0.637 0 2.057 0.085 2.662 0.312 0.606 0.227 1.463 0.557 1.836 0.979 0.367 0.429 0.478 0.618 0.809 0.967 0.41 0.435 0.538 1.53 0.562 1.995 0.019 0.477 0.067 1.199 0.067 2.16l6e-3 6.818c0 0.655 0.19 0.734 0.312 1.481-0.471-0.019-1.083-0.031-1.353-0.031-0.281 0-0.955 6e-3 -1.506 0.031 0.367-1.169 0.294-0.771 0.325-1.487l0.024-6.181c-2e-3 -0.87-7e-3 -1.384-0.032-2.026zm-24.217 8.831c-0.459 0.386-0.937 0.667-1.23 0.857-0.637 0.135-1.016 0.282-1.42 0.312-0.404 0.031-0.79 0.049-1.151 0.049-1.206 0-2.093-0.367-2.784-0.686-0.692-0.318-1.255-0.875-1.616-1.524-0.361-0.648-0.441-1.242-0.471-2.007-0.019-0.447 0.116-0.906 0.22-1.279 0.104-0.374 0.251-0.716 0.44-1.022 0.19-0.306 0.331-0.539 0.692-0.844 0.361-0.306 0.575-0.478 0.979-0.673s0.771-0.288 1.31-0.483c0.539-0.19 1.524-0.263 2.778-0.441 0.38-0.098 0.71-0.073 0.979-0.177s0.508-0.208 0.716-0.306 0.386-0.214 0.539-0.349 0.294-0.3 0.417-0.49c0.128-0.196 0.214-0.263 0.269-0.459s0.024-0.294 0.019-0.496c-0.019-0.49-0.043-0.637-0.337-0.985-0.293-0.349-0.636-0.833-1.095-0.967s-1.224-0.361-1.842-0.361c-0.575 0-1.046 0.074-1.646 0.177-0.6 0.104-1.114 0.233-1.548 0.374-0.429 0.147-0.918 0.361-1.561 0.649 0.062-0.441 0.012-1.065 0.062-1.928 1.046-0.3 1.604-0.453 2.38-0.563 0.777-0.11 1.928-0.177 2.668-0.177 0.795 0 1.292 0.171 1.989 0.336 0.704 0.166 1.579 0.777 1.904 1.261 0.336 0.496 0.648 0.851 0.82 1.328 0.165 0.478 0.404 1.42 0.428 1.958 0.025 0.686 0.062 0.239 0.037 1.842-0.025 1.609 0.073 4.547 0.061 5.912-6e-3 0.826 0.098 0.912 0.318 2.038-0.478-0.019-1.096 0.024-1.402 0.024-0.281 0-0.709-0.043-1.236-0.024v-1.53c6e-3 0.011-0.227 0.268-0.686 0.654zm-19.975-3.109c0.422 0.875 0.991 1.438 1.769 1.891 0.777 0.447 1.805 0.839 2.791 0.839 1.139 0 3.213-0.478 4.915-1.328-0.085 0.539-0.263 1.242-0.336 2.075-0.838 0.238-2.222 0.771-2.84 0.856-0.618 0.086-1.23 0.104-1.848 0.104-1.102 0-2.197-0.275-3.084-0.569-0.888-0.3-1.775-0.912-2.424-1.652-0.655-0.735-1.297-1.536-1.603-2.491-0.312-0.948-0.386-1.909-0.429-2.968-0.055-1.475 0.184-2.025 0.637-3.286s1.401-2.179 2.387-2.901c0.979-0.722 2.246-1.083 3.794-1.083 0.802 0 1.713 0.062 2.454 0.325 0.74 0.263 1.365 0.539 1.867 1.071 0.508 0.539 0.93 1.071 1.224 1.86 0.294 0.79 0.361 0.802 0.526 1.72 0.074 0.429 0.129 1.102 0.092 1.438l-10.49 0.061c-0.012 0.545-0.049 0.814-0.037 1.096 0.029 1.045 0.212 2.067 0.635 2.942zm-11.12-10.288c0.318-0.067 1.102-0.177 1.518-0.189l6e-3 2.644c0.3-0.612 0.318-0.575 0.563-0.881 0.239-0.312 0.624-0.667 0.93-0.869 0.312-0.202 0.649-0.49 1.046-0.606 0.392-0.117 0.753-0.282 1.188-0.3 0.343-0.012 0.667-0.061 1.548 0.031 0.887 0.092 1.353 0.294 1.548 0.349 0.019 0.355-0.649 1.989-0.649 1.989s-0.636-0.055-1.211-0.293c-0.551-0.166-0.924-0.166-1.359-0.166-0.514 0-1.12 0.116-1.524 0.312-0.404 0.19-0.79 0.422-1.102 0.814s-0.52 0.796-0.71 1.34c-0.159 0.441-0.104 0.073-0.165 0.765-0.067 0.691-6e-3 7.326 0.049 8.819l0.263 0.857c-0.483-0.019-1.169 0-1.462 0-0.27 0-0.924 0.012-1.469 0.03 0-0.281 0.282-0.673 0.288-0.942 0.067-4.633-0.03-8.213-0.141-11.206l-0.049-1.261-0.44-1.071c0.446-0.05 1.052-0.111 1.334-0.166zm-18.654-6.224c0.533 0 1.322 0.086 2.436 0.062 1.114-0.025 2.105 0 2.546 0.042 1.585 0.147 1.989 0.233 3.078 0.502 0.826 0.196 2.393 1.034 3.091 1.53 0.704 0.496 1.401 1.064 1.97 1.866 0.563 0.802 0.845 1.059 1.224 1.989 0.508 1.261 0.802 2.625 0.851 3.892 0.067 1.732-0.116 3.06-0.618 4.651-0.496 1.591-1.603 2.772-2.668 3.837s-2.234 1.708-3.593 2.044c-1.365 0.336-2.901 0.667-4.596 0.667l-3.991-0.03-3.8-0.092 0.539-1.42-0.043-17.528c-0.012-0.508-0.251-1.034-0.501-1.922 1.198 0.027 3.224-0.09 4.075-0.09zm-17.797 168.64v-128.02c0-2.846 2.313-5.159 5.159-5.159h144.32c2.846 0 5.159 2.313 5.159 5.159v128.02c0 2.846-2.313 5.159-5.159 5.159h-144.32c-2.846 1e-3 -5.159-2.312-5.159-5.158z" fill="#1a1a1a"/>\n     <ellipse cx="493.55" cy="200.22" rx="25.204" ry="25.115" fill="#fff"/>\n     <circle cx="493.51" cy="200.26" r="18.911" fill="#1a1a1a"/>\n     <ellipse cx="444.94" cy="246.54" rx="25.204" ry="25.115" fill="#fff"/>\n     <path d="m445.3 265.55c10.422 0 18.904-8.482 18.904-18.905s-8.482-18.911-18.904-18.911c-10.429 0-18.911 8.482-18.911 18.911s8.482 18.905 18.911 18.905z" fill="#1a1a1a"/>\n     <ellipse cx="492.88" cy="293.45" rx="25.204" ry="25.115" fill="#fff"/>\n     <path d="m492.9 274.71c-10.429 0-18.911 8.482-18.911 18.911 0 10.428 8.482 18.905 18.911 18.905 10.422 0 18.904-8.482 18.904-18.905s-8.482-18.911-18.904-18.911z" fill="#1a1a1a"/>\n     <ellipse cx="541.23" cy="247.25" rx="25.204" ry="25.115" fill="#fff"/>\n     <circle cx="541.11" cy="247.25" r="18.911" fill="#1a1a1a"/>\n     <path d="m78.855 232.89c21.53 0 39.045-17.515 39.045-39.045s-17.515-39.045-39.045-39.045-39.046 17.515-39.046 39.045 17.522 39.045 39.046 39.045z" fill="#1a1a1a"/>\n     <polygon transform="translate(6.8088,8.7805)" points="124.82 332.13 155.94 332.13 155.94 310.78 124.82 310.78 124.82 279.67 103.48 279.67 103.48 310.78 72.364 310.78 72.364 332.13 103.48 332.13 103.48 363.25 124.82 363.25" fill="#1a1a1a"/>\n     <polygon transform="translate(6.8088,8.7805)" points="269.44 444.41 318.12 444.41 293.78 403.06" fill="#1a1a1a"/>\n    </g>\n   </g>\n   <g transform="translate(-1.12)" clip-path="url(#a)" fill="#1a1a1a">\n    <g clip-path="none">\n     <path d="m243.78 111.34c0.838 0 1.818-0.043 2.687-0.135s1.481-0.397 2.167-0.636 1.377-0.643 2.02-1.261c0.637-0.618 1.157-1.316 1.548-2.099 0.392-0.784 0.673-1.659 0.845-2.632 0.171-0.967 0.239-1.952 0.196-2.95-0.042-1.12-0.343-1.953-0.648-2.907-0.306-0.955-0.881-2.154-1.671-2.803-0.869-0.716-1.493-1.224-2.387-1.481-0.894-0.251-2.154-0.637-3.599-0.637-0.881 0-2.05 0.062-2.62 0.128-0.593 0.074-1.138 0.147-1.885 0.159l0.196 17.228c1.162 0.038 2.154 0.026 3.151 0.026z" fill="#1a1a1a"/>\n     <path d="m278.33 102.96c-0.031-0.624 0-0.416-0.073-0.765-0.074-0.343-0.166-0.618-0.349-0.991-0.184-0.367-0.502-0.624-0.795-0.894-0.294-0.27-0.643-0.478-1.053-0.618-0.404-0.147-1.01-0.22-1.475-0.22-0.501 0-0.948 0.153-1.395 0.312s-0.838 0.374-1.175 0.649c-0.336 0.275-0.618 0.6-0.844 0.967-0.227 0.367-0.392 0.729-0.496 1.071-0.042 0.135-0.049 0.147-0.042 0.153 6e-3 6e-3 0.03-0.012-0.025 0.336z" fill="#1a1a1a"/>\n     <path d="m291.54 104.42c-0.3 0.27-0.441 0.343-0.587 0.453-0.147 0.11-0.361 0.171-0.551 0.269-0.19 0.092-0.447 0.116-0.68 0.202-0.226 0.085-1.022 0.11-1.346 0.153-0.691 0.086-1.15 0.159-1.426 0.27-0.6 0.214-0.955 0.275-1.298 0.496-0.342 0.22-0.612 0.551-0.838 0.808-0.227 0.257-0.312 0.49-0.404 0.747-0.104 0.318-0.092 0.655-0.073 0.998 0.018 0.538 0.434 1.132 0.734 1.523 0.293 0.398 0.3 0.257 0.679 0.526 0.379 0.263 0.918 0.404 1.518 0.404 0.374 0 0.759-0.031 1.157-0.092 0.306-0.043 0.637-0.239 1.096-0.392 0.146-0.049 0.489-0.361 0.655-0.422 0 0 0.422-0.342 0.844-1.077 0.422-0.734 0.508-1.952 0.508-1.952z" fill="#1a1a1a"/>\n     <path d="m341.81 104.23c-0.294 0.27-0.44 0.349-0.588 0.459-0.146 0.11-0.379 0.153-0.569 0.251-0.189 0.092-0.428 0.135-0.66 0.22-0.227 0.086-1.022 0.11-1.347 0.153-0.691 0.085-1.15 0.159-1.426 0.269-0.6 0.22-0.961 0.282-1.304 0.496-0.343 0.221-0.618 0.551-0.845 0.808s-0.318 0.489-0.404 0.747c-0.104 0.318-0.085 0.655-0.073 1.003 0.019 0.533 0.435 1.132 0.734 1.524 0.3 0.398 0.3 0.257 0.686 0.526 0.38 0.263 0.918 0.404 1.524 0.404 0.373 0 0.759-0.03 1.162-0.092 0.307-0.042 0.643-0.245 1.096-0.392 0.146-0.049 0.489-0.361 0.655-0.422 0 0 0.422-0.343 0.844-1.077 0.423-0.729 0.509-1.953 0.509-1.953z" fill="#1a1a1a"/>\n     <path d="m119.14 577.38c12.815-43.023 10.985-43.023 17.393-58.582 6.408-15.562 19.223-16.475 35.698-20.135 82.805-10.454 167.09-15.742 247.15-7e-5 16.476 3.66 29.291 4.578 35.698 20.135 6.407 15.564 4.578 15.564 17.394 58.582 12.814 43.018 69.554-66.818 95.184-228.83 25.631-162.01-11.848-224.91-22.222-230.4-10.373-5.49-79.382-20.404-79.382-20.404-18.269-23.911-37.871-41.377-57.039-54.199v181.14c0 53.85-43.807 97.657-97.656 97.657h-21.524c-53.85 0-97.657-43.808-97.657-97.657v-187.17c-22.156 13.194-45.296 32.319-66.624 60.232 0 0-69.009 14.908-79.382 20.404-10.374 5.49-47.853 68.385-22.222 230.4 25.624 162.01 82.375 271.85 95.19 228.83zm373.77-258.73c-13.801 0-25.031-11.223-25.031-25.024s11.23-25.031 25.031-25.031c13.8 0 25.024 11.224 25.024 25.031 1e-3 13.802-11.224 25.024-25.024 25.024zm48.207-96.432c13.801 0 25.03 11.224 25.03 25.031 0 13.801-11.229 25.025-25.03 25.025s-25.031-11.224-25.031-25.025 11.23-25.031 25.031-25.031zm-47.601-46.989c13.801 0 25.031 11.224 25.031 25.031 0 13.8-11.23 25.024-25.031 25.024s-25.03-11.224-25.03-25.024c5e-3 -13.801 11.229-25.031 25.03-25.031zm-48.207 46.383c13.801 0 25.024 11.224 25.024 25.031 0 13.801-11.224 25.025-25.024 25.025s-25.031-11.224-25.031-25.025c6e-3 -13.807 11.236-25.031 25.031-25.031zm-176.43 232.05 28.458-48.342c1.408-2.418 5.056-2.441 6.5-6e-3l28.451 48.342c0.729 1.242 0.759 2.662 0.099 3.818-0.655 1.15-1.91 1.842-3.33 1.842h-56.928c-1.426 0-2.674-0.691-3.335-1.842-0.668-1.156-0.631-2.582 0.085-3.812zm-136.01-171.33c0.12593-2.6961 5.1037 2.1992 4.895 4.8902v26.23l26.231-1.6e-4c2.693-2e-5 4.89 2.191 4.89 4.891v23.801c0 2.697-2.191 4.889-4.89 4.889l-26.231 1.6e-4v26.23c0 2.693-2.19 4.8908-4.895 4.8908h-23.801c-2.692 0-4.89-2.191-4.89-4.891v-26.23h-26.23c-2.693 0-4.89-2.191-4.89-4.889v-23.801c0-2.693 2.191-4.891 4.89-4.891h26.23v-26.23c0-2.699 2.191-4.89 4.89-4.89 7.9337 0 15.867 169.86 23.801 0zm-54.009-133.64c24.902 0 45.166 20.263 45.166 45.166s-20.263 45.166-45.166 45.166-45.166-20.263-45.166-45.166 20.264-45.166 45.166-45.166z" fill="#f2f2f2" stroke="#000" stroke-width="3.2267"/>\n     <path d="m371.79 133.6h-142.4v126.1h142.4zm-8.256 117.31c0 0.985-0.796 1.781-1.781 1.781h-122.33c-0.979 0-1.781-0.796-1.781-1.781v-108.51c0-0.985 0.795-1.781 1.781-1.781h122.33c0.985 0 1.781 0.795 1.781 1.781z" fill="#1a1a1a"/>\n     <path d="m126.54 95.719a205.64 206.43 0 0 0-36.058 116.76 205.64 206.43 0 0 0 205.64 206.43 205.64 206.43 0 0 0 205.64-206.43 205.64 206.43 0 0 0-36.06-116.76z" clip-path="none" fill="none" stroke="#000" stroke-width="7.4"/>\n     <path d="m289.82 316.22h21.523c50.558 0 91.537-40.985 91.537-91.536v-185.14c-45.018-27.974-86.578-30.765-101.38-30.765-3.69 0-5.71 0.171-5.71 0.171s-2.026-0.171-5.71-0.171c-13.733 0-50.551 2.405-91.8 25.153v190.75c0 50.552 40.986 91.537 91.537 91.537zm66.506-218.18 1.806-0.061c0.018-0.379-0.031-1.567-0.031-2.497 0-0.453-0.227-0.869-0.41-1.096 0.82-0.184 2.069-0.563 2.638-0.728-6e-3 1.469 0.099 3.556 0.117 4.321l3.684 0.055c-0.019 0.63 0.049 0.851 0.062 1.419l-1.016-0.122h-2.705l-0.05 8.103-0.024 0.679c0.024 0.723 0.123 1.641 0.282 2.001 0.159 0.361 0.385 0.496 0.679 0.655 0.3 0.159 0.637 0.196 0.949 0.196 0.22 0 0.551-6e-3 0.808-6e-3s0.435-0.019 1.071-0.202c-0.08 0.478-0.209 0.741-0.294 1.536-0.588 0.166-0.857 0.208-1.206 0.245-0.349 0.043-0.679-0.067-0.997-0.067-0.777 0-1.414-0.11-1.903-0.337-0.49-0.22-0.869-0.575-1.139-1.071-0.275-0.49-0.465-1.708-0.496-2.552-6e-3 -0.11-6e-3 -0.3-0.012-0.575 0-0.275-0.019-0.551 0-2.197l-0.056-6.402h-1.774c0.023-0.397 0.023-0.519 0.017-1.297zm-2.932 9.309c-0.135-0.184-0.643-0.618-0.899-0.838-0.257-0.227-0.937-0.557-1.824-0.924-0.899-0.379-2.044-0.74-2.46-1.089-0.416-0.355-1.175-0.759-1.475-1.132s-0.526-0.74-0.68-1.12c-0.153-0.374-0.043-0.943-0.055-1.328-0.024-0.618 0.36-1.254 0.728-1.836 0.361-0.575 0.992-0.9 1.714-1.188 0.723-0.281 1.579-0.428 2.564-0.428 1.102 0 2.166 0.214 3.501 0.471 0.073 0.753-0.099 1.273-7e-3 1.897-0.961-0.636-2.025-0.955-3.072-0.955-0.568 0-1.145 0.086-1.621 0.233-0.478 0.146-1.01 0.624-1.218 0.918-0.215 0.3-0.331 0.581-0.318 0.936 6e-3 0.233 0.079 0.618 0.165 0.833 0.086 0.214 0.648 0.808 0.942 0.937 0.404 0.177 0.245 0.153 0.612 0.232 0.416 0.092 1.444 0.618 2.423 1.083 1.017 0.483 1.946 1.089 2.265 1.408 0.324 0.318 0.637 0.759 0.931 1.438 0.165 0.38 0.257 0.826 0.257 1.145 0 0.551-0.146 0.625-0.129 0.967 0.031 0.673-0.141 0.924-0.514 1.5s-1.071 1.126-1.849 1.444c-0.777 0.318-1.604 0.582-2.576 0.582-0.416 0-1.377 0.049-1.934-6e-3 -0.558-0.049-1.035-0.239-1.427-0.312s-0.643-0.092-1.224-0.232l-0.202-0.985c-6e-3 -0.116-0.263-0.771-0.373-1.396 1.646 0.906 3.385 1.542 4.633 1.542 0.654 0 1.304-0.19 1.75-0.361 0.447-0.171 0.882-0.489 1.096-0.826 0.208-0.336 0.44-0.661 0.521-1.016 0.049-0.196 0.11-0.459 0.061-0.637-0.067-0.211-0.171-0.774-0.306-0.957zm-86.138-55.282c0.324-2.111 0.955-4.223 1.364-5.673 0.973-3.47 3.581-8.672 4.841-10.429s1.762-2.295 3.592-4.339 0.783-0.637 4.174-3.421c3.384-2.785 7.938-4.78 9.933-5.587 1.995-0.814 5.037-2.301 10.521-2.668s8.794 0.312 11.854 0.667c3.586 0.417 10.435 2.754 10.435 2.754s3.996 1.805 7.093 3.837c1.671 1.004 3.158 2.987 4.676 4.927 2.087 2.668 4.131 6.028 4.425 6.505 0.508 0.814 2.778 4.908 3.256 6.426s1.542 7.117 1.628 7.729 0.937 4.051-2.001 4.253c-3.22 0.22-3.55-3.066-3.758-4.002-0.214-0.942-2.387-8.158-3.14-9.517s-5.264-7.962-7.265-10.135-5.894-4.951-10.141-6.255c-4.063-1.254-10.961-2.479-15.6-2.276-4.076 0.177-5.416 0.459-7.191 1.022-3.629 1.157-6.812 2.993-9.015 4.382-2.203 1.383-5.899 4.357-7.515 6.383-1.916 2.405-5.166 8.354-5.888 11.64-1.334 6.114-0.502 12.014-0.502 12.014s1.506 11.579 9.015 17.521c2.938 2.332 5.336 3.562 12.02 5.379 0.937 0.257 3.978 0.471 7.778 0.496 3.801 0.019 4.957-0.11 7.124-0.869 2.16-0.759 2.852-0.894 4.504-1.75 1.659-0.857 4.505-1.799 7.559-4.811 1.707-1.689 3.837-5.006 4.719-8.329 0.514-1.946 0.189-2.552 0.122-5.104-0.019-0.783-0.092-1.493-0.153-2.167-0.146-1.524-0.397-2.938-0.93-5.178-0.771-3.231-0.539-2.387-1.292-4.449-0.52-1.42-1.107-2.577-1.523-3.25s-0.814-1.12-1.273-1.818c-3.17-4.841-9.431-8.011-15.232-8.201-1.934-0.067-4.314 0.135-6.714 0.894-1.628 0.514-3.268 1.346-4.786 2.271-0.63 0.379-1.23 0.673-1.812 1.132-0.587 0.471-0.942 0.606-1.462 1.157-0.471 0.501-1.114 1.628-1.5 2.136-4.725 6.065-3.629 11.689-3.629 11.689s-0.44 13.207 13.52 14.646c3.525 0.171 9.89-2.087 12.301-4.67 1.481-1.591 1.585-4.437 1.536-6.964-0.036-2.001-1.016-5.551-2.552-6.922-3.342-2.98-6.12-3.072-7.576-3.158-1.94-0.123-4.7 0.477-5.79 4.725-0.38 1.475 0.777 4.547 2.962 4.982 1.879 0.379 3.88 0 4.762 0.128 0.783 0.11 1.971-0.153 1.971 2.313-0.221 4.321-9.633 1.903-9.737 1.812-0.722-0.624-4.969-3.042-5.134-7.631-0.178-4.847 2.099-8.507 6.236-10.576 1.041-0.52 2.956-0.783 4.254-0.838 3.524 0.171 6.021 0.63 8.604 2.02 0.483 0.263 0.979 0.477 1.512 0.838 0.165 0.11 0.802 0.557 0.899 0.618 3.023 2.601 4.284 6.035 4.884 9.499 0.238 1.377 0.232 2.662 0.275 3.678 0.08 1.738-0.122 3.843-1.01 5.82-0.942 2.112-2.638 4.082-5 5.318-2.295 1.2-5.643 3.103-10.264 3.672-2.784 0.342-6.021 0.287-9.773-0.924-10.643-3.439-11.646-15.514-11.646-15.514s-2.173-8.898 3.69-16.916c0.618-0.844 1.322-1.928 2.129-2.735 2.644-2.644 5.012-4.015 7.185-5.166 3.99-2.111 6.916-2.595 7.779-2.595 0.618 0 2.093-0.085 3.824 0.043 1.983 0.141 4.309 0.526 6.065 0.955 1.928 0.471 3.537 0.851 4.792 1.383 1.188 0.508 2.038 1.175 2.968 1.744 1.922 1.169 4.982 3.488 6.017 5.055 1.07 1.628 2.589 3.715 3.77 7.387 0.691 2.154 1.273 5.232 1.983 8.703 1.064 5.196 0.679 10.447-0.502 13.764-0.129 0.355-1.451 4.566-5.637 8.513-4.187 3.954-9.455 6.193-11.016 6.817-1.567 0.625-3.795 2.521-12.332 2.381-7.387-0.123-12.987-2.081-14.651-2.754-1.665-0.673-6.059-2.068-10.833-7.319-4.773-5.257-5.814-8.648-6.573-10.949s-2.191-8.195-2.191-8.195 0.171-0.024-0.171-3.066c-0.129-1.359-0.111-3.133 0.159-4.908zm73.825 59.388c-0.465 0.386-0.937 0.673-1.236 0.857-0.637 0.134-1.021 0.281-1.426 0.312-0.404 0.037-0.783 0.049-1.15 0.049-1.212 0-2.1-0.367-2.791-0.686-0.691-0.318-1.261-0.875-1.622-1.523-0.36-0.649-0.44-1.243-0.471-2.008-0.019-0.446 0.11-0.905 0.22-1.279 0.104-0.379 0.251-0.716 0.447-1.022 0.189-0.306 0.33-0.539 0.691-0.851 0.361-0.306 0.575-0.478 0.979-0.673 0.403-0.202 0.777-0.288 1.315-0.483 0.539-0.196 1.524-0.263 2.785-0.441 0.385-0.098 0.71-0.073 0.979-0.177 0.27-0.104 0.509-0.208 0.717-0.306s0.385-0.214 0.538-0.349 0.294-0.3 0.416-0.49c0.129-0.196 0.215-0.141 0.27-0.336 0.055-0.196 0.024-0.294 0.019-0.496-0.019-0.489-0.043-0.765-0.337-1.107s-0.637-0.833-1.102-0.967c-0.459-0.141-1.23-0.361-1.849-0.361-0.575 0-1.046 0.073-1.646 0.178-0.6 0.104-1.114 0.232-1.549 0.373-0.429 0.147-0.918 0.361-1.561 0.649 0.062-0.435 0.013-1.065 0.062-1.922 1.053-0.306 1.609-0.453 2.387-0.563s1.928-0.178 2.674-0.178c0.796 0 1.292 0.171 1.995 0.337 0.698 0.165 1.586 0.777 1.91 1.261 0.336 0.496 0.648 0.856 0.819 1.334 0.172 0.478 0.404 1.42 0.429 1.958 0.024 0.679 0.062 0.239 0.037 1.842-0.024 1.609 0.073 4.547 0.061 5.912-6e-3 0.833 0.099 0.912 0.318 2.038-0.483-0.019-1.102 0.024-1.401 0.024-0.287 0-0.71-0.043-1.236-0.024v-1.53c7e-3 6e-3 -0.226 0.263-0.691 0.648zm-19.155-3.378c0.336 0.838 0.899 1.659 1.683 2.118s1.701 0.906 2.662 0.906c0.931 0 2.889-0.098 5.013-1.224-0.013 0.159-0.098 0.514-0.153 0.942-0.055 0.435-0.178 0.796-0.214 1.212-0.637 0.166-1.31 0.349-1.903 0.41-0.588 0.061-2.197 0.165-2.644 0.165-0.949 0-2.051-0.196-2.864-0.483-0.814-0.288-1.83-0.832-2.448-1.487-0.624-0.655-1.328-1.31-1.646-2.283s-0.545-1.909-0.581-2.993c-0.056-1.457 0.177-1.946 0.587-3.25 0.404-1.31 1.438-2.252 2.394-2.993 0.954-0.741 3.164-1.371 4.859-1.371 1.248 0 2.711 0.208 3.91 0.575 0.086 0.851 0.116 1.31 0.178 1.861-0.845-0.3-1.616-0.649-2.148-0.753s-1.199-0.202-1.652-0.202c-0.771 0-2.411 0.343-3.011 0.655-0.6 0.318-1.102 0.765-1.512 1.353-0.41 0.581-0.734 1.395-0.894 2.197s-0.221 0.869-0.189 1.702c0.04 1.125 0.23 2.104 0.573 2.943zm-6.898-5.263c-0.019-0.575-0.189-1.224-0.306-1.548-0.116-0.324-0.704-0.924-0.949-1.187-0.244-0.263-0.611-0.312-0.961-0.447-0.349-0.135-0.911-0.166-1.353-0.166-0.354 0-0.802 0.062-1.095 0.147-0.275 0.086-0.551 0.147-0.809 0.331-0.281 0.189-0.532 0.3-0.752 0.575-0.221 0.27-0.398 0.575-0.545 0.912-0.153 0.349-0.159 0.869-0.189 1.432-0.037 0.606 0.03 1.383 0.012 2.252-0.024 0.918-0.024 4.56 0 6.065l0.422 1.346c-0.514-0.018-1.272-0.03-1.529-0.03-0.239 0-0.894 6e-3 -1.457 0.03 0.043-1.224 0.19-0.11 0.196-1.407l0.024-5.594c0-1.108-0.013-2.057-0.043-2.833-0.019-0.508-0.079-0.686-0.184-1.041-0.098-0.355-0.275-0.802-0.532-1.096-0.251-0.293-0.808-0.765-1.15-0.918-0.35-0.153-0.839-0.269-1.268-0.269-0.452 0-0.746 0.049-1.138 0.22s-0.734 0.251-1.059 0.594c-0.318 0.336-0.588 0.373-0.796 0.869-0.208 0.489-0.367 0.385-0.459 1.181-0.098 0.795-0.141 3.69-0.135 5.667 6e-3 1.169 0.019 2.228 0.037 3.183 0.012 0.654 0.281 0.887 0.306 1.444-0.569-0.018-1.212-0.03-1.42-0.03-0.232 0-1.01 6e-3 -1.585 0.03l0.318-1.028c0.012-0.453 0.019-1.922 0.024-2.901l-0.147-8.292c-0.018-0.741-0.416-1.628-0.435-2.014 0.41 0.012 1.335-0.135 1.763-0.294 0.343-0.128 0.729-0.128 1.09-0.141l-6e-3 1.928c0.275-0.557 0.776-0.612 1.01-0.942 0.232-0.324 0.471-0.312 0.856-0.587s0.624-0.288 1.139-0.361c0.63-0.092 1.027-0.123 1.572-0.123 0.38 0 0.753 0.049 1.126 0.147 0.374 0.098 0.717 0.239 1.041 0.417 0.318 0.177 0.594 0.379 0.826 0.605 0.232 0.227 0.483 0.349 0.691 0.741 0.073 0.128 0.637-0.624 1.426-1.083 0.79-0.453 1.72-0.802 2.711-0.802 0.637 0 2.057 0.085 2.662 0.312 0.606 0.227 1.463 0.557 1.836 0.979 0.367 0.429 0.478 0.618 0.809 0.967 0.41 0.435 0.538 1.53 0.562 1.995 0.019 0.477 0.067 1.199 0.067 2.16l6e-3 6.818c0 0.655 0.19 0.734 0.312 1.481-0.471-0.019-1.083-0.031-1.353-0.031-0.281 0-0.955 6e-3 -1.506 0.031 0.367-1.169 0.294-0.771 0.325-1.487l0.024-6.181c-2e-3 -0.87-7e-3 -1.384-0.032-2.026zm-24.217 8.831c-0.459 0.386-0.937 0.667-1.23 0.857-0.637 0.135-1.016 0.282-1.42 0.312-0.404 0.031-0.79 0.049-1.151 0.049-1.206 0-2.093-0.367-2.784-0.686-0.692-0.318-1.255-0.875-1.616-1.524-0.361-0.648-0.441-1.242-0.471-2.007-0.019-0.447 0.116-0.906 0.22-1.279 0.104-0.374 0.251-0.716 0.44-1.022 0.19-0.306 0.331-0.539 0.692-0.844 0.361-0.306 0.575-0.478 0.979-0.673s0.771-0.288 1.31-0.483c0.539-0.19 1.524-0.263 2.778-0.441 0.38-0.098 0.71-0.073 0.979-0.177s0.508-0.208 0.716-0.306 0.386-0.214 0.539-0.349 0.294-0.3 0.417-0.49c0.128-0.196 0.214-0.263 0.269-0.459s0.024-0.294 0.019-0.496c-0.019-0.49-0.043-0.637-0.337-0.985-0.293-0.349-0.636-0.833-1.095-0.967s-1.224-0.361-1.842-0.361c-0.575 0-1.046 0.074-1.646 0.177-0.6 0.104-1.114 0.233-1.548 0.374-0.429 0.147-0.918 0.361-1.561 0.649 0.062-0.441 0.012-1.065 0.062-1.928 1.046-0.3 1.604-0.453 2.38-0.563 0.777-0.11 1.928-0.177 2.668-0.177 0.795 0 1.292 0.171 1.989 0.336 0.704 0.166 1.579 0.777 1.904 1.261 0.336 0.496 0.648 0.851 0.82 1.328 0.165 0.478 0.404 1.42 0.428 1.958 0.025 0.686 0.062 0.239 0.037 1.842-0.025 1.609 0.073 4.547 0.061 5.912-6e-3 0.826 0.098 0.912 0.318 2.038-0.478-0.019-1.096 0.024-1.402 0.024-0.281 0-0.709-0.043-1.236-0.024v-1.53c6e-3 0.011-0.227 0.268-0.686 0.654zm-19.975-3.109c0.422 0.875 0.991 1.438 1.769 1.891 0.777 0.447 1.805 0.839 2.791 0.839 1.139 0 3.213-0.478 4.915-1.328-0.085 0.539-0.263 1.242-0.336 2.075-0.838 0.238-2.222 0.771-2.84 0.856-0.618 0.086-1.23 0.104-1.848 0.104-1.102 0-2.197-0.275-3.084-0.569-0.888-0.3-1.775-0.912-2.424-1.652-0.655-0.735-1.297-1.536-1.603-2.491-0.312-0.948-0.386-1.909-0.429-2.968-0.055-1.475 0.184-2.025 0.637-3.286s1.401-2.179 2.387-2.901c0.979-0.722 2.246-1.083 3.794-1.083 0.802 0 1.713 0.062 2.454 0.325 0.74 0.263 1.365 0.539 1.867 1.071 0.508 0.539 0.93 1.071 1.224 1.86 0.294 0.79 0.361 0.802 0.526 1.72 0.074 0.429 0.129 1.102 0.092 1.438l-10.49 0.061c-0.012 0.545-0.049 0.814-0.037 1.096 0.029 1.045 0.212 2.067 0.635 2.942zm-11.12-10.288c0.318-0.067 1.102-0.177 1.518-0.189l6e-3 2.644c0.3-0.612 0.318-0.575 0.563-0.881 0.239-0.312 0.624-0.667 0.93-0.869 0.312-0.202 0.649-0.49 1.046-0.606 0.392-0.117 0.753-0.282 1.188-0.3 0.343-0.012 0.667-0.061 1.548 0.031 0.887 0.092 1.353 0.294 1.548 0.349 0.019 0.355-0.649 1.989-0.649 1.989s-0.636-0.055-1.211-0.293c-0.551-0.166-0.924-0.166-1.359-0.166-0.514 0-1.12 0.116-1.524 0.312-0.404 0.19-0.79 0.422-1.102 0.814s-0.52 0.796-0.71 1.34c-0.159 0.441-0.104 0.073-0.165 0.765-0.067 0.691-6e-3 7.326 0.049 8.819l0.263 0.857c-0.483-0.019-1.169 0-1.462 0-0.27 0-0.924 0.012-1.469 0.03 0-0.281 0.282-0.673 0.288-0.942 0.067-4.633-0.03-8.213-0.141-11.206l-0.049-1.261-0.44-1.071c0.446-0.05 1.052-0.111 1.334-0.166zm-18.654-6.224c0.533 0 1.322 0.086 2.436 0.062 1.114-0.025 2.105 0 2.546 0.042 1.585 0.147 1.989 0.233 3.078 0.502 0.826 0.196 2.393 1.034 3.091 1.53 0.704 0.496 1.401 1.064 1.97 1.866 0.563 0.802 0.845 1.059 1.224 1.989 0.508 1.261 0.802 2.625 0.851 3.892 0.067 1.732-0.116 3.06-0.618 4.651-0.496 1.591-1.603 2.772-2.668 3.837s-2.234 1.708-3.593 2.044c-1.365 0.336-2.901 0.667-4.596 0.667l-3.991-0.03-3.8-0.092 0.539-1.42-0.043-17.528c-0.012-0.508-0.251-1.034-0.501-1.922 1.198 0.027 3.224-0.09 4.075-0.09zm-17.797 168.64v-128.02c0-2.846 2.313-5.159 5.159-5.159h144.32c2.846 0 5.159 2.313 5.159 5.159v128.02c0 2.846-2.313 5.159-5.159 5.159h-144.32c-2.846 1e-3 -5.159-2.312-5.159-5.158z" fill="#1a1a1a"/>\n     <ellipse cx="444.94" cy="246.54" rx="25.204" ry="25.115" fill="#fff"/>\n     <path d="m445.3 265.55c10.422 0 18.904-8.482 18.904-18.905s-8.482-18.911-18.904-18.911c-10.429 0-18.911 8.482-18.911 18.911s8.482 18.905 18.911 18.905z" fill="#1a1a1a"/>\n     <ellipse cx="492.88" cy="293.45" rx="25.204" ry="25.115" fill="#fff"/>\n     <path d="m492.9 274.71c-10.429 0-18.911 8.482-18.911 18.911 0 10.428 8.482 18.905 18.911 18.905 10.422 0 18.904-8.482 18.904-18.905s-8.482-18.911-18.904-18.911z" fill="#1a1a1a"/>\n     <ellipse cx="541.23" cy="247.25" rx="25.204" ry="25.115" fill="#fff"/>\n     <circle cx="541.11" cy="247.25" r="18.911" fill="#1a1a1a"/>\n     <path d="m78.855 232.89c21.53 0 39.045-17.515 39.045-39.045s-17.515-39.045-39.045-39.045-39.046 17.515-39.046 39.045 17.522 39.045 39.046 39.045z" fill="#1a1a1a"/>\n     <polygon transform="translate(6.8088,8.7805)" points="124.82 279.67 103.48 279.67 103.48 310.78 72.364 310.78 72.364 332.13 103.48 332.13 103.48 363.25 124.82 363.25 124.82 332.13 155.94 332.13 155.94 310.78 124.82 310.78" fill="#1a1a1a"/>\n     <polygon transform="translate(6.8088,8.7805)" points="318.12 444.41 293.78 403.06 269.44 444.41" fill="#1a1a1a"/>\n     <polygon transform="translate(6.8088,8.7805)" points="124.82 332.13 155.94 332.13 155.94 310.78 124.82 310.78 124.82 279.67 103.48 279.67 103.48 310.78 72.364 310.78 72.364 332.13 103.48 332.13 103.48 363.25 124.82 363.25" fill="#1a1a1a"/>\n     <ellipse cx="409.18" cy="244.08" rx="25.204" ry="25.115" fill="#fff"/>\n    </g>\n   </g>\n   <path d="m444.19 415.9c23.103 0 41.897-18.795 41.897-41.897s-18.794-41.897-41.897-41.897c-23.103 0-41.898 18.795-41.898 41.897s18.802 41.897 41.898 41.897z" stroke-width=".86172"/>\n   <path d="m444.19 412.57c21.38 0 38.773-17.297 38.773-38.56 0-21.263-17.393-38.56-38.773-38.56-21.38 0-38.775 17.297-38.775 38.56 0 21.263 17.4 38.56 38.775 38.56z" fill="#ececec" stroke-width=".86172"/>\n   <path d="m444.19 407.65c18.553 0 33.646-15.093 33.646-33.646 0-18.553-15.093-33.646-33.646-33.646-18.553 0-33.647 15.093-33.647 33.646 0 18.553 15.099 33.646 33.647 33.646z" fill="#333" stroke="#000" stroke-width="2.9069" data-button="button-11"/>\n   <path d="m78.499 243.34c26.81 0 48.62-21.811 48.62-48.621s-21.81-48.621-48.62-48.621-48.622 21.811-48.622 48.621 21.819 48.621 48.622 48.621z"/>\n   <path d="m78.499 239.47c24.811 0 44.995-20.073 44.995-44.748s-20.184-44.748-44.995-44.748-44.997 20.073-44.997 44.748 20.192 44.748 44.997 44.748z" fill="#ececec"/>\n   <path d="m78.499 233.76c21.53 0 39.045-17.515 39.045-39.045s-17.515-39.045-39.045-39.045-39.046 17.515-39.046 39.045 17.522 39.045 39.046 39.045z" fill="#333" stroke="#000" stroke-width="2.9069" data-button="button-10"/>\n   <path d="m491.78 320.33c14.996 0 27.196-12.2 27.196-27.196s-12.199-27.196-27.196-27.196c-14.996 0-27.197 12.2-27.197 27.196s12.204 27.196 27.197 27.196z"/>\n   <path d="m491.78 317.32c13.408 0 24.317-10.848 24.317-24.183s-10.908-24.183-24.317-24.183c-13.409 0-24.317 10.848-24.317 24.183s10.912 24.183 24.317 24.183z" fill="#ececec"/>\n   <path d="m491.78 314.23c11.635 0 21.101-9.4653 21.101-21.101 0-11.635-9.4653-21.101-21.101-21.101-11.635 0-21.101 9.4653-21.101 21.101 0 11.635 9.4692 21.101 21.101 21.101z" fill="#a02c2c" data-button="button-0"/>\n   <path d="m539.97 273.92c14.738 0 26.727-11.99 26.727-26.728s-11.989-26.728-26.727-26.728c-14.738 0-26.728 11.99-26.728 26.728s11.994 26.728 26.728 26.728z"/>\n   <path d="m539.97 270.95c13.177 0 23.898-10.661 23.898-23.767 0-13.105-10.72-23.767-23.898-23.767s-23.899 10.661-23.899 23.767c0 13.105 10.724 23.767 23.899 23.767z" fill="#ececec"/>\n   <path d="m539.97 267.92c11.435 0 20.738-9.3024 20.738-20.738 0-11.435-9.3024-20.738-20.738-20.738-11.435 0-20.738 9.3024-20.738 20.738 0 11.435 9.3062 20.738 20.738 20.738z" fill="#06f" data-button="button-1"/>\n   <path d="m493.22 227.32c14.738 0 26.727-11.99 26.727-26.728s-11.989-26.728-26.727-26.728c-14.738 0-26.728 11.99-26.728 26.728s11.994 26.728 26.728 26.728z"/>\n   <path d="m493.22 224.36c13.177 0 23.898-10.661 23.898-23.767 0-13.105-10.72-23.767-23.898-23.767s-23.899 10.661-23.899 23.767c0 13.105 10.724 23.767 23.899 23.767z" fill="#ececec"/>\n   <path d="m493.22 221.33c11.435 0 20.738-9.3024 20.738-20.738 0-11.435-9.3024-20.738-20.738-20.738-11.435 0-20.738 9.3024-20.738 20.738 0 11.435 9.3062 20.738 20.738 20.738z" fill="#1ccb1c" data-button="button-3"/>\n   <path d="m444.79 268.33c14.738 0 26.727-11.99 26.727-26.728s-11.989-26.728-26.727-26.728c-14.738 0-26.728 11.99-26.728 26.728s11.994 26.728 26.728 26.728z"/>\n   <path d="m444.79 265.37c13.177 0 23.898-10.661 23.898-23.767 0-13.105-10.72-23.767-23.898-23.767s-23.899 10.661-23.899 23.767c0 13.105 10.724 23.767 23.899 23.767z" fill="#fff"/>\n   <path d="m444.79 262.34c11.435 0 20.738-9.3024 20.738-20.738 0-11.435-9.3024-20.738-20.738-20.738-11.435 0-20.738 9.3024-20.738 20.738 0 11.435 9.3062 20.738 20.738 20.738z" fill="#fa9900" data-button="button-2"/>\n   <polygon transform="matrix(1.7101,0,0,1.7148,-202.93,-294.51)" points="269.44 444.41 318.12 444.41 293.78 403.06" fill="#fff" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.0439"/>\n   <g transform="matrix(1.2116 0 0 1.2405 -56.477 -89.866)" fill="#333" stroke="#000" stroke-width="2.3711">\n    <polygon points="269.44 444.41 318.12 444.41 293.78 403.06" fill="#333" stroke="#000" stroke-width="2.3711" data-button="button-9"/>\n   </g>\n   <text x="484.67032" y="210.79993" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8197" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="484.67032" y="210.79993" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="28px" stroke-width="1.8197" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">Y</tspan></text>\n   <text x="435.22971" y="251.80605" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8197" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="435.22971" y="251.80605" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="28px" stroke-width="1.8197" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">X</tspan></text>\n   <text x="531.4353" y="257.39502" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8197" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="531.4353" y="257.39502" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="28px" stroke-width="1.8197" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">B</tspan></text>\n   <text x="482.2132" y="303.34509" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8197" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="482.2132" y="303.34509" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="28px" stroke-width="1.8197" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">A</tspan></text>\n   <path d="m173.25 347.86v-35.975h-35.335v-35.719h-36.421v35.719h-35.602v35.975h35.602v35.944h36.421v-35.944z" fill="#fff" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6.6" stroke-width="3.1826"/>\n   <g fill="#333" stroke="#000" stroke-width="2.0348" data-button="dpad-0">\n    <polygon transform="matrix(1.1296 0 0 1.1296 -9.6574 -33.438)" points="103.48 363.25 124.82 363.25 124.82 332.13 155.94 332.13 155.94 310.78 124.82 310.78 124.82 279.67 103.48 279.67 103.48 310.78 72.364 310.78 72.364 332.13 103.48 332.13" fill="#333" stroke="#000" stroke-width="1.8014"/>\n   </g>\n   <path d="m246.43 423.18c9.522 0 17.268-7.7465 17.268-17.268 0-9.522-7.7461-17.268-17.268-17.268-9.522 0-17.269 7.7465-17.269 17.268 0 9.522 7.7493 17.268 17.269 17.268z" stroke-width=".63497"/>\n   <path d="m246.43 420.5c8.0934 0 14.678-6.5481 14.678-14.597 0-8.0492-6.5842-14.597-14.678-14.597-8.0937 0-14.678 6.5481-14.678 14.597 0 8.0492 6.5869 14.597 14.678 14.597z" fill="#ececec" stroke-width=".60362"/>\n   <path d="m246.43 418.33c6.8504 0 12.424-5.5729 12.424-12.424 0-6.8504-5.5729-12.424-12.424-12.424-6.8504 0-12.424 5.5729-12.424 12.424 0 6.8504 5.5752 12.424 12.424 12.424z" fill="#333" stroke="#000" stroke-width="1.4535" data-button="button-8"/>\n   <path d="m352.5 423.18c9.522 0 17.268-7.7465 17.268-17.268 0-9.522-7.7461-17.268-17.268-17.268-9.522 0-17.269 7.7465-17.269 17.268 0 9.522 7.7493 17.268 17.269 17.268z" stroke-width=".63497"/>\n   <path d="m352.5 420.5c8.0934 0 14.678-6.5481 14.678-14.597 0-8.0492-6.5842-14.597-14.678-14.597-8.0937 0-14.678 6.5481-14.678 14.597 0 8.0492 6.5869 14.597 14.678 14.597z" fill="#ececec" stroke-width=".60362"/>\n   <path d="m352.5 418.33c6.8504 0 12.424-5.5729 12.424-12.424 0-6.8504-5.5729-12.424-12.424-12.424-6.8504 0-12.424 5.5729-12.424 12.424 0 6.8504 5.5752 12.424 12.424 12.424z" fill="#333" stroke="#000" stroke-width="1.4535" data-button="button-16"/>\n   <text x="281.13306" y="481.78577" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8191" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="281.13306" y="481.78577" fill="#000000" font-family="sans-serif" font-size="11.628px" stroke-width="1.8191" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">START</tspan></text>\n   <text x="224.14134" y="384.38974" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8191" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="224.14134" y="384.38974" fill="#000000" font-family="sans-serif" font-size="11.628px" stroke-width="1.8191" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">SELECT</tspan></text>\n   <text x="334.6618" y="384.38974" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="1.8191" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="334.6618" y="384.38974" fill="#000000" font-family="sans-serif" font-size="11.628px" stroke-width="1.8191" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">HOME</tspan></text>\n  </g>\n </g>\n <g transform="translate(-260.34 -473.69)">\n  <g cv-if = "a">\n  \t<path d="m591.98 611.79 68.946 20.079" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <g cv-if = "x">\n  \t<path d="m576.4 592.1 84.526 24.701" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <g cv-if = "y">\n  \t<path d="m595.33 575.12 65.6 18.183" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <g cv-if = "b">\n  \t<path d="m609.93 591.65 50.998 15.219" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="662.21619" y="608.90283" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="662.21619" y="608.90283" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[b]]</tspan></text>\n  <text x="662.5141" y="634.3454" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="662.5141" y="634.3454" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[a]]</tspan></text>\n  <text x="662.27887" y="619.60553" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="662.27887" y="619.60553" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[x]]</tspan></text>\n  <text x="661.63348" y="595.76831" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="661.63348" y="595.76831" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[y]]</tspan></text>\n  <g cv-if = "r1">\n  \t<path d="m605.15 544.5 53.163 13.403" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="659.01825" y="560.35986" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="659.01825" y="560.35986" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[r1]]</tspan></text>\n  <g cv-if = "ra">\n  <path d="m582.92 636.21 78.008 22.519" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="664.28082" y="661.3197" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="664.28082" y="661.3197" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[ra]]</tspan></text>\n  <g cv-if = "l1">\n  \t<path d="m426.92 544.08-53.163 13.403" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="347.5455" y="559.51819" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="347.5455" y="559.51819" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[l1]]</tspan></text>\n  <g cv-if = "dpad">\n\t<path d="m438.09 626.74-67.043 18.472" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="352.86777" y="647.30273" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="352.86777" y="647.30273" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[dpad]]</tspan></text>\n  <g cv-if = "start">\n  \t<path d="m507.06 652.49-115.69 44.146" fill="none" stroke="#000" stroke-width=".5"/>\n  </g>\n  <text x="371.43689" y="698.36121" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="371.43689" y="698.36121" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[start]]</tspan></text>\n </g>\n</svg>\n'}),require.register("controller/gamepad-config.html",function(t,e,s){s.exports='<div class = "gamepad-config [[animation]] input-[[type]]">\n\t<span>[[text]]</span>\n\t<div>[[caption]]</div>\n\t\x3c!-- <div class = "buttons">\n\t\t<button cv-on = "click:swap">next</button>\n\t\t<button cv-on = "click:exit">exit</button>\n\t</div> --\x3e\n</div>\n'}),require.register("controller/gc-input.svg",function(t,e,s){s.exports='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="512" height="288" version="1.0" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-260.34 -473.69)"><g transform="translate(134.82 68.294)"><g transform="matrix(.06485 0 0 .06485 172.41 452.75)" stroke-width="15.42"><g stroke-width="15.42" data-button="button-6"><g id="Shape_13_copy_1_" enable-background="new    " fill="#2d1650"><g id="Shape_13_copy" fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><ellipse cx="2016" cy="596" rx="394.32" ry="416.56" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_13_1_" enable-background="new    "><g stroke-width="15.42"><g stroke-width="15.42"><ellipse cx="2016" cy="600" rx="381.55" ry="410.27" fill="#eee" stroke-width="207.68"/></g></g></g></g><g stroke-width="15.42" data-button="button-7"><g id="Shape_13_copy_2_1_" enable-background="new    " fill="#2d1650"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><ellipse cx="4444" cy="597" rx="394.32" ry="416.56" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_13_copy_3_1_" enable-background="new    "><g stroke-width="15.42"><g stroke-width="15.42"><ellipse cx="4444" cy="601" rx="381.55" ry="410.27" fill="#eee" stroke-width="207.68"/></g></g></g></g><text transform="matrix(.68482 0 0 .68587 845.52 -545.07)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="22.5" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-2);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="22.5">R</tspan></tspan></text><g stroke-width="15.42" data-button="button-5"><g id="Shape_14_copy_1_" transform="translate(63.785 -10.951)" enable-background="new    "><g id="Shape_14_copy" stroke-width="15.42"><g stroke-width="15.42"><path d="m4875.8 533.15c-9.153-20.295-141.3-109.76-312.96-156.14-171.66-46.381-446.05-75.91-470.47-66.579-24.426 9.331-20.68 96.067-20.68 96.067l755.06 236.36c0 1e-3 58.209-89.412 49.057-109.71z" fill="#490094" stroke-width="207.68"/></g></g></g><g id="Shape_14_1_" transform="translate(63.785 -10.951)" enable-background="new    "><g stroke-width="15.42"><g stroke-width="15.42"><path d="m4862.8 543.29c-8.855-19.636-136.71-106.2-302.8-151.08s-431.57-73.446-455.2-64.418-20.008 92.95-20.008 92.95l730.55 228.69s56.319-86.51 47.464-106.15z" fill="#5600ae" stroke-width="207.68"/></g></g></g></g><g stroke-width="15.42" data-button="button-4"><g transform="matrix(-1 0 0 1 6378.1 -10.674)" enable-background="new    "><g stroke-width="15.42"><g stroke-width="15.42"><path d="m4875.8 533.15c-9.153-20.295-141.3-109.76-312.96-156.14-171.66-46.381-446.05-75.91-470.47-66.579-24.426 9.331-20.68 96.067-20.68 96.067l755.06 236.36c0 1e-3 58.209-89.412 49.057-109.71z" fill="#490094" stroke-width="207.68"/></g></g></g><g transform="matrix(-1 0 0 1 6378.1 -10.674)" enable-background="new    "><g stroke-width="15.42"><g stroke-width="15.42"><path d="m4862.8 543.29c-8.855-19.636-136.71-106.2-302.8-151.08s-431.57-73.446-455.2-64.418-20.008 92.95-20.008 92.95l730.55 228.69s56.319-86.51 47.464-106.15z" fill="#5600ae" stroke-width="207.68"/></g></g></g></g><g id="Shape_15_copy_2_1_" enable-background="new    " stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><path d="m3227.9 120.17c-783.43 0-1504.4 382.76-1504.4 382.76l447.27 1463.6s200.02-494.06 1045-494.06c807.36 0 1061.2 473.81 1061.2 473.81l423.57-1451.3s-688.92-374.76-1472.6-374.76z" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_15_copy_3_1_" enable-background="new    " fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><path d="m3228 136c-767.99 0-1504 388-1504 388l460 1390s194.99-457.37 1044-457.37c779.87 0 1036 437.37 1036 437.37l436-1378s-719.98-380-1472-380z" fill="#442178" stroke-width="15.42"/></g></g></g><text transform="matrix(.49661 0 0 .49737 -1067.6 -73.788)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="31.027" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-2-3-7);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="31.027">ZL</tspan></tspan></text><g id="Shape_12_1_" enable-background="new    " fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><path d="m1376.2 941.81c-30.5 123.8-80.063 786.99-61.001 1136.3 19.063 349.28 53.376 702.99 282.13 725.09s244-265.28 270.69-371.39c26.688-106.11 163.94-711.83 163.94-711.83s-625.25-901.94-655.75-778.15z" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_5_1_" enable-background="new    " fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><path d="m1387.9 966.73c-28.94 121.04-75.969 769.48-57.881 1111s50.646 687.34 267.7 708.96c217.06 21.614 231.52-259.38 256.85-363.12 25.322-103.75 155.56-695.99 155.56-695.99s-593.28-881.87-622.22-760.83z" fill="#442178" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_6_1_" enable-background="new    " fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><path d="m5071.2 945.81c-31.246-123.8-671.8 778.15-671.8 778.15s140.61 605.72 167.95 711.83c27.34 106.11 42.963 393.5 277.31 371.39s269.5-375.81 289.03-725.09-31.246-1012.5-62.493-1136.3z" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_7_1_" enable-background="new    " fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><path d="m5059.2 970.73c-29.648-121.04-637.45 760.83-637.45 760.83s133.42 592.24 159.36 695.99c25.942 103.75 40.768 384.74 263.13 363.12 222.36-21.615 255.72-367.45 274.25-708.96 18.531-341.51-29.649-989.94-59.297-1111z" fill="#442178" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_3_1_" enable-background="new    " fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><path d="m3049.2 1753.4c-122.76-188.31-176.88-182.53-252.72-305.76-97.796-158.92 14.472-476-199.59-766.22-174.59-236.7-591.61-384.65-941.21-138.62-373.08 262.56-355.83 699.77-175.22 973.89 189.64 287.82 445.08 264.06 582.85 407.41 85.999 89.487 101.86 265.09 203.89 370.36 143.79 148.36 380.24 225.33 639.15 61.496 215.72-136.5 255.61-429.57 142.84-602.55z" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_1_" enable-background="new    " fill="#442178" stroke-width="15.42"><g id="Shape_12_copy" fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><path d="m3044 1772c-111.08-187.17-185.56-195.03-260-316-96-156-1.5-502.6-192-760-171.76-232.08-571.05-373.11-920-140-362.3 242.03-364 668-172 956 188.32 282.48 434.64 257.5 568 400 108.42 115.84 111.85 264.14 196 356 154.8 168.97 400.25 242.11 644 68 224-160 208.51-441.82 136-564z" fill="#442178" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_4_1_" enable-background="new    " fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><path d="m4789.3 542.8c-349.6-246.03-766.62-98.079-941.21 138.62-214.06 290.21-101.8 607.3-199.59 766.22-75.836 123.24-129.96 117.45-252.72 305.76-112.77 172.98-72.872 466.05 142.84 602.55 258.9 163.84 495.36 86.859 639.15-61.496 102.03-105.28 117.89-280.87 203.89-370.36 137.77-143.35 393.21-119.59 582.85-407.41 180.61-274.12 197.86-711.33-175.22-973.89z" fill="#2d1650" stroke-width="15.42"/></g></g></g><g id="Shape_12_copy_2_1_" enable-background="new    " fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><path d="m4773 556c-348.95-233.11-748.24-92.075-920 140-190.5 257.4-96 604-192 760-74.444 120.97-148.92 128.83-260 316-72.508 122.18-88 404 136 564 243.75 174.11 489.2 100.97 644-68 84.154-91.858 87.58-240.16 196-356 133.36-142.5 379.68-117.52 568-400 192-288 190.3-713.97-172-956z" fill="#442178" stroke-width="15.42"/></g></g></g><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><ellipse cx="2064" cy="1112" rx="475.27" ry="470.42" fill="#2d1650" stroke-width="15.42"/></g></g><g id="Shape_2_copy" fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><ellipse cx="2064" cy="1112" rx="463.16" ry="458.44" fill="#442178" stroke-width="15.42"/></g></g><g stroke-width="15.42"><g stroke-width="15.42"><path d="m2277.5 911.54c-16.518-16.517-171.99-88.264-210.78-88.264-38.798 0-189.87 67.706-210.24 88.074-21.36 21.361-87.389 180.22-88.395 211.24-0.982 30.301 63.237 186.73 87.045 210.53 26.177 26.177 171.71 85.496 210.51 86.467 38.797 0.97 184.9-64.136 209.77-86.1 25.23-22.284 89.316-181.15 89.316-211.28-1e-3 -30.067-68.831-192.28-87.223-210.68z" stroke-width="15.42"/></g></g><g stroke-width="15.42"><g stroke-width="15.42"><path d="m2271 917.95c-16.014-16.014-166.74-85.57-204.35-85.57s-184.07 65.64-203.82 85.386c-20.709 20.709-84.722 174.72-85.696 204.8-0.952 29.376 61.307 181.03 84.389 204.11 25.377 25.377 166.47 82.886 204.08 83.827 37.613 0.939 179.26-62.179 203.36-83.472 24.46-21.604 86.591-175.62 86.591-204.83 0-29.15-66.729-186.42-84.561-204.25z" fill="#d1d1d1" stroke-width="207.68"/></g></g><g stroke-width="15.42" data-button="button-10"><g><g stroke-width="15.42"><ellipse cx="2065.6" cy="1124.9" rx="248.44" ry="238.77" stroke-width="15.42"/></g></g><g id="Shape_1_copy"><g stroke-width="15.42"><ellipse cx="2065.6" cy="1124.9" rx="234.29" ry="225.17" fill="#eee" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2064.1" cy="1125.8" rx="211.47" ry="199.69" fill="#acacac" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2064.1" cy="1125.8" rx="199.43" ry="188.32" fill="#eee" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2063.9" cy="1131.1" rx="135.66" ry="128.1" fill="#acacac" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2063.9" cy="1131.1" rx="123.95" ry="117.04" fill="#eee" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2066" cy="1131" rx="53.975" ry="50.966" fill="#acacac" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><ellipse cx="2066" cy="1131" rx="42.118" ry="39.771" fill="#eee" stroke-width="207.68"/></g></g></g><g stroke-width="15.42"><g stroke-width="15.42"><path d="m4035.5 1760.5c-16.518-16.517-171.99-88.264-210.78-88.264-38.798 0-189.87 67.706-210.24 88.074-21.361 21.361-87.389 180.22-88.395 211.24-0.982 30.301 63.237 186.73 87.045 210.53 26.177 26.177 171.71 85.496 210.51 86.466 38.798 0.971 184.9-64.135 209.77-86.099 25.229-22.284 89.316-181.15 89.316-211.28 0-30.067-68.831-192.28-87.223-210.68z" stroke-width="15.42"/></g></g><g stroke-width="15.42"><g stroke-width="15.42"><path d="m4029 1767c-16.014-16.014-166.74-85.57-204.35-85.57s-184.07 65.64-203.82 85.386c-20.709 20.709-84.722 174.72-85.696 204.8-0.952 29.376 61.307 181.03 84.389 204.11 25.377 25.377 166.47 82.886 204.08 83.827 37.613 0.939 179.26-62.179 203.36-83.472 24.46-21.604 86.591-175.62 86.591-204.83 0-29.15-66.729-186.42-84.561-204.25z" fill="#ffe400" stroke-width="207.68"/></g></g><g data-button="button-11"><g stroke-width="15.42"><g stroke-width="15.42"><circle cx="3824" cy="1976" r="144" fill="#5f5500" stroke-width="207.68"/></g></g><g id="Shape_9_copy" stroke-width="15.42"><g stroke-width="15.42"><circle cx="3824" cy="1976" r="128" fill="#ffe400" stroke-width="207.68"/></g></g><text transform="matrix(.68482 0 0 .68587 195.81 1137.2)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="22.5" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-2-7);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="22.5">C</tspan></tspan></text></g><text x="3826.5161" y="1970.2391" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" stroke-width="15.42" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="3826.5161" y="1970.2391" stroke-width="15.42"/></text><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><ellipse cx="2626.5" cy="1976.9" rx="320.41" ry="317.14" fill="#2d1650" stroke-width="15.42"/></g></g><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><ellipse cx="2626.5" cy="1976.9" rx="312.25" ry="309.06" fill="#442178" stroke-width="15.42"/></g></g><g stroke-width="15.42"><g stroke-width="15.42"><polygon points="2870.6 1901.9 2709.5 1901.9 2709.5 1737.1 2545.8 1737.1 2545.9 1899.5 2387.3 1899.5 2387.3 2055.9 2544.8 2057.1 2544.8 2221.9 2707.3 2221.9 2708.5 2054.7 2870.6 2053.5" stroke-width="15.42"/></g></g><g stroke-width="15.42" data-button="dpad-0"><g id="Shape_4_copy"><g stroke-width="15.42"><polygon points="2860.2 1911 2700.8 1911 2700.8 1747.6 2554.2 1747.6 2554.4 1908.7 2396.1 1908.7 2396.1 2047.5 2554.1 2048.7 2554.3 2211.4 2698.2 2211.4 2699.6 2046.4 2860.2 2045.3" fill="#eaeaea" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><polygon points="2674.2 1862 2627.3 1780.1 2578.7 1862" fill="#c7c7c7" stroke-width="207.68"/></g></g><g id="Shape_5_copy"><g stroke-width="15.42"><polygon points="2674.2 2103 2578.7 2103 2627.3 2184.9" fill="#c7c7c7" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><polygon points="2506 1934.7 2424 1981.7 2506 2030.3" fill="#c7c7c7" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><polygon points="2828.9 1981.7 2747 1934.7 2747 2030.3" fill="#c7c7c7" stroke-width="207.68"/></g></g><g><g stroke-width="15.42"><circle cx="2626.9" cy="1979.4" r="48.647" fill="#c7c7c7" stroke-width="207.68"/></g></g></g><g id="Shape_6_copy_1_" enable-background="new    " stroke-width="15.42"><g id="Shape_6_copy" stroke-width="15.42"></g></g><g id="START_x2F_PAUSE" transform="matrix(1.4379 0 0 1.1683 -1075.9 -163.29)" enable-background="new    " stroke-width="11.898"><text transform="matrix(.7382 0 0 1 3021.6 1148)" font-family="KhmerUI-Bold" font-size="86.409px" stroke-width="160.24">START</text></g><g fill="#2d1650" stroke-width="15.42"><g fill="#2d1650" stroke-width="15.42"><ellipse cx="4403.4" cy="1112" rx="475.27" ry="470.42" fill="#2d1650" stroke-width="15.42"/></g></g><g fill="#442178" stroke-width="15.42"><g fill="#442178" stroke-width="15.42"><ellipse cx="4403.4" cy="1112" rx="463.16" ry="458.44" fill="#442178" stroke-width="15.42"/></g></g><g stroke-width="15.42" data-button="button-0"><g id="Shape_7_copy"><g stroke-width="15.42"><circle cx="4408" cy="1104" r="240" stroke-width="15.42"/></g></g><g><g stroke-width="15.42"><circle cx="4408" cy="1104" r="224" fill="#00bc8e" stroke-width="207.68"/></g></g></g><g stroke-width="15.42" data-button="button-2"><g><g stroke-width="15.42"><circle cx="3968" cy="1336" r="148" stroke-width="15.42"/></g></g><g id="Shape_8_copy"><g stroke-width="15.42"><circle cx="3968" cy="1336" r="130" fill="#f00" stroke-width="207.68"/></g></g></g><g stroke-width="15.42" data-button="button-3"><g><g stroke-width="15.42"><path d="m4206 614c-40 18-216 108-140 216 94 100 146-2 226-40 104-40 210 18 210-118-8-128-256-76-296-58z" stroke-width="15.42"/></g></g><g id="Shape_10_copy"><g stroke-width="15.42"><path d="m4487.3 672.68c-8.889-112.4-236.65-62.308-273.91-45.485s-207.07 96.898-134.67 194.16c83.202 86.025 136.64-11.178 211.14-46.641 96.962-37.559 200.88 15.784 197.44-102.04z" fill="#eaeaea" stroke-width="207.68"/></g></g></g><g stroke-width="15.42" data-button="button-1"><g><g stroke-width="15.42"><path d="m4910.5 905.72c-18-40-108-216-216-140-100 94 2 146 40 226 40 104-18 210 118 210 128-8 76-256 58-296z" stroke-width="15.42"/></g></g><g><g stroke-width="15.42"><path d="m4897.3 913.11c-16.822-37.264-96.897-207.07-194.16-134.67-86.025 83.202 11.178 136.64 46.641 211.14 37.56 96.962-15.783 200.88 102.04 197.44 112.4-8.888 62.308-236.64 45.485-273.91z" fill="#eaeaea" stroke-width="207.68"/></g></g></g><text transform="translate(-888.84 -118.88)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="15.42" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan fill="#000000" fill-opacity=".75" stroke-width="15.42" style="shape-inside:url(#rect1879-3)">A</tspan></tspan></text><text transform="translate(-1331 113.12)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="15.42" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="15.42">B</tspan></tspan></text><text transform="matrix(.88915 0 0 .88915 -425.56 -389.36)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="17.343" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="17.343">Y</tspan></tspan></text><text transform="translate(-479.38 -261.09)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="15.42" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-5);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="15.42">X</tspan></tspan></text><text transform="matrix(.68482 0 0 .68587 -1678.4 -545.07)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="22.5" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-2-1);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="22.5">L</tspan></tspan></text><text transform="matrix(.49661 0 0 .49737 2207.6 -73.254)" fill="#000000" fill-opacity=".75" font-family="sans-serif" font-size="144px" letter-spacing="0px" stroke-width="31.027" word-spacing="0px" style="line-height:1.25;shape-inside:url(#rect1879-3-6-5-2-3);white-space:pre" xml:space="preserve"><tspan x="5247.6191" y="1275.3691"><tspan stroke-width="31.027">ZR</tspan></tspan></text><g stroke-width="15.42" data-button="button-16"><g transform="translate(-1196 -395.27)"><g stroke-width="15.42"><circle cx="4408" cy="1104" r="240" stroke-width="15.42"/></g></g><g><g transform="translate(-1196 -395.27)" stroke-width="15.42"><circle cx="4408" cy="1104" r="224" fill="#ebebeb" stroke-width="207.68"/></g></g></g><path d="m3170.6 561.51c-21.814 12.496-54.583 31.25-72.82 41.674l-33.157 18.954-0.026 170.4 72.068 42.783c39.638 23.53 73.022 43.032 74.185 43.336 1.3821 0.36118 17.016-8.291 45.019-24.916 23.596-14.009 56.552-33.525 73.235-43.371l30.335-17.901v-85.002c0-79.864-0.1179-84.957-1.9466-84.255-1.0711 0.41057-18.804 11.009-39.407 23.553-20.603 12.543-37.97 22.797-38.594 22.787-0.6235-0.0103-16.148-9.5256-34.499-21.145l-33.366-21.125-5.2696 3.0995c-2.8975 1.7042-17.847 10.754-33.219 20.109l-27.95 17.01 0.016 41.958 0.017 41.959 32.606 18.428c17.933 10.135 33.345 18.407 34.249 18.382 0.9044-0.025 16.698-8.3971 35.096-18.605l33.454-18.56 0.317-14.198 0.3162-14.199 14.426-8.7472c7.9335-4.8111 14.808-8.961 15.276-9.2219 0.4673-0.26094 0.8397 13.971 0.827 31.628l-0.023 32.102-50.01 29.247-50.01 29.246-26.228-15.523c-14.425-8.5379-37.327-22.118-50.893-30.176l-24.665-14.654v-116.2l50.068-28.856c27.537-15.871 50.482-29.02 50.988-29.22 0.5064-0.19976 15.973 8.6028 34.372 19.562 18.398 10.959 33.999 19.925 34.668 19.925 1.8597 0 46.5-27.347 46.5-28.486 0-0.54913-0.5337-0.99804-1.186-0.99804s-26.117-14.289-56.588-31.752c-30.471-17.464-56.103-31.752-56.96-31.752-0.8573 0-19.406 10.224-41.22 22.721" fill-opacity=".75" fill-rule="evenodd" stroke-width="237.78"/><g transform="translate(9.424)" data-button="button-8"><g transform="matrix(.58703 0 0 .58703 695.18 537.14)" stroke-width="26.268"><g stroke-width="26.268"><circle cx="3968" cy="1336" r="148" stroke-width="26.268"/></g></g><g transform="translate(-943.5 -14.586)" stroke-width="15.42"><g stroke-width="15.42"><circle cx="3968" cy="1336" r="76.314" fill="#ebebeb" stroke-width="207.68"/></g></g></g><g transform="matrix(1.4379 0 0 1.1683 -1486.6 -163.29)" enable-background="new    " stroke-width="11.898"><text transform="matrix(.7382 0 0 1 3021.6 1148)" font-family="KhmerUI-Bold" font-size="86.409px" stroke-width="160.24">SELECT</text></g><g data-button="button-9"><g transform="matrix(.58703 0 0 .58703 1084.2 537.14)" stroke-width="26.268"><g stroke-width="26.268"><circle cx="3968" cy="1336" r="148" stroke-width="26.268"/></g></g><g transform="translate(-554.5 -14.586)" stroke-width="15.42"><g stroke-width="15.42"><circle cx="3968" cy="1336" r="76.314" fill="#ebebeb" stroke-width="207.68"/></g></g></g></g></g></g><g transform="translate(-260.34 -473.69)"><g cv-if = "ra"><path d="m567.54 648.99h103.15" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "dpad"><path d="m374.56 649.32h103.15" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "a"><path d="m596.71 592.91h91.882" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "b"><path d="m568.05 607.66h103.15" fill="none" stroke="#000" stroke-width=".5"/></g><g><g cv-if = "y"><path d="m589.13 565.7h99.459" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "x"><path d="m622.99 583.02h65.606" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "r1"><path d="m628.97 554.91h59.627" fill="none" stroke="#000" stroke-width=".5"/></g><g cv-if = "start"><path d="m528.6 591.28v-82.736" fill="none" stroke="#000" stroke-width=".5"/></g><text x="519.64154" y="506.8317" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="519.64154" y="506.8317" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[start]]</tspan></text><text x="674.04346" y="651.5755" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="674.04346" y="651.5755" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[ra]]</tspan></text><text x="673.08386" y="609.31451" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="673.08386" y="609.31451" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[b]]</tspan></text><text x="691.40167" y="594.74054" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="691.40167" y="594.74054" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[a]]</tspan></text><text x="690.66138" y="584.66785" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="690.66138" y="584.66785" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[x]]</tspan></text><text x="691.40601" y="567.63531" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="691.40601" y="567.63531" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[y]]</tspan></text><text x="690.68622" y="557.03937" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="690.68622" y="557.03937" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[r1]]</tspan></text><g cv-if = "l1"><path d="m342.83 555.19h59.627" fill="none" stroke="#000" stroke-width=".5"/></g><text x="315.89267" y="557.19037" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="315.89267" y="557.19037" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[l1]]</tspan></text><text x="354.72061" y="651.14825" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve"><tspan x="354.72061" y="651.14825" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[dpad]]</tspan></text></g></svg>\n'}),require.register("controller/kb-input.html",function(t,e,s){s.exports='<section cv-each = "lines:line">[[line]]</section>\n'}),require.register("controller/ps3-input.svg",function(t,e,s){s.exports='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="512" height="288" version="1.0"\n\txmlns="http://www.w3.org/2000/svg">\n\t<g transform="translate(-260.34 -473.69)">\n\t\t<g transform="translate(134.82 68.294)">\n\t\t\t<path d="m435.57 481.84h33.046l-2.5898-4.9919c-1.698-3.2729-6.1119-5.7018-13.933-5.7018-7.8212 0-12.235 2.4289-13.933 5.7018z" fill="#7a7a7a" fill-rule="evenodd" stroke="#000" stroke-width="1.0793" data-button="button-7"/>\n\t\t\t<path d="m293.22 481.84h33.046l-2.5898-4.9919c-1.698-3.2729-6.1119-5.7018-13.933-5.7018-7.8212 0-12.235 2.4289-13.933 5.7018z" fill="#7a7a7a" fill-rule="evenodd" stroke="#000" stroke-width="1.0793" data-button="button-6"/>\n\t\t\t<path d="m320.62 497.85c-1.5358 0-2.75 1.2454-2.75 2.7812v73.156c0 1.5358 1.2142 2.75 2.75 2.75h121.78c1.5358 0 2.7812-1.2142 2.7812-2.75v-73.156c0-1.5358-1.2454-2.7812-2.7812-2.7812h-52.808c-0.2723 0.44907-0.77809 0.75-1.3438 0.75h-14.312c-0.56415 0-1.0398-0.30294-1.3125-0.75z" fill="#3f3f3f" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<rect x="324.17" y="504.14" width="114.69" height="68.484" rx="2.7723" ry="2.6797" fill="#262626" fill-rule="evenodd"/>\n\t\t\t<path d="m272.94 520.34c-5.4902 30.065-9.0709 62.226-11.765 76.34-4.2253 22.138 32.77 40.747 46.797 15.163 10.649-19.422 22.745-44.183 22.745-44.183z" fill="#262626" fill-rule="evenodd" stroke="#000"/>\n\t\t\t<path d="m435.52 483.74h33.15l-2.598-4.2714c-1.7033-2.8005-6.1312-4.8789-13.977-4.8789-7.8459 0-12.274 2.0784-13.977 4.8789z" fill="#7a7a7a" fill-rule="evenodd" stroke="#000" data-button="button-5"/>\n\t\t\t<path d="m293.16 483.74h33.15l-2.598-4.2714c-1.7033-2.8005-6.1312-4.8789-13.977-4.8789-7.8459 0-12.274 2.0784-13.977 4.8789z" fill="#7a7a7a" fill-rule="evenodd" stroke="#000" data-button="button-4"/>\n\t\t\t<path d="m330.59 504.54c-1.6994-10.98-2.4837-16.471-3.268-20.523-0.78432-4.0523-7.7124-6.1438-17.582-6.1438s-16.797 2.0915-17.582 6.1438c-0.78431 4.0523-1.5686 9.5425-3.268 20.523" fill="#262626" fill-rule="evenodd" stroke="#000"/>\n\t\t\t<circle cx="309.8" cy="529.75" r="37.909" fill="#333" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<path d="m472.94 504.54c-1.6994-10.98-2.4837-16.471-3.268-20.523-0.78432-4.0523-7.7124-6.1438-17.582-6.1438s-16.797 2.0915-17.582 6.1438c-0.78431 4.0523-1.5686 9.5425-3.268 20.523" fill="#262626" fill-rule="evenodd" stroke="#000"/>\n\t\t\t<circle cx="346.14" cy="566.61" r="24.052" fill="#333" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<circle cx="346.14" cy="566.61" r="18.562" fill-opacity=".51852" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<circle cx="346.14" cy="566.61" r="16.209" fill="#3b3b3b" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" data-button="left-stick button-10"/>\n\t\t\t<path d="m490.08 520.34c5.4902 30.065 9.0709 62.749 11.765 76.34 4.3818 22.107-32.77 40.747-46.797 15.163-10.649-19.422-22.745-44.183-22.745-44.183z" fill="#262626" fill-rule="evenodd" stroke="#000"/>\n\t\t\t<circle transform="scale(-1,1)" cx="-453.21" cy="529.75" r="37.909" fill="#333" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<path d="m445.43 501.73c-1.5358 0-2.7812 1.2454-2.7812 2.7812v14.656h-14.688c-1.5358 0-2.75 1.2454-2.75 2.7812v15.594c0 1.5358 1.2142 2.7812 2.75 2.7812h14.688v14.656c0 1.5358 1.2454 2.7812 2.7812 2.7812h15.594c1.5358 0 2.75-1.2454 2.75-2.7812v-14.656h14.688c1.5358 0 2.75-1.2454 2.75-2.7812v-15.594c0-1.5358-1.2142-2.7812-2.75-2.7812h-14.688v-14.656c0-1.5358-1.2142-2.7812-2.75-2.7812z" fill="#262626" fill-rule="evenodd"/>\n\t\t\t<rect x="353.46" y="530.28" width="11.634" height="6.6667" rx="1.5686" ry="1.5686" fill="#595959" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" data-button="button-8"/>\n\t\t\t<path d="m407.19 533.61-8.4967 3.3333c-0.80899 0.31737-1.5686-0.69961-1.5686-1.5686v-3.5294c0-0.86902 0.75963-1.886 1.5686-1.5686z" fill="#595959" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" data-button="button-9"/>\n\t\t\t<circle cx="382.48" cy="551.32" r="7.9347" fill="#595959" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.3796" data-button="button-16"/>\n\t\t\t<circle cx="453.21" cy="512.1" r="8.2353" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round" data-button="button-3"/>\n\t\t\t<circle cx="453.21" cy="547.53" r="8.2353" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round" data-button="button-0"/>\n\t\t\t<circle cx="470.93" cy="529.81" r="8.2353" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round" data-button="button-1"/>\n\t\t\t<circle cx="435.5" cy="529.81" r="8.2353" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round" data-button="button-2"/>\n\t\t\t<path d="m301.84 501.25c-1.5358 0-2.7812 1.2454-2.7812 2.7812v14.656h-14.688c-1.5358 0-2.75 1.2454-2.75 2.7812v15.594c0 1.5358 1.2142 2.7812 2.75 2.7812h14.688v14.656c0 1.5358 1.2454 2.7812 2.7812 2.7812h15.594c1.5358 0 2.75-1.2454 2.75-2.7812v-14.656h14.688c1.5358 0 2.75-1.2454 2.75-2.7812v-15.594c0-1.5358-1.2142-2.7812-2.75-2.7812h-14.688v-14.656c0-1.5358-1.2142-2.7812-2.75-2.7812z" fill="#262626" fill-rule="evenodd"/>\n\t\t\t<circle cx="416.21" cy="566.61" r="24.052" fill="#333" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<circle cx="416.21" cy="566.61" r="18.562" fill-opacity=".51852" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<circle cx="416.21" cy="566.61" r="16.209" fill="#3b3b3b" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" data-button="right-stick button-11"/>\n\t\t\t<g fill="#3f3f3f" fill-rule="evenodd">\n\t\t\t\t<path transform="matrix(0 -.28374 -.51741 0 575.79 583.64)" d="m279.97 514.41-12.665 7.3123v-14.625z"/>\n\t\t\t\t<path transform="matrix(0 .28374 -.51741 0 575.79 474.89)" d="m279.97 514.41-12.665 7.3123v-14.625z"/>\n\t\t\t\t<path transform="matrix(.28374 0 0 -.51741 255.25 795.43)" d="m279.97 514.41-12.665 7.3123v-14.625z"/>\n\t\t\t\t<path transform="matrix(-.28374 0 0 -.51741 364 795.43)" d="m279.97 514.41-12.665 7.3123v-14.625z"/>\n\t\t\t</g>\n\t\t\t<rect x="430.79" y="525.1" width="9.4281" height="9.4281" rx="0" ry="0" fill="none" stroke="#ff01db"/>\n\t\t\t<path transform="matrix(.87668 0 0 .87521 59.31 61.955)" d="m455.3 518.14h-11.974l5.9871-10.37z" fill="none" stroke="#00ff83" stroke-width="1.1416"/>\n\t\t\t<circle transform="scale(-1)" cx="-470.93" cy="-529.81" r="5.6472" fill="none" stroke="#f00" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t<path d="m449.04 543.43 8.5038 8.5038m0-8.5038-8.5038 8.5038" fill="none" stroke="#8243fb"/>\n\t\t\t<g fill="#5a5a5a" stroke="#454545">\n\t\t\t\t<path transform="translate(.35102 .37335)" d="m318.62 523.29a1.1789 1.1789 0 0 0-0.85742 0.44726l-3.5 4.4375a1.1789 1.1789 0 0 0-2e-3 1.457l3.5 4.4688a1.1789 1.1789 0 0 0 0.92382 0.45313l8.125 0.0312a1.1789 1.1789 0 0 0 1.1836-1.1797v-8.7812a1.1789 1.1789 0 0 0-1.1562-1.1777l-8.125-0.15625a1.1789 1.1789 0 0 0-0.0918 0z" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round" data-button="button-15"/>\n\t\t\t\t<g data-button="button-14">\n\t\t\t\t\t<path transform="matrix(-1 0 0 1 618.9 .2845)" d="m318.62 523.29a1.1789 1.1789 0 0 0-0.85742 0.44726l-3.5 4.4375a1.1789 1.1789 0 0 0-2e-3 1.457l3.5 4.4688a1.1789 1.1789 0 0 0 0.92382 0.45313l8.125 0.0312a1.1789 1.1789 0 0 0 1.1836-1.1797v-8.7812a1.1789 1.1789 0 0 0-1.1562-1.1777l-8.125-0.15625a1.1789 1.1789 0 0 0-0.0918 0z" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t</g>\n\t\t\t\t<g data-button="button-13">\n\t\t\t\t\t<path transform="rotate(90 309.26 529.25)" d="m318.62 523.29a1.1789 1.1789 0 0 0-0.85742 0.44726l-3.5 4.4375a1.1789 1.1789 0 0 0-2e-3 1.457l3.5 4.4688a1.1789 1.1789 0 0 0 0.92382 0.45313l8.125 0.0312a1.1789 1.1789 0 0 0 1.1836-1.1797v-8.7812a1.1789 1.1789 0 0 0-1.1562-1.1777l-8.125-0.15625a1.1789 1.1789 0 0 0-0.0918 0z" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t</g>\n\t\t\t\t<g data-button="button-12">\n\t\t\t\t\t<path transform="matrix(0 -1 -1 0 838.61 838.54)" d="m318.62 523.29a1.1789 1.1789 0 0 0-0.85742 0.44726l-3.5 4.4375a1.1789 1.1789 0 0 0-2e-3 1.457l3.5 4.4688a1.1789 1.1789 0 0 0 0.92382 0.45313l8.125 0.0312a1.1789 1.1789 0 0 0 1.1836-1.1797v-8.7812a1.1789 1.1789 0 0 0-1.1562-1.1777l-8.125-0.15625a1.1789 1.1789 0 0 0-0.0918 0z" fill="#5a5a5a" fill-rule="evenodd" stroke="#454545" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<path d="m307.47 481.42h1.038v6.7985h3.7358v0.87358h-4.7738v-7.6721"/>\n\t\t\t<path d="m454.02 485.5c0.22267 0.0754 0.43849 0.23638 0.64747 0.48303 0.2124 0.24666 0.4248 0.58582 0.6372 1.0175l1.0534 2.0966h-1.1151l-0.98149-1.9681c-0.25352-0.51387-0.50017-0.85473-0.73998-1.0226-0.23638-0.16786-0.56012-0.25179-0.97121-0.25179h-1.1305v3.2425h-1.038v-7.6721h2.3432c0.877 1e-5 1.5313 0.18329 1.963 0.54984 0.43164 0.36657 0.64747 0.91983 0.64747 1.6598 0 0.48304-0.11305 0.88386-0.33915 1.2024-0.22268 0.31861-0.54813 0.53957-0.97635 0.6629m-2.6002-3.222v2.7235h1.3052c0.50016 1e-5 0.877-0.11476 1.1305-0.34429 0.25693-0.23295 0.3854-0.57382 0.3854-1.0226 0-0.44877-0.12847-0.78622-0.3854-1.0123-0.25351-0.22953-0.63035-0.34429-1.1305-0.3443h-1.3052"/>\n\t\t\t<path d="m353.63 524.56v0.43917c-0.17091-0.0817-0.33216-0.14267-0.48375-0.1828-0.15159-0.0401-0.29798-0.0602-0.43917-0.0602-0.24522 0-0.43471 0.0476-0.56846 0.14267-0.13227 0.0951-0.19841 0.23036-0.19841 0.40573 0 0.14713 0.0438 0.2586 0.13153 0.33439 0.0892 0.0743 0.25711 0.1345 0.50382 0.18057l0.27197 0.0557c0.33587 0.0639 0.58332 0.17686 0.74234 0.33885 0.16051 0.16051 0.24076 0.37601 0.24077 0.64649-1e-5 0.3225-0.1085 0.56698-0.32548 0.73343-0.2155 0.16646-0.53205 0.24968-0.94967 0.24968-0.15753 0-0.32547-0.0178-0.50381-0.0535-0.17686-0.0357-0.3604-0.0884-0.55063-0.15828v-0.46369c0.1828 0.10255 0.36188 0.17983 0.53725 0.23185 0.17537 0.052 0.34777 0.078 0.51719 0.078 0.25711 0 0.45551-0.0505 0.59522-0.15159 0.1397-0.10106 0.20955-0.24522 0.20955-0.43248 0-0.16348-0.0505-0.29129-0.15159-0.38343-0.0996-0.0921-0.2638-0.16125-0.49267-0.20733l-0.2742-0.0535c-0.33588-0.0669-0.57887-0.17165-0.72897-0.31433-0.15011-0.14267-0.22516-0.34107-0.22516-0.59521 0-0.29426 0.10329-0.52611 0.30987-0.69553 0.20806-0.16943 0.49415-0.25414 0.85827-0.25414 0.15605 0 0.31507 0.0141 0.47706 0.0423 0.162 0.0283 0.3277 0.0706 0.49713 0.12707m0.90286-0.10923h2.1044v0.37898h-1.6541v0.98533h1.585v0.37898h-1.585v1.206h1.6942v0.37897h-2.1446v-3.3283m2.8891 0h0.45032v2.9493h1.6207v0.37897h-2.071v-3.3283m2.5414 0h2.1044v0.37898h-1.6541v0.98533h1.585v0.37898h-1.585v1.206h1.6942v0.37897h-2.1446v-3.3283m5.3815 0.25637v0.47483c-0.15159-0.14118-0.31359-0.2467-0.48598-0.31656-0.17092-0.0698-0.35297-0.10477-0.54617-0.10477-0.38047 0-0.67176 0.11667-0.87388 0.34999-0.20212 0.23185-0.30318 0.56773-0.30318 1.0076 0 0.43843 0.10106 0.77431 0.30318 1.0076 0.20212 0.23184 0.49341 0.34776 0.87388 0.34776 0.1932 0 0.37525-0.0349 0.54617-0.10477 0.17239-0.0698 0.33439-0.17537 0.48598-0.31656v0.47038c-0.15754 0.107-0.32473 0.18726-0.50159 0.24076-0.17537 0.0535-0.36114 0.0802-0.55732 0.0802-0.50381 0-0.90062-0.15382-1.1904-0.46146-0.2898-0.30912-0.43471-0.73045-0.43471-1.264 0-0.53502 0.14491-0.95635 0.43471-1.264 0.28981-0.30913 0.68662-0.46369 1.1904-0.46369 0.19915 0 0.38641 0.0267 0.56178 0.0802 0.17685 0.052 0.34256 0.13079 0.49713 0.23631m0.23853-0.25637h2.8156v0.37898h-1.1815v2.9493h-0.45254v-2.9493h-1.1815v-0.37898" fill="#e6e6e6"/>\n\t\t\t<path d="m396.51 524.56v0.43917c-0.17092-0.0817-0.33217-0.14267-0.48376-0.1828-0.15159-0.0401-0.29798-0.0602-0.43916-0.0602-0.24522 0-0.43471 0.0476-0.56847 0.14267-0.13227 0.0951-0.1984 0.23036-0.1984 0.40573 0 0.14713 0.0438 0.2586 0.13152 0.33439 0.0892 0.0743 0.25711 0.1345 0.50382 0.18057l0.27197 0.0557c0.33588 0.0639 0.58333 0.17686 0.74235 0.33885 0.1605 0.16051 0.24076 0.37601 0.24076 0.64649 0 0.3225-0.10849 0.56698-0.32547 0.73343-0.2155 0.16646-0.53206 0.24968-0.94967 0.24968-0.15754 0-0.32548-0.0178-0.50382-0.0535-0.17686-0.0357-0.3604-0.0884-0.55063-0.15828v-0.46369c0.1828 0.10255 0.36189 0.17983 0.53726 0.23185 0.17536 0.052 0.34776 0.078 0.51719 0.078 0.2571 0 0.45551-0.0505 0.59521-0.15159 0.1397-0.10106 0.20955-0.24522 0.20955-0.43248 0-0.16348-0.0505-0.29129-0.15159-0.38343-0.0996-0.0921-0.2638-0.16125-0.49267-0.20733l-0.2742-0.0535c-0.33587-0.0669-0.57886-0.17165-0.72897-0.31433-0.1501-0.14267-0.22516-0.34107-0.22515-0.59521-1e-5 -0.29426 0.10328-0.52611 0.30986-0.69553 0.20807-0.16943 0.49416-0.25414 0.85827-0.25414 0.15605 0 0.31507 0.0141 0.47707 0.0423 0.16199 0.0283 0.3277 0.0706 0.49713 0.12707m0.44139-0.10923h2.8156v0.37898h-1.1815v2.9493h-0.45254v-2.9493h-1.1815v-0.37898m4.0082 0.44362-0.61082 1.6564h1.2239l-0.61305-1.6564m-0.25413-0.44362h0.5105l1.2685 3.3283h-0.46815l-0.30318-0.85381h-1.5003l-0.30318 0.85381h-0.47484l1.2707-3.3283m3.841 1.7678c0.0966 0.0327 0.19023 0.10255 0.28089 0.20955 0.0921 0.10701 0.18429 0.25414 0.27643 0.4414l0.457 0.90954h-0.48375l-0.42579-0.85381c-0.10998-0.22292-0.21698-0.3708-0.32102-0.44362-0.10254-0.0728-0.24299-0.10924-0.42133-0.10924h-0.49044v1.4067h-0.45031v-3.3283h1.0166c0.38046 0 0.66432 0.0795 0.85158 0.23853s0.28088 0.39904 0.28089 0.72006c-1e-5 0.20955-0.0491 0.38343-0.14713 0.52165-0.0966 0.13821-0.2378 0.23407-0.42357 0.28757m-1.128-1.3978v1.1815h0.56624c0.21698 0 0.38046-0.0498 0.49044-0.14936 0.11146-0.10106 0.16719-0.24893 0.16719-0.44362s-0.0557-0.34108-0.16719-0.43917c-0.10998-0.0996-0.27346-0.14936-0.49044-0.14936h-0.56624m1.9328-0.37006h2.8156v0.37898h-1.1815v2.9493h-0.45254v-2.9493h-1.1815v-0.37898" fill="#e6e6e6"/>\n\t\t\t<text transform="scale(-1.6252 -.6153)" x="-223.68372" y="-815.48474" fill="#b3b3b3" font-family="Arial" stroke-width="1px" style="line-height:0%" xml:space="preserve">\n\t\t\t\t<tspan x="-223.68372" y="-815.48474" font-size="3.0753px" style="line-height:1.25">1</tspan>\n\t\t\t</text>\n\t\t\t<text transform="scale(-1.6252 -.6153)" x="-220.45108" y="-815.48474" fill="#b3b3b3" font-family="Arial" stroke-width="1px" style="line-height:0%" xml:space="preserve">\n\t\t\t\t<tspan x="-220.45108" y="-815.48474" font-size="3.0753px" style="line-height:1.25">2</tspan>\n\t\t\t</text>\n\t\t\t<text transform="scale(-1.6252 -.6153)" x="-216.92226" y="-815.5238" fill="#b3b3b3" font-family="Arial" stroke-width="1px" style="line-height:0%" xml:space="preserve">\n\t\t\t\t<tspan x="-216.92226" y="-815.5238" font-size="3.0753px" style="line-height:1.25">3</tspan>\n\t\t\t</text>\n\t\t\t<text transform="scale(-1.6252 -.6153)" x="-212.86066" y="-815.49377" fill="#b3b3b3" font-family="Arial" stroke-width="1px" style="line-height:0%" xml:space="preserve">\n\t\t\t\t<tspan x="-212.86066" y="-815.49377" font-size="3.0753px" style="line-height:1.25">4</tspan>\n\t\t\t</text>\n\t\t\t<rect x="343.44" y="498.32" width="2.0832" height="2.7005" rx="0" ry="1.5686" fill="#1a1a1a"/>\n\t\t\t<rect x="350" y="498.32" width="2.0832" height="2.7005" rx="0" ry="1.5686" fill="#1a1a1a"/>\n\t\t\t<rect x="355.86" y="498.32" width="2.0832" height="2.7005" rx="0" ry="1.5686" fill="#1a1a1a"/>\n\t\t\t<rect x="360.96" y="498.32" width="2.0832" height="2.7005" rx="0" ry="1.5686" fill="#f00"/>\n\t\t\t<g transform="matrix(.080659 0 0 .080659 351.05 512.47)" clip-rule="evenodd" fill-rule="evenodd" stroke-width="2.256">\n\t\t\t\t<path d="m394.88 444.14-0.0851 78.095-20.924-6.8051v-91.793l26.708 7.0613c17.096 4.5948 27.559 13.526 27.388 29.18-0.17 18.206-8.5908 25.521-25.007 20.757v-35.901c0-4.3389-8.0805-4.593-8.0805-0.59435z" fill="#de0029"/>\n\t\t\t\t<path d="m364.26 500.28-9.867 3.3186c-6.3802 2.2124-11.823-2.9768-5.9543-5.1048l4.763-1.7003-17.947-5.701c-5.5292 1.8724-10.718 5.8707-10.377 11.486 0.34027 5.6992 13.354 7.061 23.392 8.6775 9.3559 1.5306 17.862 0.68001 25.603-2.0424v-5.8705zm30.706 21.95 18.288-6.381-18.458-5.8692v11.824z" fill="#f3c202"/>\n\t\t\t\t<path d="m443.62 505.13 0.34-0.0857c7.9956-2.8065 11.398-6.7213 10.548-10.378-1.3611-6.1248-11.143-9.4434-26.199-10.55-10.802-0.76514-21.434 1.6162-31.811 5.1889l-1.7013 0.5962 18.628 5.7848 10.887-3.6586c11.398-2.1262 15.992 1.6165 5.0189 5.1048l-5.444 1.8705zm-69.748-27.052-8.2516 2.8065 8.2516 2.5524z" fill="#326db3"/>\n\t\t\t\t<path d="m413.25 515.85 30.366-10.718-19.734-6.1267-29.09 9.9534v1.0221zm-39.382-18.801-9.6118 3.2327 9.6118 3.0627zm20.924 5.0207v-12.166l18.628 5.7848zm-41.594-5.2748 20.67-7.4013v-5.9551l-8.2513-2.5524-29.941 10.124c-0.0851 0-0.25513 0.0841-0.42513 0.0841z" fill="#00aa9e"/>\n\t\t\t</g>\n\t\t</g>\n\t</g>\n\t<g transform="translate(-260.34 -473.69)">\n\t\t<g class = "a" class = "a" cv-if = "a">\n\t\t\t<path transform="translate(134.82 68.294)" d="m456.39 552.34 69.71 17.901" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t</g>\n\t\t<g class = "x" class = "x" cv-if = "x">\n\t\t\t<path transform="translate(134.82 68.294)" d="m439.07 532.57 87.033 22.593" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t</g>\n\t\t<g class = "y" class = "y" cv-if = "y">\n\t\t\t<path transform="translate(134.82 68.294)" d="m457.95 515.41 68.155 16.266" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t</g>\n\t\t<g class = "b" class = "b" cv-if = "b">\n\t\t\t<path transform="translate(134.82 68.294)" d="m474.2 532.63 51.904 12.605" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t</g>\n\t\t<text transform="translate(134.82 68.294)" x="527.39423" y="547.27045" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t<tspan class = "b" x="527.39423" y="547.27045" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[b]]</tspan>\n\t\t</text>\n\t\t<text transform="translate(134.82 68.294)" x="527.69214" y="572.71301" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t<tspan class = "a" x="527.69214" y="572.71301" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[a]]</tspan>\n\t\t</text>\n\t\t<text transform="translate(134.82 68.294)" x="527.45691" y="557.97314" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t<tspan class = "x" x="527.45691" y="557.97314" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[x]]</tspan>\n\t\t</text>\n\t\t<text transform="translate(134.82 68.294)" x="526.81152" y="534.13593" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t<tspan class = "y" x="526.81152" y="534.13593" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[y]]</tspan>\n\t\t</text>\n\t\t<g cv-if ="r1" class = "r1">\n\t\t\t<path transform="translate(134.82 68.294)" d="m470.33 481.76 53.163 13.403" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t\t<text transform="translate(134.82 68.294)" x="524.19629" y="497.62772" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t\t<tspan class = "r1" x="524.19629" y="497.62772" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[r1]]</tspan>\n\t\t\t</text>\n\t\t</g>\n\t\t<g cv-if ="ra" class = "ra">\n\t\t\t<path transform="translate(134.82 68.294)" d="m435.96 571.55 90.146 25.55" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t\t<text transform="translate(134.82 68.294)" x="529.45886" y="599.68732" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t\t<tspan x="529.45886" y="599.68732" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[ra]]</tspan>\n\t\t\t</text>\n\t\t</g>\n\t\t<g cv-if = "l1" class = "l1">\n\t\t\t<path transform="translate(134.82 68.294)" d="m292.1 481.01-53.163 13.403" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t\t<text transform="translate(134.82 68.294)" x="212.72356" y="496.87265" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t\t<tspan class = "l1" x="212.72356" y="496.87265" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[l1]]</tspan>\n\t\t\t</text>\n\t\t</g>\n\t\t<g cv-if = "dpad" class = "dpad">\n\t\t\t<path transform="translate(134.82 68.294)" d="m294.23 543.48-55.024 27.964" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t\t<text transform="translate(134.82 68.294)" x="220.96754" y="573.75909" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t\t<tspan x="220.96754" y="573.75909" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[dpad]]</tspan>\n\t\t\t</text>\n\t\t</g>\n\t\t<g cv-if = "start" class = "start">\n\t\t\t<path transform="translate(134.82 68.294)" d="m401.03 523.14v-50.774" fill="none" stroke="#000" stroke-width=".5"/>\n\t\t\t<text transform="translate(134.82 68.294)" x="392.06915" y="470.65366" fill="#000000" font-family="sans-serif" font-size="40px" letter-spacing="0px" word-spacing="0px" style="line-height:1.25" xml:space="preserve">\n\t\t\t\t<tspan class = "start" x="392.06915" y="470.65366" font-family="sans-serif" font-size="6px" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal">[[start]]</tspan>\n\t\t\t</text>\n\t\t</g>\n\t</g>\n</svg>\n'}),require.register("controller/xbox360-input.svg",function(t,e,s){s.exports='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   width="512"\n   height="288"\n   id="svg2"\n   sodipodi:version="0.32"\n   inkscape:version="1.0.2 (e86c870879, 2021-01-15)"\n   sodipodi:docname="xbox360-input.svg"\n   inkscape:output_extension="org.inkscape.output.svg.inkscape"\n   version="1.0">\n  <defs\n     id="defs4">\n    <inkscape:perspective\n       sodipodi:type="inkscape:persp3d"\n       inkscape:vp_x="0 : 663.1653 : 1"\n       inkscape:vp_y="0 : 1000 : 0"\n       inkscape:vp_z="744.09448 : 663.1653 : 1"\n       inkscape:persp3d-origin="372.04724 : 487.7716 : 1"\n       id="perspective10" />\n    <inkscape:perspective\n       id="perspective2390"\n       inkscape:persp3d-origin="372.04724 : 487.7716 : 1"\n       inkscape:vp_z="744.09448 : 663.1653 : 1"\n       inkscape:vp_y="0 : 1000 : 0"\n       inkscape:vp_x="0 : 663.1653 : 1"\n       sodipodi:type="inkscape:persp3d" />\n    <inkscape:perspective\n       id="perspective12"\n       inkscape:persp3d-origin="886.50018 : 236.98421 : 1"\n       inkscape:vp_z="1773.0004 : 286.98421 : 1"\n       inkscape:vp_y="0 : 1000 : 0"\n       inkscape:vp_x="0 : 286.98421 : 1"\n       sodipodi:type="inkscape:persp3d" />\n    <inkscape:perspective\n       id="perspective3355"\n       inkscape:persp3d-origin="67.123741 : 170.98342 : 1"\n       inkscape:vp_z="134.24748 : 187.98302 : 1"\n       inkscape:vp_y="0 : 1000 : 0"\n       inkscape:vp_x="0 : 187.98302 : 1"\n       sodipodi:type="inkscape:persp3d" />\n    <inkscape:perspective\n       id="perspective3443"\n       inkscape:persp3d-origin="177.16534 : 255.09444 : 1"\n       inkscape:vp_z="354.33069 : 314.14955 : 1"\n       inkscape:vp_y="0 : 1000 : 0"\n       inkscape:vp_x="0 : 314.14955 : 1"\n       sodipodi:type="inkscape:persp3d" />\n  </defs>\n  <sodipodi:namedview\n     id="base"\n     pagecolor="#ffffff"\n     bordercolor="#666666"\n     borderopacity="1.0"\n     gridtolerance="10000"\n     guidetolerance="10"\n     objecttolerance="10"\n     inkscape:pageopacity="0.0"\n     inkscape:pageshadow="2"\n     inkscape:zoom="1.7956884"\n     inkscape:cx="145.53463"\n     inkscape:cy="120.12192"\n     inkscape:document-units="px"\n     inkscape:current-layer="layer4"\n     showgrid="false"\n     inkscape:window-width="1920"\n     inkscape:window-height="1026"\n     inkscape:window-x="1050"\n     inkscape:window-y="31"\n     showguides="true"\n     inkscape:guide-bbox="true"\n     inkscape:document-rotation="0"\n     inkscape:window-maximized="1">\n    <sodipodi:guide\n       position="399.98588,184.41855"\n       orientation="1,0"\n       id="guide4464" />\n    <sodipodi:guide\n       position="113.8839,194.16412"\n       orientation="1,0"\n       id="guide5621" />\n  </sodipodi:namedview>\n  <metadata\n     id="metadata7">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about="">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />\n        <dc:title></dc:title>\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     inkscape:label="Layer 1"\n     inkscape:groupmode="layer"\n     id="layer1"\n     transform="translate(-260.34243,-473.69226)">\n    <g\n       id="g237"\n       transform="translate(134.82195,68.29447)">\n      <g\n         id="g817"\n         transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)">\n        <path\n           style="fill:#d8d8d8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           d="m 628.39816,299.51068 c -0.21851,-1.09254 -4.15168,-18.13627 -4.58869,-20.97689 -0.43702,-2.84062 -1.09255,-4.37019 -4.5887,-6.77379 -32.81359,-22.55933 -17.06203,-23.18579 -55.11042,-17.04898 -6.77379,1.09254 -15.51417,18.13627 -15.51417,18.13627 z"\n           id="path3352-3-3"\n           sodipodi:nodetypes="cssscc"\n           data-button="button-7" />\n        <path\n           style="fill:#d8d8d8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           d="m 124.78295,299.51068 c 0.21851,-1.09254 4.15168,-18.13627 4.58869,-20.97689 0.43702,-2.84062 1.09255,-4.37019 4.5887,-6.77379 32.81359,-22.55933 17.06203,-23.18579 55.11042,-17.04898 6.77379,1.09254 15.51417,18.13627 15.51417,18.13627 z"\n           id="path3352-3"\n           sodipodi:nodetypes="cssscc"\n           data-button="button-6" />\n        <g\n           id="g4442"\n           transform="matrix(0.5752286,0,0,0.5752286,161.90411,275.5957)"\n           style="stroke:#000000;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1">\n          <rect\n             style="fill:#4d4d4d;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="rect4436"\n             width="45.344299"\n             height="27.532085"\n             x="390.84552"\n             y="630.43866"\n             ry="4.973381"\n             rx="4.973381" />\n          <rect\n             rx="4.973381"\n             ry="4.973381"\n             y="630.43866"\n             x="305.26193"\n             height="27.532085"\n             width="45.344299"\n             id="rect4438"\n             style="fill:#4d4d4d;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />\n          <rect\n             style="fill:#4d4d4d;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="rect4440"\n             width="32.910625"\n             height="27.325605"\n             x="354.27057"\n             y="630.23145"\n             ry="4.973381"\n             rx="4.973381" />\n        </g>\n        <path\n           sodipodi:nodetypes="cssscc"\n           id="path3365"\n           d="m 655.50745,318.60794 c -0.21851,-1.09254 -4.15168,-18.13627 -4.58869,-20.97689 -0.43702,-2.84062 -1.09255,-4.37019 -4.5887,-6.77379 -32.81359,-22.55933 -71.20626,-33.45047 -109.25465,-27.31366 -6.77379,1.09254 -15.51417,18.13627 -15.51417,18.13627 z"\n           style="fill:#d8d8d8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           data-button="button-5" />\n        <path\n           style="fill:#d8d8d8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           d="m 97.673659,318.60794 c 0.218509,-1.09254 4.151681,-18.13627 4.588691,-20.97689 0.43702,-2.84062 1.09255,-4.37019 4.5887,-6.77379 32.81359,-22.55933 71.20626,-33.45047 109.25465,-27.31366 6.77379,1.09254 15.51417,18.13627 15.51417,18.13627 z"\n           id="path3352"\n           sodipodi:nodetypes="cssscc"\n           data-button="button-4" />\n        <path\n           style="fill:#cccccc;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           d="m 692.40625,795.6875 c 36.84007,1.09337 52.80772,-18.83796 56.40625,-117.4375 3.77124,-103.33202 -63.29854,-299.68945 -82.96875,-349.21875 -19.67025,-49.52929 -118.71329,-75.82532 -163.65625,-47.5 -36.98649,23.31075 -77.50632,26.375 -127.03125,26.375 -49.52492,0 -90.0135,-3.06425 -127,-26.375 -12.6402,-7.9665 -29.58112,-11.63473 -47.8125,-11.65625 C 153.75246,269.82 98.606739,293.43208 84.46875,329.03125 64.798509,378.56054 -2.2712417,574.91797 1.5,678.25 c 3.5785642,98.05266 19.406856,118.31763 55.8125,117.45312 84.47581,-9.05099 93.14578,-56.86454 150.09375,-101.60937 52.79739,-41.48369 89.78117,-45.2585 167.46875,-43.75 77.68757,-1.50848 114.64011,2.26634 167.4375,43.75 56.94798,44.7448 65.61794,92.54276 150.09375,101.59375 z"\n           id="path3354"\n           sodipodi:nodetypes="cssssscsscscsc" />\n        <path\n           style="fill:#808080;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           d="m 376.55538,626.9578 c -70.07127,10e-6 -105.56406,1.53631 -141.34375,21.125 -74.56634,40.82366 -89.5368,105.33263 -168.59376,147.59375 77.18929,-11.18226 87.06449,-58.28282 142.1875,-101.59375 52.7974,-41.48366 89.78118,-45.2585 167.46876,-43.75 77.68757,-1.50851 114.64011,2.26634 167.4375,43.75 55.31458,43.46144 65.07175,90.74856 143,101.71875 -79.25058,-42.25894 -94.17658,-106.857 -168.8125,-147.71875 -35.77969,-19.58869 -71.27248,-21.125 -141.34375,-21.125 z"\n           id="path3191" />\n        <ellipse\n           style="opacity:1;fill:#d4d4d4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.24301;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           id="path3339"\n           cx="485.73596"\n           cy="515.71448"\n           rx="90.509804"\n           ry="93.149673" />\n        <ellipse\n           style="opacity:1;fill:#d4d4d4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           id="path3335"\n           cx="162.54053"\n           cy="382.21249"\n           rx="76.556213"\n           ry="71.276474" />\n        <ellipse\n           id="path3337"\n           style="opacity:1;fill:#d4d4d4;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.24301;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           cx="264.74118"\n           cy="515.71448"\n           rx="90.509804"\n           ry="93.149673" />\n        <circle\n           style="opacity:1;fill:#333333;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           id="path3249"\n           cx="265.90213"\n           cy="501.4498"\n           r="60.547413" />\n        <path\n           id="path3253"\n           style="fill:#3a3a3a;fill-opacity:1;fill-rule:evenodd;stroke:#515151;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n           d="m 249.60884,556.05516 c 0,5.37504 32.58658,4.96298 32.58658,0 0,-20.05425 16.27567,-36.33015 36.32964,-36.33015 5.24879,1.15665 7.27598,-35.55207 0,-36.55035 -20.05397,0 -36.32964,-16.2759 -36.32964,-36.33015 0,-5.39506 -32.58658,-5.80591 -32.58658,0 0,20.05425 -16.27567,36.33015 -36.32964,36.33015 -5.88003,-0.22498 -7.05562,36.34403 0,36.55035 20.05397,0 36.32964,16.2759 36.32964,36.33015 z"\n           sodipodi:nodetypes="ccccssccc"\n           data-button="dpad-0" />\n        <g\n           id="g3292"\n           data-button="button-9">\n          <rect\n             ry="16.450199"\n             rx="16.450203"\n             y="372.24924"\n             x="437.39334"\n             height="29.558952"\n             width="37.428303"\n             id="rect3288"\n             style="opacity:1;fill:#d1d1d1;fill-opacity:1;fill-rule:evenodd;stroke:#6d6d6d;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />\n          <path\n             transform="matrix(0,1.1259413,1.1259413,0,20.719223,57.395722)"\n             inkscape:randomized="0"\n             inkscape:rounded="0"\n             inkscape:flatsided="true"\n             sodipodi:arg2="0.52359878"\n             sodipodi:arg1="-0.52359878"\n             sodipodi:r2="4.7132702"\n             sodipodi:r1="9.4265404"\n             sodipodi:cy="386.38617"\n             sodipodi:cx="292.76215"\n             sodipodi:sides="3"\n             id="path3290"\n             style="opacity:1;fill:#717171;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             sodipodi:type="star"\n             d="m 300.92577,381.6729 -8.16362,14.13981 -8.16363,-14.13981 z" />\n        </g>\n        <g\n           id="g3296-7"\n           data-button="button-8">\n          <rect\n             style="opacity:1;fill:#d1d1d1;fill-opacity:1;fill-rule:evenodd;stroke:#6d6d6d;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="rect3298-5"\n             width="37.428303"\n             height="29.558952"\n             x="282.40161"\n             y="372.24924"\n             rx="16.450203"\n             ry="16.450199" />\n          <path\n             sodipodi:type="star"\n             style="opacity:1;fill:#717171;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3300-6"\n             sodipodi:sides="3"\n             sodipodi:cx="292.76215"\n             sodipodi:cy="386.38617"\n             sodipodi:r1="9.4265404"\n             sodipodi:r2="4.7132702"\n             sodipodi:arg1="-0.52359878"\n             sodipodi:arg2="0.52359878"\n             inkscape:flatsided="true"\n             inkscape:rounded="0"\n             inkscape:randomized="0"\n             transform="matrix(0,1.1259413,-1.1259413,0,738.02813,57.395722)"\n             d="m 300.92577,381.6729 -8.16362,14.13981 -8.16363,-14.13981 z" />\n        </g>\n        <circle\n           id="path3310"\n           style="opacity:1;fill:#a7a7a7;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.07159;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           cx="379.25415"\n           cy="382.24289"\n           r="27.00733" />\n        <g\n           id="g4372"\n           data-button="button-16">\n          <circle\n             id="path3304"\n             style="opacity:1;fill:#007800;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             cx="379.25418"\n             cy="387.28577"\n             r="42.671013" />\n          <circle\n             style="opacity:1;fill:#979797;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3302"\n             cx="379.25418"\n             cy="387.28577"\n             r="36.252529" />\n          <path\n             style="fill:#007800;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.25pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n             d="m 344.94011,404.6356 c 11.61506,-28.78785 27.87652,-46.26619 54.74832,-50.37874 l 3.08442,2.57034 c -21.94963,7.88995 -42.83002,29.43216 -53.72019,53.46315 z"\n             id="path3306"\n             sodipodi:nodetypes="ccccc" />\n          <path\n             sodipodi:nodetypes="ccccc"\n             id="path3308"\n             d="M 412.64636,405.10615 C 401.90402,378.48134 383.44171,358.47214 358.58899,354.6686 l -2.85267,2.37721 c 20.3004,7.29712 43.03458,31.06484 53.1065,53.29021 z"\n             style="fill:#007800;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.25pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />\n        </g>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           x="472.78644"\n           y="364.41809"\n           id="text3312"><tspan\n             sodipodi:role="line"\n             id="tspan3314"\n             x="472.78644"\n             y="364.41809"\n             style="font-size:10.9335px;line-height:-2">START</tspan></text>\n        <path\n           d="m 542.19462,503.98223 c 0,31.40573 -25.48873,56.89446 -56.89447,56.89446 -31.40574,0 -56.89447,-25.48873 -56.89447,-56.89446 0,-31.40575 25.48873,-56.89448 56.89447,-56.89448 31.40574,0 56.89447,25.48873 56.89447,56.89448 z m -8.30373,-1e-5 c 0,26.82209 -21.76866,48.59074 -48.59074,48.59074 -26.82209,0 -48.59075,-21.76865 -48.59075,-48.59074 0,-26.82209 21.76866,-48.59074 48.59075,-48.59074 26.82208,0 48.59074,21.76865 48.59074,48.59074 z"\n           style="fill:#dfdfdf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.06703;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n           id="path3348" />\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           x="284.78766"\n           y="362.92157"\n           id="text3316"><tspan\n             sodipodi:role="line"\n             id="tspan3318"\n             x="284.78766"\n             y="362.92157"\n             style="font-size:10.9335px;line-height:1">BACK</tspan></text>\n        <path\n           id="path3350"\n           style="fill:#dfdfdf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.06703;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n           d="m 218.67656,375.05998 c 0,30.22813 -24.533,54.76113 -54.76114,54.76113 -30.22814,0 -54.76114,-24.533 -54.76114,-54.76113 0,-30.22815 24.533,-54.76115 54.76114,-54.76115 30.22814,0 54.76114,24.533 54.76114,54.76115 z m -7.99237,-10e-6 c 0,25.81636 -20.95242,46.76877 -46.76877,46.76877 -25.81636,0 -46.76878,-20.95241 -46.76878,-46.76877 0,-25.81636 20.95242,-46.76877 46.76878,-46.76877 25.81635,0 46.76877,20.95241 46.76877,46.76877 z" />\n        <path\n           id="path3320"\n           style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#969696;stroke-width:0.81337;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n           d="m 379.23104,433.61031 c 12.61575,0 24.35251,-4.77192 32.3309,-13.285 7.1145,-7.5913 15.68671,-13.9149 22.63475,-13.9149 6.94804,0 -0.53333,0 -0.53333,0 0,0 27.94422,0 27.94422,0 10.45366,0 18.93778,-8.48412 18.93778,-19.03121 0,-10.54708 -8.48412,-19.0312 -18.93778,-19.0312 0,0 -27.94422,0 -27.94422,0 0,0 7.48137,0 0.53333,0 -6.94804,0 -15.52025,-6.3236 -22.63475,-13.9149 -7.97839,-8.51308 -19.73829,-13.285 -32.3309,-13.285 -12.5926,0 -24.3525,4.77192 -32.33089,13.285 -7.1145,7.5913 -15.68671,13.9149 -22.63475,13.9149 -6.94804,0 0.53333,0 0.53333,0 0,0 -27.94422,0 -27.94422,0 -10.45366,0 -18.93778,8.48412 -18.93778,19.0312 0,10.54709 8.48412,19.03121 18.93778,19.03121 0,0 27.94422,0 27.94422,0 0,0 -7.48137,0 -0.53333,0 6.94804,0 15.52025,6.3236 22.63475,13.9149 7.97839,8.51308 19.71515,13.285 32.33089,13.285 z"\n           sodipodi:nodetypes="cssccsccsscssccsccssc" />\n        <path\n           id="path3341"\n           style="fill:#dfdfdf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.06703;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n           d="m 338.14038,501.44979 c 0,39.8755 -32.36275,72.23825 -72.23826,72.23825 -39.87552,0 -72.23826,-32.36275 -72.23826,-72.23825 0,-39.87552 32.36274,-72.23827 72.23826,-72.23827 39.87551,0 72.23826,32.36275 72.23826,72.23827 z m -10.54315,-1e-5 c 0,34.0557 -27.63942,61.69511 -61.69511,61.69511 -34.0557,0 -61.69512,-27.63941 -61.69512,-61.69511 0,-34.0557 27.63942,-61.69511 61.69512,-61.69511 34.05569,0 61.69511,27.63941 61.69511,61.69511 z" />\n        <g\n           id="g3233-5"\n           data-button="button-10">\n          <circle\n             style="opacity:1;fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3235-6"\n             cx="163.84641"\n             cy="375.03775"\n             r="49.266716" />\n          <circle\n             id="path3237-6"\n             style="opacity:1;fill:#333333;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             cx="163.84641"\n             cy="375.03778"\n             r="34.993183" />\n          <g\n             id="g3239-4"\n             transform="matrix(1.0746269,0,0,1.0746269,-358.16498,-156.16434)">\n            <circle\n               transform="matrix(0.08411222,0,0,0.08411222,471.14277,452.73529)"\n               id="path3241-0"\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               id="path3243-0"\n               transform="matrix(0.08411222,0,0,0.08411222,417.73213,452.73529)"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               id="path3245-4"\n               transform="matrix(0,0.08411222,-0.08411222,0,527.33836,479.69524)"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               transform="matrix(0,0.08411222,-0.08411222,0,527.33836,426.2846)"\n               id="path3247-6"\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n          </g>\n        </g>\n        <g\n           id="g3224"\n           data-button="button-11">\n          <circle\n             id="path3196"\n             style="opacity:1;fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             cx="491.28583"\n             cy="494.31305"\n             r="49.266716"\n             transform="translate(-5.525239)" />\n          <circle\n             style="opacity:1;fill:#333333;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:4.22368;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3198"\n             transform="matrix(0.7102804,0,0,0.7102804,136.8099,143.21219)"\n             cx="491.28583"\n             cy="494.31305"\n             r="49.266716" />\n          <g\n             transform="matrix(1.0746269,0,0,1.0746269,-36.250788,-36.889032)"\n             id="g3218">\n            <circle\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               id="path3200"\n               transform="matrix(0.08411222,0,0,0.08411222,471.14277,452.73529)"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               transform="matrix(0.08411222,0,0,0.08411222,417.73213,452.73529)"\n               id="path3202"\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               transform="matrix(0,0.08411222,-0.08411222,0,527.33836,479.69524)"\n               id="path3210-6"\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n            <circle\n               style="fill:#9b9b9b;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:26.75;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n               id="path3212-9"\n               transform="matrix(0,0.08411222,-0.08411222,0,527.33836,426.2846)"\n               cx="491.28583"\n               cy="494.31305"\n               r="49.266716" />\n          </g>\n        </g>\n        <circle\n           id="path3405"\n           style="opacity:1;fill:#dadada;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.26316;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           cx="645.6366"\n           cy="385.60663"\n           r="36.203922" />\n        <path\n           sodipodi:nodetypes="cssssscsscscsc"\n           id="path3363"\n           d="m 692.40625,795.6875 c 36.84007,1.09337 52.80772,-18.83796 56.40625,-117.4375 3.77124,-103.33202 -63.29854,-299.68945 -82.96875,-349.21875 -19.67025,-49.52929 -118.71329,-75.82532 -163.65625,-47.5 -36.98649,23.31075 -77.50632,26.375 -127.03125,26.375 -49.52492,0 -90.0135,-3.06425 -127,-26.375 -12.6402,-7.9665 -29.58112,-11.63473 -47.8125,-11.65625 C 153.75246,269.82 98.606739,293.43208 84.46875,329.03125 64.798509,378.56054 -2.2712417,574.91797 1.5,678.25 c 3.5785642,98.05266 19.406856,118.31763 55.8125,117.45312 84.47581,-9.05099 93.14578,-56.86454 150.09375,-101.60937 52.79739,-41.48369 89.78117,-45.2585 167.46875,-43.75 77.68757,-1.50848 114.64011,2.26634 167.4375,43.75 56.94798,44.7448 65.61794,92.54276 150.09375,101.59375 z"\n           style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />\n        <circle\n           style="opacity:1;fill:#dadada;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.26316;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           id="path3403"\n           cx="536.64771"\n           cy="385.60663"\n           r="36.203922" />\n        <circle\n           style="opacity:1;fill:#dadada;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.26316;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           id="path3407"\n           cx="590.95355"\n           cy="333.56348"\n           r="36.203922" />\n        <circle\n           id="path3409"\n           style="opacity:1;fill:#dadada;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1.26316;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n           cx="590.95355"\n           cy="441.04388"\n           r="36.203922" />\n        <g\n           id="g4272"\n           data-button="button-2">\n          <circle\n             style="opacity:1;fill:#004cca;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3367"\n             cx="536.64771"\n             cy="382.96677"\n             r="25.267321" />\n          <path\n             style="fill:#ffffff;fill-opacity:0.486772;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n             d="m 553.83094,369.19255 c 0,5.88801 -7.72084,1.63138 -17.23402,1.63138 -9.51318,0 -17.23402,4.25663 -17.23402,-1.63138 0,-5.888 7.72084,-10.66668 17.23402,-10.66668 9.51318,0 17.23402,4.77868 17.23402,10.66668 z"\n             id="path3433"\n             sodipodi:nodetypes="csssc" />\n          <path\n             sodipodi:nodetypes="csssc"\n             id="path3462"\n             d="m 557.61978,396.01861 c 0,-6.53475 -10.46192,4.49228 -21.02005,4.49228 -10.55813,0 -21.02005,-10.71153 -21.02005,-4.17678 0,6.53475 10.46192,11.52283 21.02005,11.52283 10.55813,0 21.02005,-5.30358 21.02005,-11.83833 z"\n             style="fill:#000000;fill-opacity:0.26455;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1" />\n        </g>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono Bold\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:0.70356804;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;"\n           x="491.71802"\n           y="429.30984"\n           id="text3381"\n           transform="scale(1.0913562,0.91629113)"><tspan\n             sodipodi:role="line"\n             id="tspan3383"\n             x="491.71802"\n             y="429.30984"\n             style="font-size:31.1568px;line-height:-2;fill:#000000;fill-opacity:0.70356804;">X</tspan></text>\n        <g\n           id="g4267"\n           data-button="button-3">\n          <circle\n             id="path3371"\n             style="fill:#ffaa00;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             transform="scale(-1)"\n             cx="-591.33069"\n             cy="-328.28375"\n             r="25.267321" />\n          <path\n             sodipodi:nodetypes="csssc"\n             id="path3436"\n             d="m 609.04671,315.31534 c 0,5.88801 -7.72084,1.63138 -17.23402,1.63138 -9.51318,0 -17.23402,4.25663 -17.23402,-1.63138 0,-5.888 7.72084,-10.66668 17.23402,-10.66668 9.51318,0 17.23402,4.77868 17.23402,10.66668 z"\n             style="fill:#ffffff;fill-opacity:0.486772;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1" />\n          <path\n             sodipodi:nodetypes="csssc"\n             id="path3456"\n             d="m 612.51723,341.12116 c 0,-6.53475 -10.46192,4.49228 -21.02005,4.49228 -10.55813,0 -21.02005,-10.71153 -21.02005,-4.17678 0,6.53475 10.46192,11.52283 21.02005,11.52283 10.55813,0 21.02005,-5.30358 21.02005,-11.83833 z"\n             style="fill:#000000;fill-opacity:0.26455;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1" />\n        </g>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono Bold\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:0.70356804;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;"\n           x="541.82349"\n           y="369.6312"\n           id="text3385"\n           transform="scale(1.0913562,0.91629113)"><tspan\n             sodipodi:role="line"\n             id="tspan3387"\n             x="541.82349"\n             y="369.6312"\n             style="font-size:31.1568px;line-height:-2;fill:#000000;fill-opacity:0.70356804;">Y</tspan></text>\n        <g\n           id="g4257"\n           data-button="button-0">\n          <circle\n             transform="scale(-1)"\n             style="fill:#009a00;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             id="path3373"\n             cx="-591.33069"\n             cy="-437.64978"\n             r="25.267321" />\n          <path\n             style="fill:#ffffff;fill-opacity:0.486772;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n             d="m 609.04671,423.73903 c 0,5.88801 -7.72084,1.63138 -17.23402,1.63138 -9.51318,0 -17.23402,4.25663 -17.23402,-1.63138 0,-5.888 7.72084,-10.66668 17.23402,-10.66668 9.51318,0 17.23402,4.77868 17.23402,10.66668 z"\n             id="path3438"\n             sodipodi:nodetypes="csssc" />\n          <path\n             style="fill:#000000;fill-opacity:0.26455;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n             d="m 612.51723,450.91606 c 0,-6.53475 -10.46192,4.49228 -21.02005,4.49228 -10.55813,0 -21.02005,-10.71153 -21.02005,-4.17678 0,6.53475 10.46192,11.52283 21.02005,11.52283 10.55813,0 21.02005,-5.30358 21.02005,-11.83833 z"\n             id="path3460"\n             sodipodi:nodetypes="csssc" />\n        </g>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono Bold\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:0.70356804;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;"\n           x="541.82349"\n           y="488.98853"\n           id="text3389"\n           transform="scale(1.0913562,0.91629113)"><tspan\n             sodipodi:role="line"\n             id="tspan3391"\n             x="541.82349"\n             y="488.98853"\n             style="font-size:31.1568px;line-height:-2;fill:#000000;fill-opacity:0.70356804;">A</tspan></text>\n        <g\n           id="g4262"\n           data-button="button-1">\n          <circle\n             id="path3369"\n             style="opacity:1;fill:#740000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n             cx="646.01373"\n             cy="382.96677"\n             r="25.267321" />\n          <path\n             sodipodi:nodetypes="csssc"\n             id="path3440"\n             d="m 663.92784,369.52718 c 0,5.88801 -7.72084,1.63138 -17.23402,1.63138 -9.51318,0 -17.23402,4.25663 -17.23402,-1.63138 0,-5.888 7.72084,-10.66668 17.23402,-10.66668 9.51318,0 17.23402,4.77868 17.23402,10.66668 z"\n             style="fill:#ffffff;fill-opacity:0.486772;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1" />\n          <path\n             style="fill:#000000;fill-opacity:0.26455;fill-rule:evenodd;stroke:none;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1"\n             d="m 667.73018,396.01861 c 0,-6.53475 -10.46192,4.49228 -21.02005,4.49228 -10.55813,0 -21.02005,-10.71153 -21.02005,-4.17678 0,6.53475 10.46192,11.52283 21.02005,11.52283 10.55813,0 21.02005,-5.30358 21.02005,-11.83833 z"\n             id="path3464"\n             sodipodi:nodetypes="csssc" />\n        </g>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;line-height:0%;font-family:\'DejaVu Sans Mono\';-inkscape-font-specification:\'DejaVu Sans Mono Bold\';text-align:center;writing-mode:lr-tb;text-anchor:middle;fill:#000000;fill-opacity:0.70356804;stroke:none;stroke-width:3pt;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;"\n           x="591.54114"\n           y="429.32504"\n           id="text3393"\n           transform="scale(1.0913562,0.91629113)"><tspan\n             sodipodi:role="line"\n             id="tspan3395"\n             x="591.54114"\n             y="429.32504"\n             style="font-size:31.1568px;line-height:-2;fill:#000000;fill-opacity:0.70356804;">B</tspan></text>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:Arial;-inkscape-font-specification:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#808080;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           x="334.25269"\n           y="350.16708"\n           id="text4416"><tspan\n             sodipodi:role="line"\n             id="tspan4418"\n             x="334.25269"\n             y="350.16708"\n             style="font-size:19.0724px;line-height:1.25">1</tspan></text>\n        <text\n           id="text4420"\n           y="350.16708"\n           x="412.03046"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:Arial;-inkscape-font-specification:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#808080;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           xml:space="preserve"><tspan\n             y="350.16708"\n             x="412.03046"\n             id="tspan4422"\n             sodipodi:role="line"\n             style="font-size:19.0724px;line-height:1.25">2</tspan></text>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-weight:normal;line-height:0%;font-family:\'Bitstream Vera Sans\';fill:#007800;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;"\n           x="337.12454"\n           y="424.88486"\n           id="text4424"><tspan\n             sodipodi:role="line"\n             id="tspan4426"\n             x="337.12454"\n             y="424.88486"\n             style="font-size:40px;line-height:1.25;fill:#007800;fill-opacity:1;"></tspan></text>\n        <text\n           id="text4428"\n           y="436.35324"\n           x="334.25269"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:Arial;-inkscape-font-specification:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#808080;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           xml:space="preserve"><tspan\n             y="436.35324"\n             x="334.25269"\n             id="tspan4430"\n             sodipodi:role="line"\n             style="font-size:19.0724px;line-height:1.25">3</tspan></text>\n        <text\n           xml:space="preserve"\n           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:0%;font-family:Arial;-inkscape-font-specification:Arial;text-align:start;writing-mode:lr-tb;text-anchor:start;fill:#808080;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n           x="412.03046"\n           y="436.35324"\n           id="text4432"><tspan\n             sodipodi:role="line"\n             id="tspan4434"\n             x="412.03046"\n             y="436.35324"\n             style="font-size:19.0724px;line-height:1.25">4</tspan></text>\n      </g>\n    </g>\n  </g>\n  <g\n     inkscape:groupmode="layer"\n     id="layer4"\n     inkscape:label="Layer 2"\n     transform="translate(-125.52048,-405.39779)">\n\t<g cv-if = "a" class = "a">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:0.499999;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="m 455.79635,519.99047 69.71001,17.90083"\n       id="path4466-5-6"\n       sodipodi:nodetypes="cc" /></g>\n\t<g cv-if = "x" class = "x">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:0.499999;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="m 438.47373,504.22466 87.03273,22.59255"\n       id="path4466-6"\n       sodipodi:nodetypes="cc" /></g>\n\t<g cv-if = "y" class = "y">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:0.499999;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="m 457.35152,487.45952 68.15505,16.26615"\n       id="path4466-5-6-4"\n       sodipodi:nodetypes="cc" /></g>\n\t<g cv-if = "b" class = "b">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:0.499999;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="m 473.60248,502.87892 51.90361,12.60482"\n       id="path4466-6-0"\n       sodipodi:nodetypes="cc" /></g>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1"\n       x="526.79633"\n       y="517.52081"\n       id="text3125-3-3-9-9"><tspan\n\t     class = "b"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6"\n         x="526.79633"\n         y="517.52081"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:1">[[b]]</tspan></text>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1"\n       x="527.09454"\n       y="540.36304"\n       id="text3125-3-3-9-9-0"><tspan\n\t     class = "a"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-4"\n         x="527.09454"\n         y="540.36304"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:1">[[a]]</tspan></text>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1"\n       x="526.85919"\n       y="529.62354"\n       id="text3125-3-3-9-9-6"><tspan\n\t     class = "x"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-2"\n         x="526.85919"\n         y="529.62354"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:1">[[x]]</tspan></text>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1"\n       x="526.21417"\n       y="506.18649"\n       id="text3125-3-3-9-9-67"><tspan\n\t     class = "y"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-5"\n         x="526.21417"\n         y="506.18649"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:1">[[y]]</tspan></text>\n\t<g cv-if = "r1" class = "r1">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:1.55126;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="M 656.93727,296.09185 821.8762,337.67559"\n       id="path4466-5-6-4-6"\n       sodipodi:nodetypes="cc"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)" />\n\t</g>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:124.101px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3.10253"\n       x="824.07147"\n       y="345.30997"\n       id="text3125-3-3-9-9-67-9"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)"><tspan\n\t     class = "r1"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-5-8"\n         x="824.07147"\n         y="345.30997"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:18.6152px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:3.10253">[[r1]]</tspan></text>\n\t<g cv-if = "l1" class = "l1">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:1.55126;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="M 98.337471,294.83145 -66.601455,336.41519"\n       id="path4466-5-6-4-6-7"\n       sodipodi:nodetypes="cc"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)" /></g>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:124.101px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3.10253"\n       x="-147.9368"\n       y="344.04959"\n       id="text3125-3-3-9-9-67-9-2"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)"><tspan\n\t     class = "l1"\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-5-8-8"\n         x="-147.9368"\n         y="344.04959"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:18.6152px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:3.10253">[[l1]]</tspan></text>\n\t<g cv-if = "dpad">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:1.55126;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="M 195.45,507.2765 -65.76263,575.40558"\n       id="path4466-5-6-4-6-7-2"\n       sodipodi:nodetypes="cc"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)" />\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:124.101px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3.10253"\n       x="-122.35963"\n       y="582.59192"\n       id="text3125-3-3-9-9-67-9-2-9"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)"><tspan\n         sodipodi:role="line"\n         id="tspan3123-1-4-1-6-5-8-8-9"\n         x="-122.35963"\n         y="582.59192"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:18.6152px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:3.10253">[[dpad]]</tspan></text></g>\n\t<g cv-if = "start">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:1.55126;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="M 455.73274,349.69679 V 192.16781"\n       id="path3121"\n       sodipodi:nodetypes="cc"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)" />\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:124.101px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3.10253"\n       x="427.94226"\n       y="186.86783"\n       id="text3125"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)"><tspan\n\t     class = "start"\n         sodipodi:role="line"\n         id="tspan3123"\n         x="427.94226"\n         y="186.86783"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:18.6152px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:3.10253">[[start]]</tspan></text></g>\n\t<g cv-if = "ra" class = "ra">\n    <path\n       style="fill:none;stroke:#000000;stroke-width:1.55126;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n       d="M 542.19462,503.98223 821.8762,583.25165"\n       id="path2959"\n       sodipodi:nodetypes="cc"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)" /></g>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-weight:normal;font-size:124.101px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:3.10253"\n       x="832.28497"\n       y="591.27563"\n       id="text3125-3"\n       transform="matrix(0.32231801,0,0,0.32231801,260.60086,378.95899)"><tspan\n         sodipodi:role="line"\n         id="tspan3123-1"\n         x="832.28497"\n         y="591.27563"\n         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:18.6152px;font-family:sans-serif;-inkscape-font-specification:\'sans-serif, Normal\';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:3.10253">[[ra]]</tspan></text>\n  </g>\n</svg>\n'}),require.register("debug/LineDump.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineDump=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LineDump=class extends i.View{constructor(){super(...arguments),r(this,"template",'<div class = "line-dump" style = "--x:[[x]];--y:[[y]];--length:[[len]];--angle:[[angle]]">\n\t\t<div class = "line" style = "border-color:[[color]]"></div>\n\t</div>'),this.args.x=this.args.x||0,this.args.y=this.args.y||0}}}),require.register("debug/PointDump.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointDump=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.PointDump=class extends i.View{constructor(){super(...arguments),r(this,"template",'<div class = "point-dump">\n\t\t<div class = "point" style = "--color:[[color]]">[[x]], [[y]]</div>\n\t</div>'),this.args.x=this.args.x||0,this.args.y=this.args.y||0}}}),require.register("debug/arrow-east.svg",function(t,e,s){s.exports='<svg width="497.81px" height="497.81px" enable-background="new 0 0 497.812 497.812" version="1.1" viewBox="0 0 497.81 497.81" xmlns="http://www.w3.org/2000/svg">\n\t<g transform="matrix(-1 0 0 1 497.81 0)">\n\t\t<path d="m203.66 312.91 117.03 117.03-67.906 67.875-248.91-248.91 248.91-248.91 67.906 67.875-117.06 117.06 290.28-0.031 0.031 127.97z"/>\n\t</g>\n</svg>\n'}),require.register("effects/Cylinder.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cylinder=void 0;var i=e("curvature/base/View"),r=e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Cylinder=class extends i.View{constructor(t,s){super(t,s),a(this,"template",e("./twist.svg")),this.args.scale=this.args.scale||0,this.args.id=this.args.id||"cylinder",this.args.width=this.args.width||64,this.args.height=this.args.height||64}onRendered(){const t=new r.Tag(`<canvas width = "${this.args.width}" height = "${this.args.height}">`),e=t.getContext("2d");e.imageSmoothingEnabled=!1;const s=e.getImageData(0,0,this.args.width,this.args.height),i=s.data;for(let t=0;t<i.length;t+=4){var a,n,o;let e,s,r,l,h;const g=t/4,c=Math.floor(g/this.args.width),d=g%this.args.width-this.args.width/2,u=c-this.args.height/2;Math.hypot(d,u),Math.min(this.args.width,this.args.height),e=128+4*d*(h=Math.abs(d/this.args.width)/2),s=128,r=0,i[t+0]=null!==(a=e)&&void 0!==a?a:128,i[t+1]=null!==(n=s)&&void 0!==n?n:128,i[t+2]=null!==(o=r)&&void 0!==o?o:128,i[t+3]=null!==l&&void 0!==l?l:255}e.putImageData(s,0,0),t.toBlob(t=>this.args.blob=URL.createObjectURL(t),"image/png")}get name(){return`${this.args.id}`}}}),require.register("effects/Droop.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Droop=void 0;var i=e("curvature/base/View"),r=e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class n extends i.View{constructor(t,s){super(t,s),a(this,"template",e("./droop.svg")),this.args.scale=this.args.scale||0,this.args.id=this.args.id||"droop",this.args.width=2*(t.width||64),this.args.height=t.height||64,this.args.intensity=1,this.args.droopWidth="102%"}static generateMap(t,e){const s=`${t}::${e}`,i=this.memoMaps;if(i.has(s))return i.get(s);const a=new r.Tag(`<canvas width = "${t}" height = "${e}">`),n=a.getContext("2d");n.imageSmoothingEnabled=!1;const o=n.getImageData(0,0,t,e),l=o.data;for(let e=0;e<l.length;e+=4){var h,g,c,d;let s,i,r,a;const n=e/4,o=n%t/t,u=(Math.floor(n/t),-Math.PI+o*Math.PI);s=128,i=128+Math.round(128*(.5*Math.cos(u)+.5)),r=0,a=255,l[e+0]=null!==(h=s)&&void 0!==h?h:128,l[e+1]=null!==(g=i)&&void 0!==g?g:128,l[e+2]=null!==(c=r)&&void 0!==c?c:128,l[e+3]=null!==(d=a)&&void 0!==d?d:255}n.putImageData(o,0,0);const u=new Promise(t=>a.toBlob(e=>{const s=URL.createObjectURL(e,"image/png");t(s)}));return i.set(s,u),u}onRendered(){this.constructor.generateMap(this.args.width,this.args.height).then(t=>{this.args.blob=t})}get name(){return`${this.args.id}`}}t.Droop=n,a(n,"memoMaps",new Map)}),require.register("effects/Pinch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pinch=void 0;var i=e("curvature/base/View"),r=e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Pinch=class extends i.View{constructor(t,s){super(t,s),a(this,"template",e("./twist.svg")),this.args.scale=this.args.scale||0,this.args.id=this.args.id||"pinch",this.args.width=this.args.width||64,this.args.height=this.args.height||64}onRendered(){const t=new r.Tag(`<canvas width = "${this.args.width}" height = "${this.args.height}">`),e=t.getContext("2d");e.imageSmoothingEnabled=!1;const s=e.getImageData(0,0,this.args.width,this.args.height),i=s.data;for(let t=0;t<i.length;t+=4){var a,n,o;let e,s,r,l,h,g=0;const c=t/4,d=Math.floor(c/this.args.width),u=c%this.args.width-this.args.width/2,p=d-this.args.height/2,f=Math.hypot(u,p),m=Math.min(this.args.width,this.args.height)/2;f<m?(h=(1-f/m)**2,g=(1-f/m)**2):(h=0,g=0),e=128+4*u*h,s=128+4*p*g,r=0,i[t+0]=null!==(a=e)&&void 0!==a?a:128,i[t+1]=null!==(n=s)&&void 0!==n?n:128,i[t+2]=null!==(o=r)&&void 0!==o?o:128,i[t+3]=null!==l&&void 0!==l?l:255}e.putImageData(s,0,0),t.toBlob(t=>this.args.blob=URL.createObjectURL(t),"image/png")}get name(){return`${this.args.id}`}}}),require.register("effects/ScreenFire.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenFire=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ScreenFire=class extends i.View{constructor(){super(...arguments),r(this,"template",e("./screen-fire"))}onAttach(t){this.args.animation="playing"}}}),require.register("effects/ScreenWarp.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenWarp=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ScreenWarp=class extends i.View{constructor(){super(...arguments),r(this,"template",e("./screen-fire"))}onAttach(t){this.args.animation="playing",this.onTimeout(5e3,()=>this.remove())}}}),require.register("effects/Twist.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Twist=void 0;var i=e("curvature/base/View"),r=e("curvature/base/Tag");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Twist=class extends i.View{constructor(t,s){super(t,s),a(this,"template",e("./twist.svg")),this.args.scale=this.args.scale||0,this.args.id=this.args.id||"twist",this.args.width=this.args.width||64,this.args.height=this.args.height||64,this.args.dx=0,this.args.dy=0}onRendered(){const t=new r.Tag('<canvas width = "64" height = "64">'),e=t.getContext("2d");e.imageSmoothingEnabled=!1;const s=e.getImageData(0,0,64,64),i=s.data;for(let t=0;t<i.length;t+=4){var a,n;let e,s,r,o,l=1;const h=t/4,g=h%64-31.5,c=Math.floor(h/64)-31.5,d=Math.hypot(g,c);e=128+4*c*(l=d>32?0:(1-d/32)**3),s=128-4*g*l,i[t+0]=null!==(a=e)&&void 0!==a?a:0,i[t+1]=null!==(n=s)&&void 0!==n?n:0,i[t+2]=null!==r&&void 0!==r?r:0,i[t+3]=null!==o&&void 0!==o?o:255}e.putImageData(s,0,0),t.toBlob(t=>this.args.blob=URL.createObjectURL(t),"image/png")}get name(){return`${this.args.id}`}}}),require.register("effects/droop.svg",function(t,e,s){s.exports='<svg\n\twidth  ="100%"\n\theight ="100%"\n>\n\t<defs>\n\n\t\t<filter\n\t\t\tcv-ref = "filter"\n\t\t\tcolor-interpolation-filters="sRGB"\n\t\t\tid = "[[id]]"\n\t\t\twidth  ="102%"\n\t\t\theight ="1204%"\n\t\t\tx  = "-1%"\n\t\t\ty  = "-2%"\n\n\t\t>\n\t\t\t<feImage\n\t\t\t\tpreserveAspectRatio = "none"\n\t\t\t\tresult  = "DisplacementSourceLeft"\n\t\t\t\tcv-attr = "width:droopWidthLeft,href:blob"\n\t\t\t/>\n\n\t\t\t<feImage\n\t\t\t\tpreserveAspectRatio = "none"\n\t\t\t\tresult  = "DisplacementSourceRightInvert"\n\t\t\t\tcv-attr = "x:droopRightStart,width:droopWidthRight,href:blob"\n\t\t\t/>\n\n\t\t\t<feColorMatrix\n\t\t\t\tin     = "DisplacementSourceRightInvert"\n\t\t\t\tresult = "DisplacementSourceRight"\n\t\t\t\ttype   = "matrix"\n\t\t\t\tvalues="\n\t\t\t\t\t1 0 0 0 0\n\t\t\t\t\t0 -1 0 0 1.5\n\t\t\t\t\t0 0 1 0 0\n\t\t\t\t\t0 0 0 1 0"\n\t\t\t/>\n\n\t\t\t<feComposite\n\t\t\t\toperator="over"\n\t\t\t\tin     = "DisplacementSourceLeft"\n\t\t\t\tin2    = "DisplacementSourceRight"\n\t\t\t\tresult = "DisplacementSource"\n\t\t\t\twidth  ="102%"\n\t\t\t/>\n\n\t\t\t<feFlood flood-color="#808000" result = "OffsetNeutral" />\n\n\t\t\t<feComposite\n\t\t\t\toperator="over"\n\t\t\t\tin     = "DisplacementSource"\n\t\t\t\tin2    = "OffsetNeutral"\n\t\t\t\tresult = "DisplacementResult"\n\t\t\t\twidth  ="102%"\n\t\t\t/>\n\n\t\t\t<feComposite\n\t\t\t\toperator="over"\n\t\t\t\tin     = "DisplacementSource"\n\t\t\t\tin2    = "OffsetNeutral"\n\t\t\t\tresult = "DisplacementResult"\n\t\t\t\twidth  ="102%"\n\t\t\t/>\n\n\t\t\t<feDisplacementMap\n\t\t\t\txChannelSelector = "R"\n\t\t\t\tyChannelSelector = "G"\n\t\t\t\tin      = "SourceGraphic"\n\t\t\t\tin2     = "DisplacementResult"\n\t\t\t\tcv-ref  = "displace"\n\t\t\t\tcv-attr = "scale:scale"\n\t\t\t\twidth  ="102%"\n\t\t\t/>\n\n\t\t</filter>\n\n\t</defs>\n</svg>\n'}),require.register("effects/screen-fire.html",function(t,e,s){s.exports='<div class = "screen-fire [[animation]]">\n\t<div class = "fire-strip" style = "--index:0"><div></div></div>\n\t<div class = "fire-strip" style = "--index:1"><div></div></div>\n\t<div class = "fire-strip" style = "--index:2"><div></div></div>\n\t<div class = "fire-strip" style = "--index:3"><div></div></div>\n\t<div class = "fire-strip" style = "--index:4"><div></div></div>\n\t<div class = "fire-strip" style = "--index:5"><div></div></div>\n\t<div class = "fire-strip" style = "--index:6"><div></div></div>\n\t<div class = "fire-strip" style = "--index:7"><div></div></div>\n\t<div class = "fire-strip" style = "--index:8"><div></div></div>\n\t<div class = "fire-strip" style = "--index:9"><div></div></div>\n\t<div class = "fire-strip" style = "--index:10"><div></div></div>\n\t<div class = "fire-strip" style = "--index:11"><div></div></div>\n\t<div class = "fire-strip" style = "--index:12"><div></div></div>\n\t<div class = "fire-strip" style = "--index:13"><div></div></div>\n\t<div class = "fire-strip" style = "--index:14"><div></div></div>\n\t<div class = "fire-strip" style = "--index:15"><div></div></div>\n\t<div class = "fire-strip" style = "--index:16"><div></div></div>\n</div>\n'}),require.register("effects/twist.svg",function(t,e,s){s.exports='<svg\n\theight ="100%"\n\twidth  ="100%"\n>\n\t<defs>\n\n\t\t<filter\n\t\t\tcv-ref = "filter"\n\t\t\tcolor-interpolation-filters="sRGB"\n\t\t\theight = "100%"\n\t\t\twidth  = "100%"\n\t\t\tid     = "[[id]]"\n\t\t\tx      = "0%"\n\t\t\ty      = "0%"\n\n\t\t>\n\t\t\t<feFlood\n\t\t\t\tflood-color="#808000"\n\t\t\t\theight = "100%"\n\t\t\t\twidth  = "100%"\n\t\t\t\tresult = "OffsetNeutral"\n\t\t\t\tx="0"\n\t\t\t\ty="0"\n\t\t\t/>\n\n\t\t\t<feImage\n\t\t\t\txlink:href="[[blob]]"\n\t\t\t\tresult = "DisplacementSource"\n\t\t\t\theight = "100%"\n\t\t\t\twidth  = "100%"\n\t\t\t/>\n\n\t\t\t<feOffset\n\t\t\t\tin      = "DisplacementSource"\n\t\t\t\tresult  = "OffsetSource"\n\t\t\t\tcv-attr =  "dx:dx,dy:dy"\n\t\t\t/>\n\n\t\t\t<feComposite\n\t\t\t\toperator="over"\n\t\t\t\tin2    = "OffsetNeutral"\n\t\t\t\tin     = "OffsetSource"\n\t\t\t\tresult = "DisplacementResult"\n\t\t\t/>\n\n\t\t\t<feDisplacementMap\n\t\t\t\txChannelSelector = "R"\n\t\t\t\tyChannelSelector = "G"\n\t\t\t\tin      = "SourceGraphic"\n\t\t\t\tin2     = "DisplacementResult"\n\t\t\t\tcv-ref  = "displace"\n\t\t\t\tcv-attr = "scale:scale"\n\t\t\t/>\n\n\t\t</filter>\n\n\t</defs>\n</svg>\n'}),require.register("initialize.js",function(t,e,s){"use strict";var i=e("./audio/Bgm"),r=e("./audio/Sfx"),a=e("./viewport/Viewport"),n=e("matrix-api/Matrix");if(i.Bgm.register("MENU_THEME","/Sonic/s3k-competition.mp3"),"/accept-sso"===location.pathname){const t="https://matrix.org/_matrix",e=new n.Matrix(t),s=new URLSearchParams(location.search).get("loginToken");e.completeSso(s)}else{const t=new a.Viewport;document.addEventListener("DOMContentLoaded",function(){console.log("Starting..."),navigator.serviceWorker&&navigator.serviceWorker.register("/worker-cache.js");let e=0;const s=i=>{const r=i-e;r<1e3/(t.args.maxFps||61)?requestAnimationFrame(s):(t.update(),t.args.fps=1e3/r,e=i,requestAnimationFrame(s))};t.render(document.body),s()}),i.Bgm.register("STAR_SHIELD","/audio/leslie-wai/feel-the-sunshine.mp3"),i.Bgm.register("RADICAL_CITY","/audio/colbreakz/848482_ColBreakz---My-Universe.mp3"),i.Bgm.register("WEST_SIDE","/audio/akselmcbossmcgee123/1066486_Blammed-By-Pico.mp3"),i.Bgm.register("UNDERGROUND_ZONE","/audio/tee-lopes/under-ground-zone-remix.mp3"),i.Bgm.register("MISTY_RUINS","audio/neil-voss/extol.mp3"),i.Bgm.register("MANIC_HARBOR","/audio/bobenshibobsled/1024371_Curse-Ska-Version.mp3"),i.Bgm.register("TITLE_THEME","/Sonic/carnival-night-zone-act-2-beta.mp3"),i.Bgm.register("TUTORIAL_THEME","/audio/teravex/1083419_Lowbeat.mp3"),i.Bgm.register("CITY_ESCAPE","/audio/senoue-jun/city-escape.mp3"),i.Bgm.register("AGORAPOLIS","/audio/AetheR/1063556_Forest.mp3"),i.Bgm.register("ACT-BOSS","/audio/F-777/Double-Cross.mp3"),i.Bgm.register("ZONE-BOSS","/audio/dex-arson/rampage.mp3"),i.Bgm.register("ACT_CLEAR","/audio/gta-sa/mission-passed.mp3",{volume:1}),i.Bgm.register("NO_WAY","/audio/sonic/no-way.mp3"),r.Sfx.register("WTF_BOOM","/audio/meme/wtf-boom.mp3"),r.Sfx.register("PLAYER_DAMAGED","/Sonic/S3K_35.wav"),r.Sfx.register("RINGS_SCATTERED","/Sonic/ring-loss.wav",{maxConcurrent:3,volume:.75,fudgeFactor:0}),r.Sfx.register("BUMPER_BOUNCE","/Sonic/S3K_AA.wav"),r.Sfx.register("BOOST_RING","/Sonic/S3K_CA.wav",{maxConcurrent:1,volume:.75,fudgeFactor:.2}),r.Sfx.register("RING_COLLECTED","/Sonic/ring-collect.wav",{maxConcurrent:3,volume:.25,fudgeFactor:.1}),r.Sfx.register("SPIKE_DAMAGE","/Sonic/S2_26.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.1}),r.Sfx.register("EMBLEM_COLLECTED","/custom/emblem-collect.wav",{maxConcurrent:3,volume:.25,fudgeFactor:.1}),r.Sfx.register("EMERALD_COLLECTED","/Sonic/S3K_9C.wav"),r.Sfx.register("OBJECT_DESTROYED","/Sonic/object-destroyed.wav",{maxConcurrent:8,volume:.75,fudgeFactor:.3}),r.Sfx.register("BOX_DESTROYED","/Sonic/S3K_B4.wav",{maxConcurrent:4,volume:1,fudgeFactor:0,startTime:0}),r.Sfx.register("BLOCK_DESTROYED","/Sonic/0A3H.wav",{maxConcurrent:4,volume:1,fudgeFactor:0,startTime:.2,throttle:100}),r.Sfx.register("WORM_BLOCK_DESTROYED","/Sonic/0A3H.wav",{maxConcurrent:4,volume:.8,fudgeFactor:.2,startTime:.2,throttle:100}),r.Sfx.register("ROCKS_DESTROYED","/Sonic/rock-smash.wav"),r.Sfx.register("ROCK_BREAK_1","/Sonic/S1_B9.wav",{maxConcurrent:1,volume:.75,fudgeFactor:.3}),r.Sfx.register("ROCK_BREAK_2","/Sonic/S1_CB.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.1}),r.Sfx.register("SPEEDPAD_HIT","/Sonic/S2_2B.wav",{maxConcurrent:3,volume:.75,fudgeFactor:.1}),r.Sfx.register("HALLBOOSTER_HIT","/Sonic/S3K_74.wav",{maxConcurrent:1,volume:.75,fudgeFactor:.1}),r.Sfx.register("SPRING_HIT","/Sonic/spring-activated.wav",{maxConcurrent:2,volume:.5,fudgeFactor:.1}),r.Sfx.register("NOTCH_SPRING_HIT","/Sonic/S3K_7B.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.2}),r.Sfx.register("SWITCH_HIT","/Sonic/switch-activated.wav",{maxConcurrent:3,volume:.3,fudgeFactor:.2}),r.Sfx.register("ALT_BEEP","/Sonic/S2_28.wav",{maxConcurrent:8,volume:.5,fudgeFactor:.2}),r.Sfx.register("KNOCK_PLATFORM","/Sonic/S2_57.wav",{maxConcurrent:3,volume:.8,fudgeFactor:.2}),r.Sfx.register("STAR_TWINKLE","/Sonic/S2_27.wav",{maxConcurrent:3,volume:.8,fudgeFactor:.2}),r.Sfx.register("PAD_BOUNCE","/Sonic/S2_58.wav",{maxConcurrent:3,volume:.8,fudgeFactor:.2}),r.Sfx.register("SPRING_SHOT","/Sonic/S2_62.wav",{maxConcurrent:3,volume:.8,fudgeFactor:.2}),r.Sfx.register("QUICK_SLIDE","/Sonic/S2_5B.wav",{maxConcurrent:1,volume:.3,fudgeFactor:.2}),r.Sfx.register("SS_BWIP","/Sonic/S1_A9.wav",{maxConcurrent:1,volume:.7,fudgeFactor:.2}),r.Sfx.register("SS_BWIP_HIGH","/Sonic/S2_29.wav",{maxConcurrent:8,volume:.85,fudgeFactor:.2}),r.Sfx.register("WAIT_TONE","/Sonic/S3K_A7.wav",{maxConcurrent:8,volume:.5,fudgeFactor:.2}),r.Sfx.register("READY_TONE","/Sonic/S3K_AD.wav",{maxConcurrent:8,volume:.5,fudgeFactor:.2}),r.Sfx.register("STARPOST_HIT","/Sonic/starpost-active.wav",{volume:.5}),r.Sfx.register("SHOT_FIRED","/Sonic/shot-fired.wav",{volume:.5}),r.Sfx.register("THRUSTER_FIRED","/Sonic/mecha-sonic-thruster.wav"),r.Sfx.register("BOSS_DAMAGED","/Sonic/S3K_6E.wav"),r.Sfx.register("BOSS_DUDHIT","/Sonic/S2_59.wav"),r.Sfx.register("FAIL","/Sonic/S2_6D.wav"),r.Sfx.register("HEAVY_THUD","/Sonic/S3K_96.wav",{maxConcurrent:3,volume:1,fudgeFactor:.2,startTime:0}),r.Sfx.register("WOOD_THUD","/Sonic/S3K_5F_smoother.wav",{maxConcurrent:3,volume:1,fudgeFactor:.2,startTime:.04}),r.Sfx.register("WATER_ACQUIRE","/Sonic/S3K_3F.wav",{volume:.75,fudgeFactor:.1}),r.Sfx.register("WATER_BOUNCE","/Sonic/S3K_44.wav",{volume:.5,fudgeFactor:.1}),r.Sfx.register("ELECTRIC_ACQUIRE","/Sonic/S3K_41.wav",{volume:.75,fudgeFactor:.1}),r.Sfx.register("ELECTRIC_JUMP","/Sonic/S3K_45.wav",{maxConcurrent:3,volume:.5,fudgeFactor:.1}),r.Sfx.register("FIRE_ACQUIRE","/Sonic/S3K_3E.wav",{volume:.75,fudgeFactor:.1}),r.Sfx.register("FIRE_DASH","/Sonic/S3K_43.wav",{volume:.5,fudgeFactor:.1}),r.Sfx.register("CHOPPER_DRONE","/Sonic/drill-car-copter.wav"),r.Sfx.register("CHOPPER_GUN","/Sonic/010.Synth_MLT_se_ac_bf_ricochet.wav",{maxConcurrent:4,volume:.5,fudgeFactor:.25}),r.Sfx.register("MECHASONIC_TAKEOFF","/Sonic/mecha-sonic-takeoff.wav"),r.Sfx.register("MECHASONIC_SCRAPE","/Sonic/mecha-sonic-scrape.wav"),r.Sfx.register("MECHASONIC_SLAP","/Sonic/mecha-sonic-thruster-close.wav"),r.Sfx.register("TAILS_FLY","/Sonic/tails-flying.wav"),r.Sfx.register("DOOT_DOOT","/audio/meme/doot-doot.mp3"),r.Sfx.register("HOOK_GRABBED","/Sonic/S3K_4A.wav"),r.Sfx.register("LIGTNING_STRIKE","/Sonic/S3K_4E.wav",{maxConcurrent:1,volume:1,fudgeFactor:0}),r.Sfx.register("SECRET_FOUND","/doom/dssecret.wav"),r.Sfx.register("SICK_TRICK","/Sonic/S2_6C.wav",{volume:1,fudgeFactor:0,maxConcurrent:6}),r.Sfx.register("GRINDING","/Sonic/S3K_DB_sus.wav"),r.Sfx.register("SPIKES_OUT","/Sonic/S3K_A6.wav"),r.Sfx.register("SPIKES_IN","/Sonic/S3K_52.wav"),r.Sfx.register("LID_POP","/Sonic/S2_54.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.25}),r.Sfx.register("PROP_PLAT","/Sonic/S3K_PropPlat.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.25}),r.Sfx.register("POGO_BOUNCE","/Sonic/0A8H.wav",{maxConcurrent:3,volume:.5,fudgeFactor:.25}),r.Sfx.register("COPTER_SPIN","/Sonic/drill-car-copter.wav",{maxConcurrent:1,volume:.5,fudgeFactor:0}),r.Sfx.register("TOTAL_SCORE","/Sonic/S3K_B0.wav",{maxConcurrent:1,volume:1,fudgeFactor:0}),r.Sfx.register("TALLY_SCORE","/Sonic/B00_00_05.WAV",{maxConcurrent:1,volume:.5,fudgeFactor:0}),r.Sfx.register("TALLY_SCORE","/Sonic/027.Synth_MLT_menu_score menu text appear.wav",{maxConcurrent:1,volume:.5,fudgeFactor:0}),r.Sfx.register("RADIO_CHATTER_1","/thps2/CD_00171.wav",{maxConcurrent:1,volume:1,fudgeFactor:0}),r.Sfx.register("RADIO_CHATTER_2","/thps2/CD_00181.wav",{maxConcurrent:1,volume:1,fudgeFactor:0}),r.Sfx.register("BARREL_EXPLODE","/audio/doom/DSBAREXP.wav",{maxConcurrent:1,volume:1,fudgeFactor:0}),r.Sfx.register("SAP_HEALTH","/audio/pokemon/SFX_POISONED.wav",{maxConcurrent:1,volume:.5,fudgeFactor:.25,startTime:.1})}}),require.register("intro/BootCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BootCard=void 0;var i=e("./Card");t.BootCard=class extends i.Card{constructor(t,e){super(t,e),this.args.cardName="boot-card",this.args.text="PRODUCED BY\nSEAN MORRIS UNDER\nTHE APACHE 2.0 LICENSE"}}}),require.register("intro/Card.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Card=class extends i.View{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t,arguments.length>1?arguments[1]:void 0),r(this,"template",e("./card.html")),t.text=t.text||"this is an intro card.",this.args.timeout=this.args.timeout||1e3,this.args.animation="opening",this.done=new Promise(t=>this.accept=t)}play(t){this.onTimeout(50,()=>this.args.animation="opened");const e=this.args.waitFor||Promise.resolve();return new Promise(t=>{e.then(()=>{const e=this.args.timeout;e>0&&(this.onTimeout(e-500,()=>this.args.animation="closing"),this.onTimeout(e,()=>{this.args.animation="closed";const s=new Promise(t=>this.onTimeout(e,t));t(this.accept([s]))}))})})}}}),require.register("intro/DebianCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebianCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.DebianCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./debian-card.html")),this.args.cardName="debian-card",this.args.text=""}}}),require.register("intro/GamepadCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GamepadCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.GamepadCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./gamepad-card.html")),this.args.timeout=2500,this.args.cardName="gamepad-card",this.args.text=""}}}),require.register("intro/LoadingCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingCard=void 0;var i=e("./Card");t.LoadingCard=class extends i.Card{constructor(t,e){super(t,e),this.args.cardName="loading-card"}}}),require.register("intro/LogoSplash.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoSplash=void 0;var i=e("curvature/base/View"),r=e("../audio/Sfx");t.LogoSplash=class extends i.View{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),this.template='\n\t\t<div class = "player-waving"></div>\n\t\t<div class = "splash [[animation]]" style = "\n\t\t\tpointer-events: [[pointerEvents]]\n\t\t">\n\t\t\t<div class = "center">SEAN<span class = "min">MORRIS</span><div class = "sm">SM</div></div>\n\t\t\t<div class = "center">SEAN<span class = "min">MORRIS</span><div class = "sm">SM</div></div>\n\t\t\t<div class = "center">SEAN<span class = "min">MORRIS</span><div class = "sm">SM</div></div>\n\t\t</div>'}onAttached(){this.alreadyAttached||(this.alreadyAttached=!0,this.args.left=0,this.args.right=0,this.args.fade=1,this.args.frame=0,this.args.fullFade=1,this.args.pointerEvents="all",this.args.animation="hide",this.onTimeout(500,()=>this.args.animation="slide"),this.onTimeout(1250,()=>this.args.animation="show"),this.onTimeout(5e3,()=>this.args.animation="done"),this.onTimeout(1250,()=>r.Sfx.play("RING_COLLECTED")))}}}),require.register("intro/NewgroundsCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewgroundsCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.NewgroundsCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./newgrounds-card.html")),this.args.timeout=2500,this.args.cardName="newgrounds-card",this.args.text=""}}}),require.register("intro/NoWayCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoWayCard=void 0;var i=e("./Card"),r=e("../audio/Bgm"),a=e("../ui/CharacterString");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.NoWayCard=class extends i.Card{constructor(t,s){super(t,s),n(this,"template",e("./no-way.html")),this.args.cardName="no-way-card",this.args.text=new a.CharacterString({value:"Error: "+this.args.errorString}),this.args.backdrop="..."}onAttached(){r.Bgm.play("NO_WAY",{loop:!0})}}}),require.register("intro/SaneCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SaneCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SaneCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./sane-card.html")),this.args.cardName="sane-card",this.args.text=""}}}),require.register("intro/SeanCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeanCard=void 0;var i=e("./Card"),r=e("./LogoSplash");t.SeanCard=class extends i.Card{constructor(t,e){super(t,e),this.args.cardName="sean-card",this.args.text=new r.LogoSplash({},e)}}}),require.register("intro/Series.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Series=void 0;var i=e("curvature/base/View");e("./Card");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Series=class extends i.View{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0),r(this,"template",'<div class = "intro-cards" cv-each = "cards:card:c">[[card]]</div>'),this.cards=this.args.cards,this.args.cards=[],this.args.card=null,this.startTime=!1}play(){if(!this.cards.length)return;const t=this.cards.shift(),e=new Promise(e=>t.onRemove(e)),s=t.play();this.args.cards.push(t),this.startTime=Date.now();const i=[e,t.done];return s&&i.push(s),Promise.race(i).then(e=>(e&&this.parent.onFrameOut(10,()=>t.remove()),this.cards.length?this.play():s))}input(t){const e=this.args.cards[this.args.cards.length-1];e&&e.input&&e.input(t)}}}),require.register("intro/SkippableCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkippableCard=void 0;var i=e("./Card");t.SkippableCard=class extends i.Card{constructor(t,e){super(t,e),this.args.cardName="skippable-card",this.args.text=""}input(t){!this.started||Date.now()+-this.started<500||(t.buttons[9]&&1===t.buttons[9].time||t.buttons[0]&&1===t.buttons[0].time)&&(this.onTimeout(200,()=>this.startPressed=!0),this.args.animation="closing")}play(){return this.started=Date.now(),Promise.race([super.play(),new Promise(t=>this.onFrame(()=>{this.startPressed&&t()}))])}}}),require.register("intro/ThankYouCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThankYouCard=void 0;var i=e("./Card"),r=e("../ui/CharacterString");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ThankYouCard=class extends i.Card{constructor(t,s){super(t,s),a(this,"template",e("./thank-you.html")),this.args.cardName="thank-you-card",this.args.text=new r.CharacterString({value:"Thank you for playing!"}),this.args.backdrop="..."}}}),require.register("intro/TitleScreenCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TitleScreenCard=void 0;var i=e("./Card"),r=e("../ui/CharacterString"),a=e("../audio/Bgm"),n=e("../backdrop/MarbleGarden"),o=e("curvature/input/Keyboard");function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.TitleScreenCard=class extends i.Card{constructor(t,s){super(t,s),l(this,"template",e("./titlescreen.html")),this.args.cardName="title-screen-card",this.args.text="",this.args.backdrop="...",this.startPressed=!1;const i=new n.MarbleGarden;i.args.frame=0,i.args.x=0,i.args.y=140,i.args.xMax=1e4,i.args.yMax=800,this.started=0,o.Keyboard.get().reset();const a=o.Keyboard.get().codes.bindTo("Enter",t=>{!this.started||Date.now()-this.started<2e3||t<=0||void 0===t||(this.onTimeout(200,()=>this.startPressed=!0),this.args.animation="closing")});this.onRemove(a),i.args.xPan=0,this.start=new Promise(t=>this.onFrame(()=>{if(this.started&&!(Date.now()-this.started<0)&&(i.args.xPan-=24,i.args.frame++,this.startPressed)){const e=new Promise(t=>this.onTimeout(200,t));t([e])}})),this.args.backdrop=i,this.args.pressStart=new r.CharacterString({value:"press start/enter"})}input(t){!this.started||Date.now()-this.started<2e3?t.zero():t.buttons[9]&&1===t.buttons[9].time&&(this.onTimeout(200,()=>this.startPressed=!0),this.args.animation="closing")}play(){this.onTimeout(1e3,()=>{this.onRemove(()=>a.Bgm.stop("TITLE_THEME")),a.Bgm.play("TITLE_THEME")}),this.onTimeout(2e3,()=>this.args.aurora="aurora"),this.started=Date.now();const t=super.play();return Promise.race([this.start,t])}}}),require.register("intro/WarningCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WarningCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WarningCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./warning-card.html")),this.args.cardName="warning-card",this.args.text=""}}}),require.register("intro/WebkitCard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebkitCard=void 0;var i=e("./SkippableCard");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WebkitCard=class extends i.SkippableCard{constructor(t,s){super(t,s),r(this,"template",e("./webkit-card.html")),this.args.cardName="webkit-card",this.args.text=""}play(t){return this.onTimeout(1500,()=>this.args.animation="spindash-charge"),this.onTimeout(3e3,()=>this.args.animation="spindash"),super.play(t)}}}),require.register("intro/card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]]">\n\t<span>[[text]]</span>\n</div>\n'}),require.register("intro/debian-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div class = "debian-logo"></div>\n\t\t<div class = "caption">Built on Debian</div>\n\t</div>\n</div>\n'}),require.register("intro/gamepad-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div class = "gamepad-svg"></div>\n\t\t<div class = "caption">Supports HTML5 Gamepad API.</div>\n\t\t<div class = "button-callout">Toggle audio and fullscreen<div class = "arrow"></div></div>\n\t</div>\n</div>\n\n'}),require.register("intro/newgrounds-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div class = "caption">Special thanks to the artists on</div>\n\t\t<div class = "newgrounds-svg"></div>\n\t</div>\n</div>\n\n'}),require.register("intro/no-way.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "player-waving"></div>\n\t<div class = "no-way"></div>\n\t<div class = "main-elements-container">\n\t\t[[text]]\n\t</div>\n</div>\n'}),require.register("intro/sane-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div><img src = "/icons/chaosean.svg" /></div>\n\t\t<div><img src = "/icons/sane-engine.svg" /></div>\n\t</div>\n</div>\n\n'}),require.register("intro/thank-you.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "player-waving"></div>\n\t<div class = "main-elements-container">\n\t\t<div class = "title-emblem"></div>\n\t\t[[text]]\n\t</div>\n</div>\n'}),require.register("intro/titlescreen.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t[[backdrop]]\n\n\t<div class = "main-elements-container">\n\n\t\t<div class = "title-emblem"></div>\n\t\t<div class = "press-start">[[pressStart]]</div>\n\n\t</div>\n\n</div>\n'}),require.register("intro/warning-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div class = "warning-svg"></div>\n\t</div>\n</div>\n\n'}),require.register("intro/webkit-card.html",function(t,e,s){s.exports='<div class = "screen-card screen-card-[[cardName]] [[animation]] [[aurora]]">\n\t<div class = "main-elements-container">\n\t\t<div class = "chromium-logo"></div>\n\t\t<div class = "caption">WebKit recommended for best experience.</div>\n\t</div>\n</div>\n'}),require.register("legacy/Actor.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actor=void 0;var i=e("curvature/base/View"),r=e("../debug/PointDump");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Actor=class extends i.View{constructor(){super(...arguments),a(this,"speed",15),a(this,"template",e("./actor.html")),this.world=null,this.x=92,this.y=1024,this.width=64,this.height=64,this.boxWidth=64,this.boxHeight=64,this.directions=16,this.state="standing",this.gSpeed=0,this.gSpeedMax=40,this.xSpeed=0,this.ySpeed=0,this.angle=0,this.maxGravity=48,this.gravity=0,this.slopeFactor=.01,this.falling=!0,this.sensors={top:!1,bottom:!1,left:!1,right:!1},this.mode=this.args.mode=0,this.modes={floor:0,leftWall:1,ceiling:2,rightWall:3},this.animationClasses={},this.currentClasses=null,this.pdL=new r.PointDump({color:"red"}),this.pdR=new r.PointDump({color:"green"}),this.args.debugs=[this.pdL,this.pdR]}destroy(){}update(){if(!this.tags.actor)return;let t=this.gSpeed;this.args.animspeed=Math.floor((this.gSpeedMax-Math.abs(t))/12),this.args.animspeed<1&&(this.args.animspeed=1);const e=Math.round(1e3*this.angle)/1e3;if(this.falling?(this.falling||this.jumped)&&(this.args.state="jumping"):(e>Math.PI/4&&e<2*Math.PI/4&&(this.mode===this.modes.floor?this.args.mode=this.mode=this.modes.leftWall:this.mode===this.modes.leftWall?this.args.mode=this.mode=this.modes.ceiling:this.mode===this.modes.ceiling?this.args.mode=this.mode=this.modes.rightWall:this.mode===this.modes.rightWall&&(this.args.mode=this.mode=this.modes.floor)),e<-Math.PI/4&&e>-2*Math.PI/4&&(this.mode===this.modes.floor?this.args.mode=this.mode=this.modes.rightWall:this.mode===this.modes.rightWall?this.args.mode=this.mode=this.modes.ceiling:this.mode===this.modes.ceiling?this.args.mode=this.mode=this.modes.leftWall:this.mode===this.modes.leftWall&&(this.args.mode=this.mode=this.modes.floor)),Math.abs(t)>this.gSpeedMax/2?this.args.state="running":Math.abs(t)>0?this.args.state="walking":this.args.state="standing",this.args.facing=t>0?"facing-right":"facing-left"),this.falling?this.mode==this.modes.floor?this.ySpeed++:this.mode==this.modes.ceiling?this.ySpeed--:this.mode==this.modes.leftWall?this.xSpeed--:this.mode==this.modes.rightWall&&this.xSpeed++:this.jumped||(this.xSpeed=0,this.ySpeed=0),this.x+=this.xSpeed,this.ySpeed&&(this.y+=this.ySpeed>0?1:-1),t){const e=8,s=Math.abs(t),i=s>e?e:s;for(let e=0;e<i;e++)this.iteratePosition(Math.floor(t/i))}else this.iteratePosition(0);this.ySpeed>32&&(this.ySpeed=32),this.ySpeed<-32&&(this.ySpeed=-32),this.xSpeed>32&&(this.xSpeed=32),this.xSpeed<-32&&(this.xSpeed=-32),this.tags.actor.style({"--x":Math.floor(this.x),"--y":Math.floor(this.y)}),this.mode===this.modes.floor?this.tags.actor.style({"--angle":this.angle}):this.mode===this.modes.leftWall?this.tags.actor.style({"--angle":this.angle+Math.PI/2*1}):this.mode===this.modes.ceiling?this.tags.actor.style({"--angle":this.angle+Math.PI/2*2}):this.mode===this.modes.rightWall&&this.tags.actor.style({"--angle":this.angle+Math.PI/2*3}),this.jumped&&(this.jumped=!1)}iteratePosition(t){let e=Math.sin(this.angle),s=Math.cos(this.angle);const i=this.center,r=(this.top,this.bottom),a=(this.left,this.right);let n,o,l,h,g;this.mode==this.modes.floor||this.mode==this.modes.ceiling?(n=a-i[0],o=r-i[1]):this.mode!=this.modes.leftWall&&this.mode!=this.modes.rightWall||(n=a-i[1],o=r-i[0]),l=this.left-n*e+.5*n,h=this.right-n*e-.5*n,g=Math.abs(h-l);const c=this.viewport.tileMap;let d,u,p,f,m=0,v=0,y=!1,b=!1;const S=(this.falling,this.height),w=[[-S,0],[-S,S]];t:for(let t in w)for(m=w[t][0];m<w[t][1];){if(this.mode==this.modes.floor?(d=l,u=r+m):this.mode==this.modes.ceiling?(d=l,u=r-m):this.mode==this.modes.leftWall?(d=r-m,u=l):this.mode==this.modes.rightWall&&(d=r+m,u=l),y=c.getSolid(d,u)){if(0!==m)break t;break}m++}for(let t in w)for(v=w[t][0];v<w[t][1]&&(this.mode==this.modes.floor?(p=h,f=r+v):this.mode==this.modes.ceiling?(p=h,f=r-v):this.mode==this.modes.leftWall?(p=r-v,f=h):this.mode==this.modes.rightWall&&(p=r+v,f=h),!(b=c.getSolid(p,f)));)v++;if(this.pdL.args.x=d,this.pdL.args.y=u,this.pdR.args.x=p,this.pdR.args.y=f,this.angle=Math.atan((v-m)/g),!this.falling){let i=(m+v)/2;this.mode===this.modes.floor?(this.x+=t*s,this.y+=t*e):this.mode===this.modes.rightWall?(this.x+=t*e,this.y-=t*s):this.mode===this.modes.ceiling?(this.x-=t*s,this.y-=t*e):this.mode===this.modes.leftWall&&(this.x-=t*e,this.y+=t*s),y&&b&&m<=0&&v<=0&&(this.mode==this.modes.floor?this.y+=Math.ceil(i):this.mode==this.modes.ceiling?this.y-=Math.ceil(i):this.mode==this.modes.leftWall?this.x-=i:this.mode==this.modes.rightWall&&(this.x+=i))}this.falling=m>0&&v>0}isColliding(t){}animate(t){}animate(){this.animationClasses[animation]&&this.currentClasses!=this.animationClasses[animation]&&(this.currentClasses.map(function(t){this.tags.sprite.removeClass(t)}),this.animationClasses[animation].map(function(t){this.tags.sprite.addClass(t)}),this.currentClasses=this.animationClasses[animation])}roundAngle(t,e){return 360*"Math.round"((t=Math.round(t*(180/Math.PI)))/(360/e))/e*(Math.PI/180)}goLeft(){this.gSpeed>0&&(this.gSpeed=0),this.gSpeed>-this.gSpeedMax&&this.gSpeed--}goRight(){this.gSpeed<0&&(this.gSpeed=0),this.gSpeed<this.gSpeedMax&&this.gSpeed++}slowDown(){Math.abs(this.gSpeed)>32?this.gSpeed=.95*this.gSpeed:this.gSpeed=.75*this.gSpeed,Math.abs(this.gSpeed)<=.1&&(this.gSpeed=0)}jump(){if(this.falling)return;let t;this.falling=!0,this.jumped=!0,this.mode=this.args.mode=this.modes.floor,this.mode===this.modes.floor?t=this.angle:this.mode===this.modes.leftWall?t=this.angle+Math.PI/2*1:this.mode===this.modes.ceiling?t=this.angle+Math.PI/2*2:this.mode===this.modes.rightWall&&(t=this.angle+Math.PI/2*3),this.angle=0,this.ySpeed=20*-Math.cos(t),this.xSpeed=20*Math.sin(t),this.mode!==this.modes.leftWall&&this.mode!==this.modes.rightWall||(this.gSpeed=0)}get center(){return[this.x+this.boxWidth/2,this.y+this.boxHeight/2]}get left(){return this.mode==this.modes.floor?this.center[0]-this.width/2:this.mode==this.modes.ceiling?this.center[0]+this.width/2:this.mode==this.modes.leftWall?this.center[1]-this.width/2:this.mode==this.modes.rightWall?this.center[1]+this.width/2:void 0}get right(){return this.mode==this.modes.floor?this.center[0]+this.width/2:this.mode==this.modes.ceiling?this.center[0]-this.width/2:this.mode==this.modes.leftWall?this.center[1]+this.width/2:this.mode==this.modes.rightWall?this.center[1]-this.width/2:void 0}get top(){return this.mode==this.modes.floor?this.center[1]-Math.floor(this.height/2):this.mode==this.modes.ceiling?this.center[1]+Math.floor(this.height/2):this.mode==this.modes.leftWall?this.center[0]+Math.floor(this.height/2):this.mode==this.modes.rightWall?this.center[0]-Math.floor(this.height/2):void 0}get bottom(){return this.mode==this.modes.floor?this.center[1]+Math.floor(this.height/2):this.mode==this.modes.ceiling?this.center[1]-Math.floor(this.height/2):this.mode==this.modes.leftWall?this.center[0]-Math.floor(this.height/2):this.mode==this.modes.rightWall?this.center[0]+Math.floor(this.height/2):void 0}}}),require.register("legacy/Walker.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Walker=void 0;var i=e("./Actor");t.Walker=class extends i.Actor{}}),require.register("legacy/actor.html",function(t,e,s){s.exports='<div class = "actor knuckles [[state]] [[facing]]" cv-ref = "actor" data-mode = "[[mode]]" style = "--animspeed:[[animspeed]]">\n\t<div class = "sprite" cv-ref = "sprite" ></div>\n</div>\n<div cv-each = "debugs:debug">[[debug]]</div>\n'}),require.register("lib/Analytic.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Analytic=void 0;t.Analytic=class{static report(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};requestIdleCallback(()=>ga("send","event",t))}}}),require.register("lib/Color.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;t.Color=class extends Uint8Array{get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}get rf(){return this[0]/255}get gf(){return this[1]/255}get bf(){return this[2]/255}constructor(t){super(3),"string"==typeof t&&("#"===t[0]&&(t=t.substr(1)),"0"===t[0]||"x"===t[1]&&"X"===t[1]||(t="0x"+t),t=parseInt(t)),"number"==typeof t?(t>16777215&&(t%=16777215),this[0]=t>>16&255,this[1]=t>>8&255,this[2]=t>>0&255):Array.isArray(t)&&t.length<=3&&(this[0]=t[0],this[1]=t[1],this[2]=t[2])}rotate(t,e,s){const i=[this.rf,this.gf,this.bf],r=Math.max(...i),a=r-Math.min(...i);let n=0;a&&r===this.rf?n=(i[1]-i[2])/a%6*60:a&&r===this.gf?n=60*((i[2]-i[0])/a+2):a&&r===this.bf&&(n=60*((i[0]-i[1])/a+4));const o=0===a?0:a/r,l=r;let h=(n+t)%360;const g=Math.max(0,Math.min(o*e,1)),c=Math.max(0,Math.min(l*s,1));h<0&&(h+=360);const d=c*g,u=d*(1-Math.abs(h/60%2-1)),p=c-d;let f,m,v;return 0<=h&&h<60?(f=d+p,m=u+p,v=0+p):60<=h&&h<120?(f=u+p,m=d+p,v=0+p):120<=h&&h<180?(f=0+p,m=d+p,v=u+p):180<=h&&h<240?(f=0+p,m=u+p,v=d+p):240<=h&&h<300?(f=u+p,m=0+p,v=d+p):300<=h&&h<360&&(f=d+p,m=0+p,v=u+p),new this.constructor([255*f,255*m,255*v].map(Math.round))}toString(){return String(Math.round(this[0]).toString(16).padStart(2,"0")+Math.round(this[1]).toString(16).padStart(2,"0")+Math.round(this[2]).toString(16).padStart(2,"0"))}toPrimitive(){return(this[0]<<16)+(this[1]<<8)}}}),require.register("mixin/CanPop.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanPop=void 0;var i=e("curvature/base/Tag"),r=(e("../actor/Explosion"),e("../actor/Projectile")),a=e("../audio/Sfx"),n=e("../lib/Analytic"),o=e("../actor/Vehicle");t.CanPop=class{collideA(t,e){this.knocked&&t.pop&&this.pop(this.knocked);const s=this.viewport;if(this.args.invincible)return void t.damage(this);if(t.knocked)return t.pop&&t.pop(t.knocked),void this.pop(t.knocked);if(t.punching&&!this.knocked)return this.args.falling=!0,Math.abs(t.args.gSpeed||t.gSpeedLast)<5?void this.pop(t):(t.args.falling&&t.args.ySpeed<0?(this.args.ySpeed=-10+t.args.ySpeed,this.args.y-=18):(this.args.xSpeed=1.2*(t.args.gSpeed||t.gSpeedLast),this.args.ySpeed=-5,this.args.y-=18),this.args.x=t.args.x+24*t.args.direction+t.args.gSpeed,this.knocked=t,this.static=!1,this.viewport.onFrameOut(60,()=>this.pop(t)),!1);const i=this.args.currentSheild,a=t.immune(this,i?i.type:"normal");if(i&&!a||this.args.gone||!this.viewport||!(a||t.dashed||t.args.jumping||t.args.bellySliding||t.args.spinning||t.args.standinOn&&t.args.standinOn instanceof o.Vehicle||t instanceof r.Projectile&&t.args.owner&&t.args.owner.controllable))return!this.knocked&&t&&t.controllable&&!t.punching&&(s&&"function"==typeof ga&&n.Analytic.report({eventCategory:"badnik",eventAction:"damaged-player",eventLabel:`${s.args.actName}::${this.args.name}::${this.args.id}::${t.args.id}`}),t.args.mercy||(t.damage(this,i?i.type:"normal"),this.ignores.set(t,10))),!1;{const e=t.args.currentSheild;this.damage(t,e?e.type:t.args.damageType||"normal")}}damage(t,e){if(this.args.invincible)return;if(!t)return void this.pop();const s=this.args.currentSheild,i=t.immune(this,s?s.type:"normal");s&&!i||this.args.gone||!this.viewport||!(i||t.dashed||t.args.jumping||t.args.bellySliding||t.args.spinning||t instanceof r.Projectile)||this.pop(t)}pop(t){const e=this.viewport;if(!e||this.args.gone||this.args.invincible||t&&t.args.owner===this)return;this.args.gone=!0;const s=document.createElement("div");s.classList.add("particle-explosion");const r=new i.Tag(s);if(r.style({"--x":this.args.x,"--y":this.args.y-16}),e.particles.add(r),e.onFrameOut(30,()=>e.particles.remove(r)),e.onFrameOut(90,()=>this.screen&&this.screen.remove()),this.box&&this.box.setAttribute("data-animation","broken"),t&&t.dashed&&(Math.abs(t.args.xSpeed)>Math.abs(t.args.ySpeed)&&(t.args.gSpeed=0,t.args.xSpeed=-1.5*Math.sign(t.args.xSpeed),t.args.ySpeed=-10),t.dashed=!1),t){if(t.args.doubleSpin&&(t.args.doubleSpin=2),t.occupant&&(t=t.occupant),t.args.owner&&(t=t.args.owner),t.controllable&&"function"==typeof this.effect){let s=100;this.args.gold&&(s=1e4);const r={label:this.name||this.args.name,points:s,multiplier:1};if(this.args.gold&&(r.label="Gold "+r.label,r.color="orange",r.special=!0),!t.isVehicle&&t.args.ySpeed>5&&t.args.ySpeed<25&&Math.abs(t.args.ySpeed)>Math.abs(t.args.xSpeed)&&(t.args.cameraMode="popping"),t.args.popCombo+=1,t.args.popChain.push(r),t.args.ySpeed>25&&!t.args.bouncing){const s={label:"BIG AIR!!!",points:1e3,multiplier:2};t.args.popChain.push(s),t.args.popCombo+=1,!t.airReward&&Math.abs(t.args.xSpeed)>10&&(t.args.x=this.args.x,t.args.y=this.args.y+-8,e.onFrameOut(1,()=>e.args.frozen=25),e.args.invert="invert",e.onFrameOut(25,()=>e.args.invert=""),a.Sfx.play("SICK_TRICK"),a.Sfx.play("SICK_TRICK")),t.airReward=s}const n=document.createElement("div");switch(n.classList.add("particle-score"),new i.Tag(n).style({"--x":this.args.x,"--y":this.args.y-16}),!0){case this.args.gold:s=1e4;break;case 1===t.args.popCombo:s=100;break;case 2===t.args.popCombo:s=200;break;case 3===t.args.popCombo:s=300;break;case 4===t.args.popCombo:s=400;break;case 5===t.args.popCombo:s=500;break;case 6===t.args.popCombo:s=600;break;case 7===t.args.popCombo:s=700;break;case 8===t.args.popCombo:s=800;break;case 9===t.args.popCombo:s=900;break;case t.args.popCombo>=10:s=1e3}this.effect(t)}const s=Math.min(t.args.ySpeed,t.ySpeedLast);if(t.args.falling&&!t.punching){const i=t.args.spinning,r=t.args.jumping,a=t.args.flying,n=t.args.xSpeed||t.args.gSpeed;e.onFrameOut(1,()=>{s>=0?t.flyTime<5?t.args.ySpeed=Math.min(-s,-7):t.args.ySpeed=Math.min(-s,-2):t.args.ySpeed+=8,t.args.spinning=t.args.spinning||i,t.args.jumping=t.args.jumping||r,t.args.flying=t.args.flying||a,t.args.xSpeed=n,t.args.falling=!0})}t.dashed=!1,this.viewport.settings.rumble&&t&&t.controller&&t.controller.rumble&&(t.controller.rumble({duration:40,strongMagnitude:0,weakMagnitude:1}),this.viewport.onTimeout(40,()=>{t.controller.rumble({duration:110,strongMagnitude:.75,weakMagnitude:1})}))}if(this.args.target&&this.viewport.actorsById[this.args.target]){const e=this.viewport.actorsById[this.args.target];e&&(this.viewport.auras.add(e),e.activate(t,this))}a.Sfx.play("OBJECT_DESTROYED"),"function"==typeof ga&&n.Analytic.report({eventCategory:"badnik",eventAction:"defeated",eventLabel:`${e.args.actName}::${this.args.name}::${this.args.id}`}),this.viewport.actors.remove(this)}}}),require.register("mixin/Constrainable.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constrainable=void 0;var i=e("curvature/base/Tag");const r={initialize:function(){if(!this.others.tiedTo)return;const t=this.others.tiedTo;if(t&&!t.hanging.has(this.constructor)){t.hanging.set(this.constructor,new Set);const e=t.hanging.get(this.constructor);e.add(this),this.chain=new i.Tag('<div class = "chain">'),this.sprite.appendChild(this.chain.node),this.onRemove(()=>e.delete(this))}this.setPos()},wakeUp:function(){},sleep:function(){this.viewport&&!this.args.stay&&this.def&&this.viewport.onFrameOut(5,()=>{this.args.x=this.def.get("x"),this.args.y=this.def.get("y"),this.args.xSpeed=0,this.args.ySpeed=0,this.viewport.setColCell(this)})},setPos:function(){let t=null;if(t=this.getMapSolidAt(this.args.x,this.args.y),this.hooked&&Array.isArray(t)&&(t=t.filter(t=>!this.hooked.has(t)).length),t&&!this.getMapSolidAt(this.args.x,this.args.y+1)&&this.args.y++,!this.others.tiedTo)return;const e=this.others.tiedTo;if(!e)return!1;this.args.ropeLength=this.args.ropeLength||e.args.ropeLength,this.args.falling=!0;const s=e.args.x,i=e.args.y,r=s-this.args.x,a=i-this.args.y,n=Math.atan2(a,r),o=Math.hypot(a,r),l=this.args.ropeLength||64;this.chain&&this.chain.style({"--distance":Math.min(o,l)}),this.args.groundAngle=-(n+Math.PI/2);const h=n;if(o>l){const t=o-l,r=s-Math.cos(n)*l,a=i-Math.sin(n)*l;this.args.xSpeed+=Math.cos(h)*t,this.args.ySpeed+=Math.sin(h)*t,this.args.xSpeedMax<Math.abs(this.args.xSpeed)&&(this.args.xSpeed=this.args.xSpeedMax*Math.sign(this.args.xSpeed)),this.args.ySpeedMax<Math.abs(this.args.ySpeed)&&(this.args.ySpeed=this.args.ySpeedMax*Math.sign(this.args.ySpeed)),this.args.gSpeed=this.args.xSpeed,this.args.x=r,this.args.y=a,this.viewport&&this.viewport.setColCell(this),this.args.x!==s||e.args.xSpeed||e.args.gSpeed||(this.args.ySpeed=0)}e.args.ySpeed>0&&!e.args.xSpeed&&!this.args.xSpeed&&(this.args.x=s,this.args.y=i+this.args.ropeLength)}};t.Constrainable=r}),require.register("mixin/Pushable.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pushable=void 0;var i=e("../actor/Ring");const r={collideA:function(t,e){if(t instanceof i.Ring)return!1;if(-1===e||t.isEffect)return!1;let s=Math.ceil(Math.abs(t.args.gSpeed||t.args.xSpeed))*Math.sign(t.args.gSpeed||t.args.xSpeed);if(Math.abs(t.args.ySpeed)>Math.abs(t.args.xSpeed))return!0;if(!this.args.falling&&1===e&&s<=0)return!1;if(!this.args.falling&&3===e&&s>=0)return!1;const r=this.y-this.args.height;if((1===e||3===e)&&(t.y>=this.y||t.y>r)){if(!s)return!0;this.args.gSpeed=s,this.args.pushed=Math.sign(s)||this.args.pushed;const i=this.viewport.tileMap,r=1===e?1:3===e&&-1,a=this.scanBottomEdge(r);if(i.getSolid(this.x+Math.ceil(this.args.width/2)*r,this.y))return!0;const n=this.args.width/2;if(r>0&&0===a)this.args.falling=!0;else if(r<0&&0===a)this.args.falling=!0;else if(!this.args.falling||a>0){const e=this.bMap("findNextStep",r).get(Platformer),s=this.bMap("findNextStep",r+n*Math.sign(r)).get(Platformer);if((!e[1]||e[2])&&!s[3]){const e=t.args.width,s=this.args.width/2;return this.args.x=t.args.x+r*(s+e),0===a}return!0}}return!0}};t.Pushable=r}),require.register("network/ChatBox.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatBox=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ChatBox=class extends i.View{constructor(t,s){super(t,s),r(this,"template",e("./chat-box.html")),this.args.outputLines=[],this.listen(t.pipe,"open",t=>this.args.outputLines=["You joined the chat."]),this.listen(t.pipe,"message",t=>{const e=JSON.parse(t.detail);e.message&&(this.args.outputLines.push(i.View.from('> <span class = "incoming">[[message]]</span>',{message:e.message})),this.onNextFrame(()=>{const t=this.tags.chatOutput;t&&t.scrollTo(0,t.scrollHeight)}))})}send(t){if(t&&t.key&&"Enter"!==t.key)return;const e=this.args.chatInput;e&&(this.args.outputLines.push(`< ${e}`),this.args.chatInput="",this.onNextFrame(()=>{const t=this.tags.chatOutput;t.scrollTo(0,t.scrollHeight),t.focus()}),this.args.pipe.send(JSON.stringify({message:e})))}}}),require.register("network/CryptoMessage.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CryptoMessage=void 0;var i=e("curvature/base/Uuid"),r=e("./CryptoReply");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.CryptoMessage=class{constructor(t){let{content:e,sender:s,uuid:r,re:n,foreignKey:o,publicKey:l}=t;a(this,"content",void 0),a(this,"sender",void 0),a(this,"uuid",void 0),a(this,"re",void 0),a(this,"encryptedSymmetricKey",void 0),a(this,"foreignKey",void 0),a(this,"publicKey",void 0),this.uuid=r||String(new i.Uuid),Object.assign(this,{content:e,sender:s,re:n,foreignKey:o,publicKey:l})}createReply(t){const e=window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=e.then(t=>window.crypto.subtle.exportKey("raw",t)),i=window.crypto.getRandomValues(new Uint8Array(12)),a=s.then(t=>{const e=new Uint8Array([...i,...new Uint8Array(t)]);return window.crypto.subtle.encrypt({name:"RSA-OAEP"},this.foreignKey,e)});"object"==typeof t&&(console.warn("Encoding non-string value with JSON.stringify()."),t=JSON.stringify(t));const n=fetch("data:text/plain,"+t).then(t=>t.arrayBuffer()),o=Promise.all([e,n]).then(t=>{let[e,s]=t;return window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,s)}),l=window.crypto.subtle.exportKey("spki",this.publicKey);return Promise.all([o,a,l]).then(t=>{let[e,s,i]=t;return new r.CryptoReply({packet:btoa(String.fromCharCode(...new Uint8Array(e))),key:btoa(String.fromCharCode(...new Uint8Array(s))),pub:btoa(String.fromCharCode(...new Uint8Array(i))),uuid:this.uuid,to:this.sender,re:this.re})})}}}),require.register("network/CryptoMessageService.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CryptoMessageService=void 0;var i=e("./CryptoMessage"),r=e("curvature/base/Uuid");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.CryptoMessageService=class{constructor(){a(this,"requests",new Map)}invite(t){const e=String(new r.Uuid),s=window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]);return s.then(t=>this.requests.set(e,{keyPair:t})),s.then(t=>window.crypto.subtle.exportKey("spki",t.publicKey)).then(s=>({pub:btoa(String.fromCharCode(...new Uint8Array(s))),uuid:e,to:t}))}accept(t){const e=t.content.pub,s=t.content.uuid,a=t.content.re,n=t.sender,o=String(new r.Uuid),l=fetch("data:text/plain;base64,"+e).then(t=>t.arrayBuffer()).then(t=>window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])),h=window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]);h.then(t=>this.requests.set(o,{keyPair:t}));let g=Promise.resolve();if(t.content.key&&this.requests.has(a)){const e=this.requests.get(a),s=t.content.key,i=(t.content.iv,t.content.packet);this.requests.delete(a);const r=fetch("data:text/plain;base64,"+s).then(t=>t.arrayBuffer()).then(t=>window.crypto.subtle.decrypt({name:"RSA-OAEP"},e.keyPair.privateKey,t)).then(t=>{const e=new Uint8Array(t),s=e.slice(0,12),i=e.slice(12),r=window.crypto.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!0,["decrypt"]);return Promise.all([r,s])}),n=fetch("data:text/plain;base64,"+i).then(t=>t.arrayBuffer());g=Promise.all([r,n]).then(t=>{let[e,s]=t;return window.crypto.subtle.decrypt({name:"AES-GCM",iv:e[1]},e[0],s)}).then(t=>new Blob([t],{type:"text/plain; charset=utf-8"}).text())}return Promise.all([h,l,g]).then(t=>{let[{publicKey:e},r,a]=t;return new i.CryptoMessage({uuid:o,foreignKey:r,publicKey:e,content:a,sender:n,re:s})})}}}),require.register("network/CryptoReply.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.CryptoReply=void 0;t.CryptoReply=class{constructor(t){let{packet:e,label:s,uuid:r,key:a,pub:n,re:o,to:l}=t;i(this,"packet",void 0),i(this,"label",void 0),i(this,"uuid",void 0),i(this,"key",void 0),i(this,"pub",void 0),i(this,"re",void 0),i(this,"to",void 0),Object.assign(this,{packet:e,label:s,uuid:r,key:a,pub:n,re:o,to:l})}}}),require.register("network/Lobby.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lobby=void 0;var i=e("curvature/base/View"),r=(e("curvature/base/Uuid"),e("curvature/base/Bag")),a=e("./LobbyMessage"),n=e("./LobbyStatus"),o=e("./CryptoMessageService"),l=e("../audio/Bgm"),h=e("../audio/Sfx");function g(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Lobby=class extends i.View{input(){}constructor(t,s){super(t,s),g(this,"template",e("./lobby.html")),g(this,"messageService",new o.CryptoMessageService),g(this,"floodControl",new Map),g(this,"requests",new Map),g(this,"users",new Map),g(this,"serverCandidates",new Set),g(this,"clientCandidates",new Set),g(this,"isClient",null),g(this,"sortByName",(t,e)=>t.username.localeCompare(e.username)),g(this,"sortByTime",(t,e)=>e.lastSeen-t.lastSeen),g(this,"sorting",!1),this.refreshRtc(),this.args.roomId=this.args.roomId||"!hJzXrccruagKGXTFUQ:matrix.org",this.args.invites=new r.Bag,this.args.loading=!0,this.args.userList=[],this.args.users=new r.Bag((t,e,s)=>{this.sortUsers()}),this.args.motd="Welcome to the Sonic 3000 test lobby! We're still building and testing, so check back soon for updates. Click a user's name on the left to send an invite.",this.args.messages=[],s.matrixConnect().then(t=>{this.matrix=t,this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.step-in",{}),t.whoAmI().then(t=>{this.user=t,this.args.username=t.user_id});const e=t.listenForRoomEvents(this.args.roomId);this.onRemove(()=>e.cancelled=!0),t.joinRoom(this.args.roomId),this.listen(t,"sonic-3000.lobby.message",t=>this.handleLobbyMessage(t)),this.listen(t,"sonic-3000.lobby.step-out",t=>this.handleLobbyStepOut(t)),this.listen(t,"sonic-3000.lobby.step-in",t=>this.handleLobbyStepIn(t)),this.listen(t,"sonic-3000.lobby.crypto-game-invite",t=>this.handleCryptoGameInvite(t)),this.listen(t,"sonic-3000.lobby.crypto-game-offer",t=>this.handleCryptoGameOffer(t)),this.listen(t,"sonic-3000.lobby.crypto-game-accept",t=>this.handleCryptoGameAccept(t)),this.listen(t,"sonic-3000.lobby.crypto-game-reject",t=>this.handleCryptoGameReject(t)),this.listen(t,"sonic-3000.lobby.crypto-candidate-invite",t=>this.handleCryptoCandidateInvite(t)),this.listen(t,"sonic-3000.lobby.crypto-candidate-present",t=>this.handleCryptoCandidatePresent(t)),this.listen(t,"sonic-3000.lobby.crypto-candidate-ack",t=>this.handleCryptoCandidateAck(t)),this.listen(window,"unload",t=>{this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.step-out",{})}),this.listen(t,"matrix-event",t=>{t.detail.sender&&(this.checkEventSender(t.detail),this.sortUsers())});const s=t.syncRoomHistory(this.args.roomId,t=>{if(this.removed)return!1;t.sender&&"sonic-3000.lobby.message"===t.type&&(t.origin_server_ts<1664651274e3?this.args.loading=!1:t.content.body&&(this.args.messages.length<=3&&h.Sfx.play("READY_TONE"),this.handleLobbyMessage({detail:t},this)))},Date.now()-6048e5,null,{types:["sonic-3000.lobby.message"]}),i=t.syncRoomHistory(this.args.roomId,t=>{if(this.removed)return!1;t.sender&&this.checkEventSender(t)},Date.now()-6048e5,null);Promise.all([s,i]).then(()=>this.args.loading=!1)}),this.args.input=""}onAttached(){l.Bgm.fadeOut(250),this.onTimeout(250,()=>l.Bgm.stop())}checkEventSender(t){const e=t.sender,[s,i]=e.slice(1).split(":");if(!this.users.has(e)){const t={id:e,lastSeen:0,username:s,host:i};this.users.set(e,t),this.args.users.add(t),this.sortUsers()}const r=this.users.get(e);r.lastSeen=Math.max(r.lastSeen,t.origin_server_ts)}sendMessage(t){this.args.input&&this.args.input.trim()&&this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.message",{msgtype:"m.text",body:this.args.input}).then(t=>this.args.input="").catch(t=>console.error(t)).finally(()=>{this.tags.input.focus(),h.Sfx.play("WAIT_TONE")})}logOut(t){this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.step-out",{}),this.matrix.logOut(),this.remove()}keyup(t){"Enter"===t.key&&this.sendMessage(t)}sendCryptoGameInvite(t,e){let{id:s}=e;this.refreshRtc(),this.messageService.invite(s).then(t=>this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.crypto-game-invite",t)).then(e=>{this.args.messages.push(new n.LobbyStatus({message:`You invited ${s} to play!`,time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight)}).catch(t=>console.error(t)).finally(()=>this.tags.input.focus())}handleCryptoGameInvite(t){if(!this.user||t.detail.content.to!==this.user.user_id)return;this.floodControl.has(t.detail.sender)||this.floodControl.set(t.detail.sender,{});const e=this.floodControl.get(t.detail.sender);e.invite&&Date.now()-e.invite<15e3?this.rejectCryptoGameInvite(t,t.detail,"flood_control",!0):(h.Sfx.play("KNOCK_PLATFORM"),this.args.messages.push(new n.LobbyStatus({message:`${t.detail.sender} invited you to play!`,time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight),this.args.invites.add(t.detail),e.invite=Date.now())}acceptCryptoGameInvite(t,e){this.args.invites.delete(e),e.content.uuid,e.sender,this.args.messages.push(new n.LobbyStatus({message:`You accepted the invite from ${e.sender}!`})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight),this.isClient=!0;const s=this.client.getIceCandidates();this.messageService.accept(e).then(t=>{Promise.all([s,this.client.offer()]).then(e=>{let[s,i]=e;return t.createReply(JSON.stringify({candidates:s,token:i}))}).then(t=>this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.crypto-game-offer",t))}),this.onTimeout(200,()=>this.args.showInvites="hide-invites"),this.args.showInvites="hiding-invites",h.Sfx.play("STAR_TWINKLE")}rejectCryptoGameInvite(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.args.invites.delete(e),e.content.uuid,e.sender,i||(this.args.messages.push(new n.LobbyStatus({message:`You rejected the invite from ${e.sender}.`,time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight)),this.messageService.accept(e).then(t=>{t.createReply(s).then(t=>this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.crypto-game-reject",t))}),i||(this.onTimeout(200,()=>this.args.showInvites="hide-invites"),this.args.showInvites="hiding-invites",h.Sfx.play("OBJECT_DESTROYED"))}handleCryptoGameOffer(t){if(!this.user||t.detail.content.to!==this.user.user_id)return;const e=t.detail;e.content.uuid,e.sender,this.messageService.accept(e).then(s=>{this.args.messages.push(new n.LobbyStatus({message:"Initializing RTC handshake...",time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight);let{content:i}=s;const r=/^s3ktp:\/\/request\/(.+)/.exec(i);r&&(i=atob(r[1]));const{token:a,candidates:o}=JSON.parse(i),l=this.server.answer(a);l.then(()=>{o.map(t=>this.server.addIceCandidate(t))}),Promise.all([this.server.getIceCandidates(),l]).then(t=>{let[e,i]=t;s.createReply(JSON.stringify({candidates:e,token:i})).then(t=>this.matrix.putEvent(this.args.roomId,"sonic-3000.lobby.crypto-game-accept",t))}),this.args.messages.push(new n.LobbyStatus({message:`${e.sender} accepted your invite!`,time:String(new Date(e.origin_server_ts))})),h.Sfx.play("STAR_TWINKLE"),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight)})}handleCryptoGameAccept(t){if(!this.user||t.detail.content.to!==this.user.user_id)return;const e=t.detail;e.content.uuid,e.sender,this.messageService.accept(e).then(t=>{const{token:e,candidates:s}=JSON.parse(t.content);this.client.accept(e).then(()=>s.map(t=>this.client.addIceCandidate(t)))})}handleCryptoGameReject(t){if(!this.user||t.detail.content.to!==this.user.user_id)return;const e=t.detail;e.content.uuid,e.sender,this.messageService.accept(e).then(e=>{let s=`${t.detail.sender} rejected your invite.`;e.content&&(s=`${t.detail.sender} rejected your invite: (${e.content})`),this.args.messages.push(new n.LobbyStatus({message:s})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight)})}handleLobbyMessage(t){let{detail:e}=t,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.room_id!==this.args.roomId||!e.content.body)return;this.checkEventSender(e);const i=this.users.get(e.sender);this.args.messages[s?"unshift":"push"](new a.LobbyMessage({message:e.content.body,time:String(new Date(e.origin_server_ts)),user:i})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight),e.sender!==this.args.username&&(!s||this.args.messages.length<=3)&&h.Sfx.play("READY_TONE")}refreshRtc(){const t=!this.server,e=!this.client;this.server=this.server||this.parent.getServer(),this.client=this.client||this.parent.getClient();const s=this.server,i=this.client,r=t=>{console.log("Connection Opened!"),this.parent.loadMap({mapUrl:"/map/emerald-isle.json",networked:!0}),this.remove()},a=t=>this.disconnect();t&&(s.addEventListener("open",r,{once:!0}),s.addEventListener("close",a,{once:!0})),e&&(i.addEventListener("open",r,{once:!0}),i.addEventListener("close",a,{once:!0}))}toggleMenu(){this.args.showMenu&&"hide-menu"!=this.args.showMenu?(this.onTimeout(200,()=>this.args.showMenu="hide-menu"),this.args.showMenu="hiding-menu"):(this.onTimeout(200,()=>this.args.showMenu="show-menu"),this.args.showMenu="showing-menu")}toggleInvites(){this.args.showInvites&&"hide-invites"!=this.args.showInvites?(this.onTimeout(200,()=>this.args.showInvites="hide-invites"),this.args.showInvites="hiding-invites"):(this.onTimeout(200,()=>this.args.showInvites="show-invites"),this.args.showInvites="showing-invites")}disconnect(){this.server.close(),this.client.close(),this.refreshRtc(),this.parent.args.started&&this.parent.quit(2),this.parent.args.networked=!1,this.parent.args.chatBox=null}sortUsers(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null){case"abc":this.userSorter=this.sortByName;break;case"time":this.userSorter=this.sortByTime}this.sorting||(this.sorting=!0,this.onTimeout(100,()=>{const t=this.args.users.items();t.sort(this.userSorter||this.sortByTime),this.args.userList=t,this.sorting=!1}))}closeMotd(t){this.args.motdClosed="closed"}handleLobbyStepOut(t){this.args.messages.push(new n.LobbyStatus({message:`${t.detail.sender} stepped out.`,time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight),h.Sfx.play("MECHASONIC_SLAP")}handleLobbyStepIn(t){this.args.messages.push(new n.LobbyStatus({message:`${t.detail.sender} stepped in.`,time:String(new Date(t.detail.origin_server_ts))})),this.onNextFrame(()=>this.tags.scroller.scrollTop=this.tags.scroller.scrollHeight),h.Sfx.play("SS_BWIP_HIGH")}}}),require.register("network/LobbyInvite.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LobbyInvite=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LobbyInvite=class extends i.View{constructor(){super(...arguments),r(this,"template",'<div class = "lobby-invite">invite!</div>')}}}),require.register("network/LobbyMessage.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LobbyMessage=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LobbyMessage=class extends i.View{constructor(){super(...arguments),r(this,"template",'<span title = "[[user.id]] [[time]]" class = "username">&lt;<b>[[user.username]]</b>&gt;</span>:&nbsp;<span class = "message" cv-bind = "message"></span>'),r(this,"preserve",!0)}}}),require.register("network/LobbyStatus.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LobbyStatus=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LobbyStatus=class extends i.View{constructor(){super(...arguments),r(this,"template",'<span class = "lobby-status-message" title = [[time]] cv-bind = "message"></span>'),r(this,"preserve",!0)}}}),require.register("network/Rtc.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rtc=void 0;t.Rtc=class{}}),require.register("network/RtcClient.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcClient=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/mixin/EventTargetMixin");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.RtcClient=class extends(i.Mixin.with(r.EventTargetMixin)){constructor(t){super(),a(this,"candidateTimeout",500),this.peerClient=new RTCPeerConnection(t),this.peerClientChannel=this.peerClient.createDataChannel("chat"),this.peerClientChannel.addEventListener("open",t=>{const e=new CustomEvent("open",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e),this.connected=!0}),this.peerClientChannel.addEventListener("close",t=>{const e=new CustomEvent("close",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e),this.connected=!1}),this.peerClientChannel.addEventListener("message",t=>{const e=new CustomEvent("message",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e)}),this.peerClient.addEventListener("icecandidate",t=>{const e=new CustomEvent("icecandidate",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e)})}send(t){this.peerClientChannel&&"open"===this.peerClientChannel.readyState&&this.peerClientChannel.send(t)}close(){return this.peerClient.close()}getIceCandidates(){const t=new Set;return new Promise(e=>this.peerClient.addEventListener("icecandidate",s=>{t.add(s.candidate),s.candidate||e([...t])}))}addIceCandidate(t){this.peerClient.addIceCandidate(t)}offer(){return this.peerClient.createOffer().then(t=>this.peerClient.setLocalDescription(t)).then(()=>this.peerClient.localDescription)}fullOffer(){return this.offer().then(t=>this.getIceCandidates().then(e=>({offer:t,candidates:e})))}accept(t){const e=new RTCSessionDescription(t);return this.peerClient.setRemoteDescription(e)}fullAccept(t){let{answer:e,candidates:s}=t;return this.accept(e).then(()=>s.map(t=>this.addIceCandidate(t)))}}}),require.register("network/RtcClientTask.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcClientTask=void 0;var i=e("subspace-console/Task"),r=e("curvature/base/Tag"),a=e("./RtcClient");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const o=Symbol("accept");class l extends i.Task{constructor(){super(...arguments),n(this,"title","RTC Client Task"),n(this,"connected",!1)}init(){return this.client=new a.RtcClient({iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]}),this.finally(()=>{console.log("Terminating connection..."),this.client.close()}),this.client.addEventListener("open",()=>{this.print("Remote peer client accepted!")}),this.client.addEventListener("close",()=>{this.print("Peer reset connection.")}),this.client.addEventListener("message",t=>{this.print(`> ${t.detail}`)}),this.client.offerToken.then(t=>{const e=JSON.stringify(t),s=`s3ktp://request/${btoa(e)}`;this.print(`Client request code: ${s}`);const i=new r.Tag('<textarea style = "display:none">');i.innerText=s,document.body.append(i.node),i.select(),document.execCommand("copy"),i.node.remove()}),new Promise(t=>{this[o]=t})}main(t){t&&(this.client.connected?(this.print(`< ${t}`),this.client.send(t)):this.accept(t))}accept(t){if(!t)return void this.print("Please supply server's accept string.");const e=/^s3ktp:\/\/accept\/(.+)/.exec(t);e&&(t=atob(e[1]));const s=JSON.parse(t);this.client.accept(s)}}t.RtcClientTask=l,n(l,"helpText","RTC Client."),n(l,"useText","")}),require.register("network/RtcServer.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcServer=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/mixin/EventTargetMixin");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.RtcServer=class extends(i.Mixin.with(r.EventTargetMixin)){constructor(t){super(),a(this,"candidateTimeout",500),this.peerServer=new RTCPeerConnection(t),this.peerServer.addEventListener("datachannel",t=>{this.peerServerChannel=t.channel,this.peerServerChannel.addEventListener("open",t=>{const e=new CustomEvent("open",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e),this.connected=!0}),this.peerServerChannel.addEventListener("close",t=>{const e=new CustomEvent("close",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e),this.connected=!1}),this.peerServerChannel.addEventListener("message",t=>{const e=new CustomEvent("message",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e)}),this.peerServerChannel.addEventListener("icecandidate",t=>{const e=new CustomEvent("icecandidate",{detail:t.data});e.originalEvent=t,this.dispatchEvent(e)})})}send(t){this.peerServerChannel&&"open"===this.peerServerChannel.readyState&&this.peerServerChannel.send(t)}close(){return this.peerServer.close()}getIceCandidates(){const t=new Set;return new Promise(e=>this.peerServer.addEventListener("icecandidate",s=>{t.add(s.candidate),s.candidate||e([...t])}))}addIceCandidate(t){this.peerServer.addIceCandidate(t)}answer(t){return this.peerServer.setRemoteDescription(t).then(()=>this.peerServer.createAnswer()).then(t=>this.peerServer.setLocalDescription(t)).then(()=>this.peerServer.localDescription)}fullAnswer(t){let{offer:e,candidates:s}=t;return this.answer(e).then(t=>Promise.all(s.map(t=>this.addIceCandidate(t))).then(()=>this.getIceCandidates().then(e=>({answer:t,candidates:e}))))}}}),require.register("network/RtcServerTask.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcServerTask=void 0;var i=e("subspace-console/Task"),r=e("curvature/base/Tag"),a=e("./RtcServer");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const o=Symbol("accept");class l extends i.Task{constructor(){super(...arguments),n(this,"title","RTC Server Task"),n(this,"connected",!1)}init(){return this.server=new a.RtcServer({iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]}),this.finally(()=>{this.print("Terminating connection..."),this.server.close()}),this.server.addEventListener("open",()=>{this.print("Remote peer client accepted!")}),this.server.addEventListener("close",()=>{this.print("Peer reset connection.")}),this.server.addEventListener("message",t=>{this.print(`> ${t.detail}`)}),this.server.answerToken.then(t=>{const e=JSON.stringify(t),s=`s3ktp://accept/${btoa(e)}`;this.print(`Server accept code: ${s}`);const i=new r.Tag('<textarea style = "display:none">');i.innerText=s,document.body.append(i.node),i.select(),document.execCommand("copy"),i.node.remove()}),this.printErr("Please supply client's request code."),new Promise(t=>{this[o]=t})}main(t){t&&(this.server.connected?(this.print(`< ${t}`),this.server.send(t)):this.answer(t))}answer(t){const e=/^s3ktp:\/\/request\/(.+)/.exec(t);console.log(e),e&&(t=atob(e[1]));const s=JSON.parse(t);this.server.answer(s)}done(){}}t.RtcServerTask=l,n(l,"helpText","RTC Server."),n(l,"useText","")}),require.register("network/chat-box.html",function(t,e,s){s.exports='<div class = "chatbox" data-click-barrier>\n\n\t<div class = "chat-output" cv-each = "outputLines:line" cv-ref = "chatOutput">\n\t\t<p>[[line]]</p>\n\t</div>\n\n\t<div class = "chat-input">\n\t\t<input cv-bind = "chatInput" cv-ref = "chatInput" cv-on = "keydown:send(event)">\n\t\t<button cv-on = "click:send">send</button>\n\t</div>\n\n</div>\n'}),require.register("network/lobby.html",function(t,e,s){s.exports='<div class = "lobby [[showMenu]] [[showInvites]]" data-click-barrier>\n\n\t<div class = "main column">\n\t\t<div class = "left-menu">\n\t\t\t<div>[[username]]</div>\n\t\t\t<button cv-on = "click:logOut">Log Out</button>\n\t\t</div>\n\n\t\t<div class = "topbar row">\n\t\t\t<div class = "row">\n\t\t\t\t<div class = "burger-button" cv-on = "click:toggleMenu">\n\t\t\t\t\t<div class = "stripe"></div>\n\t\t\t\t\t<div class = "stripe"></div>\n\t\t\t\t\t<div class = "stripe"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class = "title">\n\t\t\t\t\t#sonic-3000-test-lobby\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div cv-on = "click:toggleInvites" class = "invite button">\n\t\t\t\t\t<div class = "amount" cv-if = "invites.length">[[invites.length]]</div>\n\t\t\t\t\t<img class = "icon" src = "/icons/mail.svg" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class = "row wide">\n\n\t\t\t<div class = "users frame column">\n\t\t\t\t<div class = "sort-buttons">\n\t\t\t\t\t<button class = "sort-abc"  cv-on = \'click:sortUsers("abc")\'></button>\n\t\t\t\t\t<button class = "sort-time" cv-on = \'click:sortUsers("time")\'></button>\n\t\t\t\t</div>\n\t\t\t\t<div class = "scroller" cv-each = "userList:user">\n\t\t\t\t\t<div title = "[[user.id]]" class = "user" tabindex = "0">\n\t\t\t\t\t\t[[user.username]]\n\t\t\t\t\t\t<div class = "user-list-buttons">\n\t\t\t\t\t\t\t<button cv-on   = "click:sendCryptoGameInvite(event, user)">invite</button>\n\x3c!-- \t\t\t\t\t\t\t<button>message</button>\n\t\t\t\t\t\t\t<button>ignore</button> --\x3e\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class = "messages wide column">\n\t\t\t\t<div class = "row motd [[motdClosed]]">\n\t\t\t\t\t<button class="close-button" cv-on = "click:closeMotd"></button>\n\t\t\t\t\t<span>&lt;motd&gt;: [[motd]]</span>\n\t\t\t\t</div>\n\t\t\t\t<div class = "row wide frame">\n\t\t\t\t\t<div class = "scroller" cv-ref = "scroller">\n\t\t\t\t\t\t<div cv-if = "loading">\n\t\t\t\t\t\t\t<img class = "loader icon" src = "/icons/loader.svg" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class = "column" cv-each = "messages:message">\n\t\t\t\t\t\t\t<span class = "message">[[message]]</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class = "row">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype    = "text"\n\t\t\t\t\t\tcv-bind = "input"\n\t\t\t\t\t\tcv-on   = "keyup"\n\t\t\t\t\t\tcv-ref  = "input"\n\t\t\t\t\t/>\n\t\t\t\t\t<button cv-on   = "click:sendMessage">send</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class = "invites">\n\t\t\t\t<div cv-if = "!invites.length">No pending invites.</div>\n\t\t\t\t<div class = "column" cv-each = "invites:invite:i">\n\t\t\t\t\t<div class = "column">\n\t\t\t\t\t\t<div>[[invite.sender]] invited you to play!</div>\n\t\t\t\t\t\t<div class = "row">\n\t\t\t\t\t\t\t<button cv-on = "click:acceptCryptoGameInvite(event, invite)">accept</button>\n\t\t\t\t\t\t\t<button cv-on = \'click:rejectCryptoGameInvite(event, invite, "button_clicked")\'>reject</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n</div>\n'}),require.register("particle/Particle3d.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Particle3d=void 0;var i=e("curvature/base/Tag");t.Particle3d=class extends i.Tag{constructor(){super('<div class = "particle-3d">');const t=new i.Tag('<div class = "front-3d">'),e=new i.Tag('<div class = "back-3d">'),s=new i.Tag('<div class = "right-3d">'),r=new i.Tag('<div class = "left-3d">'),a=new i.Tag('<div class = "top-3d">'),n=new i.Tag('<div class = "bottom-3d">');this.append(e.node),this.append(s.node),this.append(r.node),this.append(t.node),this.append(a.node),this.append(n.node)}}}),require.register("powerups/BubbleSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BubbleSheild=void 0;var i=e("curvature/base/Bindable"),r=e("./Sheild"),a=e("../audio/Sfx");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.BubbleSheild=class extends r.Sheild{constructor(){super(...arguments),n(this,"template",'<div class = "sheild bubble-sheild [[bouncing]]"><div class = "bubble-sheild-shine"></div></div>'),n(this,"protect",!0),n(this,"type","water")}unequip(t){super.unequip(t),t.args.bouncing=!1,this.args.bouncing=!1,this.args.force=0}acquire(t){if(!t.viewport)return;t.controllable&&a.Sfx.play("WATER_ACQUIRE");const e=s=>{if(t.args.currentSheild!==i.Bindable.make(this))return;s.preventDefault();const r=s.detail.other;r&&r.pop&&r.pop(t),this.onNextFrame(()=>{t.args.currentSheild=null,t.inventory.remove(this)}),t.removeEventListener("damage",e),t.startle(r)};t.addEventListener("damage",e)}immune(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";return"water"===s||"projectile"===s}command_0(t,e){if(!(t.canFly&&t.yAxis<.55||t.dashed||t.args.standingOn&&t.args.standingOn.isVehicle))return this.args.force=10,t.args.jumping&&(t.impulse(14,Math.PI/2),this.args.bouncing="bouncing",t.args.bouncing=!0),(!t.args.falling||!t.yAxis)&&void 0}hold_0(){this.args.bouncing&&this.args.force<25&&this.args.force++}update(t){t.args.ySpeed<-5&&this.onNextFrame(()=>{t.args.bouncing=!1,this.args.bouncing=!1,this.args.force=0}),t.args.falling||this.args.bouncing&&this.args.force&&(this.onNextFrame(()=>{t.args.standingOn=null,t.args.bouncing=!1,t.args.falling=!0,t.args.jumping=!0,t.impulse(this.args.force,-Math.PI/2,!0)}),this.args.bouncing="",a.Sfx.play("WATER_BOUNCE"),t.viewport.settings.rumble&&t.controller.rumble({duration:200,strongMagnitude:1,weakMagnitude:1}))}}}),require.register("powerups/ElectricSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ElectricSheild=void 0;var i=e("curvature/base/Bindable"),r=e("./Sheild"),a=e("../audio/Sfx"),n=e("curvature/base/Tag");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ElectricSheild=class extends r.Sheild{constructor(){super(...arguments),o(this,"template",'<div class = "sheild electric-sheild [[boosted]]"></div>'),o(this,"protect",!0),o(this,"type","electric"),o(this,"jumps",3),o(this,"attract",new Set),o(this,"magnetism",.25),o(this,"magnetTimeout",!1),o(this,"particles",new Set)}acquire(t){if(!t.viewport)return;t.controllable&&a.Sfx.play("ELECTRIC_ACQUIRE");const e=s=>{if(t.args.currentSheild!==i.Bindable.make(this))return;s.preventDefault();const r=s.detail.other;this.immune(t,r,s.detail.type)?s.detail.immune=!0:(r&&r.damage&&r.damage(t,"electric"),this.onNextFrame(()=>{t.args.currentSheild=null,t.inventory.remove(this)}),t.removeEventListener("damage",e),t.startle(r))};t.addEventListener("damage",e)}immune(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";return"electric"===s||"projectile"===s}command_0(t,e){if(t.args.falling&&(!t.canFly||!(Math.abs(t.yAxis)<.55||t.args.flying))){if(this.jumps>0&&t.args.jumping){if(t.args.ySpeed=0,t.impulse(10,-Math.PI/2),this.jumps--,this.onTimeout(250,()=>this.args.boosted=""),a.Sfx.play("ELECTRIC_JUMP"),t.xAxis&&Math.sign(t.xAxis)!==Math.sign(t.args.xSpeed)&&(t.args.xSpeed=1*t.xAxis),viewport=t.viewport,!viewport)return;const e=new n.Tag(document.createElement("div")),s=new n.Tag(document.createElement("div"));e.classList.add("particle-electric-jump-spark"),s.classList.add("particle-electric-jump-spark"),e.style({"--x":t.args.x,"--y":t.args.y-30,"z-index":0}),s.style({"--x":t.args.x,"--y":t.args.y-30,"z-index":0}),e.age=0,e.y=t.args.y-30,e.x=t.args.x,e.d=-1,s.age=0,s.y=t.args.y-30,s.x=t.args.x,s.d=1,viewport.particles.add(e),viewport.particles.add(s),viewport.onFrameOut(200,()=>viewport.particles.remove(e)),viewport.onFrameOut(200,()=>viewport.particles.remove(s)),this.particles.add(e),this.particles.add(s)}return!(t.canFly&&Math.abs(t.yAxis)>.55)&&void 0}}release_6(t,e){}magnetize(t,e){if(!t.controllable)return;t.args.xOff=0,t.args.yOff=32,this.magnetism=Math.max(.25,e);const s=t.viewport.objectPalette.ring,i=t.findNearestActor(t=>!this.attract.has(t)&&t instanceof s&&!t.args.gone&&!t.restore,256);i&&(t.viewport.auras.add(i),this.attract.add(i))}update(t){for(const t of this.particles)t.age&&t.style({"--x":t.x-(40-40/(.35*t.age)**2)*t.d,"--y":t.y+(.35*t.age)**2}),t.age++;this.magnetize(t,2.5),t.args.falling||this.magnetTimeout||(this.magnetTimeout=this.onTimeout(100,()=>{this.magnetTimeout=!1,this.args.boosted=""})),t.canFly,t.args.falling||(this.jumps=3);let e=0;for(const s of this.attract){if(s.args.gone){this.attract.delete(s),s.attract=null;const e=t.viewport;e.onFrameOut(30,()=>{s.def&&(s.args.static=!1,s.args.xSpeed=0,s.args.ySpeed=0,s.args.x=s.def.get("x"),s.args.y=s.def.get("y"),e.setColCell(s),e.onFrameOut(300,()=>{e.auras.delete(s),s.args.float=-1,s.noClip=!1,s.restore=!0}))});continue}s.args.static=!1,s.attract=t,s.noClip=!0;const i=t.x-s.x,r=t.y-t.args.height/2-s.y,a=Math.atan2(r,i),n=Math.hypot(r,i),o=512,l=Math.sign(i),h=Math.sign(r),g=Math.sign(s.args.xSpeed||0)===l,c=Math.sign(s.args.ySpeed||0)===h;if(n>o){if(e>45)continue;s.args.x=t.x-Math.cos(a)*o,s.args.y=t.y-Math.sin(a)*o}t.viewport.setColCell(s),e++;const d=2*(this.magnetism||.75),u=Math.max(d,g?.45:.55),p=Math.max(d,.45);s.args.groundAngle=0;const f=this.magnetism?Math.random():1;(!g||Math.abs(s.args.xSpeed)<8||n>o)&&(s.args.xSpeed+=Math.max(.1,u*f)*l),(!c||Math.abs(s.args.ySpeed)<8||n>o)&&(s.args.ySpeed+=Math.max(.1,p*f)*h),s.args.falling=!0}}}}),require.register("powerups/FireSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FireSheild=void 0;var i=e("curvature/base/Bindable"),r=e("./Sheild"),a=e("../audio/Sfx");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.FireSheild=class extends r.Sheild{constructor(){super(...arguments),n(this,"template",'<div class = "sheild fire-sheild [[boosted]]"></div>'),n(this,"protect",!0),n(this,"type","fire"),n(this,"power",15)}acquire(t){if(!t.viewport)return;t.controllable&&a.Sfx.play("FIRE_ACQUIRE");const e=s=>{if(t.args.currentSheild!==i.Bindable.make(this))return;s.preventDefault();const r=s.detail.other;r&&r.pop&&r.pop(t),this.onNextFrame(()=>{t.args.currentSheild=null,t.inventory.remove(this)}),t.removeEventListener("damage",e),t.startle(r)};t.addEventListener("damage",e)}immune(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";return"fire"===s||"projectile"===s}update(t){t.args.falling||(this.didBoost=!1,this.power=15)}hold_4(t,e){this.power<=0||(this.power--,t.canFly,t.args.falling?(t.impulse(1,Math.PI),this.args.boosted||(this.args.boosted="boosted",t.args.didBoost=!0,a.Sfx.play("FIRE_DASH"),t.viewport.onFrameOut(15,()=>this.args.boosted=""))):this.args.boosted="")}hold_5(t,e){this.power<=0||(this.power--,t.canFly,t.args.falling?(t.impulse(1,0),this.args.boosted||(this.args.boosted="boosted",t.args.didBoost=!0,a.Sfx.play("FIRE_DASH"),t.viewport.onFrameOut(15,()=>this.args.boosted=""))):this.args.boosted="")}}}),require.register("powerups/NormalSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NormalSheild=void 0;var i=e("curvature/base/Bindable"),r=e("./Sheild");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.NormalSheild=class extends r.Sheild{constructor(){super(...arguments),a(this,"template",'<div class = "sheild normal-sheild"></div>'),a(this,"protect",!0),a(this,"type","normal")}acquire(t){if(!t.viewport)return;const e=s=>{if(t.args.currentSheild!==i.Bindable.make(this))return;s.preventDefault();const r=s.detail.other;r&&r.damage&&r.damage(t),this.onNextFrame(()=>{t.args.currentSheild=null,t.inventory.remove(this)}),t.removeEventListener("damage",e),t.startle(r)};t.addEventListener("damage",e)}immune(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],!1}}}),require.register("powerups/Powerup.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Powerup=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/View");let a;function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}a=i.Bindable.NoGetters;t.Powerup=class extends r.View{constructor(){super(...arguments),n(this,a,!0)}equip(){}unequip(){}acquire(){}drop(){}}}),require.register("powerups/Sheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sheild=void 0;var i=e("./Powerup");t.Sheild=class extends i.Powerup{}}),require.register("powerups/StarSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarSheild=void 0;var i=e("./Sheild"),r=e("../audio/Bgm"),a=e("curvature/base/Tag");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.StarSheild=class extends i.Sheild{constructor(){super(...arguments),n(this,"type","star"),n(this,"protect",!0),n(this,"template",'<div class = "sheild star-sheild">\n\t\t<div class = "star-sheild-stars"></div>\n\t</div>'),n(this,"frame",0),n(this,"recycle",[])}acquire(t){const e=t.viewport;if(!e)return;const s=t.args.currentSheild,i=e=>{e.preventDefault();const s=e.detail.other;s&&s.pop&&s.pop(t)};t.addEventListener("damage",i),e.onFrameOut(1560,()=>{r.Bgm.stop("STAR_SHIELD"),t.inventory.remove(this),t.removeEventListener("damage",i),t.args.currentSheild=s,this.debindPaused&&this.debindPaused(),delete this.debindPaused}),t.onRemove(()=>r.Bgm.stop("STAR_SHIELD")),r.Bgm.play("STAR_SHIELD",{interlude:!0}),e.args.audio||r.Bgm.pause()}immune(){return!0}drop(t){console.log(this,t),this.debindPaused&&this.debindPaused(),delete this.debindPaused}update(t){const e=t.viewport;if(!e)return;const s=this.recycle.length?this.recycle.shift():new a.Tag(document.createElement("div"));s.node.classList.add("particle-stars");const i=t.rotatePoint(0,t.args.height/2),r=t.dashed||"springdash"===t.args.animation;let n=-3;t.args.rolling&&(n=3),r&&(n=-16),s.style({"--frame":this.frame++,"--x":i[0]+t.x+-3+t.args.xSpeed,"--y":i[1]+t.y+t.args.ySpeed+n,"z-index":-1,opacity:2*Math.random()}),s.preserve=!0,e.particles.add(s),e.onFrameOut(15,()=>{e.particles.remove(s),this.recycle.push(s)})}}}),require.register("powerups/SuperSheild.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SuperSheild=void 0;var i=e("./Sheild");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.SuperSheild=class extends i.Sheild{constructor(){super(...arguments),r(this,"template",'<div class = "sheild super-sheild">\n\t\t<div class = "super-sheild-shine"></div>\n\t\t<div class = "super-sheild-spark"></div>\n\t\t<div class = "super-sheild-flare"></div>\n\t</div>'),r(this,"type","super")}immune(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],!(!t.isSuper&&!t.isHyper)}}}),require.register("region/BgShadeRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BgShadeRegion=void 0;var i=e("./ShadeRegion");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.BgShadeRegion=class extends i.ShadeRegion{constructor(){super(...arguments),r(this,"currentFilter",-1),r(this,"filters",["studio","western","heat","hydro","lava","frost","eight-bit","corruption","black-hole","normal"]),this.args.type="region region-shade bg-region-shade"}}}),require.register("region/BossRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BossRegion=void 0;var i=e("./Region");t.BossRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region boss",this.args.hidden=!0}updateActor(t){if(!t.args.falling&&!this.args._boss){const e=this.viewport.actorsById[this.args.boss];if(!e)return void(t.args.bossMode=!1);e.args.hitPoints?t.args.bossMode=!0:t.args.bossMode=!1}}}}),require.register("region/CorkscrewRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorkscrewRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.CorkscrewRegion=class extends i.Region{static fromDef(t){const e=t.width,s=t.height,i=(t.x,t.y),r=super.fromDef(t);return r.args.width=e,r.args.height=s,r.args.y=i+s,r}constructor(){super(...arguments),this.args.type="region corkscrew",this.args.hidden=!0}updateActor(t){if(!t.canRoll||t.args.falling&&t.args.ySpeed<0)return;if(Math.abs(t.args.xSpeed)<1||Math.abs(t.args.ySpeed)>5)return void("corkscrew"===t.args.animation&&(t.args.animation="walking"));t.args.groundAngle=0;const e=(t.x-this.x)/this.args.width,s=1+Math.cos(-Math.PI+e*Math.PI*2),i=s*this.args.height*.5;t.args.y=this.y-i-1,t.args.ySpeed=0,t.args.xSpeed=Math.max(Math.abs(t.args.xSpeed)||t.args.width)*Math.sign(t.args.xSpeed),t.args.mode=0,t.args.ignore=-2,t.args.cameraMode="corkscrew",t.args.xSpeed+=Math.sign(t.args.xSpeed)*(-1+Math.abs(s))*.25,t.args.gSpeed=t.args.xSpeed,e>1||e<0?(t.args.animation="walking",t.args.y=this.y-1,t.args.corkscrew=0):(t.args.animation="corkscrew",t.args.corkscrew=e)}collideA(t){return!1}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/DarkRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DarkRegion=void 0;var i=e("./Region"),r=e("curvature/base/Tag"),a=e("curvature/base/View");t.DarkRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region region-shade region-dark",this.paths=new Map,this.actors=new Set}onRendered(t){super.onRendered(t),this.basePath="M 0 0\n    \t\t\t\t\tL 0 545\n    \t\t\t\t\tL 544 545\n    \t\t\t\t\tL 544 0\n    \t\t\t\t\tZ",this.mask=a.View.from(`<svg style = "position:absolute; width: calc(100vw + 2px); height: calc(100vh + 2px); top: -1px; left: -1px">\n\t\t\t<defs>\n\t\t\t\t<clipPath id = "mask-${this.args.id}" clipPathUnits="userSpaceOnUse">\n\t\t\t\t\t<path data-lights />\n\t\t\t\t</clipPath>\n\t\t\t</defs>\n\t\t<svg>`),this.mask.render(this.tags.sprite),this.path=this.mask.findTag("path[data-lights]"),this.path.attr({d:`${this.basePath} ${this.lightPath}`}),this.tags.sprite.style({"--maskImage":`url(#mask-${this.args.id})`})}update(){super.update(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new r.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new r.Tag('<div class = "region-color-wrapper">'),this.filter=new r.Tag('<div class = "region-filter">'),this.color=new r.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node))}updateEnd(){super.updateEnd();for(const t of this.actors){const e=-this.viewport.args.y-(this.args.y-this.args.height),s=t.x+t.viewport.args.x,i=t.y+t.viewport.args.y-.5*t.args.height+(e<0?e:0);if(t.args.polygon){const e=Object.assign([],t.args.polygon),r=e.shift(),a=e.map(t=>`L ${s+t.x} ${i+t.y}`).join(" ");this.paths.set(t,`M ${s+r.x} ${i+r.y}\n\t\t\t\t\t ${a}\n\t\t\t\t\t Z`)}}this.path.attr({d:this.basePath+" "+[...this.paths.values()].join(" ")}),this.actors.clear(),this.paths.clear()}updateActor(t){t.controllable,this.actors.add(t)}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/DebrisRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebrisRegion=void 0;var i=e("./Region"),r=e("curvature/base/Tag");e("curvature/base/View");t.DebrisRegion=class extends i.Region{constructor(){var t;super(...arguments),this.args.type="region region-shade region-debris",this.args.active=null===(t=this.args.active)||void 0===t||t}update(){this.others.switch&&(this.args.active=this.others.switch.args.active),super.update(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new r.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new r.Tag('<div class = "region-color-wrapper">'),this.filter=new r.Tag('<div class = "region-filter">'),this.color=new r.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node))}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/DropVehicleRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropVehicleRegion=void 0;var i=e("./Region");e("../ObjectPalette");t.DropVehicleRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region drop-vehicle"}updateActor(t){t.controllable&&(t.isVehicle||t.args.standingOn&&(t.args.standingOn=null))}}}),require.register("region/ExitRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExitRegion=void 0;var i=e("./Region");t.ExitRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region exit",this.args.hidden=!0,this.triggered=!1}updateActor(t){if(!this.viewport)return;if(this.others.boss&&this.others.boss.args.hitPoints>0)return;if(t.occupant&&(t=t.occupant),!t.controllable)return;const e=this.viewport;e.clearCheckpoints(),this.triggered||e.onFrameOut(30,()=>{if(this.triggered)return;this.triggered=!0;const s=this.others.signpost&&this.others.signpost.tally;e.replay?e.quit(2):this.args.nextStage?(s||e.clearAct(`${t.args.name} GOT THROUGH\n${e.args.actName}`,!1)).addEventListener("done",t=>e.quit(2,()=>e.loadMap({mapUrl:"/map/"+this.args.nextStage}))):(s||e.clearAct(`${t.args.name} GOT THROUGH\n${e.args.actName}`,!1)).addEventListener("done",t=>e.quit(2))})}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/ExplodingRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodingRegion=void 0;var i=e("./Region"),r=e("../audio/Sfx"),a=e("curvature/base/Tag");t.ExplodingRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region region-exploding"}updateActor(t){this.args.active&&(t.controllable||(t.break&&(t.break(),this.viewport.actorIsOnScreen(t)||this.viewport.actors.remove(t)),t.pop&&(t.pop(),this.viewport.actorIsOnScreen(t)||this.viewport.actors.remove(t))))}update(){super.update();const t=this.viewport;if(t)if(this.args.active){if(t){Math.random()>.85&&r.Sfx.play("BOSS_DAMAGED");for(let e=0;e<1;e++){const e=document.createElement("div");e.classList.add("particle-explosion");const s=new a.Tag(e),i=(this.args.width,Math.random(),this.args.height,Math.random(),Math.max(this.x,-this.viewport.args.x)),r=Math.max(this.y,-this.viewport.args.y),n=Math.min(this.x+this.args.width,-this.viewport.args.x+this.viewport.args.width),o=Math.min(this.y-this.args.height,-this.viewport.args.y-this.viewport.args.height/2),l=n-i,h=r-o;s.style({"--x":i+l*Math.random(),"--y":o+h*Math.random()}),t.particles.add(s),setTimeout(()=>t.particles.remove(s),512)}}}else{if(this.args.target&&t.actorsById[this.args.target]){const e=t.actorsById[this.args.target];t.auras.delete(e)}t.auras.delete(this)}}activate(){r.Sfx.play("BOSS_DAMAGED"),this.args.active=!0,this.viewport.onFrameOut(250,()=>this.args.active=!1),this.args.target&&this.viewport.actorsById[this.args.target]&&this.viewport.onFrameOut(60,()=>{const t=this.viewport.actorsById[this.args.target];this.viewport.auras.add(t),t.activate(other,this)})}}}),require.register("region/FgShadeRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FgShadeRegion=void 0;var i=e("./ShadeRegion");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.FgShadeRegion=class extends i.ShadeRegion{constructor(){super(...arguments),r(this,"currentFilter",-1),r(this,"filters",["studio","western","heat","hydro","lava","frost","eight-bit","corruption","black-hole","normal"]),this.args.type="fg-region-shade region region-shade"}}}),require.register("region/ForceRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ForceRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.ForceRegion=class extends i.Region{constructor(t,e){var s,i,r;super(t,e),this.args.type="region region-force",this.args.xForce=null!==(s=this.args.xForce)&&void 0!==s?s:0,this.args.yForce=null!==(i=this.args.yForce)&&void 0!==i?i:-5,this.args.active=null!==(r=this.args.active)&&void 0!==r?r:1}update(){this.originalHeight||(this.originalHeight=this.args.height),this.switch&&this.switch.args.active>0&&!this.args.active&&(this.args.active=!0),super.update()}onAttach(){this.viewport&&this.args.switch}wakeUp(){this.switch=this.viewport.actorsById[this.args.switch]}activate(){this.args.active=1}updateActor(t){if(t instanceof i.Region||t.args.static)return;if(this.args.active<=0)return;if(t.args.falling){const e=t.args.xSpeed+Number(this.args.xForce);Math.abs(e)>Math.abs(this.args.xForceMax)&&Math.sign(this.args.xForceMax)===Math.sign(e)?t.args.xSpeed=this.args.xForceMax:t.args.xSpeed=e;const s=t.args.ySpeed+Number(this.args.yForce);return Math.abs(s)>Math.abs(this.args.yForceMax)&&Math.sign(this.args.yForceMax)===Math.sign(s)?(Math.abs(s)>=t.args.gravity||t.args.falling)&&(t.args.ySpeed=this.args.yForceMax):t.args.ySpeed=s,void(t.args.groundAngle=0)}let e;switch(t.args.mode){case 0:e=t.args.gSpeed+this.args.xForce,Math.abs(e)>Math.abs(this.args.xForceMax)&&Math.sign(this.args.xForceMax)===Math.sign(e)?t.args.gSpeed=this.args.xForceMax:t.args.gSpeed=e;break;case 1:t.args.gSpeed+=Math.sign(this.args.yForce);break;case 2:t.args.gSpeed-=Math.sign(this.args.xForce);break;case 3:t.args.gSpeed-=Math.sign(this.args.yForce)}}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/FrictionRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrictionRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.FrictionRegion=class extends i.Region{constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e,arguments.length>1?arguments[1]:void 0),this.args.type="region region-friction",this.args.friction=null!==(t=e.friction)&&void 0!==t?t:1}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/GrindingRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GrindingRegion=void 0;var i=e("./Region");e("curvature/base/Tag");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.GrindingRegion=class extends i.Region{constructor(){super(...arguments),r(this,"grind",!0),this.args.type="region grinding",this.args.hidden=!0}update(){this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){t.args.falling||(t.args.grinding=!0)}collideA(t,e){super.collideA(t,e)}collideB(t,e){super.collideA(t,e)}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/KillRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KillRegion=void 0;var i=e("./Region");t.KillRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region kill",this.args.hidden=!0}updateActor(t){t.controllable&&t.die()}}}),require.register("region/LavaRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LavaRegion=void 0;var i=e("./Region"),r=e("../actor/Ring"),a=e("../actor/MarbleBlock"),n=e("curvature/base/Tag"),o=e("curvature/base/Bindable");function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.LavaRegion=class extends i.Region{constructor(){super(...arguments),l(this,"isWater",!0),this.args.type="region region-lava",this.args.gravity=.5,this.args.drag=.85,this.args.density=15,this.skimSpeed=1/0}update(){!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new n.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new n.Tag('<div class = "region-color-wrapper">'),this.filter=new n.Tag('<div class = "region-filter">'),this.color=new n.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node)),this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){t instanceof r.Ring?t.args.ySpeed=-Math.abs(t.args.ySpeed||-6):t.noClip||(t.controllable||t instanceof r.Ring)&&(t.y<this.y+-this.args.height+8||t.args.ySpeed<0||t.args.ignore||t.args.mercy||t.immune(this,"fire")||t.damage(this,"fire"))}collideA(t,e){if(!t.noClip)return!(t instanceof a.MarbleBlock||t.args.standingOn&&t.args.standingOn!==o.Bindable.make(this)||(super.collideA(t,e),!t.args.mercy&&!t.immune(this,"fire")&&(t.damage(this,"fire"),0)))}get solid(){return!0}get isEffect(){return!0}}}),require.register("region/LoadingRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingRegion=void 0;var i=e("./Region");t.LoadingRegion=class extends i.Region{constructor(){var t;super(...arguments),this.args.hidden=!0,this.loading=this.loaded=!1,this.args.xOffset=null!==(t=this.args.xOffset)&&void 0!==t?t:0}updateActor(t){this.others.signpost&&!this.others.signpost.args.active&&this.others.signpostAlt&&!this.others.signpostAlt.args.active||t.controllable&&(this.loaded||this.loading||this.loading||(this.loading=!0))}updateEnd(){if(super.updateStart(),this.loaded||!this.loading)return;const t=this.viewport,e=t.tileMap,s=(e.mapData.width,e.mapData.height,this.args.x/32+this.args.xOffset);this.others.signpost&&this.others.signpost.willActivate?(t.args.frozen=30,t.appendMap(this.args.map,s,0),this.loaded=!0):this.others.signpostAlt&&this.others.signpostAlt.willActivate&&(t.args.frozen=30,t.appendMap(this.args.map,s,0),this.loaded=!0)}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/PerspectiveRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.PerspectiveRegion=class extends i.Region{constructor(t,e){var s,i,r,a;super(t,e),this.args.sticky=!0,this.args.type="region rolling",this.args.destroyTruck=null!==(s=this.args.destroyTruck)&&void 0!==s&&s,this.args.maxSpeed=null!==(i=this.args.maxSpeed)&&void 0!==i?i:-1,this.args.minSpeed=null!==(r=this.args.minSpeed)&&void 0!==r?r:-1,this.args.canJump=null!==(a=this.args.canJump)&&void 0!==a&&a,this.args.hidden=!0,this.args.perspective=!0,this.args.shift=this.args.shift||600,this.args.xPerspective=0}update(){this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){if(t!==this.viewport.controlActor)return;let e=(Math.abs(t.realAngle)+-Math.PI)/(.5*Math.PI);(e=-1+Math.abs(e))<0&&(e=1-++e),e=1-e,this.args.xPerspective=this.args.shift*e,this.viewport.args.xPerspective=this.viewport.args.xPerspective||0;const s=this.args.xPerspective-this.viewport.args.xPerspective;this.viewport.args.xPerspective+=24*Math.sign(s),Math.abs(s)<24&&(this.viewport.args.xPerspective=this.args.xPerspective),console.log(this.viewport.args.xPerspective)}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/PhazonRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhazonRegion=void 0;var i=e("./Region"),r=e("../actor/Ring"),a=e("../actor/MarbleBlock"),n=e("curvature/base/Tag"),o=e("curvature/base/Bindable"),l=e("../actor/LavaBall");e("../audio/Sfx");function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.PhazonRegion=class extends i.Region{constructor(){super(...arguments),h(this,"isWater",!0),this.args.type="region region-phazon",this.args.gravity=.5,this.args.drag=.85,this.args.density=15,this.skimSpeed=1/0,this.sapped=new Set,this.timings=new WeakMap,this.onRemove(()=>this.sapped.clear())}update(){this.sapped.clear(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new n.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new n.Tag('<div class = "region-color-wrapper">'),this.filter=new n.Tag('<div class = "region-filter">'),this.color=new n.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node)),this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){t instanceof r.Ring?t.args.ySpeed=-Math.abs(t.args.ySpeed||-6):t.noClip||(t.controllable||t instanceof r.Ring)&&(t.y<this.y+-this.args.height+8||t.args.ySpeed<0||t.args.ignore||!t.args.mercy&&t.immune(this,"fire"))}collideA(t,e){if(!t.noClip){if(t instanceof a.MarbleBlock||t instanceof l.LavaBall)return!1;if(t.args.standingOn&&t.args.standingOn!==o.Bindable.make(this))return!1;if(t.args.y=Math.round(t.args.y),super.collideA(t,e),t.args.mercy||t.immune(this,"phazon"))return!0;if(t.controllable&&!this.sapped.has(t)){let e=0;this.timings.has(t)||this.timings.set(t,e),e=this.timings.get(t),e++,this.timings.set(t,e),e%9==0&&(!t.args.float||t.fallTime<20)&&t.sap()}return this.sapped.add(t),!0}}get solid(){return!0}get isEffect(){return!0}}}),require.register("region/RainRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RainRegion=void 0;var i=e("./Region"),r=e("curvature/base/Tag");e("curvature/base/View");t.RainRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region region-shade region-rain"}update(){super.update(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new r.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new r.Tag('<div class = "region-color-wrapper">'),this.filter=new r.Tag('<div class = "region-filter">'),this.color=new r.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node))}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/Region.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Region=void 0;var i=e("curvature/base/Tag"),r=e("../actor/PointActor");t.Region=class extends r.PointActor{static fromDef(t){const e=super.fromDef(t);return e.args.width=t.width,e.args.height=t.height,e.args.x=e.originalX=-0+Math.floor(t.x),e.args.y=e.originalY=-0+Math.floor(t.y),e.args.static=!0,e}constructor(){super(...arguments),this.args.type="region",this.args.width=this.args.width||32,this.args.height=this.args.height||32,this.args.density=0,this.args.gravity=1,this.args.drag=1,this.skimSpeed=1/0,this.args.float=-1,this.isRegion=!0,this.skimmers=new WeakSet}onRendered(){this.mainElem=new i.Tag(this.tags.sprite.parentNode),super.onRendered()}skim(t){this.skimmers.add(t)}updateStart(){this.skimmers=new WeakSet,super.updateStart()}update(){if(this.viewport&&(!this.focus&&this.args.focus&&(this.focus=this.viewport.actorsById[this.args.focus]),super.update(),this.viewport.args.frameId%this.viewport.settings.frameSkip==0)){var t;const e=-this.viewport.args.y-(this.args.y-this.args.height),s=-this.viewport.args.x-this.args.x;this.mainElem&&this.mainElem.style({"--viewportWidth":this.viewport.args.width+"px","--viewportHeight":this.viewport.args.height+"px","--leftBoundry":s+"px","--topBoundry":e+"px","--vpX":this.viewport.args.x+"px","--vpY":this.viewport.args.y+"px","--color":null!==(t=this.args.color)&&void 0!==t?t:"rgba(0,128,255,0.33)"})}}updateActor(t){}get solid(){return!1}get isEffect(){return!0}enter(t){}leave(t){}}}),require.register("region/RollingRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RollingRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.RollingRegion=class extends i.Region{constructor(t,e){var s,i,r,a;super(t,e),this.args.sticky=!0,this.args.type="region rolling",this.args.destroyTruck=null!==(s=this.args.destroyTruck)&&void 0!==s&&s,this.args.maxSpeed=null!==(i=this.args.maxSpeed)&&void 0!==i?i:-1,this.args.minSpeed=null!==(r=this.args.minSpeed)&&void 0!==r?r:-1,this.args.canJump=null!==(a=this.args.canJump)&&void 0!==a&&a,this.args.hidden=!0}update(){this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){if(!t.controllable)return;if(t.args.falling)return;t.willStick=!1;const e=t.args.modeTime>5?t.gSpeedLast:0;Math.abs(t.args.gSpeed)<this.args.minSpeed&&(t.args.gSpeed=this.args.minSpeed*Math.sign(t.args.gSpeed||e||t.args.direction)),this.args.maxSpeed>0&&Math.abs(t.args.gSpeed)>this.args.maxSpeed&&(t.args.gSpeed=this.args.maxSpeed*Math.sign(t.args.gSpeed||e||t.args.direction),1===t.args.mode&&(t.args.gSpeed=t.ySpeedLast),3===t.args.mode&&(t.args.gSpeed=-t.ySpeedLast)),t.args.gSpeed||(t.args.gSpeed=2*Math.sign(e||t.args.direction)),t.args.rolling||(t.args.rolling=!0),t.willJump&&(this.args.canJump||(t.willJump=!1))}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/ShadeRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShadeRegion=void 0;var i=e("../ui/CharacterString"),r=e("../effects/Cylinder"),a=e("../effects/Pinch"),n=e("./Region"),o=e("curvature/base/Tag");function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ShadeRegion=class extends n.Region{constructor(){super(...arguments),l(this,"currentFilter",-1),l(this,"filters",["western","heat","hydro","lava","black-hole","normal"]),this.args.type="region region-shade"}onRendered(){super.onRendered(),this.actorFilterWrapper=new o.Tag('<div class = "region-filter-wrapper">'),this.actorColorWrapper=new o.Tag('<div class = "region-color-wrapper">'),this.filterWrapper=new o.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new o.Tag('<div class = "region-color-wrapper">'),this.actorFilter=new o.Tag('<div class = "region-filter">'),this.actorColor=new o.Tag('<div class = "region-color">'),this.filter=new o.Tag('<div class = "region-filter">'),this.color=new o.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node),this.text=new i.CharacterString({value:""}),this.text.render(this.tags.sprite),this.cylinder=new r.Cylinder({id:"shade-cylinder",width:this.args.width,height:this.args.height}),this.cylinder.render(this.tags.sprite),this.pinch=new a.Pinch({id:"shade-pinch",width:this.args.width,height:this.args.height,scale:150}),this.pinch.render(this.tags.sprite),this.args.filter&&(this.filters=[this.args.filter]),this.rotateFilter()}update(){super.update(),this.args.scale=175-Math.abs(25*Math.sin(Date.now()/200)),!this.switch&&this.args.switch&&(this.switch=this.viewport.actorsById[this.args.switch],this.switch&&this.switch.args.bindTo("active",t=>{t&&this.rotateFilter()}))}rotateFilter(){this.mainElem&&this.args.filter&&this.mainElem.classList.remove(this.args.filter),this.mainElem&&(this.args.filter=this.filters[this.currentFilter++],this.currentFilter>=this.filters.length&&(this.currentFilter=0),this.args.filter&&this.mainElem.classList.add(this.args.filter),this.args.filter&&(this.text.remove(),this.text=new i.CharacterString({value:`${this.currentFilter}: ${this.args.filter}`}),this.text.render(this.tags.sprite)))}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/SlidingRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SlidingRegion=void 0;var i=e("./Region");e("curvature/base/Tag");t.SlidingRegion=class extends i.Region{constructor(t,e){var s,i;super(t,e),this.args.sticky=!0,this.args.hidden=!0,this.args.canJump=null===(s=this.args.canJump)||void 0===s||s,this.args.type="region sliding",this.args.toSpeed=null!==(i=this.args.toSpeed)&&void 0!==i?i:8}updateActor(t){t.args.static||t.args.falling||t.controllable&&(t.willStick=!1,Math.abs(this.args.toSpeed-t.args.gSpeed)>1?t.args.gSpeed+=Math.sign(this.args.toSpeed-t.args.gSpeed):t.args.gSpeed=this.args.toSpeed,t.args.rolling=!1,t.args.sliding=!0,t.willJump&&(this.args.canJump||(t.willJump=!1)))}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/SwitchRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchRegion=void 0;var i=e("./Region"),r=e("../actor/Rocket");t.SwitchRegion=class extends i.Region{constructor(){for(var t,e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];super(...s),this.args.type="region region-switch",this.args.latch=null!==(t=s.latch)&&void 0!==t?t:this.args.latch,this.args.hidden=!0,this.activated=!1}onAttach(t){return t&&t.preventDefault(),!1}activate(t){if(!this.viewport)return;if(this.args.latch&&this.activated)return;this.args.latch&&(this.args.active=this.activated=!0);const e=this.viewport.actorsById[this.args.target];e&&e.activate&&e.activate(t,this)}updateActor(t){if(this.args.rocket){if(t instanceof r.Rocket){const e=this.viewport.actorsById[this.args.target];if(!e||!e.activate)return;this.viewport.onFrameOut(this.args.delay||1,()=>e.activate(t,this)),t.explode()}}else t.isVehicle&&t.occupant&&(t=t.occupant),t.controllable&&this.viewport.onFrameOut(this.args.delay||1,()=>this.activate(t))}}}),require.register("region/ToxicRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToxicRegion=void 0;var i=e("./Region"),r=e("../actor/Ring"),a=e("../actor/MarbleBlock"),n=e("curvature/base/Tag"),o=e("curvature/base/Bindable");e("../audio/Sfx");function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ToxicRegion=class extends i.Region{constructor(){super(...arguments),l(this,"isWater",!0),this.args.type="region region-toxic",this.args.gravity=.5,this.args.drag=.85,this.args.density=15,this.skimSpeed=0,this.sapped=new Set,this.timings=new WeakMap,this.onRemove(()=>this.sapped.clear())}update(){this.sapped.clear(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new n.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new n.Tag('<div class = "region-color-wrapper">'),this.filter=new n.Tag('<div class = "region-filter">'),this.color=new n.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node)),this.originalHeight||(this.originalHeight=this.args.height),super.update()}updateActor(t){t instanceof r.Ring?t.args.ySpeed=-Math.abs(t.args.ySpeed||-6):t.noClip||(t.controllable||t instanceof r.Ring)&&(t.y<this.y+-this.args.height+8||t.args.ySpeed<0||t.args.ignore||!t.args.mercy&&t.immune(this,"fire"))}collideA(t,e){if(!t.noClip){if(t instanceof a.MarbleBlock)return!1;if(t.args.standingOn&&t.args.standingOn!==o.Bindable.make(this))return!1;if(t.args.y=Math.round(t.args.y),super.collideA(t,e),t.args.mercy||t.immune(this,"toxic"))return!0;if(t.controllable&&!this.sapped.has(t)){let e=0;this.timings.has(t)||this.timings.set(t,e),e=this.timings.get(t),e++,this.timings.set(t,e),e%27==0&&(!t.args.float||t.fallTime<20)&&t.sap()}return this.sapped.add(t),!0}}get solid(){return!0}get isEffect(){return!0}}}),require.register("region/VehicleRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VehicleRegion=void 0;var i=e("./Region"),r=e("../ObjectPalette");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.VehicleRegion=class extends i.Region{constructor(){super(...arguments),a(this,"SpawnedFor",Symbol("SpawnedFor")),this.args.type="region vehicle"}updateActor(t){if(!1!==t[this.SpawnedFor]){if(t[this.SpawnedFor]){const e=t[this.SpawnedFor];e.args.x=t.args.x,e.args.y=t.args.y,e.args.xSpeed=t.args.xSpeed,e.args.ySpeed=t.args.ySpeed,e.args.gSpeed=t.args.gSpeed,t.args.standingOn=e}if(t.controllable&&!t.isVehicle&&!t.args.standingOn){const e=r.ObjectPalette[this.args.vehicle];if(!e)return;const s=new e({x:t.x,y:t.y,xSpeed:t.args.xSpeed,ySpeed:t.args.ySpeed,gSpeed:t.args.gSpeed,falling:t.args.falling,lockedIn:!0});this.viewport.spawn.add({object:s}),t.args.standingOn=s,t[this.SpawnedFor]=s}}}leave(t){if(t.occupant&&(t=t.occupant),!this.args.restricted)return;if(!t.args.standingOn)return;if(!t.args.standingOn.isVehicle)return;t[this.SpawnedFor]=!1;const e=t.args.standingOn;e.args.lockedIn=!1,e.dead=!0,t.args.standingOn=null,t.args.x=e.args.x,t.args.y=e.args.y,t.args.gSpeed=e.args.gSpeed,t.args.xSpeed=e.args.xSpeed,t.args.ySpeed=e.args.ySpeed,t.args.falling=e.args.falling}}}),require.register("region/VerticalRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalRegion=void 0;var i=e("./Region");t.VerticalRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region vertical",this.args.hidden=!0}updateActor(t){t.args.falling&&(t.args.xSpeed=0)}}}),require.register("region/WaterRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterRegion=void 0;var i=e("./Region"),r=e("curvature/base/Tag");e("curvature/base/View");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.WaterRegion=class extends i.Region{constructor(){super(...arguments),a(this,"isWater",!0),this.args.type="region region-water",this.entryParticle='<div class = "particle-splash">',this.args.gravity=.4,this.args.drag=.85,this.args.density=1,this.skimSpeed=15,this.draining=0,this.skimParticles=new Map}skim(t){if(super.skim(t),this.viewport.args.frameId%this.viewport.settings.frameSkip!=0)return;const e=t.rotatePoint(t.args.gSpeed,3);if(this.skimParticles.has(t)){const s=this.skimParticles.get(t),{skimParticle:i,timeout:r}=s;r();const a=this.viewport.onFrameOut(2,()=>{this.viewport.particles.remove(i),this.skimParticles.delete(t)});return s.timeout=a,void i.style({"--x":e[0]+t.x,"--y":e[1]+t.y,"z-index":0,"--flip":`${Math.sign(t.args.gSpeed)}`})}if(this.viewport){const e=new r.Tag('<div class = "particle-skim">');this.viewport.particles.add(e);const s=this.viewport.onFrameOut(2,()=>{this.viewport.particles.remove(e),this.skimParticles.delete(t)});this.skimParticles.set(t,{skimParticle:e,timeout:s})}}update(){if(this.viewport){if(!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new r.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new r.Tag('<div class = "region-color-wrapper">'),this.filter=new r.Tag('<div class = "region-filter">'),this.color=new r.Tag('<div class = "region-color">'),this.colorWrapper.appendChild(this.color.node),this.filterWrapper.appendChild(this.filter.node),this.tags.sprite.appendChild(this.colorWrapper.node),this.tags.sprite.appendChild(this.filterWrapper.node)),this.args.controller){const t=this.viewport.actorsById[this.args.controller];t&&(this.args.height=t.args.level)}if(!this.switch&&this.args.switch&&(this.switch=this.viewport.actorsById[this.args.switch],this.switch&&this.switch.args.bindTo("active",t=>{!t&&this.draining,this.draining=t?1:-1})),this.originalHeight||(this.originalHeight=this.args.height),this.draining&&(this.draining>0&&this.args.height>=32?this.args.height-=3.5:this.draining<0&&this.args.height<this.originalHeight&&(this.args.height+=3.5),this.args.height<=0?(this.args.display="none",this.draining>0&&(this.draining=0)):this.args.display="initial"),this.target&&this.args.height!==this.target){var t,e;const s=this.args.height-this.target,i=null!==(t=this.args.drainSpeed)&&void 0!==t?t:1,r=null!==(e=this.args.fillSpeed)&&void 0!==e?e:1,a=s>0?i:r;Math.abs(this.args.height-this.target)>a?this.args.height-=Math.abs(a)*Math.sign(s):this.args.height=this.target}super.update()}}updateEnd(){if(super.updateEnd(),this.viewport.args.frameId%this.viewport.settings.frameSkip==0)for(const[t,{skimParticle:e}]of this.skimParticles){const s=t.rotatePoint(0,3);e.style({"--x":s[0]+t.x+-32*Math.sign(t.args.gSpeed),"--y":s[1]+t.y,"z-index":0,"--flip":`${Math.sign(t.args.gSpeed)}`})}}updateActor(t){if(t.controllable&&!(t.args.y-t.args.height<this.args.y-this.args.height)&&this.viewport.args.frameId%5==0&&Math.random()>.9){const e=this.viewport,s=new r.Tag('<div class = "particle-bubble">'),i=t.rotatePoint(...t.facePoint),a=(t.args.x,i[0],t.args.y+i[1]);s.style({"--startY":a,"--size":Math.random()});const n=e.onFrameInterval(1,()=>{const e=t.facePoint,i=t.args.x+e[0],r=t.args.y+e[1];t.args.y<this.args.y-this.args.height&&s.style({display:"none"}),r<this.args.y-this.args.height&&s.style({display:"none"}),s.style({"--x":i,"--y":r})}),o=e.onFrameInterval(1,()=>{s.style({"--maxY":this.args.y-this.args.height})});e.particles.add(s),e.onTimeout(350,()=>{s.classList.add("float"),n()}),e.onTimeout(1e3,()=>{s.classList.add("floating")}),setTimeout(()=>{e.particles.remove(s),o()},1500)}}get solid(){return!1}get isEffect(){return!0}}}),require.register("region/WaterfallRegion.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaterfallRegion=void 0;var i=e("./Region"),r=e("curvature/base/Tag");e("curvature/base/View");t.WaterfallRegion=class extends i.Region{constructor(){super(...arguments),this.args.type="region region-shade region-waterfall",this.args.density=0}update(){super.update(),!this.filterWrapper&&this.tags.sprite&&(this.filterWrapper=new r.Tag('<div class = "region-filter-wrapper">'),this.colorWrapper=new r.Tag('<div class = "region-color-wrapper">'),this.filter=new r.Tag('<div class = "region-filter">'),this.color=new r.Tag('<div class = "region-color">'),this.filterWrapper.appendChild(this.filter.node),this.colorWrapper.appendChild(this.color.node),this.tags.sprite.appendChild(this.filterWrapper.node),this.tags.sprite.appendChild(this.colorWrapper.node),this.tags.sprite.style({"--maskImage":`url(#mask-${this.args.id})`}))}get solid(){return!1}get isEffect(){return!0}}}),require.register("replay/Replay.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Replay=void 0;var i=e("curvature/base/Uuid"),r=e("curvature/model/Model");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const n=document.head.querySelector('meta[name="x-build-time"]'),o=n?n.getAttribute("content"):null;t.Replay=class extends r.Model{constructor(){super(...arguments),a(this,"class","Replay"),a(this,"uuid",String(new i.Uuid)),a(this,"created",Date.now()),a(this,"local",String(new Date)),a(this,"tz",Intl.DateTimeFormat().resolvedOptions().timeZone),a(this,"buildTime",o),a(this,"map",""),a(this,"frames",[]),a(this,"keyFrames",[]),a(this,"name",""),a(this,"lastFrame",0),a(this,"firstFrame",0)}consume(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=Object.assign(Object.create(null),t);if(s.keyFrames=Object.assign([],s.keyFrames),s.frames=Object.assign([],s.frames),s.frames=s.frames.map(t=>Object.assign([],t)),s.uuid=s.uuid||this.uuid||String(new i.Uuid),super.consume(s,e=!1),s.frames){this.keyFrames=s.frames.filter(t=>Object.keys(t[2]).length).map(t=>t[0]);const t=this.frames.map(t=>t[0]);this.firstFrame=t.length?Math.min(...t):0,this.lastFrame=t.length?Math.max(...t):0}}getIndexedFrames(){const t=new Map;for(const e of this.frames)t.set(e[0],e);return t}}}),require.register("replay/ReplayDatabase.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayDatabase=void 0;var i=e("curvature/model/Database");t.ReplayDatabase=class extends i.Database{_version_1(t){const e=this.createObjectStore("replays",{keyPath:"id",autoIncrement:!0});e.createIndex("buildTime","buildTime",{unique:!1}),e.createIndex("created","created",{unique:!1}),e.createIndex("uuid","uuid",{unique:!0}),e.createIndex("id","id",{unique:!0})}_version_2(t,e,s){const i=s.target.transaction.objectStore("replays");i.createIndex("name","name",{unique:!1}),i.createIndex("map","map",{unique:!1})}_version_3(t,e,s){const i=s.target.transaction.objectStore("replays");i.createIndex("map-id",["map","id"],{unique:!0}),console.log("existing index names in store",i.indexNames)}}}),require.register("replay/ReplayService.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayService=void 0;t.ReplayService=class{constructor(t){this.viewport=t}startDemo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.viewport;s.reset(),s.replayFrames=t.getIndexedFrames(),s.replayStart=s.replayFrames.get(e||t.firstFrame)||{},s.replay=t,s.maxReplayFrame=t.lastFrame,s.replayOffset=-1+t.firstFrame+e,Router.setQuery("demo",t.uuid),s.loadMap({mapUrl:t.map}).then(()=>{s.args.paused=!0,s.playback()})}}}),require.register("save/Save.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Save=void 0;var i=e("curvature/base/Uuid"),r=e("curvature/model/Model"),a=e("./SaveDatabase");function n(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const o=a.SaveDatabase.open("saves",1);t.Save=class extends r.Model{constructor(){super(...arguments),n(this,"id",null),n(this,"created",Date.now()),n(this,"emeralds",[]),n(this,"characters",{}),n(this,"zones",{})}static from(t){const e=super.from(t);e.emeralds=Object.assign([],e.emeralds);for(const t of Object.values(e.zones))t.emblems=Object.assign([],t.emblems),t.chao=Object.assign([],t.chao);return e}getCharacterState(t){const e=this.characters[t]||{cleared:{}};return this.characters[t]=e}getZoneState(t){const e=this.zones[t]||{lastCheckpoint:null,emblems:[],chao:[],rings:0,score:0,time:0};return this.zones[t]=e}static index(){return o.then(t=>{const e=[];return t.select({direction:"next",index:"created",store:"saves"}).each(t=>e.push(t)).then(()=>e)})}save(){o.then(t=>{this.id?t.update("saves",this):(this.id=String(new i.Uuid),t.insert("saves",this))})}load(){}}}),require.register("save/SaveDatabase.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SaveDatabase=void 0;var i=e("curvature/model/Database");t.SaveDatabase=class extends i.Database{_version_1(t){this.createObjectStore("saves",{keyPath:"id"}).createIndex("created","created",{unique:!1})}}}),require.register("sprite/Png.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.Png=void 0;const r=[137,80,78,71,13,10,26,10];class a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;i(this,"r",0),i(this,"g",0),i(this,"b",0),i(this,"a",1),this.r=t,this.g=e,this.b=s,this.a=r}mean(){return(this.r+this.g+this.b)/3}hex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return 3===t?`${this.r.toString(16).padStart(2,"0")}${this.g.toString(16).padStart(2,"0")}${this.b.toString(16).padStart(2,"0")}`:4===t?`${this.r.toString(16).padStart(2,"0")}${this.g.toString(16).padStart(2,"0")}${this.b.toString(16).padStart(2,"0")}${this.a.toString(16).padStart(2,"0")}`:void 0}valueOf(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}}class n{constructor(){i(this,"previous",null),i(this,"content",null),i(this,"length",0),i(this,"start",0),i(this,"type",""),i(this,"crc",0)}get text(){return this.bytes.map(t=>String.fromCharCode(t)).join("")}get bytes(){const t=[];for(let e=0;e<this.length;e++)t.push(this.content.getUint8(e));return t}}class o{constructor(t){i(this,"buffer",null),i(this,"width",0),i(this,"height",0),i(this,"depth",0),i(this,"colorType",0),i(this,"compression",0),i(this,"filter",0),i(this,"interlace",0),"string"==typeof t?this.ready=fetch(t).then(t=>t.arrayBuffer()).then(t=>{this.buffer=t,this.checkHeader(),this.indexChunks()}):"object"==typeof t&&t instanceof o&&(this.ready=Promise.resolve(),this.buffer=t.buffer.slice(0),this.chunks=t.chunks.slice(0))}checkHeader(){const t=new Uint8Array(this.buffer);for(const e in r)if(r[e]!==t[e])throw new Error("Png is not valid.")}readIhdr(){const t=this.chunks[0];this.width=t.content.getUint32(0),this.height=t.content.getUint32(4),this.depth=t.content.getUint8(8),this.colorType=t.content.getUint8(9),this.compression=t.content.getUint8(10),this.filter=t.content.getUint8(11),this.interlace=t.content.getUint8(12)}get palette(){const t=[];for(const e in this.chunks){const s=this.chunks[e];if("PLTE"===s.type){for(let e=0;e<s.bytes.length;e+=3){const i=new a(s.bytes[e+0],s.bytes[e+1],s.bytes[e+2]);t.push(i)}return t}}}recolor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.palette,s=[];for(const i in e){const r=e[i],a=r.hex();if(t[a]){const e=t[a],i=[e.substring(0,2),e.substring(2,4),e.substring(4,6)].map(t=>parseInt(t,16));s.push(...i)}else s.push(r.r,r.g,r.b)}const i=new o(this);for(const t in i.chunks){const e=i.chunks[t];if("PLTE"!==e.type)continue;const r=new Uint8Array(i.buffer),a=new DataView(i.buffer,e.start+e.length,4);r.set(s,e.start),a.setUint32(0,i.runCrc(e))}return i}runCrc(t){if(!o.crcTable){o.crcTable=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1==(1&e)?e=3988292384^e>>>1:e>>>=1;o.crcTable[t]=e}}let e=4294967295;const s=new Uint8Array(this.buffer).slice(t.start-4,t.start+t.length);for(const t in s){const i=s[t];e=o.crcTable[255&(e^i)]^e>>>8}return e=(4294967295^e)>>>0}indexChunks(){const t=[];let e=8;for(;e<this.buffer.byteLength;){const s=new DataView(this.buffer,e,4);e+=4;const i=new DataView(this.buffer,e,4);e+=4;const r=new n;r.start=e,r.length=s.getUint32();for(let t=0;t<4;t++){const e=i.getUint8(t),s=String.fromCharCode(e);r.type+=s}r.content=new DataView(this.buffer,e,r.length),e+=r.length;const a=new DataView(this.buffer,e,4);r.crc=a.getUint32(),r.previous=t[t.length-1],t.push(r),e+=4}this.chunks=t}toBlob(){return new Blob([new Uint8Array(this.buffer)],{type:"image/png"})}toUrl(){return URL.createObjectURL(this.toBlob())}toDataUri(){if(this.getDataUri)return this.getDataUri;const t=new FileReader;return t.readAsDataURL(this.toBlob()),this.getDataUri=new Promise(e=>t.addEventListener("load",t=>e(t.target.result))),this.getDataUri}}t.Png=o,o.Pixel=a,o.Chunk=n}),require.register("tally/TallyBoard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TallyBoard=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/Mixin"),a=e("curvature/mixin/EventTargetMixin"),n=e("curvature/base/View"),o=e("../audio/Sfx"),l=(e("../audio/Bgm"),e("./TallyCounter")),h=e("../ui/CharacterString");function g(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.TallyBoard=class extends(r.Mixin.with(class{},a.EventTargetMixin)){constructor(){super(...arguments),g(this,"totalLabel",new h.CharacterString({value:"Total:",color:"yellow"})),g(this,"totalValue",new h.CharacterString({value:"0"})),g(this,"inventoryCounter",new h.CharacterString({value:"-"})),g(this,"inventoryBump",""),g(this,"inventory",i.Bindable.make([])),g(this,"hasInventory",!1),g(this,"counters",i.Bindable.make([])),g(this,"totaling",!1),g(this,"totaled",!1),g(this,"total",0),g(this,"step",200),g(this,"age",0),g(this,"almostDone",!1),g(this,"done",!1),g(this,"doneAge",0)}update(t){let e=!0,s=!1;this.hasInventory=!!t.args.inventory.length;for(const i of this.counters)if(45+15*i.index===this.age&&(o.Sfx.play("TALLY_SCORE"),i.started||(i.started=!0,i.display.args.value=i.points,i.display.args.color="white",i.bump="bump")),60+15*(this.counters.length+t.args.inventory.length)+15*i.index>this.age)e=!1;else if(i.started=!0,i.display.args.value>0){const r=Math.min(this.step,i.display.args.value);this.total+=r,t.controlActor.args.score+=r,i.display.args.value=Math.max(0,i.display.args.value-this.step),s=!0,e=!1}let i=0;for(const s of t.args.inventory)i++,30+15*(this.counters.length+i)>this.age?e=!1:s.tallied||(this.inventoryBump="",t.onFrameOut(1,()=>{o.Sfx.play("TALLY_SCORE"),this.inventoryBump="bump"}),this.inventory.push(s),this.inventoryCounter.args.value=(Number(this.inventoryCounter.args.value)||0)+s.points,s.tallied=!0);if(Number(this.inventoryCounter.args.value)>0){if(30+15*(this.counters.length+i+2)+30<this.age){const e=Math.min(this.step,Number(this.inventoryCounter.args.value)||0);this.total+=e,t.controlActor.args.score+=e,this.inventoryCounter.args.value=Math.max(0,(Number(this.inventoryCounter.args.value)||0)-this.step),s=!0}e=!1}s&&(this.totaling||(this.dispatchEvent("totalingstarted"),this.totaling=!0)),s||this.totaling&&this.dispatchEvent("totalingdone"),this.totaled=e,this.totaled&&this.totaling&&(o.Sfx.play("TOTAL_SCORE"),this.doneAge=this.age),this.doneAge&&this.age==this.doneAge+60&&(this.almostDone||(this.almostDone=!0,this.dispatchEvent("almostdone"))),this.doneAge&&this.age>this.doneAge+120&&(this.done||(this.done=!0,this.dispatchEvent("done"))),this.totalValue.args.value=this.total,e&&(this.totaling=!1),this.totaling&&!this.totaled&&o.Sfx.play("SWITCH_HIT"),this.age++}view(){return n.View.from(e("./tally-board.html"),this)}addCounter(t){let{type:e="label",label:s="counter",value:i=0,required:r=!0}=t;if(!i&&!r)return;const a=new l.TallyCounter;a.display=new h.CharacterString({value:"-",color:"grey"}),a.points=i,a.label=new h.CharacterString({value:s,color:"yellow"}),a.index=this.counters.length,this.counters.push(a)}}}),require.register("tally/TallyCounter.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TallyCounter=void 0;var i=e("curvature/base/Bindable");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a{constructor(){return r(this,"multiplier",1),r(this,"points",0),r(this,"value",0),r(this,"type",a.TYPE_LABEL),r(this,"label",""),r(this,"icon",""),r(this,"items",[]),r(this,"started",0),r(this,"display",0),r(this,"visible",0),r(this,"index",0),i.Bindable.make(this)}}t.TallyCounter=a,a.TYPE_LABEL=0,a.TYPE_ICONS=1,a.TYPE_ITEMS=2}),require.register("tally/tally-board.html",function(t,e,s){s.exports='<div class = "tally-board">\n\t<div class = "tally-board-content" cv-each = "counters:counter">\n\t\t<div class = "tally-board-row">\n\t\t\t<div>[[counter.label]]</div>\n\t\t\t<div class = "tally-item [[counter.bump]]">[[counter.display]]</div>\n\t\t</div>\n\t</div>\n\t<div class = "tally-board-content tally-board-inventory" cv-if = "hasInventory">\n\t\t<div class = "tally-board-row">\n\t\t\t<div cv-each = "inventory:item"><img loading="lazy" src = "[[item.tallyIcon]]" class = "inventory-icon" /></div>\n\t\t\t<div class = "tally-item [[inventoryBump]]">[[inventoryCounter]]</div>\n\t\t</div>\n\t</div>\n\t</div>\n\t<div class = "tally-board-row tally-board-total">\n\t\t<div>[[totalLabel]]</div>\n\t\t<div>[[totalValue]]</div>\n\t</div>\n</div>\n'}),require.register("tileMap/Elicit.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Elicit=void 0;var i=e("curvature/base/Mixin"),r=e("curvature/mixin/EventTargetMixin"),a=e("curvature/mixin/PromiseMixin");t.Elicit=class extends(i.Mixin.with(r.EventTargetMixin,a.PromiseMixin)){constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.fetch=fetch(t,e).then(t=>this.handleFetch(t))}headers(){return this.fetch.then(t=>{let{response:e,stream:s}=t;return e.headers})}stream(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.fetch.then(t=>{let{response:e,stream:s}=t;return new Response(s,{headers:e.headers})})}objectUrl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.stream(t,e).then(t=>t.blob()).then(t=>URL.createObjectURL(t))}emitProgressEvent(t,e){const s=t?e/t:0;this.dispatchEvent(new CustomEvent("progress",{detail:{length:t,received:e,done:s}}))}iterateDownload(t,e,s){this.emitProgressEvent(s,0);let i=0;const r=()=>{t.read().then(t=>{let{done:n,value:o}=t;return n?(this[a.PromiseMixin.Accept](),void e.close()):(e.enqueue(o),i+=o.length,this.emitProgressEvent(s,i),r())})};return r()}handleFetch(t){const e=t.body.getReader(),s=t.headers.get("Content-Length"),i=this;return{response:t,stream:new ReadableStream({start(t){i.iterateDownload(e,t,s)}})}}}}),require.register("tileMap/TileMap.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileMap=void 0;e("curvature/base/Tag");var i=e("curvature/base/Mixin"),r=(e("curvature/base/Bindable"),e("curvature/mixin/EventTargetMixin")),a=e("./Elicit");t.TileMap=class extends(i.Mixin.with(r.EventTargetMixin)){constructor(t,e){super(),this.preloaders=new Map,this.meta=new Map,this.heightMask=null,this.tileImages=new Map,this.tileNumberCache=new Map,this.tileSetCache=new Map,this.tileCache=new Map,this.heightMasks=new Map,this.heightMaskCache=new Map,this.prefixed=new Map,this.mapDirectory="/map",this.tileLayers=[],this.destructibleLayers=[],this.collisionLayers=[],this.objectLayers=[];const s=t.mapUrl;if(this.mapData=null,this.mapUrl=s,this.maps=new Map,this.replacements=new Map,this.loaded=new Map,this.emptyCache=new Map,this.solidCache=new Map,"json"===String(s).substr(-4)){const t=new a.Elicit(s);t.addEventListener("progress",t=>{const{received:e,length:i,done:r}=t.detail;this.dispatchEvent(new CustomEvent("level-progress",{detail:{length:i,received:e,done:r,url:s}}))}),this.ready=t.stream().then(t=>t.json()).then(t=>{if(this.maps.set(t,[0,0]),this.mapData=t,t&&t.properties)for(const e of t.properties){const t=e.name.replace(/-/g,"_");this.meta.set(t,e.value)}return this.desparseLayers(t),this.loadLayers(t),this.loadTilesets(t)})}else"png"===String(s).substr(-3)&&(this.ready=this.fromImage(s,32));Object.preventExtensions(this)}desparseLayers(t){for(const e of t.layers){if("tilelayer"!==e.type||!e.sparsed||e.data)continue;const t=e.data=Object.create(null);for(;e.sparsed.length;){const s=Number(e.sparsed.pop());t[Number(e.sparsed.pop())]=s}}}preloadMap(t){if(this.preloaders.has(t))return this.preloaders.get(t);const e=new a.Elicit(t).stream().then(t=>t.json());return this.preloaders.set(t,e),e}append(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.preloadMap(t).then(t=>{const r=this.mapData.width,a=-r+e,n=r+t.width+a,o=this.mapData.height;Math.max(o,o+t.height+-Math.round(s/32)),this.maps.set(t,[e,s]),this.resize(n,o),this.desparseLayers(t);let l=0;for(const t of this.mapData.tilesets)l+=t.tilecount;for(const e of t.tilesets)e.firstgid+=l;for(const r of t.layers){const t=Object.create(null),a=this.mapData.width-r.width,n=e+s*this.mapData.width;if(r.data){for(let e of Object.keys(r.data)){const s=Number(e),i=Number(r.data[e]),o=Math.floor(s/r.width);delete r.data[e],t[o*a+n+s]=i+l}Object.assign(r.data,t);for(const t of this.mapData.layers)r.name===t.name&&(Object.assign(t.data,r.data),t.layer.setMeta(r,i))}}for(const e of t.tilesets)this.mapData.tilesets.push(e);return this.tileNumberCache.clear(),this.loadTilesets(t).then(()=>({defs:this.getObjectDefs(t,l),data:t}))})}resize(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.tileLayers;const i=this.mapData,r=i.width;i.height,i.width=t,i.height=e;const a=t-r;for(const t of s){const e=Object.create(null);for(const[s,i]of Object.entries(t.data)){const t=Number(s),n=Math.floor(t/r);e[s]=0,e[n*a+t]=i}t.data=e}this.tileNumberCache.clear()}offset(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.tileLayers;const i=t+e*this.mapData.width;for(const t of s){const e=Object.create(null);for(const[s,r]of Object.entries(t.data)){const t=Number(s);e[s]=0,e[i+t]=r}t.data=e}this.tileNumberCache.clear()}loadTilesets(t){const e=[],s=new Map,i=new Map;this.emptyCache.clear(),this.solidCache.clear();for(const r of t.tilesets){const t=new Image;this.tileImages.set(r,t),this.prefixed.has(r)||this.prefixed.set(r,String(this.mapDirectory+"/"+r.image).replace(/\/\/+/g,"/"));const n=this.prefixed.get(r);r.original=r.image=n;const o=new a.Elicit(n);o.addEventListener("progress",t=>{const{received:e,length:r,done:a}=t.detail;s.set(o,e),i.set(o,r);const l=[...s.values()].reduce((t,e)=>Number(t)+Number(e)),h=[...i.values()].reduce((t,e)=>Number(t)+Number(e)),g=l/h;this.dispatchEvent(new CustomEvent("texture-progress",{detail:{length:h,received:l,done:g,url:n}}))});const l=o.objectUrl().then(e=>new Promise(s=>{r.cachedImage=e,t.addEventListener("load",i=>{this.replacements.has(n)||this.replacements.set(n,e),this.loaded.set(n,e);const a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0,t.width,t.height),this.heightMasks.set(r,a.getContext("2d").getImageData(0,0,a.width,a.height)),s(a)},{once:!0}),t.src=e}));e.push(l)}return Promise.all(e)}loadLayers(t){const e=Object.create(null);t.layers,t.layers.forEach((t,e)=>{t.offsetX=!1,t.offsetY=!1,t.offsetXChanged=!1,t.offsetYChanged=!1,t.destroyed=!1,t.layer=null,t.index=null,Object.preventExtensions(t)}),this.objectLayers=t.layers.filter(t=>"objectLayers"===t.type),this.tileLayers=t.layers.filter(t=>"tilelayer"===t.type),this.tileLayers.forEach((t,e)=>t.index=e),e.tileLayers=this.tileLayers,this.collisionLayers=this.tileLayers.filter(t=>!!t.name.match(/^Collision\s\d+/)),this.destructibleLayers=this.tileLayers.filter(t=>!!t.name.match(/^Destructible\s\d+/)),e.destructibleLayers=this.destructibleLayers,e.collisionLayers=this.collisionLayers}coordsToTile(t,e,s){const i=this.blockSize;let r=0,a=0;var n,o;return this.tileLayers[s]&&(r=null!==(n=this.tileLayers[s].offsetX)&&void 0!==n?n:0,a=null!==(o=this.tileLayers[s].offsetY)&&void 0!==o?o:0),[Math.floor((t-r)/i),Math.floor((e-a)/i)]}getTileNumber(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.tileLayers;if(!i[s])return!1;const r=this.mapData,a=r.width,n=r.height;if(t>=a||t<0){if(t<0||!this.meta.get("wrapX"))return 0===s&&1;t<0&&t%a!=0&&e++,t%=a}if(e>=n||e<0){if(e<0||!this.meta.get("wrapY"))return 0===s&&1;e%=n}const o=e*a+t;if(o in i[s].data){const t=i[s].data[o],e=t>0?t-1:0;return!this.checkEmpty(e)&&e}return!1}getObjectDefs(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mapData,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t)return t.layers.filter(t=>"objectgroup"===t.type).map(t=>t.objects).flat().map(t=>(void 0!==t.gid&&(t.gid+=e),t))}getTile(t){const e=this.tileCache.get(t);if(void 0!==e)return this.replacements.has(e[3])?e[2]=this.replacements.get(e[3]):this.loaded.has(e[3])&&(e[2]=this.loaded.get(e[3])),e;const s=this.blockSize;let i=0,r=0,a="",n="";const o=this.getTileset(t),l=this.tileImages.get(o);if(!o.meta&&o.properties){o.meta=Object.create(null);for(const t of o.properties)o.meta[t.name]=t.value}if(t){const e=t+-o.firstgid+1,h=Math.ceil(l.width/s);i=e%h,r=Math.floor(e/h),a=o.image,n=o.original}const h=[i,r,a,n,o];return Object.preventExtensions(h),this.tileCache.set(t,h),h}getSolid(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.trunc(t),e=Math.trunc(e);let i,r,a=0,n=0;s instanceof Map?r=s:((r=new Map).set(this.tileLayers[0],!0),r.set(this.tileLayers[s],!0));for(const[s,h]of r){if(!h)continue;const r=s.index;var o,l;if(this.tileLayers[r]&&(a=null!==(o=this.tileLayers[r].offsetX)&&void 0!==o?o:0,n=null!==(l=this.tileLayers[r].offsetY)&&void 0!==l?l:0),i=this.getTileNumber(Math.floor((t-a)/this.blockSize),Math.floor((e-n)/this.blockSize),r),this.collisionLayers.length,r<=3){if(0===i)continue;if(1===i)return this.tileLayers[r]}const g=this.getTileset(i),c=this.mapData.tilewidth,d=this.getTile(i),u=d[0]*c,p=d[1]*c,f=u+Number(t)%c,m=p+Number(e)%c,v=this.heightMasks.get(g),y=4*(f+m*v.width);if(255===v.data[y+3])return this.tileLayers[r]}}getColor(t,e,s){let i=0,r=0;var a,n;this.tileLayers[s]&&(i=null!==(a=this.tileLayers[s].offsetX)&&void 0!==a?a:0,r=null!==(n=this.tileLayers[s].offsetY)&&void 0!==n?n:0);const o=this.getTileNumber(Math.floor((t-i)/this.blockSize),Math.floor((e-r)/this.blockSize),s),l=this.getTileset(o),h=this.mapData.tilewidth,g=this.getTile(o),c=[g[0]*h,g[1]*h],d=Number(t)%h,u=Number(e)%h,p=c[0]+d,f=c[1]+u,m=this.heightMasks.get(l),v=4*(p+f*m.width);return(m.data[v+0]<<24)+(m.data[v+1]<<16)+(m.data[v+2]<<8)+(m.data[v+3]<<0)}checkEmpty(t){if(this.emptyCache.has(t))return this.emptyCache.get(t);this.getTile(t);const e=this.getTileset(t),s=this.mapData.tilewidth,i=this.getTile(t),r=[i[0]*s,i[1]*s];for(let i=0;i<s;i++)for(let a=0;a<s;a++){const s=r[0]+i,n=r[1]+a,o=this.heightMasks.get(e),l=4*(s+n*o.width);if(o.data[l+3]>0)return this.emptyCache.set(t,!1),!1}return this.emptyCache.set(t,!0),!0}checkFull(t){if(this.solidCache.has(t))return this.solidCache.get(t);this.getTile(t);const e=this.getTileset(t),s=this.mapData.tilewidth,i=this.getTile(t),r=[i[0]*s,i[1]*s];for(let i=0;i<s;i++)for(let a=0;a<s;a++){const s=r[0]+i,n=r[1]+a,o=this.heightMasks.get(e),l=4*(s+n*o.width);if(o.data[l+3]<255)return this.solidCache.set(t,!1),!1}return this.solidCache.set(t,!0),!0}getTileset(t){t=Number(t);const e=this.tileSetCache;if(e.has(t)){const s=e.get(t);return this.replacements.has(s.original)&&(s.image=this.replacements.get(s.original)),s}if(this.mapData)for(const s in this.mapData.tilesets){const i=this.mapData.tilesets[s];if(t+1>=i.firstgid){const r=this.mapData.tilesets[Number(s)+1];if(!r)return e.set(t,i),this.replacements.has(i.original)&&(i.image=this.replacements.get(i.original)),i;if(t+1<r.firstgid)return e.set(t,i),this.replacements.has(i.original)&&(i.image=this.replacements.get(i.original)),i}}}unreplace(){this.replacements.clear(),this.tileCache.clear()}reset(){this.tileSetCache.clear(),this.replacements.clear(),this.tileCache.clear();for(let t=0;t<this.tileLayers.length;t++)this.tileLayers[t].destroyed=!1;for(const t of this.mapData.tilesets)t.image=t.original;this.loadTilesets(this.mapData)}castRay(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:320,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=r instanceof Map?new Map([...r.entries()].filter(t=>t[1])):new Map,n=new Map,o=new Map;if(!(r instanceof Map))for(const t of this.tileLayers)t.layer&&t.layer.meta&&t.layer.meta.solid&&(t.layer.meta.switchable&&t.index!==r||(a.set(t,!0),n.set(t.index,Math.sign(t.layer.args.offsetX)),o.set(t.index,Math.sign(t.layer.args.offsetY))));i=Math.ceil(i);const l=Math.cos(s),h=Math.sin(s),g=t+(Math.abs(l)>Number.EPSILON?l:0)*i,c=e+(Math.abs(h)>Number.EPSILON?h:0)*i,d=this.blockSize,u=g-t,p=c-e,f=Math.sign(u),m=Math.sign(p),v=u?Math.hypot(1,p/u):0,y=p?Math.hypot(1,u/p):0;let b,S=0;if(this.getSolid(t,e,r))return[t,e];const w=this.coordsToTile(t,e,r)||this.coordsToTile(t,e,0);for(const[t,e]of a)if(e&&(b=this.getTileNumber(w[0],w[1],t.index)))break;let x=b,k=b,M=!1,P=!1,C=1,j=b?0:f>0?d-t%d:t%d+1,A=b?0:m>0?d-e%d:e%d+1,T=j*v*f,O=A*y*m;Math.abs(T),Math.abs(O);const _=new Set,E=new Set,R=new Set,B=new Set;window.logPoints&&console.time("rayCast");let I=0;for(;Math.abs(S)<i&&!R.size&&!B.size;){if(f&&(!m||Math.abs(T)<Math.abs(O))){const i=Math.abs(T);let l=t+i*Math.cos(s),h=e+i*Math.sin(s);f>0&&l%1>.99999&&(l=Math.round(l)),m>0&&h%1>.99999&&(h=Math.round(h)),f<0&&l%1<1e-5&&(l=Math.round(l)),m<0&&h%1<1e-5&&(h=Math.round(h));const[g,c]=this.coordsToTile(l,h,r);M=x;for(const[t,e]of a){const s=t.index;if(e){if(x=this.getTileNumber(g,c,s))break;if(!x&&(n.has(s)||o.has(s))){if(x=this.getTileNumber(g+-n.get(s),c,s))break;if(x=this.getTileNumber(g,c+-o.get(s),s))break;if(x=this.getTileNumber(g+-n.get(s),c+-o.get(s),s))break}}}if(C=x?1:d,!x&&M&&(C=f<0?(t+-j+1)%d:d-(t+j)%d),window.logPoints&&_.add([l,h,`rayX tile-${g}-${c} mode-${x} bf-${C} layer-${r} `]),this.getSolid(l,h,a)){R.add([l,h]);break}S=Math.abs(T),T=(j+=C)*v*f}else{const i=Math.abs(O);let l=t+i*Math.cos(s),h=e+i*Math.sin(s);f>0&&l%1>.99999&&(l=Math.round(l)),f<0&&l%1<1e-5&&(l=Math.round(l)),m>0&&h%1>.99999&&(h=Math.round(h)),m<0&&h%1<1e-5&&(h=Math.round(h));const[g,c]=this.coordsToTile(l,h,r);P=k;for(const[t,e]of a){const s=t.index;if(e){if(k=this.getTileNumber(g,c,s))break;if(!k&&(n.has(s)||o.has(s))){if(k=this.getTileNumber(g,c+-o.get(s),s))break;if(k=this.getTileNumber(g+-n.get(s),c,s))break;if(k=this.getTileNumber(g+-n.get(s),c+-o.get(s),s))break}}}if(C=k?1:d,!k&&P&&(C=m<0?(e+-A+1)%d:d-(e+A)%d),window.logPoints&&E.add([l,h,`rayY tile-${g}-${c} mode-${k} bf-${C} layer-${r} `]),this.getSolid(l,h,a)){B.add([l,h]);break}S=Math.abs(O),O=(A+=C)*y*m}I++}const F=[...R,...B],L=F.map(s=>(s[0]-t)**2+(s[1]-e)**2),D=Math.min(...L),N=F[L.indexOf(D)];return N&&(f>0&&N[0]%1>.99999&&(N[0]=Math.round(N[0])),f<0&&N[0]%1<1e-5&&(N[0]=Math.round(N[0])),m>0&&N[1]%1>.99999&&(N[1]=Math.round(N[1])),m<0&&N[1]%1<1e-5&&(N[1]=Math.round(N[1]))),window.logPoints&&console.timeEnd("rayCast"),window.logPoints&&console.log({iterations:I}),window.logPoints&&(window.logPoints(t,e,"start"),window.logPoints(g,c,"end"),[..._].map(t=>window.logPoints(t[0],t[1],t[2])),[...E].map(t=>window.logPoints(t[0],t[1],t[2])),N&&window.logPoints(N[0],N[1],"nearest")),Math.sqrt(D)>i?void 0:N}getCollisionMap(){const t=new Map;for(const e of this.tileLayers){let s=!1;"Collision"===e.name.substr(0,9)?s=!0:"Moving"===e.name.substr(0,6)&&(s=!0),t.set(e,s)}return t}negSafeMod(t,e){return t>=0?t%e:(e+t%e)%e}get blockSize(){return this.mapData.tilewidth}fromImage(t,e){return new Promise(s=>{const i=new Image;i.addEventListener("load",r=>{const a=Math.floor(i.width*i.height/1024),n={columns:Math.floor(i.width/e),firstgid:1,image:t.substr(4),original:t.substr(4),imageheight:i.height,imagewidth:i.width,margin:0,name:"image-map",spacing:0,tileheight:e,tilewidth:e,tilecount:a},o={data:Object.assign(Object.create(null),[...Array(a)].map((t,e)=>e)),width:Math.floor(i.width/e),height:Math.floor(i.height/e),id:1,name:"Tile Layer 1",opacity:1,properties:[{name:"solid",type:"bool",value:!0}],type:"tilelayer",visible:!0,x:0,y:0},l={tilewidth:e,tileheight:e,layers:[o],tilesets:[n],width:Math.floor(i.width/e),height:Math.floor(i.height/e)};this.mapData=l,console.log(l),this.loadLayers(l),this.loadTilesets(l).then(s)},{once:!0}),i.src=t})}}}),require.register("timer/Countdown.js",function(t,e,s){"use strict";function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(t,"__esModule",{value:!0}),t.Countdown=void 0;t.Countdown=class{constructor(t,e){i(this,"time",0),i(this,"callback",()=>console.warn("No callback set!")),this.time=t,this.callback=e}extend(t){this.time+=t}extendTo(t){this.time=Math.max(t,this.time)}update(){this.time>0&&this.time--,this.time<=0&&(this.callback(),this.time=0)}}}),require.register("titlecard/Titlecard.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Titlecard=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const a=Symbol("Accept");t.Titlecard=class extends i.View{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t,arguments.length>1?arguments[1]:void 0),r(this,"template",e("./titlecard.html")),this.args.firstLine=t.firstLine||"First Line",this.args.secondLine=t.secondLine||"Second Line",this.args.creditLine=t.creditLine||"Credit Line",this.args.actNumber=t.actNumber||1,this.args.animation="start",this.played=new Promise(t=>this[a]=t)}replay(t){Object.assign(this.args,t),this.args.replay="replay";const e=new Promise(t=>{const e=this.args.waitFor||Promise.resolve();let s=75;this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="")),s+=75,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="opening")),s+=500,e.finally(()=>{this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="opening2")),s+=750,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="closing")),this.onTimeout(s,()=>{t([new Promise(t=>this.onTimeout(s+750,t))]),this[a]()}),s+=1e3,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="closed")),s+=2500,this.onTimeout(s,()=>this.onNextFrame(()=>{this.args.animation="done",this.playing=!1}))})});this.playing=e}play(t){if(this.playing)return this.playing;const e=new Promise(t=>{const e=this.args.waitFor||Promise.resolve();let s=750;this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="")),s+=750,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="opening")),s+=500,e.finally(()=>{this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="opening2")),s+=750,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="closing")),this.onTimeout(s,()=>{t([new Promise(t=>this.onTimeout(s+750,t))]),this[a]()}),s+=1e3,s+=1e3,this.onTimeout(s,()=>this.onNextFrame(()=>this.args.animation="closed")),s+=2500,this.onTimeout(s,()=>this.onNextFrame(()=>{this.args.animation="done",this.playing=!1}))})});this.playing=e}}}),require.register("titlecard/titlecard.html",function(t,e,s){s.exports='<div class = "titlecard [[replay]] [[animation]]">\n\n\t<div class = "titlecard-field"></div>\n\n\t<div class = "titlecard-bottom-border">\n\t\t<div class = "titlecard-border-text">[[creditLine]]</div>\n\t</div>\n\n\t<div class = "titlecard-left-border">\n\t\t<div class = "titlecard-border-shadow"></div>\n\t\t<div class = "titlecard-border-color"></div>\n\t</div>\n\n\t<div class = "titlecard-title">\n\n\t\t<div class = "titlecard-title-box">\n\n\t\t\t<div class = "titlecard-title-line-1">[[firstLine]]</div>\n\n\t\t\t<div class = "titlecard-title-line-2">\n\t\t\t\t[[secondLine]]<div class = "titlecard-title-number">[[actNumber]]</div>\n\t\t\t</div>\n\n\t\t</div>\n\n\t</div>\n\n</div>\n'}),require.register("trace/Trace.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Trace=void 0;var i=e("curvature/base/Uuid"),r=e("curvature/model/Model");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const n=document.head.querySelector('meta[name="x-build-time"]'),o=n?n.getAttribute("content"):null;t.Trace=class extends r.Model{constructor(){super(...arguments),a(this,"class","Trace"),a(this,"uuid",String(new i.Uuid)),a(this,"created",Date.now()),a(this,"local",String(new Date)),a(this,"tz",Intl.DateTimeFormat().resolvedOptions().timeZone),a(this,"stack",""),a(this,"message",""),a(this,"timeStamp",null),a(this,"filename",null),a(this,"lineno",null),a(this,"colno",null),a(this,"buildTime",o),a(this,"replay",null)}consume(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super.consume(t,e),this.uuid=t.uuid||this.uuid||String(new i.Uuid)}}}),require.register("trace/TraceDatabase.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TraceDatabase=void 0;var i=e("curvature/model/Database");t.TraceDatabase=class extends i.Database{_version_1(t){const e=this.createObjectStore("traces",{keyPath:"id",autoIncrement:!0});e.createIndex("position",["filename","lineno","colno"],{unique:!1}),e.createIndex("filename","uuid",{unique:!1}),e.createIndex("lineno","lineno",{unique:!1}),e.createIndex("colno","colno",{unique:!1}),e.createIndex("created","created",{unique:!1}),e.createIndex("uuid","uuid",{unique:!0}),e.createIndex("id","id",{unique:!0})}}}),require.register("ui/CharacterString.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterString=void 0;var i=e("curvature/base/View"),r=e("curvature/base/Bindable");function a(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.CharacterString=class extends i.View{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t[r.Bindable.NoGetters]=!0,super(t,e),a(this,"template",'<div cv-ref = "main" class = "hud-character-string [[hide]] [[color]] [[font]] [[classes]]" cv-each = "chars:char:c"><span\n\t\t\t\tclass = "hud-character"\n\t\t\t\tdata-type  = "[[char.type]]"\n\t\t\t\tdata-value = "[[char.pos]]"\n\t\t\t\tdata-index = "[[c]]"\n\t\t\t\tstyle      = "--value:[[char.pos]];--index:[[c]];"\n\t\t\t>[[char.original]]</span></div>'),this[r.Bindable.NoGetters]=!0;const s=[];s[r.Bindable.NoGetters]=!0,this.args.chars=s,this.args.classes=this.args.classes||"",this.args.scale=this.args.scale||1,this.args.high,this.args.med,this.args.low,this.args.bindTo("value",t=>{const e=String(t).split("").map(this.characterToModel.bind(this));if(e.length<this.args.chars.length)for(let t=e.length;t<this.args.chars.length;t++)this.characterToModel(-2,t);Object.assign(this.args.chars,e)})}characterToModel(t,e){let s=t,i="number";if(" "===t||Number(t)!=t)switch(t){case" ":t=-1,i="number";break;case"-":t=11,i="number";break;case":":t=10,i="number";break;case".":t=12,i="number";break;case"/":t=13,i="number";break;case",":t=14,i="number";break;case"?":t=15,i="number";break;case"!":t=16,i="number";break;case"@":t=17,i="number";break;case"#":t=18,i="number";break;case"$":t=19,i="number";break;case"%":t=20,i="number";break;case"^":t=21,i="number";break;case"&":t=22,i="number";break;case"*":t=23,i="number";break;case"(":t=24,i="number";break;case")":t=25,i="number";break;case"":t=0,i="symbol2";break;case"":t=1,i="symbol2";break;case"":t=2,i="symbol2";break;case"":t=3,i="symbol2";break;case"":t=4,i="symbol2";break;case"":t=5,i="symbol2";break;case"'":t=6,i="symbol2";break;case'"':t=7,i="symbol2";break;case'"':t=8,i="symbol2";break;case"=":t=9,i="symbol2";break;case"+":t=10,i="symbol2";break;case"[":t=11,i="symbol2";break;case"]":t=12,i="symbol2";break;case"{":t=13,i="symbol2";break;case"}":t=14,i="symbol2";break;case"\\":t=15,i="symbol2";break;case";":t=16,i="symbol2";break;case"~":t=17,i="symbol2";break;case"|":t=18,i="symbol2";break;case"_":t=19,i="symbol2";break;case">":t=20,i="symbol2";break;case"<":t=21,i="symbol2";break;case"":t=22,i="symbol2";break;case"":t=23,i="symbol2";break;case"":t=24,i="symbol2";break;case"`":t=25,i="symbol2";break;default:t=String(t).toLowerCase().charCodeAt(0)-97,i="letter"}return this.args.chars[e]?(this.args.chars[e].original=s,this.args.chars[e].type=i,this.args.chars[e].pos=t,this.args.chars[e]):{pos:t,type:i,original:s}}}}),require.register("ui/ClickSwitch.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClickSwitch=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.ClickSwitch=class extends i.View{constructor(){super(...arguments),r(this,"template",e("./click-switch.html"))}toggle(){this.args.active=!this.args.active}}}),require.register("ui/HudFrame.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HudFrame=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.HudFrame=class extends i.View{constructor(){super(...arguments),r(this,"template",'<div class = "hud-frame [[type]] [[alert]]">\n\t\t<div class = "hud-value">[[value]]</div>\n\t</div>')}}}),require.register("ui/click-switch.html",function(t,e,s){s.exports='<div class = "switch" data-active = "[[active]]"  cv-on = "click:toggle(event)">\n\n\t<div class = "label labelOff">\n\t\t<img src = "/ui/mute.svg" />\n\t</div>\n\n\t<div class = "slide">\n\t\t<div class = "head"></div>\n\t</div>\n\n\t<div class = "label labelOn">\n\t\t<img src = "/ui/unmute.svg" />\n\t</div>\n\n</div>\n'}),require.register("viewport/Layer.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/View"),a=e("curvature/base/Tag"),n=e("curvature/base/Bag");e("../intro/TitleScreenCard");function o(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Layer=class extends r.View{constructor(t,s){t[i.Bindable.NoGetters]=!0,super(t,s),o(this,"template",e("./layer.html")),this[i.Bindable.NoGetters]=!0,this.args.width=t.width||320,this.args.height=t.height||200,this.args.blockSize=t.blockSize||32,this.x=0,this.y=0,this.viewport=t.viewport,this.hidden=!1,this.args.offsetX=0,this.args.offsetY=0,this.args.parallax=this.args.parallax||0,this.args.layerId=this.args.layerId,Object.defineProperty(this,"blocksXY",{value:new Map}),Object.defineProperty(this,"blocks",{value:new n.Bag}),Object.defineProperty(this,"blockMeta",{value:new Map}),Object.defineProperty(this,"blockSrcs",{value:new Map}),this.args.blocks=this.blocks.list,this.meta=Object.create(null);const r=this.args.viewport.tileMap.tileLayers[this.args.layerId];this.setMeta(r),this.meta.offsetX&&(this.args.offsetX=this.meta.offsetX),this.meta.offsetY&&(this.args.offsetY=this.meta.offsetY),r.offsetX=this.args.offsetX,r.offsetY=this.args.offsetY,r.layer=this,this.args.name.match(/^(Grinding)\s\d+/)&&(this.meta.grinding=!0),this.offsetXChanged=0,this.offsetYChanged=0,this.fallSpeed=0,Object.preventExtensions(this);const a=()=>[...this.blockMeta.values()].forEach(t=>t.reset=!0);this.args.bindTo("width",a,{wait:0}),this.args.bindTo("height",a,{wait:0})}setMeta(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.properties)for(const s of t.properties)this.meta[s.name]=s.value,"object"===s.type&&(this.meta[s.name]+=e)}move(){if(void 0===this.meta.controller)return;const t=this.args.viewport,e=t.tileMap.tileLayers[this.args.layerId],s=t.actorsById[this.meta.controller];if(this.offsetXChanged=0,this.offsetYChanged=0,e&&(e.offsetXChanged=0,e.offsetYChanged=0),s){e&&(e.offsetX=this.args.offsetX,e.offsetY=this.args.offsetY);const t=(s.args.xLayer||0)-this.args.offsetX,i=(s.args.yLayer||0)-this.args.offsetY;this.args.offsetX=s.args.xLayer||0,this.args.offsetY=s.args.yLayer||0,e&&(e.offsetXChanged=t,e.offsetYChanged=i),this.offsetXChanged=t,this.offsetYChanged=i}else this.args.offsetX=0,this.args.offsetY=0;this.fallSpeed=this.fallSpeed||0}onAttach(t){const e=this.args.viewport,s=e.tileMap.tileLayers[this.args.layerId],i=e.actorsById[this.meta.controller];s&&this.args.bindTo("destroyed",t=>{this.args.viewport.tileMap.tileLayers[this.args.layerId].destroyed=!!t,i&&(i.args.destroyed=!!t)})}update(t,e){const s=this.args.viewport;if(s.args.frameId%s.settings.frameSkip!=0)return;if(this.args.hidden)return void(this.hidden||(this.blocks.list.forEach(t=>{t.style({display:"none"}),t.remove()}),this.hidden=!0));if(this.args.destroyed&&this.tags.background){const t=s.tileMap,e=this.args.layerId;return t.tileLayers[e].destroyed=!0,this.tags.background.style({display:"none"}),void(this.args.hidden=!0)}const i=this.args.blockSize,r=Math.ceil(this.args.width/i)+1,n=Math.ceil(this.args.height/i)+1,o=this.blocksXY,l=this.blocks,h=this.blockMeta,g=(this.blockSrcs,this.args.offsetX),c=this.args.offsetY,d=this.args.layerId;let u=1+r,p=!0;for(let m=-1;m<u;m+=Math.sign(r)){const r=m+-Math.ceil(this.x/i)+-Math.ceil(g/i)+(g>0?1:0);for(let g=0;g<n;g+=Math.sign(n)){const n=g+Math.floor(-this.y/i)+(this.offsetYChange<0?-Math.ceil(c/i):-Math.floor(c/i))+(c<0?-1:0),u=t.getTileNumber(r,n,d),v=`${m},${g}`;let y,b;if(!o.has(v)||(b=h.get(v).reset)){if(b){const t=h.get(v);y=o.get(v),t.reset=!1,t.visible=!1,t.src=null,y.style({"background-image":"none",display:"none"})}else{y=new a.Tag(document.createElement("div"));const t=Object.create(null,{visible:{value:!1,writable:!0},reset:{value:!1,writable:!0},src:{value:null,writable:!0},x:{value:null,writable:!0},y:{value:null,writable:!0}});Object.preventExtensions(t),o.set(v,y),h.set(v,t)}const t=i*m,e=i*g,s="1.016";y.style({transform:`translate(${t}px, ${e}px) scale(${s}, ${s})`,display:"none",width:i+"px",height:i+"px",position:"absolute",left:0,top:0}),l.add(y)}else y=o.get(v);const S=h.get(v),w=e.get(v),x="Moving"!==String(this.args.name).substr(0,6);if(t.checkEmpty(u)||w>this.args.layerId&&x){S.visible&&y.style({display:"none"}),S.visible=!1,S.src=null;continue}!1!==u&&t.checkFull(u)&&x&&e.set(v,this.args.layerId);const k=[];d&&!1===u?(k[0]=-1,k[1]=-1):Object.assign(k,t.getTile(u));const M=k[4];if(M&&M.meta&&M.meta.animated){var f;const t=M.meta.frames,e=s.args.frameId,i=null!==(f=M.meta.speed)&&void 0!==f?f:1,r=Math.floor(e/i)%t;k[1]+=M.meta.frameSize*r}const P=k[0]*i*-1,C=k[1]*i*-1,j=k[2];if(!1!==u&&0!==u&&(p=!1),S.x!==P||S.y!==C||S.src!==j){if(!1!==u&&0!==u){const t=P+"px "+C+"px";y.style({display:"initial","background-position":t,"background-image":`url(${j})`}),S.visible=!0}else S.visible&&(y.style({display:"none"}),S.visible=!1);S.src=j,S.x=P,S.y=C}}}if(this.tags.background){const t=this.tags.background;p?t.style({display:"none"}):this.tags.background&&t.style({display:"initial","--offsetX":-g%i,"--offsetY":-c%i,"--xPerspective":this.viewport.args.xPerspective,"--parallax":this.args.parallax})}}}}),require.register("viewport/Plot.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plot=void 0;var i=e("curvature/base/View");function r(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}t.Plot=class extends i.View{constructor(t,e){super(t,e),r(this,"template",'<svg style = "--x:[[x]];--y:[[y]]" cv-each = "points:point" class = "plot">\n\t\t<circle cx="[[point.x]]" cy="[[point.y]]" r="2" class="[[point.color]]" />\n\t</svg>'),this.args.points=[],this.points=new Set,this.count=0,this.max=2048}clearPoints(){for(const t of this.args.points)Object.assign(t,{x:0,y:0,color:"hidden"});this.count=0}addPoint(t,e,s){s+=` point-${this.count}`;const i=this.count++%this.max;this.args.points.length>=this.max?Object.assign(this.args.points[i],{x:t,y:e,color:s}):this.args.points.push({x:t,y:e,color:s})}}}),require.register("viewport/Viewport.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;var i=e("curvature/base/Bindable"),r=e("curvature/base/Bag"),a=(e("curvature/base/Tag"),e("curvature/base/Uuid")),n=e("curvature/base/View"),o=e("curvature/base/Router"),l=e("curvature/input/Keyboard"),h=e("curvature/input/Sequence"),g=e("curvature/net/Elicit"),c=(e("../QuadCell"),e("../timer/Countdown")),d=e("../audio/Bgm"),u=e("../audio/Sfx"),p=e("../tileMap/TileMap"),f=e("../titlecard/Titlecard"),m=e("../particle/Particle3d"),v=(e("../backdrop/MarbleGarden"),e("../backdrop/ProtoLabrynth"),e("../backdrop/MysticCave"),e("../intro/Series")),y=(e("../intro/Card"),e("../intro/TitleScreenCard")),b=e("../intro/ThankYouCard"),S=e("../intro/LoadingCard"),w=e("../intro/BootCard"),x=e("../intro/DebianCard"),k=e("../intro/WebkitCard"),M=e("../intro/GamepadCard"),P=e("../intro/NewgroundsCard"),C=e("../intro/WarningCard"),j=e("../intro/SaneCard"),A=e("../intro/NoWayCard"),T=e("../intro/SeanCard"),O=e("../Menu/PauseMenu.js"),_=e("../Menu/MainMenu.js"),E=e("../actor/LayerSwitch"),R=e("../region/Region"),B=e("../ui/CharacterString"),I=(e("../ui/HudFrame"),e("./Layer")),F=(e("./Plot"),e("../controller/Controller")),L=e("../BackdropPalette"),D=e("../ObjectPalette"),N=e("../ScriptPalette"),z=e("../ui/ClickSwitch"),q=e("subspace-console/Console"),U=e("../console/task/Input"),H=e("../console/task/Impulse"),W=e("../console/task/Mark"),G=e("../console/task/Settings"),V=e("../console/task/Move"),$=e("../console/task/Pos"),K=e("../console/task/Spawn"),Y=e("../console/task/Chao"),J=e("subspace-client/Socket"),X=e("../network/RtcClient"),Z=e("../network/RtcServer"),Q=e("../Classifier"),tt=e("../network/ChatBox"),et=e("../actor/Platformer"),st=e("../actor/Sonic"),it=e("../actor/Tails"),rt=e("../actor/Knuckles"),at=(e("../actor/Seymour"),e("../actor/Chalmers"),e("../save/SaveDatabase"),e("../save/Save")),nt=e("../trace/TraceDatabase"),ot=e("../trace/Trace"),lt=e("../replay/ReplayDatabase"),ht=e("../replay/Replay"),gt=e("../behavior/Platformer"),ct=e("matrix-api/Matrix"),dt=e("../controller/GamepadConfig"),ut=e("../tally/TallyBoard"),pt=e("../actor/Emblem"),ft=e("../lib/Analytic");function mt(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const vt=Symbol("actor-point-cache"),yt=(Symbol("collision-cells-near"),Symbol("collision-cells")),bt=Symbol("collision-cell"),St=Symbol("run");t.Viewport=class extends n.View{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;t[i.Bindable.NoGetters]=!0,super(t,s),mt(this,"secretsFound",new Set),mt(this,"template",e("./viewport.html")),this.listen(window,"error",t=>this.handleUncaughtException(t)),window.viewport=this,this.listen(window,"focus",t=>{this.focusDelay&&this.focusDelay(),this.focusDelay=this.onFrameOut(45,()=>this.args.focusMe.args.hide="hide hidden"),this.args.focusMe.args.hide="hide",this.args.windowFocused="window-focused"}),this.listen(window,"blur",t=>{this.focusDelay&&this.focusDelay(),this.gamepad?this.args.focusMe.args.hide="hide hidden":(this.focusDelay=this.onFrameOut(1,()=>this.args.focusMe.args.hide=""),this.args.focusMe.args.hide="hide",this.args.windowFocused="window-blurred")}),this.args.windowFocused=document.hasFocus()?"window-focused":"window-blurred",this[i.Bindable.NoGetters]=!0,o.Router.listen(this,{"":()=>""}),this.args.agent="unknown",String(navigator.userAgent).match("Chrome")?this.args.agent="chrome":String(navigator.userAgent).match("Firefox")&&(this.args.agent="firefox"),this.args.screenEffects=new r.Bag,this.meta={},this.customColor=i.Bindable.make({h:0,s:1,v:1}),this.args.combo=[],this.args.invert="",this.args.publishTime=0,this.netId=String(new a.Uuid),this.netPlayers=new Map,this.args.controlCardShown=new Set,this.bytesReceived=0,this.args.mainPallet="",this.args.customColor={h:0,s:1,v:1},this.args.inventory=[],this.loadSaves().then(t=>{t.length?this.currentSave=at.Save.from(t[0]):this.currentSave=new at.Save}),this.characters={Sonic:st.Sonic,Tails:it.Tails,Knuckles:rt.Knuckles,platformer:et.PlatformActor},this.objectPalette=D.ObjectPalette,this.scriptPalette=N.ScriptPalette,this.zoneScript=null,this.timers=new Map,this.args.paused=!1,this.args.freeze=!1,this.quadCell=null,this.visible=new Set,this.callIntervals=new Map,this.callFrames=new Map,this.callRenderedFrames=new Map,this.willDetach=new Map,this.backdrops=new Map,this.checkpoints=new Map,this.zeroFrame=!1,this.spawnedDefs=new Map,this.defsByMap=new Map,this.actorsByMap=new Map,this.args.replayQuickExit=!1,this.args.replayBanners=!0,this.maxObjectId=0,this.maxGid=0,this.args.loadingMap=!1,this.maps=new Map,this.server=null,this.client=null,this.args.networked=!1,this.args.tallyBoard=null,this.args.mouse="moved",this.settings=i.Bindable.make({audio:!0,blur:!0,smoothing:!1,displace:!0,scaling:!0,rumble:!0,showHud:!0,shortcuts:!0,showFps:!0,debugOsd:!1,outline:1,frameSkip:1,musicVol:50,sfxVol:75,username:"player",graphicsLevel:"High",matrixUrl:"https://matrix.org/_matrix",matrixRoom:"!hJzXrccruagKGXTFUQ:matrix.org",iceServer1:"stun:stun1.l.google.com:19302",iceServer2:"stun:stun2.l.google.com:19302"}),this.defaults=Object.assign({},this.settings),this.args.shakeX=0,this.args.shakeY=0,this.args.level="";let n="";const l=o.Router.query.map;let g=!1;l&&l.match(/^\w/)&&(n="/map/"+l,g=!0),this.args.startFrameId=0,this.args.actStartFrameId=0,this.args.lastFrameId=-1,n&&this.loadMap({mapUrl:n}).catch(t=>{console.warn(t),this.args.titlecard=new v.Series({cards:[new A.NoWayCard({errorString:`Cannot load map "${l}"!`,timeout:-1})]},this),this.args.titlecard.play()}),this.sprites=new r.Bag,this.world=null;let p=o.Router.query.nointro;const f=[];g&&(p=!0),p?f.push(new _.MainMenu({timeout:-1},this)):f.push(...this.introCards()),this.args.titlecard=new v.Series({cards:f},this),n||this.args.titlecard.play(),this.args.noIntro=p?"no-intro":"";const m=new h.Sequence({keys:["Button12","Button12","Button13","Button13","Button12","Button12","Button12","Button12"],timing:750}),y=new h.Sequence({keys:["Button12","Button12","Button13","Button13","Button14","Button15","Button14","Button15","Button1201","Button14","Button1200"],timing:750}),b=new h.Sequence({keys:["Button12","Button12","Button13","Button13","Button14","Button15","Button14","Button15","Button1201","Button1200","Button1209"],timing:750});this.konamiSeqA=y,this.konamiSeqB=b,this.debugSeq=m;const S=new h.Sequence({keys:["KeyS","KeyV","KeyG","KeyR","KeyA","KeyV"],timing:750});this.sequences=[m,y,b,S],this.args.debugEnabled=o.Router.query.debugEnabled,this.args.debugEditMode=!1,this.args.debugObjectCursor=0,this.args.debugObjectName=new B.CharacterString({value:""}),this.debugBank={},this.args.interacted=!1,m.addEventListener("complete",t=>{this.args.debugEnabled||(this.args.debugEnabled=!0,console.log("Debug variable set."),this.args.topLine.args.value="",this.args.topLine.args.hide="hide hidden",this.onTimeout(1,()=>{this.args.topLine.args.value=" Debug variable set! ",this.args.topLine.args.hide=""}),this.onTimeout(1500,()=>{this.args.topLine.args.hide="hide"}),this.onTimeout(1750,()=>{this.args.topLine.args.hide="hide hidden"}))});const w=t=>{this.args.masterCheat||(this.args.masterCheat=!0,this.args.topLine.args.value="",this.args.topLine.args.hide="hide hidden",this.onTimeout(1,()=>{this.args.topLine.args.value=" Master cheat detected. ",this.args.topLine.args.hide=""}),console.log("Master cheat detected."),this.args.paused=!1,this.onTimeout(1500,()=>{this.args.topLine.args.value="",this.args.status.args.hide="hide"}),this.onTimeout(1750,()=>{this.args.topLine.args.hide="hide hidden"}))};y.addEventListener("complete",w),b.addEventListener("complete",w),S.addEventListener("complete",t=>{this.controlActor&&(this.controlActor.gravityCheat=!this.controlActor.gravityCheat,this.args.topLine.args.value="",this.args.topLine.args.hide="hide hidden",this.onTimeout(1,()=>{this.args.topLine.args.value=` Gravity cheat ${this.controlActor.gravityCheat?"on":"off"}. `,this.args.topLine.args.hide=""}),this.onTimeout(1500,()=>{this.args.topLine.args.value="",this.args.status.args.hide="hide"}),this.onTimeout(1750,()=>{this.args.topLine.args.hide="hide hidden"}),this.controlActor.gravityCheat?this.controlActor.args.gravity*=.5:this.controlActor.args.gravity*=2)}),this.args.pauseMenu=new O.PauseMenu({},this),this.particleObserver=new IntersectionObserver((t,e)=>{for(const e of t)0===e.intersectionRation?(e.target.style.display="none",e.target.remove()):delete e.target.style.display},{threshold:0}),this.particles=new r.Bag((t,e,s)=>{s===r.Bag.ITEM_ADDED?(t.node&&this.particleObserver.observe(t.node),t.node&&this.tags.particles.appendChild(t.node)):s===r.Bag.ITEM_REMOVED&&(t.preserve?t.node.remove():t.remove())}),this[St]=0,this.effects=new r.Bag,this.maxCameraBound=64,this.cameraBound=64,this.args.particles=this.particles.list,this.args.effects=this.effects.list,this.args.maxFps=69,this.args.currentActor="",this.args.xMouse=0,this.args.YMouse=0,this.args.xMouseOffset=0,this.args.YMouseOffset=0,this.mouseState={position:[0,0],buttons:[]},this.args.xOffset=.5,this.args.yOffset=.5,this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.75,this.args.topLine=new B.CharacterString({value:""}),this.args.status=new B.CharacterString({value:""}),this.args.focusMe=new B.CharacterString({value:""}),this.args.topLine.args.hide="hide hidden",this.args.status.args.hide="hide hidden",this.args.focusMe.args.hide="hide hidden",this.args.labelChar=new B.CharacterString({value:"Char: "}),this.args.labelX=new B.CharacterString({value:"x pos: "}),this.args.labelY=new B.CharacterString({value:"y pos: "}),this.args.demoIndicator=null,this.args.labelGround=new B.CharacterString({value:"Grounded: "}),this.args.labelCamera=new B.CharacterString({value:"Camera: "}),this.args.labelAngle=new B.CharacterString({value:"Gnd theta: "}),this.args.labelGSpeed=new B.CharacterString({value:"Gnd spd: "}),this.args.labelXSpeed=new B.CharacterString({value:"X air spd: "}),this.args.labelYSpeed=new B.CharacterString({value:"Y air spd: "}),this.args.labelLayer=new B.CharacterString({value:"Layer: "}),this.args.labelMode=new B.CharacterString({value:"Mode: "}),this.args.labelActors=new B.CharacterString({value:"Actors: "}),this.args.labelRegions=new B.CharacterString({value:"Regions: "}),this.args.labelFrame=new B.CharacterString({value:"Frame ID: "}),this.args.labelIgnore=new B.CharacterString({value:"Ignore: "}),this.args.labelFps=new B.CharacterString({value:"FPS: "}),this.args.labelAirAngle=new B.CharacterString({value:"Air theta: "}),this.args.char=new B.CharacterString({value:"..."}),this.args.xPos=new B.CharacterString({value:0}),this.args.yPos=new B.CharacterString({value:0}),this.args.layer=new B.CharacterString({value:0}),this.args.gSpeed=new B.CharacterString({value:0,high:199,med:99,low:49}),this.args.ground=new B.CharacterString({value:""}),this.args.xSpeed=new B.CharacterString({value:0}),this.args.ySpeed=new B.CharacterString({value:0}),this.args.mode=new B.CharacterString({value:0}),this.args.angle=new B.CharacterString({value:0}),this.args.ignore=new B.CharacterString({value:0}),this.args.actorCount=new B.CharacterString({value:0}),this.args.regionCount=new B.CharacterString({value:0}),this.args.xPerspective=0,this.args.cameraMode=new B.CharacterString({value:0}),this.args.airAngle=new B.CharacterString({value:0}),this.args.nowPlaying=new B.CharacterString({value:"Now playing"}),this.args.trackName=new B.CharacterString({value:""}),this.args.hideNowPlaying="hide-now-playing",this.args.hiddenNowPlaying="hidden-now-playing",u.Sfx.addEventListener("play",t=>{this.args.audio||t.preventDefault()}),d.Bgm.addEventListener("play",t=>{if(this.bgm=this.meta.bgm,!this.args.audio)return t.preventDefault(),this.args.hideNowPlaying="hide-now-playing",void this.onFrameOut(60,()=>{this.args.hideNowPlaying&&(this.args.hiddenNowPlaying="hidden-now-playing")});if(!t.detail)return this.args.trackName.args.value="",this.args.audioComment="",this.args.hideNowPlaying="hide-now-playing",void(this.args.hiddenNowPlaying="hidden-now-playing");{this.args.trackName.args.value=t.detail.TIT2+" by "+t.detail.TPE1,this.args.audioComment=t.detail.COMM;const e=Math.random();this.args.secretIcon=e>.99?100:e>.9?10:"0"}if(this.args.trackName.args.value){let t=Promise.resolve();this.args.zonecard&&(t=this.args.zonecard.played),t.then(()=>{this.args.started&&(this.args.hiddenNowPlaying="",this.onFrameOut(60,()=>this.args.hideNowPlaying=""),this.timers.has(d.Bgm)?this.timers.get(d.Bgm).extendTo(600):this.timers.set(d.Bgm,new c.Countdown(600,()=>{this.args.hideNowPlaying="hide-now-playing"})))})}}),d.Bgm.addEventListener("stop",t=>{}),d.Bgm.addEventListener("pause",t=>{}),d.Bgm.addEventListener("unpause",t=>{this.args.audio||t.preventDefault()}),this.args.fpsSprite=new B.CharacterString({value:0}),this.args.frame=new B.CharacterString({value:0}),this.args.scoreLabel=new B.CharacterString({value:"SCORE:",color:"yellow"}),this.args.timerLabel=new B.CharacterString({value:"TIME: ",color:"yellow"}),this.args.ringLabel=new B.CharacterString({value:"RINGS: ",color:"yellow"}),this.args.actClearLabel=new B.CharacterString({value:"",color:"yellow"}),this.args.dialogLines=[],this.args.perfectBonusLabel=new B.CharacterString({value:"PERFECT BONUS: ",color:"yellow"}),this.args.perfectBonus=new B.CharacterString({value:0}),this.args.speedBonusLabel=new B.CharacterString({value:"SPEED BONUS: ",color:"yellow"}),this.args.speedBonus=new B.CharacterString({value:0}),this.args.skidBonusLabel=new B.CharacterString({value:"SKID BONUS: ",color:"yellow"}),this.args.skidBonus=new B.CharacterString({value:0}),this.args.ringBonusLabel=new B.CharacterString({value:"RING BONUS: ",color:"yellow"}),this.args.ringBonus=new B.CharacterString({value:0}),this.args.timeBonusLabel=new B.CharacterString({value:"TIME BONUS: ",color:"yellow"}),this.args.timeBonus=new B.CharacterString({value:0}),this.args.airBonusLabel=new B.CharacterString({value:"AIR TIME: ",color:"yellow"}),this.args.airBonus=new B.CharacterString({value:"0%"}),this.args.totalBonusLabel=new B.CharacterString({value:"TOTAL: ",color:"yellow"}),this.args.totalBonus=new B.CharacterString({value:0}),this.args.rings=new B.CharacterString({value:0}),this.args.score=new B.CharacterString({value:0}),this.args.timer=new B.CharacterString({value:"00:00"}),this.args.prompt=new B.CharacterString({value:""}),this.args.ntsc="ntsc",this.args.frameId=-1,this.settings.bindTo("scaling",t=>this.fitScale(!1),{wait:0}),this.settings.bindTo("graphicsLevel",t=>{switch(t){case"High":this.settings.displace=!0,this.settings.scaling=!0,this.settings.blur=!0;break;case"Medium":this.settings.scaling=!0,this.settings.displace=!0,this.settings.blur=!1;break;case"Low":this.settings.scaling=!0,this.settings.displace=!1,this.settings.blur=!1;break;case"Very Low":this.settings.displace=!1,this.settings.scaling=!1,this.settings.blur=!1}"firefox"===this.args.agent&&(this.settings.displace=!1,this.settings.blur=!1)}),"firefox"===this.args.agent&&(this.settings.displace=!1,this.settings.blur=!1),this.settings.bindTo("displace",t=>this.args.displacement=t?"on":"off"),this.settings.bindTo("outline",t=>this.args.outline=t),this.settings.bindTo("debugOsd",t=>this.args.debugOsd=t),this.settings.bindTo("showHud",t=>this.args.showHud=t),this.settings.bindTo("shortcuts",t=>this.args.shortcuts=t),this.settings.bindTo("showFps",t=>this.args.showFps=t),this.settings.bindTo("smoothing",t=>this.args.smoothing=t),this.settings.bindTo("musicVol",t=>d.Bgm.setVolume(t/100)),this.settings.bindTo("sfxVol",t=>u.Sfx.setVolume(t/100)),this.args.emeralds=[];for(const t in this.settings){const e=localStorage.getItem("sonic-3000-setting-v0.0.0="+t);try{var x;this.settings[t]=null!==(x=JSON.parse(e))&&void 0!==x?x:this.settings[t]}catch(t){console.warn(t)}}this.settings.bindTo((t,e)=>{localStorage.setItem("sonic-3000-setting-v0.0.0="+e,JSON.stringify(t))});const k=!!o.Router.query.char&&String(o.Router.query.char).substr(0,1).toUpperCase()+String(o.Router.query.char).substr(1);this.args.selectedChar=this.args.selectedChar||k||"Sonic",this.args.blockSize=32,this.args.populated=!1,this.args.willStick=!1,this.args.stayStuck=!1,this.args.willStick=!0,this.args.stayStuck=!0,this.args.scale=1,this.args.tileScale=1,this.args.width=512,this.args.height=288,this.args.bindTo("tileScale",t=>{if(this.args.width=512*t,this.args.height=288*t,this.args.layers)for(const e of this.args.layers)e.args.width=512*t,e.args.height=288*t;if(this.args.fgLayers)for(const e of this.args.fgLayers)e.args.width=512*t,e.args.height=288*t;this.fitScale()},{wait:1}),this.collisionCache=new Map,this.collisions=new Map,this.args.x=this.args.x||0,this.args.y=this.args.y||0,this.args.fgLayers=[],this.args.layers=[],this.args.animation="",this.regions=new Set,this.spawn=new Set,this.auras=new Set,this.recent=new Set,this.actorsByName={},this.actorsById={},window.actors=this.actorsById,this.playable=new Set,this.actors=new r.Bag((t,e,s)=>{if(s==r.Bag.ITEM_ADDED)t.viewport=this,this.setColCell(t),t instanceof R.Region&&this.regions.add(t),t.controllable&&this.playable.add(t),this.actorsByName[t.args.name]=t,this.actorsById[t.args.id]=t,this.objectDb.add(t),t.onSpawned&&t.onSpawned(this);else if(s==r.Bag.ITEM_REMOVED){t.viewport=null,this.playable.delete(t),t instanceof R.Region&&this.regions.delete(t),delete this.actorsByName[t.args.name],delete this.actorsById[t.args.name],delete this.actorsById[t.args.id];for(const[,e]of this.actorsByMap)delete e[t.oid];this.recent.delete(t),this.auras.delete(t),this.updateStarted.delete(t),this.updateEnded.delete(t),this.updated.delete(t),this.objectDb.remove(t);const e=this.getColCell(t);t[bt]&&t[bt].delete(t),t[yt]&&t[yt].forEach(e=>e.delete(t)),e&&e.delete(t),delete t[bt],!t.removed&&t.firstNode.isConnected&&t.remove(),t.onDespawned&&t.onDespawned(this)}}),this.layerDb=new Q.Classifier([/^Art\s+$/,/^Collision\s+$/,/^Destructible\s+$/],()=>{}),this.objectDb=new Q.Classifier(Object.values(D.ObjectPalette)),this.blocks=new r.Bag,this.args.blocks=this.blocks.list,this.args.actors=this.actors.list,this.listen(window,"gamepadconnected",t=>this.padConnected(t)),this.listen(window,"gamepaddisconnected",t=>this.padRemoved(t)),this.colCellDiv=.75*Math.max(this.args.width,this.args.height),this.colCellCache=new Map,this.colCells=new Map,this[vt]=new Map,this.startTime=null,this.args.audio=!1,this.nextControl=!1,this.updateStarted=new Set,this.updateEnded=new Set,this.updated=new Set,this.args.xBlur=0,this.args.yBlur=0,this.args.isReplaying=!1,this.args.isRecording=!1,this.args._isRecording=!1,this.replayFrames=new Map,this.replayOffset=0,this.replayStart=null,this.replay=null,this.maxReplayFrame=0,this.lastFrame={input:{},args:{}},this.args.standalone="",this.args.fullscreen="",this.args.initializing="initializing",this.args.muteSwitch=new z.ClickSwitch,this.args.muteSwitch.args.active=!1,this.args.bindTo("interacted",t=>{t&&(this.args.muteSwitch.args.active=this.getAudioSetting(),this.args.muteSwitch.args.bindTo("active",t=>this.args.audio=t),this.args.bindTo("audio",t=>{var e;localStorage.setItem("sonic-3000-audio-enabled",t);const s=this.args.frameId-this.args.startFrameId;this.onNextFrame(()=>t?u.Sfx.unpause():u.Sfx.pause()),s>(null!==(e=this.meta.bgm_delay)&&void 0!==e?e:0)&&this.onNextFrame(()=>t?d.Bgm.unpause():d.Bgm.pause()),this.args.muteSwitch.args.active=t}))}),this.args.showConsole=null,this.listen(document,"keydown",t=>{"Escape"===t.key&&(this.args.showConsole=!1),"F10"!==t.key&&"`"!==t.key||(this.args.subspace||(this.args.subspace=new q.Console({scroller:this.tags.subspace,path:{input:U.Input,mark:W.Mark,impulse:H.Impulse,move:V.Move,pos:$.Pos,set:G.Settings,spawn:K.Spawn,chao:Y.Chao}})),this.args.networked?this.args.showConsole=!1:this.args.showConsole=this.args.showConsole?null:"showConsole",t.preventDefault())}),this.args.bindTo("shakeY",(t,e,s,i,r)=>{this.controlActor&&this.controlActor.controller&&this.controlActor.controller.rumble&&(Math.abs(t)>40&&Math.abs(t)>Math.abs(r)?this.controlActor.controller&&this.controlActor.controller.rumble({duration:4*t,strongMagnitude:1,weakMagnitude:1}):Math.abs(t)>20&&Math.abs(t)>Math.abs(r)?this.controlActor.controller&&this.controlActor.controller.rumble({duration:8*t,strongMagnitude:t/20,weakMagnitude:1}):Math.abs(t)>1&&this.controlActor.controller&&this.controlActor.controller.rumble({duration:16*t,strongMagnitude:.1,weakMagnitude:1}))}),this.args.bindTo("showConsole",t=>{this.args.subspace&&(t?(this.onNextFrame(()=>this.args.subspace.focus()),this.args.showConsole="showConsole"):(this.onNextFrame(()=>this.tags.viewport.focus()),this.args.showConsole=null))}),this.controller=new F.Controller({deadZone:.2}),this.controller.zero(),this.matrix=new ct.Matrix(this.settings.matrixUrl,{interval:0})}loadWorld(t){let{worldUrl:e,networked:s=!1}=t;new g.Elicit(e).json().then(t=>{const e=t.maps.sort((t,e)=>t.x===e.x?t.y-e.y:t.x-e.x);let i=Math.min(...e.map(t=>t.x)),r=Math.min(...e.map(t=>t.y)),a=Math.max(...e.map(t=>t.x+t.width)),n=Math.max(...e.map(t=>t.y+t.height));for(const t of e)t.x-=i,t.y-=r;const o=e.shift();this.loadMap({mapUrl:"/map/"+o.fileName,networked:s}).then(()=>{const t=this.tileMap.mapData.tilewidth;this.tileMap.resize(a,n);for(const s of e){console.log(s);const e="/map/"+s.fileName;this.appendMap(e,s.x/t,s.y/t)}})})}loadSaves(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.getSaveIndex?this.getSaveIndex=at.Save.index():this.getSaveIndex}getZoneState(t){var e;const s=this.currentSave,i=null!==(e=this.currentMap)&&void 0!==e?e:"";return s?s.getZoneState(t||i):{}}getCharacterState(t){const e=this.currentSave;return t?e.getCharacterState(t):this.controlActor&&this.controlActor.args.canonical?e.getCharacterState(this.controlActor.args.canonical):void 0}loadMap(t){let{mapUrl:e,networked:s=!1,useCheckpoint:i=!0}=t;this.maps.clear(),this.maps.set(e,{x:0,y:0});const r=new p.TileMap({mapUrl:e});this.baseMap=this.currentMap=e,this.args.networked=s,this.tileMap=r,this.args.started=!1,this.args.running=!1;const a=new S.LoadingCard({timeout:-1,text:"loading ... 0%"},this);let n="kb";this.args.selectedChar&&"Sonic"!==this.args.selectedChar&&"Tails"!==this.args.selectedChar&&"Knuckles"!==this.args.selectedChar||("input-generic"===(n=this.args.inputType)&&(n="input-xbox"),this.controller&&this.controller.buttons&&this.controller.buttons[6]&&this.controller.buttons[7]&&this.controller.buttons[6].time>0&&this.controller.buttons[7].time>0?(this.args.controlCardShown.delete(this.args.selectedChar),n="input-dreamcast"):this.controller&&this.controller.buttons&&this.controller.buttons[10]&&this.controller.buttons[10].time>0?(this.args.controlCardShown.delete(this.args.selectedChar),n="input-gamecube"):this.controller&&this.controller.buttons&&this.controller.buttons[8]&&this.controller.buttons[8].time>0&&this.args.controlCardShown.delete(this.args.selectedChar));const l=new dt.GamepadConfig({inputType:n,char:this.args.selectedChar,timeout:-1,caption:"loading ... 0%"});r.addEventListener("level-progress",t=>{const{received:e,length:s,done:i}=t.detail;a.args.text=`loading level ... ${(100*i).toFixed(4)}%`,l.args.caption=`loading level ... ${(100*i).toFixed(4)}%`}),r.addEventListener("texture-progress",t=>{const{received:e,length:s,done:i}=t.detail;a.args.text=`loading textures ... ${(100*i).toFixed(4)}%`,l.args.caption=`loading textures ... ${(100*i).toFixed(4)}%`,1===i&&(a.args.text="initializing...",l.args.caption="initializing...")}),r.ready.then(()=>{const t=Object.create(null);if([...r.getObjectDefs()].forEach(e=>t[e.oid||e.id]=e),this.defsByMap.set(this.currentMap,t),this.tileMap.mapData&&this.tileMap.mapData.properties)for(const t of this.tileMap.mapData.properties){const e=t.name.replace(/-/g,"_");this.meta[e]=t.value}this.args.fgLayers.length=0,this.args.layers.length=0;const e=this.tileMap.tileLayers,s=e.length,i=this.tileMap.mapData.tilewidth;this.args.blockSize=i;for(let t=0;t<s;t++){const s=new I.Layer({layerId:t,blockSize:i,viewport:this,name:e[t].name,width:this.args.width,height:this.args.height,parallax:e[t].parallaxx,perspective:this.args.xPerspective});"Foreground"===e[t].name.substring(0,10)?this.args.fgLayers.push(s):this.args.layers.push(s),"Collision"===e[t].name.substring(0,9)?s.meta.solid=!0:"Moving"===e[t].name.substring(0,6)&&"Moving Art"!==e[t].name.substring(0,10)&&(s.meta.solid=!0),"construct"!==this.meta.theme&&("Collision"===e[t].name.substring(0,9)?s.args.hidden=!0:"Moving"===e[t].name.substring(0,6)&&"Moving Art"!==e[t].name.substring(0,10)?s.args.hidden=!0:s.args.hidden=!1)}});let h=new Promise(t=>setTimeout(t,7250));const g=!(this.args.controlCardShown.has(this.args.selectedChar)&&!this.args.networked||this.args.map||this.args.selectedChar&&"Sonic"!==this.args.selectedChar&&"Tails"!==this.args.selectedChar&&"Knuckles"!==this.args.selectedChar);this.replay||!g||o.Router.query.map?(this.args.titlecard=new v.Series({cards:[a]},this),h=Promise.resolve()):(this.args.titlecard=new v.Series({cards:[l]},this),this.args.controlCardShown.add(this.args.selectedChar)),this.args.titlecard.play();const c=Promise.all([r.ready,h]);return c.then(()=>a.args.text="starting level"),c.then(()=>this.startLevel({useCheckpoint:i})),c}fullscreen(){this.exitFullscreen(),this.args.focusMe.args.hide="hide",this.initScale=this.args.scale,this.showStatus(3500," hit escape to revert. "),this.tags.frame.node.requestFullscreen().then(t=>{this.onTimeout(100,()=>{this.fitScale(),this.args.fullscreen="fullscreen"})}).catch(t=>console.error(t))}exitFullscreen(){if(document.fullscreenElement)return document.exitFullscreen(),this.showStatus(0,""),this.args.focusMe.args.hide="",void(this.args.fullscreen="")}fitScale(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.settings.scaling){const e=window.innerHeight/this.args.height,s=window.innerWidth/this.args.width;this.args.scale=t?e>s?e:s:e>s?s:e}else this.args.scale=1;this.tags.frame&&this.tags.frame.style({"--width":this.args.width*this.args.tileScale,"--height":this.args.height*this.args.tileScale,"--scale":this.args.scale})}showStatus(t,e){this.args.status.args.hide="",this.args.status.args.value="",this.args.status.args.value=e,t>=0&&(this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.statusTimeout=this.onTimeout(t,()=>{this.args.status.args.hide="hide"}),this.statusTimeout=this.onTimeout(2*t,()=>{this.args.status.args.hide="hide hidden"}))}getAudioSetting(){var t;return!!JSON.parse(null===(t=localStorage.getItem("sonic-3000-audio-enabled"))||void 0===t||t)}onAttached(t){G.Settings.viewport=this,H.Impulse.viewport=this,U.Input.viewport=this,W.Mark.viewport=this,V.Move.viewport=this,$.Pos.viewport=this,K.Spawn.viewport=this,Y.Chao.viewport=this,this.buildDetect(),this.cpuDetect(),this.gpuDetect(),this.onTimeout(100,()=>this.fitScale(!1)),this.onTimeout(5500,()=>this.args.ntsc="");const e=this.getAudioSetting();this.onTimeout(o.Router.query.map||o.Router.query.nointro?0:36e3,()=>{this.args.bindTo("interacted",t=>{const s=!t&&e?" Click here to enable audio. ":" Click here to enable keyboard control. ";this.args.focusMe.args.value!==s&&(this.args.focusMe.args.value="",this.args.focusMe.args.value=s)},{wait:250})}),this.settings.bindTo("blur",t=>{t?(this.tags.blurDistance.setAttribute("style","filter:url(#motionBlur)"),this.tags.blurDistanceFg.setAttribute("style","filter:url(#motionBlur)")):(this.tags.blurDistance.setAttribute("style",""),this.tags.blurDistanceFg.setAttribute("style",""))}),this.listen(window,"resize",t=>{this.onTimeout(100,()=>this.fitScale(!1))}),this.listen(document,"fullscreenchange",t=>{if(this.onTimeout(100,()=>this.fitScale(!1)),!document.fullscreenElement)return this.args.scale=this.initScale,void(this.args.fullscreen="")}),this.tags.frame.style({"--width":this.args.width,"--height":this.args.height,"--scale":this.args.scale}),this.startTime||(this.startTime=0),this.args.started=!1,this.args.running=!1,this.args.paused=!1,this.listen(document.body,"click",t=>{let e=t.target;for(;e&&e.matches;){if(e.matches("[data-click-barrier]"))return;e=e.parentNode}this.tags.viewport.contains(document.activeElement)||this.tags.viewport.focus()},{capture:!0}),this.args.scale=this.args.scale||1;const s=l.Keyboard.get();s.listening=!0,s.focusElement=this.tags.viewport.node,s.codes.bindTo((t,e,s,i)=>{this.controller&&this.controller.keyIsMapped(e)||-1===t&&this.sequences.map(t=>t.check(e))}),this.tags.viewport.node.focus(),(window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: fullscreen)").matches)&&(this.args.standalone="standalone",document.title="Sonic 3000",this.listen(window,"resize",()=>this.fitScale(!1)),this.onTimeout(100,()=>this.fitScale(!1))),this.onTimeout(100,()=>this.args.initializing="")}setZoneCard(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||(this.args.zonecard=new f.Titlecard({waitFor:this.tileMap.ready},this));const e=this.meta.titlecard_title_1,s=this.meta.titlecard_title_2,i=this.meta.titlecard_author,r=this.meta.titlecard_number;return this.args.zonecard.args.firstLine=e,this.args.zonecard.args.secondLine=s,this.args.zonecard.args.creditLine=i,this.args.zonecard.args.actNumber=r,this.args.actName=`${e} ${s} ${r}`,t?Promise.resolve():(this.args.titlecard=new v.Series({cards:[this.args.zonecard]},this),this.args.titlecard.play())}fillBackground(){const t=L.BackdropPalette[this.meta.backdrop];delete this.args.backdrop,this.args.backdrop=t?new t:null,this.args.theme=this.meta.theme||"construct",this.args.bg=this.meta.backdrop}startLevel(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(performance.mark("init-start"),this.populateMap(),this.levelFinished=!1,this.args.isReplaying||(this.args._isRecording=!this.args.networked),this.args.debugEditMode=!1,this.clearDialog(),this.hideDialog(),this.args.mouse="hide",this.args.currentSheild=null,this.args.hasFire=!1,this.args.hasWater=!1,this.args.hasElectric=!1,this.args.hasNormal=!1,this.meta.zoneScript&&N.ScriptPalette[this.meta.zoneScript]&&(this.zoneScript=new N.ScriptPalette[this.meta.zoneScript]),d.Bgm.stop("MENU_THEME"),d.Bgm.playing&&this.meta.bgm!==this.bgm&&d.Bgm.stop(),this.meta.bgm||d.Bgm.fadeOut(250),this.args.audio||d.Bgm.pause(),t&&(this.setZoneCard(),this.zeroFrame=!1),this.fillBackground(),this.args.networked&&!this.remotePlayer){const t=new st.Sonic({name:"Player 1",id:String(new a.Uuid)},this),e=new st.Sonic({name:"Player 2",id:String(new a.Uuid)},this);1===this.args.playerId?(this.nextControl=t,this.remotePlayer=e,e.args.netplayer=!0):2===this.args.playerId&&(this.remotePlayer=t,this.nextControl=e,t.args.netplayer=!0);const s=this.defsByName.get("player-start");t.args.x=s.x,t.args.y=s.y,e.args.x=s.x,e.args.y=s.y,this.spawn.add({object:t}),this.spawn.add({object:e}),this.auras.add(t),this.auras.add(e),this.actors.add(t),this.actors.add(e)}for(const t of[...this.args.fgLayers,...this.args.layers])t.args.destroyed=!1;this.args.networked||(this.actors.list,this.playableIterator||(this.playableIterator=this.playable.entries()),Object.values(this.args.actors)[0]&&Object.values(this.args.actors)[0].controllable&&(this.nextControl=Object.values(this.args.actors)[0])),this.nextControl&&this.nextControl.controller&&this.nextControl.controller.zero(),this.controller&&this.controller.zero(),l.Keyboard.get().reset(),this.args.started=!1,d.Bgm.unpause(),this.args.zonecard.played.then(()=>{performance.mark("init-end"),performance.measure("init-marker","init-start","init-end");const t=this.getZoneState();if(!this.replay){for(const e of t.emblems){if(!this.actorsById[e])continue;const t=this.actorsByMap.get(this.currentMap)[e];t&&t.mapUrl===this.currentMap&&t instanceof pt.Emblem&&(t.existing="existing",this.nextControl&&!this.nextControl.args.emblems.includes(t)&&this.nextControl.args.emblems.push(t))}for(const t of this.currentSave.emeralds)this.args.emeralds.includes(t)||this.args.emeralds.push(t)}if(this.args.startFrameId=this.args.frameId-this.replayOffset,this.args.actStartFrameId=this.args.startFrameId,this.replayStart){if(this.nextControl){for(let t in this.replayStart[2]){Object.assign(this.nextControl.args,this.replayStart[2][t]);break}this.nextControl.controller.replay(this.replayStart[1]||{}),this.nextControl.readInput()}}else if(o.Router.query.start){const t=o.Router.query.start;if(t.match(/\d+(\.\d+)?,\d+(\.\d+)?/)){const[e=128,s=128]=t.split(",");this.nextControl.args.x=Number(e),this.nextControl.args.y=Number(s)}else if(this.defsByName.has(t)){const e=this.defsByName.get(t);this.nextControl.args.x=Number(e.x),this.nextControl.args.y=Number(e.y)}Number(o.Router.query.noClip)&&(this.nextControl.args.float=-1,this.nextControl.noClip=1)}else if(!(this.replay||this.args.isReplaying||this.args.isRecording||this.args.networked)&&(this.args.demoIndicator=null,this.nextControl)){const t=this.getCheckpoint(this.nextControl.args.canonical);if(t){const e=t?this.actorsByMap.get(this.currentMap)[t.checkpointId]:null;e&&(this.args.startFrameId=this.args.frameId-t.frames,this.args.actStartFrameId=this.args.startFrameId,e.args.wasActive=!0,e.args.active=!0,this.nextControl.args.x=e.x,this.nextControl.args.y=e.y,this.nextControl.follower&&(this.nextControl.follower.args.x=e.x,this.nextControl.follower.args.y=e.y,this.setColCell(this.nextControl.follower)),this.args.xOffset=.5,this.args.yOffset=.5,d.Bgm.play(this.meta.bgm,{loop:!0}))}}if(Number(o.Router.query.pause)&&(this.args.pauseMenu.args.hideMenu="pause-menu-hide",this.args.paused=Number(o.Router.query.pause)),this.nextControl.follower&&(this.nextControl.follower.args.x=this.nextControl.x,this.nextControl.follower.args.y=this.nextControl.y,this.setColCell(this.nextControl.follower)),o.Router.query.impulse){const t=o.Router.query.impulse;if(console.log(t),t.match(/-?\d+(\.\d+)?,-?\d+(\.\d+)?/)){const[e=0,s=0]=t.split(",");console.log({x:e,y:s}),this.nextControl.args.xSpeed=Number(e),this.nextControl.args.ySpeed=Number(s)}}o.Router.query.rings&&(this.nextControl.args.rings=Number(o.Router.query.rings)),this.args.level="level",this.args.fade=!1,this.args.started=!0,this.args.running=!0,this.startTime=Date.now(),this.onFrameOut(30,()=>this.args.fade="hide"),ft.Analytic.report({eventCategory:"zone",eventAction:"started",eventLabel:`${this.args.actName}`})})}finishLevel(){this.replay||this.saveReplay("#008000").catch(()=>{}),this.levelFinished=!0}saveReplay(t){const e=new ht.Replay;return e.consume({color:t,map:this.baseMap,frames:[...this.replayFrames.values()]}),e.lastFrame-e.firstFrame<30?Promise.reject():lt.ReplayDatabase.open("replays",3).then(t=>{delete e.id;const s=t.insert("replays",e).then(()=>e);return this.replayFrames=new Map,this.replayOffset=0,this.replayStart=null,this.replay=null,s})}takeInput(t){const e=l.Keyboard.get();if(e.update(),this.gamepad||this.args.cutScene)if(this.args.cutScene)this.controlActor.args.idleTime=0;else{const s=navigator.getGamepads(),i=t.readInput({keyboard:e,gamepads:s});for(const t of i){if(t===e)continue;const s=t;if(s){this.gamepad=s;const t=String(s.id);t.match(/x-?bo?x/i)?this.args.inputType="input-xbox":t.match(/ps[345]/i)||t.match(/playstation/i)||t.match(/duals(hock|ense)/i)||t.match(/ds[45]/i)?this.args.inputType="input-playstation":this.args.inputType="input-generic"}else this.args.inputName="keyboard",this.args.inputType="input-keyboard"}}else t.readInput({keyboard:e}),this.args.inputType="input-keyboard";if(this.controlActor&&this.args.debugEditMode){if(t.buttons[0]&&1===t.buttons[0].time){const t=Object.keys(D.ObjectPalette)[this.args.debugObjectCursor];this.debugBank[t]||(this.debugBank[t]=new D.ObjectPalette[t]);const e=this.debugBank[t];this.spawn.add({object:e}),e.controllable&&(e.args.name="SPAWN",this.playable.add(e)),e[St]=this[St],e.args.x=this.controlActor.args.x,e.args.y=this.controlActor.args.y,delete this.debugBank[t]}if(t.buttons[1]&&1===t.buttons[1].time){this.args.debugObjectCursor++;const t=Object.keys(D.ObjectPalette);this.args.debugObjectCursor>=t.length&&(this.args.debugObjectCursor=0);const e=t[this.args.debugObjectCursor];for(this.debugBank[e]||(this.debugBank[e]=new D.ObjectPalette[e]);this.tags.spawnPreview.node.firstChild;)this.tags.spawnPreview.node.firstChild.remove();this.debugBank[e].render(this.tags.spawnPreview.node),this.args.debugObjectName.args.value=e}if(t.buttons[2]&&1===t.buttons[2].time){this.args.debugObjectCursor--;const t=Object.keys(D.ObjectPalette);this.args.debugObjectCursor<=0&&(this.args.debugObjectCursor=t.length-1);const e=t[this.args.debugObjectCursor];for(this.debugBank[e]||(this.debugBank[e]=new D.ObjectPalette[e]);this.tags.spawnPreview.node.firstChild;)this.tags.spawnPreview.node.firstChild.remove();this.debugBank[e].render(this.tags.spawnPreview.node),this.args.debugObjectName.args.value=e}}if(this.args.debugEnabled&&t.buttons[8]&&1===t.buttons[8].time&&(this.args.debugEditMode=!this.args.debugEditMode,this.settings.debugOsd=this.args.debugEditMode),t.buttons[2011]&&1===t.buttons[2011].time&&this.fullscreen(),t.buttons[2008]&&1===t.buttons[2008].time&&(this.args.muteSwitch.args.active=!this.args.muteSwitch.args.active),t.buttons[2009]&&1===t.buttons[2009].time&&(this.settings.debugOsd=!this.settings.debugOsd),t.buttons[1050]&&1===t.buttons[1050].time&&this.args.fullscreen&&this.exitFullscreen(),t.buttons[1020]&&1===t.buttons[1020].time&&this.args.started&&(this.args.paused?this.unpauseGame():this.pauseGame()),!this.args.networked&&t.buttons[1011]&&t.buttons[1011].time>0&&this.args.pauseMenu.input(t),this.replay&&this.replay.auto&&t.buttons[1209]&&t.buttons[1209].time>0&&this.quit(this.args.replayQuickExit?2:1),!this.args.networked&&!this.args.paused&&!this.dontSwitch&&t.buttons[11]&&1===t.buttons[11].time){this.playableIterator=this.playableIterator||this.playable.entries();let t=this.playableIterator.next();t.done&&(this.playableIterator=!1,this.playableIterator=this.playable.entries(),t=this.playableIterator.next()),t.value&&(this.nextControl=t.value[0],this.dontSwitch=3)}if(this.args.started){this.controlActor&&(this.args.currentSheild=this.controlActor.args.currentSheild?this.controlActor.args.currentSheild.type:"");const e=9;if(t.buttons[e]&&t.buttons[e].active&&1===t.buttons[e].time&&(this.args.paused?this.unpauseGame():this.pauseGame()),!this.args.isReplaying&&(this.args.isRecording||this.args._isRecording)){this.args.isRecording&&!this.args.demoIndicator&&(this.args.demoIndicator=new B.CharacterString({value:" REC",color:"red"}));const e=this.args.frameId-this.args.startFrameId,s=t.serialize();let i={},r={},a={};this.controlActor&&(i={[this.controlActor.args.id]:{x:this.controlActor.args.x,y:this.controlActor.args.y,mode:this.controlActor.args.mode,falling:this.controlActor.args.falling,groundAngle:this.controlActor.args.groundAngle,gSpeed:this.controlActor.args.gSpeed,xSpeed:this.controlActor.args.xSpeed,ySpeed:this.controlActor.args.ySpeed}});let n=!1;if(e%60==0||0===this.replayFrames.size)for(let t in i){r[t]=r[t]||{},this.lastFrame.args[t]=this.lastFrame.args[t]||{};let e=!1;for(let s in i[t])i[t][s]!==this.lastFrame.args[t][s]&&(this.lastFrame.args[t][s]=r[t][s]=i[t][s],n=e=!0);e||delete r[t]}for(let t in s){a[t]=a[t]||{},this.lastFrame.input[t]=this.lastFrame.input[t]||{};for(let e in s[t])s[t][e]!==this.lastFrame.input[t][e]&&(this.lastFrame.input[t][e]=a[t][e]=s[t][e],n=!0)}a.axes&&!Object.keys(a.axes).length&&delete a.axes,a.buttons&&!Object.keys(a.buttons).length?delete a.buttons:delete a.buttons[1011],n&&this.controlActor&&!this.controlActor.args.dead&&this.replayFrames.set(e,[e,a,r])}}t.update({gamepad:this.gamepad})}moveCamera(){if(!this.controlActor)return;this.zeroFrame||(this.args.x=-this.controlActor.args.x,this.args.y=-this.controlActor.args.y),this.zeroFrame=!0,this.cameraBound<=this.maxCameraBound?this.cameraBound=this.maxCameraBound:this.cameraBound<1/0?this.cameraBound-=.05*this.cameraBound:this.maxCameraBound=this.cameraBound=Math.hypot(this.args.x+this.controlActor.args.x,this.args.y+this.controlActor.args.y);let t=25,e=this.controlActor,s=0;if(e.args.standingOn&&(s=e.args.standingOn.args.cameraBias,e.args.standingOn.isVehicle&&(e=e.args.standingOn)),e.focused){if("panning"!==this.cameraMode&&"panning"===e.args.cameraMode){const t=e.focused;this.cameraBound=this.maxCameraBound=Math.max(Math.abs(t.x-e.args.x),Math.abs(t.y-e.args.y)),this.args.x-=e.args.x-t.x,this.args.y-=e.args.y-t.y}this.cameraMode=e.args.cameraMode,e=e.focused}else this.cameraMode=e.args.cameraMode;const i=e.args.highJump,r=e.args.deepJump,a=(e.args.falling,e.args.ySpeed);switch(this.cameraMode){case"panning":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.85,t=8;break;case"boost-ring":const s=e.args.angle;!s||Math.abs(s-Math.PI)<.1?(this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.5,t=24):(this.args.xOffsetTarget=.5-.5*Math.cos(s),this.args.yOffsetTarget=.5-.2*Math.sin(s),t=16);break;case"cross-cannon":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.4,t=18;break;case"cross-cannon-quick":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.4,t=5;break;case"cutScene":this.args.xOffsetTarget=[.5,.25,.5,.75][e.args.mode],this.args.yOffsetTarget=[.75,.5,.25,.5][e.args.mode],this.maxCameraBound=64,t=15;break;case"corkscrew":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.75,this.maxCameraBound=96,t=64;break;case"normal":this.args.xOffsetTarget=[.5,.45,.5,.55][e.args.mode],this.args.yOffsetTarget=[.5,.5,.5,.5][e.args.mode],this.maxCameraBound=96,t=24,0===e.args.mode&&(t=9);break;case"perspective":this.args.xOffsetTarget=[.5,.6,.5,.4][e.args.mode],this.args.yOffsetTarget=[.5,.5,.5,.5][e.args.mode],this.maxCameraBound=96,t=12;break;case"climbing":this.args.xOffsetTarget=[.5,.33,.5,.66][e.args.mode],this.args.yOffsetTarget=[.5,.5,.5,.5][e.args.mode],this.maxCameraBound=48,t=24;break;case"airplane":{const s=e.args.xSpeed,i=Math.abs(s);t=20;const r=Math.max(i/100,.45)*-Math.sign(s);this.args.xOffsetTarget=.5+r,this.args.yOffsetTarget=.5;break}case"aerial":this.args.xOffsetTarget=.5,t=24,e.args.flying||!r&&!i?this.args.yOffsetTarget=.5:this.args.yOffsetTarget=a<0?.75:.35;break;case"popping":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.25,this.maxCameraBound=64,t=6;break;case"hooked":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.6,this.maxCameraBound=1,t=25;break;case"tube":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.5,this.maxCameraBound=64,t=24;break;case"cinematic":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.5,this.maxCameraBound=1,t=0;break;case"cliff":this.args.xOffsetTarget=.5+-.1*e.args.direction,this.args.yOffsetTarget=.3,t=30;break;case"bridge":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.35,t=24;break;case"boss":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.72,this.maxCameraBound=64,t=24;break;case"draggable":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.5,this.maxCameraBound=48,t=3;break;case"locked":this.args.xOffsetTarget=.5,this.args.yOffsetTarget=.25,this.maxCameraBound=32,t=16;break;default:this.maxCameraBound=64,t=25}if(["normal","perspective","bridge","cliff","aerial","tube","hooked","cutScene","hooked","corkscrew"].includes(this.cameraMode)&&!e.args.pushing&&e.args.modeTime>0){let t=e;e.args.standingOn&&e.args.standingOn.invertsBias&&(t=e.args.standingOn);let s=t.args.gSpeed,i=t.args.xSpeed;e.args.hangingFrom&&(i=e.args.hangingFrom.args.xSpeed),t.args.standingLayer&&(s+=t.args.standingLayer.offsetXChanged);const r=!t.args.falling,a=Math.abs(r?s:i),n=17;let o=Math.abs(t.xLast-t.args.x)>1&&Math.min(a/n,1)*-Math.sign(s||i);switch(t!==e&&(o*=4),t.args.mode){case 0:this.args.xOffsetTarget+=.4*o;break;case 1:this.args.yOffsetTarget+=.4*o;break;case 2:this.args.xOffsetTarget-=.4*o;break;case 3:this.args.yOffsetTarget-=.4*o}this.args.speedBias=o}this.args.xOffsetTarget=Math.max(0,Math.min(1,this.args.xOffsetTarget)),e.args.jumping&&e.args.fallTime>15&&(this.maxCameraBound=128,(r||i)&&(t*=.75));let n=0,o=512,l=0;if("boss"!==this.cameraMode&&"rocket"!==this.cameraMode&&e.args.modeTime>0&&(e.args.falling||1!==e.args.mode?e.args.falling||3!==e.args.mode||(o=e.args.gSpeedMax,l=-e.args.gSpeed/12):(o=e.args.gSpeedMax,l=e.args.gSpeed/12),e.args.rolling&&(l/=4),e.args.falling&&e.args.ySpeed>0&&((r||i)&&(l=e.args.ySpeed),e.args.ySpeed>0?n+=e.args.ySpeed>24?.5:0:n+=e.args.deepJump||e.args.ySpeed<-24?-.5:0),e.args.hangingFrom&&(l=e.args.ySpeed),n+=l/o,e.args.hangingFrom&&(n+=.2)),e.args.climbing&&(n=-.33*Math.sign(e.args.gSpeed)*(Math.max(4,Math.abs(e.args.gSpeed))/4)*(1===e.args.mode?-1:1)),this.args.yOffsetTarget+=s+e.args.cameraBias-n,0===e.args.mode&&Math.abs(e.args.groundAngle- -Math.PI/4)<.001&&(this.args.yOffsetTarget-=.25),t){const e=this.args.xOffsetTarget-this.args.xOffset,s=this.args.yOffsetTarget-this.args.yOffset;this.args.xOffset+=e/t,this.args.yOffset+=s/t}else this.args.xOffset=this.args.xOffsetTarget,this.args.yOffset=this.args.yOffsetTarget;const h=e.rotatePoint(0,-e.args.height/2);e.cofocused?(e.cofocusPoint||(e.cofocusPoint={}),e.cofocusPoint.x=.5*(e.args.x+e.cofocused.args.x),e.cofocusPoint.y=.5*(e.args.y+e.cofocused.args.y)):e.cofocusPoint=null;const g=h[0]+(e.cofocused?-e.cofocusPoint.x:-e.args.x),c=h[1]+(e.cofocused?-e.cofocusPoint.y:-e.args.y),d=g+h[0]+this.args.width*Number(this.args.xOffset),u=c+h[1]+this.args.height*Number(this.args.yOffset),p=this.args.x+-d,f=this.args.y+-u,m=Math.hypot(p,f),v=Math.atan2(f,p),y=this.cameraBound,b=Math.min(y,m),S=Math.abs(b/y),w=b/("panning"===this.cameraMode?6:12);let x=d+b*Math.cos(v),k=u+b*Math.sin(v);S*w>.01&&(x-=S*Math.cos(v)*w,k-=S*Math.sin(v)*w/2);const M=e.screenLock?-(e.screenLock.xMin+0):0;x>M&&!this.meta.wrapX&&(x=M),k>0&&!this.meta.wrapY&&(k=0);const P=this.meta.deathLine||this.tileMap.mapData.height*this.tileMap.mapData.tileheight,C=e.screenLock?-(e.screenLock.xMax-this.args.width):-this.tileMap.mapData.width*this.tileMap.mapData.tilewidth+this.args.width,j=-P+this.args.height;x<C&&!this.meta.wrapX&&(x=C),k<j&&!this.meta.wrapY&&(k=j),this.args.shakeX*=-.95,this.args.shakeY*=-.95,this.args.shakeX=Math.abs(this.args.shakeX)<.1?0:this.args.shakeX,this.args.shakeY=Math.abs(this.args.shakeY)<.1?0:this.args.shakeY,e.args.dead&&!e.args.respawning?this.args.x=x+this.args.shakeX:(this.args.x=x+this.args.shakeX,this.args.y=k+this.args.shakeY)}applyMotionBlur(){if(this.args.frameId%this.settings.frameSkip!=0)return;const t=this.controlActor;if(this.settings.blur&&t&&this.tags.blur){const t=this.args.x-this.xPrev,e=this.args.y-this.yPrev,s=6;let i=(Number(t)/s)**2,r=(Number(e)/s)**2;const a=32;i=i<a?i:a,r=r<a?r:a;let n=Math.max(0,.25*Math.hypot(i,r)-1);const o=Math.atan2(e,t);this.args.frozen>0&&(n=0),n>.5?(this.tags.blurAngle.setAttribute("style",`transform:rotate(calc(1rad * ${o}))`),this.tags.blurAngleFg.setAttribute("style",`transform:rotate(calc(1rad * ${o}))`),this.tags.blurAngleCancel.setAttribute("style",`transform:rotate(calc(-1rad * ${o}))`),this.tags.blurAngleCancelFg.setAttribute("style",`transform:rotate(calc(-1rad * ${o}))`),this.tags.blur.setAttribute("stdDeviation",`${n}, 0`)):(this.tags.blurAngle.setAttribute("style","transform:none;"),this.tags.blurAngleFg.setAttribute("style","transform:none;"),this.tags.blurAngleCancel.setAttribute("style","transform:none;"),this.tags.blurAngleCancelFg.setAttribute("style","transform:none;"),this.tags.blur.removeAttribute("stdDeviation")),this.xPrev=this.args.x,this.yPrev=this.args.y}else this.tags.blurAngle.setAttribute("style","transform:none;"),this.tags.blurAngleFg.setAttribute("style","transform:none;"),this.tags.blurAngleCancel.setAttribute("style","transform:none;"),this.tags.blurAngleCancelFg.setAttribute("style","transform:none;"),this.tags.blur.removeAttribute("stdDeviation")}updateBackground(){if(this.args.frameId%this.settings.frameSkip!=0)return;let t=this.controlActor;t&&t.standingOn&&t.standingOn.isVehicle&&(t=this.controlActor.standingOn),this.tags.bgFilters.style({"--x":this.args.x,"--y":this.args.y}),this.args.plot&&(this.args.plot.args.x=Number(this.args.x).toFixed(2),this.args.plot.args.y=Number(this.args.y).toFixed(2)),this.tags.content.style({"--x":this.args.x,"--y":this.args.y,"--xPerspective":this.args.xPerspective,"--outlineWidth":this.settings.outline+"px"});const e=this.args.x<=0?this.args.x%this.args.blockSize:(-this.args.blockSize+this.args.x%this.args.blockSize)%this.args.blockSize,s=this.args.y<=0?this.args.y%this.args.blockSize:(-this.args.blockSize+this.args.y%this.args.blockSize)%this.args.blockSize;this.tags.background.style({transform:`translate( ${e.toFixed(2)}px, ${s.toFixed(2)}px )`}),this.tags.foreground.style({transform:`translate( ${e.toFixed(2)}px, ${s.toFixed(2)}px )`}),this.tags.frame.style({"--width":this.args.width,"--height":this.args.height,"--scale":this.args.scale})}updateBackdrops(){if(this.args.frameId%this.settings.frameSkip!=0)return;for(const[,t]of this.backdrops){if(!t.view){const e={};let s="";for(const i of t.properties)"backdrop"!==i.name?e[i.name]=i.value:s=i.value;e.width=t.width,e.height=t.height,e.bX=t.x,e.bY=t.y;const i=L.BackdropPalette[s];i&&(t.view=new i(e,this),t.view.render(this.tags.backdrops))}this.args.width,this.args.x,t.x;const e=this.args.height+-this.args.y+-t.y,s=(t.width,this.args.x,t.x,-(-t.height-this.args.y-t.y)),i=this.tileMap?-32*this.tileMap.mapData.width:512;this.tileMap&&this.tileMap.mapData.height,t.view&&Object.assign(t.view.args,{x:this.args.x,xOffset:-this.args.x-t.x,xPan:this.args.x+1.5*this.args.xPerspective,xMax:i,y:this.args.y+t.y,yMax:this.args.y+t.y+-t.view.stacked,stacked:-t.view.stacked+"px",frame:this.args.frameId,top:e,bottom:s})}this.tileMap.mapData.tilewidth;const t=this.tileMap.mapData.tileheight,e=this.tileMap.mapData.width,s=this.tileMap.mapData.height;this.tileMap&&this.tileMap.ready.then(()=>{const i=this.tileMap?-e*t:512,r=this.tileMap?-s*t:512;this.args.backdrop&&Object.assign(this.args.backdrop.args,{x:0,xPan:this.args.x+1.5*this.args.xPerspective,y:this.args.y+this.args.yOffset,xMax:null!==i&&void 0!==i?i:0,yMax:null!==r&&void 0!==r?r:0,frame:this.args.frameId,stacked:-this.args.backdrop.stacked+"px"})})}spawnFromDef(t){const e=t.type||t.class||t.name;if(t.id>this.maxObjectId&&(this.maxObjectId=t.id),"particle"===e){const e=new m.Particle3d;e.style({"--x":t.x,"--y":t.y}),this.particles.add(e.node)}if("backdrop"===e)return void this.backdrops.set(t.id,t);if(!D.ObjectPalette[e])return;const s=D.ObjectPalette[e].fromDef(t);s[St]=this[St],s[i.Bindable.NoGetters]=!0;const r=i.Bindable.make(s);return r.oid=t.oid||t.id,r.name=r.name||t.name,r.startFrame=this.args.frameId||0,this.actors.add(r),r}spawnInitialObjects(t,e){const s=new Set;for(let i in t){this.defsByName.set(t[i].name,t[i]),this.objDefs.set(t[i].id,t[i]);const r=this.spawnFromDef(t[i]);r&&(r.mapUrl=e,s.add(r),this.actorsByMap.has(e)||this.actorsByMap.set(e,Object.create(null)),this.actorsByMap.get(e)[r.oid]=r)}if(this.defsByName.has("player-start")&&!this.args.started){const t=this.defsByName.get("player-start");this.args.x=-t.x,this.args.y=-t.y}for(const t of this.actors.items())if(s.has(t)){for(const e in t.others)t.others[e]=this.actorsById[t.others[e]];if(t.objDef&&t.objDef.properties)for(const e of t.objDef.properties)"object"===e.type&&(t.otherDefs[e.name]=this.objDefs.get(e.value));this.actorIsOnScreen(t)?(t.args.display=t.defaultDisplay||null,t.render(this.tags.actors)):(t.args.display="none",t.render(),t.detach()),(t.onAttach&&!1===t.onAttach()||t.args.hidden)&&(t.args.display="none",t.detach()),t.controllable&&(t.args.display=t.defaultDisplay||null)}for(const t of this.actors.items())t.initialize&&t.initialize(),t.vizi=!1;this.args.started||(this.args.started=!0,this.update(),this.args.started=!1)}appendMap(t,e,s){return this.maps.set(t,{x:e,y:s}),this.args.loadingMap=!0,this.tileMap.preloadMap(t).then(i=>{const r=s+i.height;if(r>this.tileMap.mapData.height){const t=r-this.tileMap.mapData.height;this.tileMap.resize(this.tileMap.mapData.width,r),this.offsetMap(0,t),s=0}return this.tileMap.append(t,e,s,this.maxObjectId)}).then(i=>{let{defs:r,data:a}=i;this.currentMap=t;const n=this.getZoneState();this.controlActor.args.emblems.splice(0);const o=this.maxObjectId;let l=0;for(const t of r)if(t.oid=t.id,t.id+=o,t.x+=e*this.tileMap.mapData.tilewidth,t.y+=s*this.tileMap.mapData.tileheight,l=Math.max(l,t.id),t.properties)for(const e of t.properties)"object"===e.type&&(e.value+=o);const h=Object.create(null);[...r].forEach(t=>h[t.oid]=t),this.defsByMap.set(this.currentMap,h),this.maxObjectId=l;for(const t of Object.values(a.properties)){const e=t.name.replace(/-/g,"_");this.meta[e]=t.value}const g=this.spawnInitialObjects(r,t),c=this.defsByName.get("player-start");c&&this.storeCheckpoint(this.controlActor.args.canonical,c.oid||c.args.id);for(const e of n.emblems){const s=this.actorsByMap.get(this.currentMap)[e];s&&s.mapUrl===t&&(s.existing="existing",this.controlActor&&!this.controlActor.args.emblems.includes(s)&&this.controlActor.args.emblems.push(s))}return g}).finally(()=>this.args.loadingMap=!1)}offsetMap(t,e){for(const s of this.actors.items())s.args.x+=t*this.tileMap.blockSize,s.args.y+=e*this.tileMap.blockSize,this.setColCell(s);this.args.x-=t*this.tileMap.blockSize,this.args.y-=e*this.tileMap.blockSize,this.meta.deathLine&&(this.meta.deathLine+=e*this.tileMap.blockSize),this.tileMap.offset(t,e)}populateMap(){if(this.args.populated)return;const t=32*this.tileMap.mapData.width+64,e=32*this.tileMap.mapData.height+64;this.args.populated=!0,this.defsByName=new Map,this.objDefs=new Map;for(const[t,e]of this.backdrops)e.view&&(e.view.remove(),e.view=void 0),this.backdrops.delete(t);for(const t of Object.entries(this.particles.list))t&&this.particles.remove(t);const s=String(this.args.selectedChar||o.Router.query.char||"Sonic").toLowerCase(),i=new(D.ObjectPalette[s]||st.Sonic)({name:s},this);for(const[t,e]of this.defsByMap)this.spawnInitialObjects(e,t);if(!this.args.networked){var r;let s="player-start";!i.canRoll&&this.defsByName.has("wide-player-start")&&(s="wide-player-start");const a=this.defsByName.get(s);i.args.x=a?a.x:t/2,i.args.y=a?a.y:e/2,i.args.z=a&&null!==(r=a.z)&&void 0!==r?r:10,i.args.animation="dropping";const n=String(this.args.followerChar||o.Router.query.follower||"").toLowerCase();if(n){const t=new(D.ObjectPalette[n]||it.Tails)({following:!0,name:n,x:i.args.x,y:i.args.y,z:i.args.z-1},this);this.spawn.add({object:t}),this.auras.add(t),this.actors.add(t),i.follower=t}if(this.spawn.add({object:i}),this.auras.add(i),this.actors.add(i),a&&a.properties)for(const t of a.properties)i.args[t.name]=t.value;this.nextControl=i}if(this.onFrameOut(1,()=>{i.follower&&(i.follower.args.x=i.args.x,i.follower.args.y=i.args.y)}),!this.replayStart)for(const[t,e]of Object.entries(this.actors.list)){if(!e||e.args.npc)continue;if(!e.controllable)continue;const t=this.getCheckpoint(e.args.canonical);if(t&&t.checkpointId){const s=this.defsByMap.get(this.currentMap)[t.checkpointId],i=this.actorsByMap.get(this.currentMap)[t.checkpointId];s&&(e.args.x=s.x,e.args.y=s.y),i&&(i.args.active=!0)}}}actorIsOnScreen(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512;if(!t)return;const s=this.args.width,i=this.args.height,r=-this.args.x-16-e,a=16-this.args.x+e+s,n=-this.args.y-e,o=-this.args.y+i+.5*e,l=t.args.width,h=t.args.y-t.args.height,g=t.args.x-(t.isRegion?0:l/2);return!(r>t.args.x+(t.isRegion?l:l/2)||g>a||n>t.args.y||h>o)}spawnActors(){const t=new DocumentFragment;new DocumentFragment;let e=!1;for(const s of this.spawn)if(s.frame){if(s.frame<=this.args.frameId){this.spawn.delete(s),s.object[i.Bindable.NoGetters]=!0,s.object[St]=this[St],s.object.startFrame=this.args.frameId||0,s.object.args.id=++this.maxObjectId,this.actors.add(i.Bindable.make(s.object)),s.object,R.Region;const r=t;s.object.render(r),s.object.onRendered(),s.object.onAttach&&!1===s.object.onAttach()&&(s.object.args.hidden||s.object.detach()),this.setColCell(s.object),e=!0,s.object.initialize&&s.object.initialize()}}else this.spawn.delete(s),s.object[i.Bindable.NoGetters]=!0,s.object[St]=this[St],s.object.startFrame=this.args.frameId||0,s.object.args.id=++this.maxObjectId,this.actors.add(i.Bindable.make(s.object)),s.object.render(t),s.object.onRendered(),s.object.onAttached&&s.object.onAttached(),s.object.onAttach&&!1===s.object.onAttach()&&s.object.detach(),e=!0,s.object.initialize&&s.object.initialize();e&&this.tags.actors.append(t)}actorUpdateStart(t){this.updateStarted.has(t)||(this.updateStarted.add(t),t.updateStart(),t.colliding&&(t.colliding=!1),t.moved=!1)}actorUpdate(t){this.updated.has(t)||(this.updated.add(t),t.update())}actorUpdateEnd(t){this.updateEnded.has(t)||(this.updateEnded.add(t),t.args.colliding=t.colliding,t.updateEnd(),t.moved&&!t.removed&&this.setColCell(t))}nearbyActors(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.getNearbyColCells(t,e),r=new Set;for(const t of i)for(const e of t)s&&!e.isRegion||r.add(e);return r}update(){const t=this.args.frameId-this.args.startFrameId;if(this.zoneScript&&this.args.started&&!1===this.args.paused&&this.zoneScript.update(t,this),this.args.started&&this.meta.bgm&&t===(this.meta.bgm_delay||1)&&d.Bgm.play(this.meta.bgm,{loop:!0}),this.socket&&this.args.frameId%120==0&&this.socket.publish("keepalive",""),this.args.loadingMap)return;this.args.paused>0&&this.args.paused--,this.args.frozen>0&&this.args.frozen--,this.tallyBoard&&!this.args.paused&&(this.tallyBoard.update(this),this.args.score.args.value=String(this.controlActor.args.score).padStart(4," "),this.tallyBoard.done||(this.args.frozen=1));const e=this.controlActor?this.controlActor.controller:this.controller;for(const t in e.buttons)e.buttonIsMapped(t)||e.buttons[t].active&&1===e.buttons[t].time&&(this.debugSeq.check(`Button${t}`),this.konamiSeqA.check(`Button${t}`),this.konamiSeqB.check(`Button${t}`));if(this.args.frameId%600==0&&(ga("set","metric1",this.args.frameId/60),"function"==typeof ga&&ft.Analytic.report({eventCategory:"fps-check",eventAction:`fps-check::${navigator.platform}::cores_${navigator.hardwareConcurrency}`,eventLabel:`${this.args.actName}`,eventValue:Math.trunc(this.args.fps),Value:Math.trunc(this.args.fps)})),this.args.started||(this.startTime=Date.now(),e&&(this.takeInput(e),this.args.titlecard&&this.args.titlecard.input(e))),!1!==this.args.paused&&(this.takeInput(e),this.args.pauseMenu.input(e)),!1===this.args.paused||this.args.paused>0||this.args.networked){this.callFrameOuts(),this.callRenderedFrameOut(),this.callFrameIntervals();for(const[t,e]of this.timers)e.update();this.args.lastFrameId=this.args.frameId,this.args.cutScene?(this.args.startFrameId++,this.args.showHud=!1):this.settings.showHud&&(this.args.showHud=!0),this.args.debugEditMode||this.args.frameId++,this.args.debugOsd&&(this.args.frame.args.value=this.args.frameId)}if(!this.args.networked&&this.args.started&&!1!==this.args.paused&&this.args.paused<=0)return;if(!this.args.networked&&this.args.frozen>0)return this.args.startFrameId++,void(this.args.blur=0);if(!this.args.started&&this.args.frameId>0)return;this.tileMap&&this.tileMap.mapData&&this.updateBackdrops();for(const[t,e]of this.willDetach)this.willDetach.delete(t),e();Number(this.args.rings.args.value)?this.args.ringLabel.args.color="yellow":this.args.ringLabel.args.color="red-alert",this.args.fpsSprite.args.value=Number(this.args.fps).toFixed(0).padStart(2,"0");const s=(this.args.frameId-this.args.actStartFrameId)/60;let i=String(Math.trunc(Math.abs(s)/60)).padStart(2,"0"),r=String(Math.trunc(Math.abs(s)%60)).padStart(2,"0");const a=s<0?"-":"";if(a&&(i=Number(i)),this.args.timer.args.value=`${a}${i}:${r}`,this.dontSwitch>0&&this.dontSwitch--,this.dontSwitch<0&&(this.dontSwitch=0),this.args.rippleFrame=this.args.frameId%128,this.args.displaceWater=this.args.frameId%128,this[vt].clear(),this.args.isReplaying||this.args.isRecording||(this.args.demoIndicator=null),this.updateBackground(),this.controlActor)if(this.args.isReplaying){l.Keyboard.get().getKeyCode("NumpadAdd")>0&&(this.focus(),this.args.paused=1,this.args.pauseMenu.args.hideMenu="pause-menu-hide"),this.args.demoIndicator||(this.args.demoIndicator=new B.CharacterString({value:" PLAY",color:"green"})),this.onFrameOut(60,()=>{this.args.focusMe.args.hide&&(this.args.focusMe.args.hide="hide hidden")});const t=this.args.frameId-this.args.startFrameId;if(t<this.maxReplayFrame){const e=this.controlActor;if(this.lastInput=this.lastInput||{},this.lastInput.axes=this.lastInput.axes||{},this.lastInput.buttons=this.lastInput.buttons||{},this.replayFrames.has(t)){const[s,i,r]=this.replayFrames.get(t),a={frame:s,input:i,args:r};if(a.args)for(const t in a.args)Object.assign(e.args,a.args[t]),e.args.ignore=0,e.args.respawning=!1,e.args.dead=!1,e.noClip=!1;a.input&&a.input.buttons&&delete a.input.buttons[9],a.input?(Object.assign(this.lastInput.axes,a.input.axes||{}),Object.assign(this.lastInput.buttons,a.input.buttons||{}),e.controller.replay(this.lastInput),e.readInput()):(e.controller.replay(this.lastInput),e.readInput())}else e.controller.replay(this.lastInput),e.readInput();this.args.hasRecording=!0,this.args.replayBanners&&this.args.frameId-this.args.startFrameId<5&&(this.args.topLine.args.hide="hide hidden",this.args.status.args.hide="hide hidden",this.args.focusMe.args.hide="hide hidden",this.onTimeout(1,()=>{}))}else this.args.topLine.args.hide="hide hidden",this.args.status.args.hide="hide hidden",this.replayFrames=new Map,this.replayOffset=0,this.replayStart=null,this.args.isReplaying=!1,this.args._isRecording=!1,this.onFrameOut(30,()=>this.quit(this.args.replayQuickExit?2:1))}else this.gamepad&&(this.args.focusMe.args.hide="hide hidden"),this.controlActor.controller&&this.takeInput(this.controlActor.controller),this.args.cutScene||this.controlActor.readInput();this.controlActor&&this.controlActor.args.respawning&&!this.args.isReplaying&&(this.replay=null),!this.args.isReplaying&&this.controlActor&&this.controlActor.args.dead&&this.onFrameOut(30,()=>{this.replayFrames.size&&(this.saveReplay("#804000").catch(()=>{}),this.replayFrames=new Map)}),this.collisionCache=new Map,this.collisions=new Map,this.updateStarted.clear(),this.updated.clear(),this.updateEnded.clear(),this.controlActor&&this.controlActor.setCameraMode();const n=new Map,o=[...this.args.layers,...this.args.fgLayers];for(let t=o.length;t>0;t--){const e=o[t-1];e.x=this.args.x,e.y=this.args.y,e.update(this.tileMap,n)}for(let t=o.length;t>0;t--)o[t-1].move();if(this.args.running&&!this.args.debugEditMode){const t=new Set;for(const e of this.regions)this.actorIsOnScreen(e,768)&&t.add(e);for(const e of this.auras){if(!e||e.removed){this.auras.delete(e);continue}e!==this.controlActor&&t.add(e);const s=this.nearbyActors(e.args.x,e.args.y);for(const e of s)e===this.controlActor||e.removed||t.add(e)}for(const e of t)e[St]!==this[St]||e.removed||this.actorUpdateStart(e);this.controlActor&&this.controlActor[St]===this[St]&&this.actorUpdateStart(this.controlActor);for(const e of t)e[St]!==this[St]||e.removed||this.actorUpdate(e);this.controlActor&&this.controlActor[St]===this[St]&&this.actorUpdate(this.controlActor);for(const e of t)e[St]!==this[St]||e.removed||this.actorUpdateEnd(e);this.controlActor&&this.controlActor[St]===this[St]&&this.actorUpdateEnd(this.controlActor);for(const e of t)e.moved&&!e.removed&&e[St]===this[St]&&this.setColCell(e);if(this.controlActor&&this.controlActor[St]===this[St]&&this.setColCell(this.controlActor),this.collisions)for(const[t,e]of this.collisions)for(const[t,s]of e)t&&t.pause(!1);if(this.controlActor&&(this.args.score.args.value=String(this.controlActor.args.score).padStart(4," "),this.args.rings.args.value=String(this.controlActor.args.rings).padStart(4," "),this.args.emblems=this.controlActor.args.emblems,this.args.hasRings=!!this.controlActor.args.rings,this.args.hasEmeralds=!!this.controlActor.args.emeralds,this.args.char.args.value=this.controlActor.args.name,this.args.charName=this.controlActor.args.name,this.args.debugOsd)){this.args.xPos.args.value=Number(this.controlActor.args.x).toFixed(3),this.args.yPos.args.value=Number(this.controlActor.args.y).toFixed(3),this.args.layer.args.value=Number(this.controlActor.args.layer),this.args.ground.args.value=this.controlActor.args.landed,this.args.gSpeed.args.value=Number(this.controlActor.args.gSpeed).toFixed(3),this.args.xSpeed.args.value=Number(this.controlActor.args.xSpeed).toFixed(3),this.args.ySpeed.args.value=Number(this.controlActor.args.ySpeed).toFixed(3),this.args.angle.args.value=(Math.round(1e3*this.controlActor.args.groundAngle)/1e3).toFixed(3),this.args.airAngle.args.value=(Math.round(1e3*this.controlActor.args.airAngle)/1e3).toFixed(3),this.args.actorCount.args.value=this.actors.size,this.args.regionCount.args.value=this.regions.size,this.args.ignore.args.value=this.controlActor.args.ignore;const t=["FLOOR (0)","L-WALL (1)","CEILING (2)","R-WALL (3)"];this.args.mode.args.value=t[Math.floor(this.controlActor.args.mode)]||Math.floor(this.controlActor.args.mode),this.args.cameraMode.args.value=this.controlActor.args.cameraMode}}else this.args.running&&this.args.debugEditMode&&this.controlActor&&(this.controlActor.args.x+=4*e.axes[0].magnitude,this.controlActor.args.y+=4*e.axes[1].magnitude,this.controlActor.args.respawning=!1,this.controlActor.args.dead=!1,this.controlActor.noClip=!1,this.controlActor.args.xSpeed=0,this.controlActor.args.ySpeed=0,this.controlActor.args.gSpeed=0);this.args.width,this.args.height;const h=(this.args.x,this.args.x,this.args.y,this.args.y,new WeakSet);if(this.controlActor){const t=new DocumentFragment,e=new DocumentFragment;let s=!1,i=!1,r=this.controlActor;this.controlActor.focused&&(r=this.controlActor.focused);const a=this.nearbyActors(r.args.x,r.args.y)||[],n=this.nearbyActors(r.args.x,r.args.y,!0)||[];for(const e of[a,n])for(const i of e)i[St]===this[St]&&(i.args.hidden||i.nodes.length||i.render(this.tags.actors),!this.actorIsOnScreen(i)||i instanceof E.LayerSwitch||(i.args.display=i.defaultDisplay||null,i.vizi||(i.nodes.length||i.onAttach&&!1===i.onAttach()&&i.detach(),i.args.hidden||(R.Region,i.nodes.map(e=>t.append(e)),s=!0),i.wakeUp()),this.willDetach.delete(i),this.visible.add(i),i.args.hidden||(i.vizi=!0)),h.add(i),this.recent.add(i));for(const t of new Set([...this.recent,...this.visible])){if(t.removed){this.visible.delete(t),this.recent.delete(t);continue}if(t[St]!==this[St]){this.recent.delete(t);continue}const e=!t.args.hidden&&this.actorIsOnScreen(t);t.vizi&&!e&&(this.willDetach.set(t,()=>{t.sleep(),t.args.display="none",t.detach(),this.visible.delete(t),t.vizi=!1,t.willhide=null,this.willDetach.delete(t)}),this.recent.delete(t))}s&&this.tags.actors.append(t),i&&this.tags.actors.append(e)}if(this.nextControl&&(!this.args.networked&&this.auras.clear(),this.controlActor&&this.controlActor.sprite&&this.controlActor.sprite.parentNode&&this.controlActor.sprite.parentNode.classList.remove("actor-selected"),this.controlActor&&(this.controlActor.args.selected=!1),this.controlActor=this.nextControl,this.controlActor.args.selected=!0,this.auras.add(this.controlActor),this.controlActor.args.display=this.controlActor.defaultDisplay||null,this.controlActor.nodes.map(t=>this.tags.actors.append(t)),this.visible.add(this.controlActor),this.controlActor.vizi=!0,this.args.maxSpeed=null,this.nextControl=null),this.updated.forEach(t=>{if(t.args.standingLayer){const e=t.args.standingLayer.offsetXChanged;if(e){const s=t.bMap("scanForward",e).get(gt.Platformer);t.args.x+=!1===s?e||0:s*Math.sign(e)}t.args.y+=t.args.standingLayer.offsetYChanged||0}}),this.controlActor){this.moveCamera(),this.applyMotionBlur(),this.args.popTopLine=this.args.popTopLine||this.getUnusedCharString({color:"yellow"}),this.args.popBottomLine=this.args.popBottomLine||this.getUnusedCharString({color:"yellow"});let t=0,e=0,s=this.controlActor.args.popChain.length>1,i=0;if(this.controlActor.args.popChain.length){this.controlActor.args.popChain[0].special&&(s=!0),i=this.controlActor.args.popChain.length;const r=Math.max(0,i-4);if(!i)for(const t of this.args.combo)this.pooledCharStringDetached(t.label);let a=!1;for(let s=0;s<i;s++){const i=this.controlActor.args.popChain[s];t+=i.multiplier,e+=i.points;const n=s+-r;s>=r?(this.args.combo[n]=this.args.combo[n]||{label:this.getUnusedCharString(),score:null,index:s},this.args.combo[n].label=this.args.combo[n].label||this.getUnusedCharString(),this.args.combo[n].index!==s&&(a=!0),this.args.combo[n].label.args.value=String(i.label).replace(/-/g," "),this.args.combo[n].index=s,i.color?this.args.combo[n].label.args.color=i.color:i.multiplier>1?this.args.combo[n].label.args.color="orange":this.args.combo[n].label.args.color="white"):s<r&&this.args.combo[n]&&this.pooledCharStringDetached(this.args.combo[n].label)}if(a){const t=this.args.combo[this.args.combo.length+-1];t.label.args.classes="pulse",this.onFrameOut(1,()=>t.label.args.classes="")}this.args.combo.length=Math.min(4,Math.max(0,-r+this.controlActor.args.popChain.length))}else{for(const t of this.args.combo)this.pooledCharStringDetached(t.label);this.args.combo.length=0}this.args.popTopLine.args.value=e+" x "+t,this.args.popBottomLine.args.value=i>4?"+"+(i-4):"",this.args.showCombo=s}if(this.args.networked&&this.controlActor){const t={frame:this.serializePlayer()};1===this.args.playerId?this.server.send(JSON.stringify(t)):2===this.args.playerId&&this.client.send(JSON.stringify(t))}this.socket&&this.args.publishTime<=0?(this.packPlayerFrame().arrayBuffer().then(t=>this.socket.publish(0,t)),this.args.publishTime=10):this.args.publishTime--,this.spawnActors(),this.controlActor&&this.controlActor.isSuper&&!this.controlActor.isHyper&&this.controlActor.args.rings&&this.controlActor.args.minRingsHyper&&this.controlActor.args.rings>=this.controlActor.args.minRingsHyper?this.args.prompt.args.value="  ":this.controlActor&&!this.controlActor.isSuper&&!this.controlActor.isHyper&&this.controlActor.args.rings&&this.controlActor.args.minRingsSuper&&this.controlActor.args.rings>=this.controlActor.args.minRingsSuper?this.args.prompt.args.value="  ":this.args.prompt.args.value="",this.args.fps<30?this.settings.frameSkip=3:this.args.fps<20?this.settings.frameSkip=2:this.settings.frameSkip=1;for(const t in this.mouseState.buttons)this.mouseState.buttons[t]&&this.mouseState.buttons[t]++}populateCharStringPool(){if(!this.charStringPool){this.charStringPool=new Set,this.charStringOpen=new Set;for(let t=0;t<30;t++){const t=i.Bindable.make(new B.CharacterString({value:" ".repeat(10)}));t.preserve=!0,this.charStringPool.add(t),this.charStringOpen.add(t)}}}getUnusedCharString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.populateCharStringPool();for(const e of this.charStringOpen)return this.charStringOpen.delete(e),Object.assign(e.args,t),t.value||(e.args.value=""),e}pooledCharStringDetached(t){this.charStringOpen.add(t)}resetCharStringPool(){this.populateCharStringPool();for(const t of this.charStringPool)this.charStringOpen.add(t)}click(t){this.args.isReplaying&&(this.controlActor&&this.controlActor.controller.zero(),this.stop(),this.args.topLine.args.hide="hide hidden",this.args.status.args.hide="hide hidden",this.quit(this.args.replayQuickExit?2:1))}regionsAtPoint(t,e){var s;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new Set;i=null!==(s=i)&&void 0!==s?s:this.nearbyActors(t,e,!0);for(const s of i){if(!s.isRegion)continue;if(s[St]!==this[St]){this.regions.delete(s);continue}const i=s.args,a=i.x,n=i.y,o=i.width,l=i.height;Math.floor(o/2),t>=a&&a+o>t&&n>=e&&e>n-l&&r.add(s)}return r}actorsAtPoint(t,e){var s;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{ghosts:!1,nearbyActors:null};const n=null!==(s=a.nearbyActors)&&void 0!==s?s:this.nearbyActors(t,e);if(!n.size)return[];const o=new Set;for(const s of n){if(!a.ghosts&&s.isGhost)continue;const n=Math.max(Math.floor(i/2),0),l=s.isRegion,h=t-n,g=t+n,c=s.args,d=c.x,u=c.width,p=u/2;if(g<d-(l?0:p)||d+(l?u:p)<h)continue;const f=e-Math.max(r,0),m=e,v=c.y,y=c.height;v<f||m<v-y||o.add(s)}return Array.from(o.values())}actorsAtLine(t,e,s,i){const r=new Set,a=Math.floor(t/this.colCellDiv),n=Math.floor(e/this.colCellDiv),o=Math.floor(s/this.colCellDiv),l=Math.floor(i/this.colCellDiv);for(let t=0;t<3+Math.abs(a+-o);t++)for(let e=0;e<3+Math.abs(n+-l);e++){const s=t+Math.min(a,o)+-1+":"+(e+Math.min(n,l)+-1);if(this.colCells.has(s))for(const t of this.colCells.get(s))r.add(t)}const h=new Map;for(const a of r){if(a.isGhost)continue;const r=this.actorIntersectsLine(a,t,e,s,i);if(!r)continue;const n=Math.hypot(t-r[0],e-r[1]);h.set(a,{intersection:r,distance:n})}return new Map(Array.from(h.entries()).sort((t,e)=>t[1].distance-e[1].distance))}lineIntersectsLine(t,e,s,i,r,a,n,o){const l=s-t,h=i-e,g=n-r,c=o-a,d=l*c-h*g;if(0===d)return!1;const u=r-t,p=a-e,f=(u*h-p*l)/d;if(f<0||f>1)return!1;const m=(u*c-p*g)/d;return!(m<0||m>1)&&[t+m*l,e+m*h]}actorIntersectsLine(t,e,s,i,r){const a=t.args,n=a.width,o=a.height,l=a.y,h=l-o,g=a.x-(t.isRegion?0:.5*n);if(g<e&&e<g+n&&h<s&&s<l)return[e,s];const c=t.getBoundingLines();let d,u=1/0;for(const t of c){const a=this.lineIntersectsLine(t[0],t[1],t[2],t[3],e,s,i,r);if(!a)continue;const n=Math.hypot(e-a[0],s-a[1]);n<u&&(u=n,d=a)}return d}padConnected(t){this.gamepad=t.gamepad,console.log(this.gamepad);const e=String(this.gamepad.id).replace(/\(.\)/," ").replace(/\s?\(.+/,"");this.showStatus(2500," Gamepad connected: "+e+" "),this.args.focusMe.args.hide="hide",this.interact(),"function"==typeof ga&&ft.Analytic.report({eventCategory:"gamepad",eventAction:"connected",eventLabel:t.gamepad.id})}padRemoved(t){if(!this.gamepad)return;const e=String(this.gamepad.id).replace(/\(.\)/," ").replace(/\s?\(.+/,"");this.showStatus(2500," Gamepad disconnected: "+e+" "),this.args.started&&this.pauseGame(),this.gamepad.index===t.gamepad.index&&(this.gamepad=null),"function"==typeof ga&&ft.Analytic.report({eventCategory:"gamepad",eventAction:"disconnected",eventLabel:t.gamepad.id})}getColCell(t){const e=this.colCellDiv,s=this.colCells,i=`${Math.floor(t.x/e)}:${Math.floor(t.y/e)}`;if(!s.has(i)){const t=new Set;return s.set(i,t),t.name=i,t}return s.get(i)}getColCells(t){const e=this.colCellDiv,s=t.args.y-t.args.height,i=t.args.width,r=t.args.x-(t.isRegion?0:i/2),a=t.args.x+(t.isRegion?i:i/2),n=-1+Math.floor(r/e),o=Math.ceil(a/e),l=-1+Math.floor(s/e),h=Math.ceil(t.args.y/e),g=new Set;for(let s=n;s<=o;s++)for(let i=l;i<=h;i++){const r=this.getColCell({x:s*e,y:i*e});r.add(t),g.add(r)}return g}actorsInCells(t){const e=new Set;for(const s of t)for(const t of s)e.add(t);return e}setColCell(t){if(t.removed)return;i.Bindable.isBindable(t)||console.log(t),t[i.Bindable.NoGetters]=!0,t=i.Bindable.make(t);const e=this.getColCell(t.args);if(t[bt]&&t[bt]!==e&&t[bt].delete(t),e.add(t),t[bt]=e,!t.isRegion)return e;const s=t[yt];if(t[yt]=this.getColCells(t),s)for(const e of s)t[yt].has(e)||e.delete(t);return e}getNearbyColCells(t,e){const s=this.colCellDiv,i=`${Math.floor(t/s)}::${Math.floor(e/s)}`;let r=this.colCellCache.get(i);if(r)return r;const a=t-s,n=t,o=t+s,l=e-s,h=e,g=e+s;return this.colCellCache.set(i,r=[this.getColCell({x:a,y:l}),this.getColCell({x:a,y:h}),this.getColCell({x:a,y:g}),this.getColCell({x:n,y:l}),this.getColCell({x:n,y:h}),this.getColCell({x:n,y:g}),this.getColCell({x:o,y:l}),this.getColCell({x:o,y:h}),this.getColCell({x:o,y:g})]),r}screenFilter(t){this.args.screenFilter=t}reset(){if(console.clear(),this[St]++,this.stop(),this.args.currentSheild=null,this.args.hasFire=!1,this.args.hasWater=!1,this.args.hasElectric=!1,this.args.hasNormal=!1,this.clearDialog(),this.hideDialog(),this.replayFrames=new Map,this.visible.clear(),this.callFrames.clear(),this.callIntervals.clear(),this.collisionCache.clear(),this.collisions.clear(),this.colCellCache.clear(),this.colCells.clear(),this.regions.clear(),this.spawn.clear(),this.auras.clear(),this.updateStarted.clear(),this.updateEnded.clear(),this.updated.clear(),this[vt].clear(),this.objectDb=new Q.Classifier(Object.values(D.ObjectPalette)),this.args.actClear=!1,this.args.cutScene=!1,this.args.fade=!1,this.onFrameOut(30,()=>this.args.fade="hide"),this.args.xOffset=.5,this.args.yOffset=.5,this.args.screenEffects=new r.Bag,this.tileMap){this.tileMap.unreplace();const t=this.tileMap.tileLayers;for(const e of t)e.offsetX=0,e.offsetY=0,e.offsetXChanged=0,e.offsetYChanged=0;for(const t of[...this.args.layers,...this.args.fgLayers])t.args.destroyed=!1,t.args.offsetX=0,t.args.offsetY=0,t.args.offsetXChanged=0,t.args.offsetYChanged=0}for(const t of this.actors.items())this.actors.remove(t);this.controlActor&&this.actors.remove(this.controlActor),this.nextControl=null,this.actorsById={};for(const[t,e]of Object.entries(this.effects.list))e&&this.effects.remove(e);for(const[t,e]of Object.entries(this.particles.list))e&&this.particles.remove(e);this.spawn.clear(),this[vt].clear(),this.args.isRecording=!1,this.args.isReplaying=!1,this.args.populated=!1,this.controlActor=null,this.tags.viewport.focus(),this.args.paused=!0}quit(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.replay||this.levelFinished||this.saveReplay("#FFF").catch(()=>{}),this.baseMap=this.currentMap=null,this.args.networked&&(this.server&&this.server.close(),this.client&&this.client.close(),this.actors.remove(this.remotePlayer),this.actors.remove(this.controlActor),this.controlActor=this.remotePlayer=null),this.args.fade=!0===this.args.fade&&this.args.fade,this.onNextFrame(()=>this.args.fade=!0),this.onFrameOut(45,()=>{this.args.actClear=!1,this.args.cutScene=!1,this.args.screenEffects=new r.Bag,this.callFrames.clear(),this.callIntervals.clear(),this.collisionCache.clear(),this.collisions.clear(),this.colCellCache.clear(),this.colCells.clear(),this.regions.clear(),this.spawn.clear(),this.auras.clear(),this.replayFrames=new Map,this.replayOffset=0,this.replayStart=null,this.replay=null,this.args.timeBonus.args.value=0,this.args.ringBonus.args.value=0,this.args.speedBonus.args.value=0,this.args.totalBonus.args.value=0,this.defsByMap.clear(),this.actorsByMap.clear(),this.meta={},this.willDetach.clear(),this.objectDb.clear(),this.args.currentSheild=null,this.args.hasFire=!1,this.args.hasWater=!1,this.args.hasElectric=!1,this.args.hasNormal=!1,this.args.isRecording=!1,this.args.isReplaying=!1,this.playableIterator=!1,this.args.populated=!1,this.args.paused=!1,this.args.started=!1,this.controlActor=null,this.args.frameId=-1,this.args.timer.args.value="",this.args.rings.args.value=0,this.args.hasRings=!1,this.args.hasCoins=!1,this.args.hasEmeralds=!1,this.args.char.args.value="",this.args.charName="",this.args.level=!1,this.args.layers.length,this.recent.clear(),this.visible.clear(),this[vt].clear();for(const t of this.actors.items())this.actors.remove(t);for(const t of this.particles.items())this.particles.remove(t),t.remove();for(const t of[...this.args.layers,...this.args.fgLayers])t.args.destroyed=!1;for(const t of this.args.layers)t.remove();for(const t of this.args.fgLayers)t.remove();this.args.layers.splice(0),this.args.fgLayers.splice(0),this.args.bg=this.args.backdrop=null;for(const[t,e]of this.backdrops)e.view.remove();if(this.backdrops.clear(),e)this.onFrameOut(15,()=>e());else{const e=[];if(2===t||this.args.networked){const t=new _.MainMenu({timeout:-1},this);this.args.networked&&(t.args.initialPath=["Multiplayer"]),e.push(t)}else t?(d.Bgm.fadeOut(2e3),e.push(...this.homeCards())):(d.Bgm.fadeOut(3e3),e.push(...this.returnHomeCards()));this.onFrameOut(15,()=>{this.args.titlecard=new v.Series({cards:e},this),this.args.titlecard.play()})}}),l.Keyboard.get().reset(),this.controller.zero()}introCards(){return[new S.LoadingCard({timeout:3500,text:"loading"},this),new w.BootCard({timeout:3500}),new C.WarningCard({timeout:8500}),new x.DebianCard({timeout:4500}),new k.WebkitCard({timeout:3500}),new P.NewgroundsCard({timeout:2500}),new j.SaneCard({timeout:4500}),new M.GamepadCard({timeout:2500}),new T.SeanCard({timeout:5e3},this),...this.homeCards()]}homeCards(){return[new y.TitleScreenCard({timeout:51e3},this),new _.MainMenu({timeout:-1},this)]}returnHomeCards(){return[new b.ThankYouCard({timeout:5e3},this),...this.homeCards()]}playCards(){this.args.titlecard.play()}record(){this.args.demoIndicator=null,this.reset(),this.args.frameId=0,this.replayFrames=new Map,this.args.isRecording=!0,this.args.isReplaying=!1,this.args.hasRecording=!0,this.args.paused=!1,this.startLevel()}playback(){this.args.demoIndicator=null,this.args.frameId=0,this.args.isReplaying=!0,this.args.isRecording=!1,this.lastInput={},this.startLevel(),this.args.paused=!1}stop(){if(this.args.isRecording){const t=JSON.stringify(this.replayFrames.entries());localStorage.setItem("replay",t)}this.args.isReplaying=!1,this.args.isRecording=!1,this.args.paused=!1,this.controlActor&&this.controlActor.controller.zero(),this.tags.viewport.focus()}focus(){this.tags.viewport&&this.tags.viewport.focus()}getServer(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t&&this.server&&this.server.peerServer&&"new"===this.server.peerServer.connectionState)return this.server;const e={iceServers:[{urls:this.settings.iceServer1},{urls:this.settings.iceServer2}]},s=t||!this.server?new Z.RtcServer(e):this.server||new Z.RtcServer(e);return this.listen(s,"open",t=>{this.args.chatBox=new tt.ChatBox({pipe:s}),this.args.playerId=1},{once:!0}),this.listen(s,"close",t=>{this.actors.remove(this.remotePlayer),this.quit(2)},{once:!0}),this.listen(s,"message",t=>{if(this.remotePlayer){const e=JSON.parse(t.detail),s=this.remotePlayer;e.frame&&(e.frame.frame>this.args.frameId&&(this.args.frameId=e.frame.frame),e.frame.input&&(s.controller.replay(e.frame.input),s.readInput()),e.frame.args&&Object.assign(s.args,e.frame.args),s.noClip=s.args.dead)}}),this.server=s,s}getClient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t&&this.client&&this.client.peerClient&&"new"===this.client.peerClient.connectionState)return this.client;const e={iceServers:[{urls:this.settings.iceServer1},{urls:this.settings.iceServer2}]},s=t||!this.client?new X.RtcClient(e):this.client||new X.RtcClient(e);return this.listen(s,"open",t=>{this.args.chatBox=new tt.ChatBox({pipe:s}),this.args.playerId=2},{once:!0}),this.listen(s,"close",t=>this.quit(2),{once:!0}),this.listen(s,"message",t=>{if(this.remotePlayer){const e=JSON.parse(t.detail),s=this.remotePlayer;e.frame&&(e.frame.frame>this.args.frameId&&(this.args.frameId=e.frame.frame),e.frame.input&&(s.controller.replay(e.frame.input),s.readInput()),e.frame.args&&Object.assign(s.args,e.frame.args),s.noClip=s.args.dead)}}),this.client=s,s}serializePlayer(){if(!this.controlActor||!this.controlActor.controller)return{};const t=this.args.frameId,e=this.controlActor.controller.serialize(),s=this.controlActor.args;return{frame:t,input:e,args:{x:s.x,y:s.y,gSpeed:s.gSpeed,xSpeed:s.xSpeed,ySpeed:s.ySpeed,direction:s.direction,facing:s.facing,falling:s.falling,rolling:s.rolling,jumping:s.jumping,flying:s.flying,float:s.float,angle:s.angle,mode:s.mode,rings:s.rings,groundAngle:s.groundAngle,respawning:s.respawning,dead:!!s.dead}}}packPlayerFrame(){const t=this.controlActor.args,e=new Int8Array(8),s=new Int8Array(16),i=new Int32Array(11),r=new Float32Array(7),a=new Int32Array(1);i[0]=t.direction,i[1]="left"===t.facing?-1:1,i[2]=t.falling,i[3]=t.rolling,i[4]=t.jumping,i[5]=t.flying,i[6]=t.float,i[7]=t.mode,i[8]=t.rings,i[9]=t.respawning,i[10]=Number(t.dead),r[0]=t.x,r[1]=t.y,r[2]=t.gSpeed,r[3]=t.xSpeed,r[4]=t.ySpeed,r[5]=t.angle,r[6]=t.groundAngle,a[0]=this.args.frameId;const{axes:n,buttons:o}=this.controlActor.controller.serialize();for(const t in e){var l;e[t]=127*(null!==(l=n[t])&&void 0!==l?l:0)}for(const t in s){var h;s[t]=127*(null!==(h=o[t])&&void 0!==h?h:0)}return new Blob([e.buffer,s.buffer,i.buffer,r.buffer,a.buffer])}unpackPlayerFrame(t){const e=new DataView(t,0),s=new DataView(t,8),i=new DataView(t,24),r=new DataView(t,68),a=new DataView(t,96),n={axes:{},buttons:{}},o={};for(let t=0;t<8;t++)n.axes[t]=e.getInt8(t)/127;for(let t=0;t<16;t++)n.buttons[t]=s.getInt8(t)/127;return o.direction=i.getInt32(0,!0),o.facing=-1===i.getInt32(4,!0)?"left":"right",o.falling=i.getInt32(8,!0),o.rolling=i.getInt32(12,!0),o.jumping=i.getInt32(16,!0),o.flying=i.getInt32(20,!0),o.float=i.getInt32(24,!0),o.mode=i.getInt32(28,!0),o.rings=i.getInt32(32,!0),o.respawning=i.getInt32(36,!0),o.dead=i.getInt32(40,!0),o.x=r.getFloat32(0,!0),o.y=r.getFloat32(4,!0),o.gSpeed=r.getFloat32(8,!0),o.xSpeed=r.getFloat32(12,!0),o.ySpeed=r.getFloat32(16,!0),o.angle=r.getFloat32(20,!0),o.groundAngle=r.getFloat32(24,!0),{frame:{input:n,args:o,frame:a.getInt32(0,!0)}}}onRenderedFrameOut(t,e){t<0?e():this.callRenderedFrames.set(e,t)}onFrameOut(t,e){if(t<=0)return void e();const s=this.args.frameId+t;this.callFrames.has(s)||this.callFrames.set(s,new Set);const i=this.callFrames.get(s);return i.add(e),()=>i.delete(e)}onFrameInterval(t,e){if(frames<=0)return;const s=t;this.callIntervals.has(s)||this.callIntervals.set(s,new Set);const i=this.callIntervals.get(s);return i.add(e),()=>i.delete(e)}callFrameOuts(){for(let t=this.args.lastFrameId;t<=this.args.frameId;t++){if(!this.callFrames.has(t))continue;const e=this.callFrames.get(t);for(const t of e)t();this.callFrames.delete(t)}}callRenderedFrameOut(){if(this.args.frameId%this.settings.frameSkip==0)for(const[t,e]of this.callRenderedFrames)e<=0?t():this.callRenderedFrames.set(t,-1+frames)}callFrameIntervals(){for(let t=this.args.lastFrameId;t<=this.args.frameId;t++)for(const[e,s]of this.callIntervals)if(t%e==0)for(const t of s)t()}pauseGame(){this.focus(),this.args.mouse="moved",this.args.paused=-1,this.args.pauseMenu.focusFirst(),d.Bgm.pause(),this.onTimeout(6,()=>{this.controller&&this.controller.zero()})}unpauseGame(){this.args.pauseMenu.reset(),d.Bgm.unpause(),this.args.mouse="hide",this.onTimeout(15,()=>{this.controller&&this.controller.zero()}),this.onTimeout(30,()=>{this.focus()}),this.onTimeout(60,()=>{this.args.paused=!1})}mousemove(t){this.args.mouse="moved";const e=t.currentTarget.offsetLeft,s=t.currentTarget.offsetTop,i=(t.pageX+-e)/this.args.scale,r=(t.pageY+-s)/this.args.scale;this.args.xMouseOffset=i,this.args.yMouseOffset=r,this.onTimeout(800,()=>{this.args.mouse="hide"})}mousedown(t){this.setMouseButtons(t)}mouseup(t){this.setMouseButtons(t)}setMouseButtons(t){for(let e=0;e<8;e++){const s=2**e;this.mouseState.buttons[e]=this.mouseState.buttons[e]||0,t.buttons&s?this.mouseState.buttons[e]++:this.mouseState.buttons[e]=0}}hyphenate(t){return String(t).replace(/\s/g,"-").toLowerCase()}storeCheckpoint(t,e){this.checkpoints[this.currentMap]||(this.checkpoints[this.currentMap]={}),this.checkpoints[this.currentMap][t]={checkpointId:e,frames:this.args.frameId-this.args.startFrameId},localStorage.setItem(`checkpoints:::${this.currentMap}`,JSON.stringify(this.checkpoints[this.currentMap]))}getCheckpoint(t){if(!this.checkpoints[this.currentMap]){const t=localStorage.getItem(`checkpoints:::${this.currentMap}`)||"{}";this.checkpoints[this.currentMap]=JSON.parse(t)||{}}return this.checkpoints[this.currentMap][t]}setCheckpoint(t,e){localStorage.setItem(`checkpoints:::${t}`,JSON.stringify(e))}clearCheckpoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.controlActor&&(null===t&&(t=this.controlActor.args.canonical),this.checkpoints[this.currentMap]||(this.checkpoints[this.currentMap]={}),delete this.checkpoints[this.currentMap][t],localStorage.setItem(`checkpoints:::${this.currentMap}`,JSON.stringify(this.checkpoints[this.currentMap])))}showCenterMessage(t,e){this.args.centerMessage=new B.CharacterString({value:t,color:e})}hideCenterMessage(){this.args.centerMessage=!1}showDialog(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.args.dialog=!0,this.clearDialog(),t=t.map(t=>new B.CharacterString({value:t}));let s=0;for(const e of t)e.offset=s,s+=e.args.value.length;this.args.dialogLines=t,this.args.dialogClasses=e}hideDialog(t){this.clearDialog(),this.args.dialog=!1}clearDialog(){this.args.dialogLines=[]}clearAct(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this.getZoneState();if(this.controlActor&&this.controlActor.args.canonical){const t=this.getCharacterState(this.controlActor.args.canonical);t&&(this.currentMap in t.cleared||(t.cleared[this.currentMap]={firstCleared:Date.now()}),t.cleared[this.currentMap].clearCount=t.cleared[this.currentMap].clearCount||0,t.cleared[this.currentMap].lastCleared=Date.now(),t.cleared[this.currentMap].clearCount++)}this.args.actClearLabel.args.value=t;const i=this.controlActor.args.rings,r=this.args.frameId-this.args.startFrameId,a=r/60,n=this.controlActor.args.airTimeTotal/(this.controlActor.args.airTimeTotal+this.controlActor.args.groundTimeTotal),o=Math.trunc(10*this.controlActor.args.clearSpeed),l=100*i,h=Math.round(1e4*(n||0));let g=0;const c=Math.trunc(Math.abs(a)),u=(g=c<30?5e4:c<45?1e4:c<60?5e3:c<90?4e3:c<120?3e3:c<180?2e3:c<240?1e3:500)+l+o+h;this.args.actClear=!0,this.args.skidBonusValue=this.controlActor.args.dragBonus||0,this.controlActor.args.dragBonus;const p=new ut.TallyBoard;return p.addCounter({label:"Time Bonus:",value:g}),p.addCounter({label:"Ring Bonus:",value:l}),o&&p.addCounter({label:"Speed Bonus:",value:o}),p.addCounter({label:"Air Bonus:",value:h}),d.Bgm.play("ACT_CLEAR",{interlude:!0}),p.update(this),e&&p.addEventListener("totalingdone",t=>this.setZoneCard(!0)),p.addEventListener("done",t=>{this.controlActor.args.clearSpeed=0,this.args.tallyBoard=null,this.tallyBoard=!1,this.args.actStartFrameId=this.args.frameId,this.args.actClear=!1,this.args.inventory.splice(0),d.Bgm.stop("ACT_CLEAR"),e&&this.args.zonecard.replay()}),this.tallyBoard=p,this.args.tallyBoard=p.view(),(!s.time||s.time>r)&&(s.time=r),(!s.rings||s.rings<i)&&(s.rings=i),(!s.air||s.air<n)&&(s.air=n),(!s.score||s.score<u)&&(s.score=u),this.currentSave.save(),p}cpuDetect(){try{ft.Analytic.report({eventCategory:"cpu",eventAction:"cores",eventLabel:"core check",eventValue:navigator.hardwareConcurrency})}catch(t){ft.Analytic.report({eventCategory:"cpu",eventAction:"cpu detect fail",eventLabel:`Cpu Detect Failure: ${t}`})}}gpuDetect(){try{this.gpuDetector=this.gpuDetector||document.createElement("canvas").getContext("webgl");const t=this.gpuDetector.getExtension("WEBGL_debug_renderer_info"),e=this.gpuDetector.getParameter(t.UNMASKED_VENDOR_WEBGL),s=this.gpuDetector.getParameter(t.UNMASKED_RENDERER_WEBGL);ft.Analytic.report({eventCategory:"gpu",eventAction:"gpu detect",eventLabel:`${e} :: ${s}`})}catch(t){ft.Analytic.report({eventCategory:"gpu",eventAction:"gpu detect fail",eventLabel:`Gpu Detect Failure: ${t}`})}}buildDetect(){const t=document.head.querySelector('meta[name="x-build-time"]').getAttribute("content");ft.Analytic.report({eventCategory:"build",eventAction:"build check",eventLabel:t})}interact(){this.args.interacted=!0}matrixConnect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.settings.matrixUrl||console.error("No matrixUrl defined!!!");const e=location.origin+"/accept-sso";return!t&&this.matrix&&this.matrix.isLoggedIn?Promise.resolve(this.matrix):this.matrix.logIn(e).then(()=>this.matrix)}subspaceConnect(){this.socket=J.Socket.get("ws://localhost:9998"),this.socket.subscribe("open",()=>{console.log("socket ready!"),fetch("http://localhost:2020/auth?api").then(t=>t.text()).then(t=>{console.log(t),this.socket.send(`auth ${t}`),this.socket.subscribe("message",(t,e,s,i,r,a)=>{if("user"===i)return;if(console.log(t.data),"{"!==t.data[0])return;const n=JSON.parse(t.data);"youruid"in n&&(this.netId=n.youruid)}),this.socket.send("uid"),this.socket.subscribe("message:0",(t,e,s,i,r,n)=>{if(this.bytesReceived+=e.length||e.byteLength,"user"!==i)return void console.log(e);if(!this.controlActor||r===this.netId)return;const o=this.unpackPlayerFrame(e);if(!this.netPlayers.has(r)){const t=new st.Sonic({name:"Player "+r,id:String(new a.Uuid),netplayer:!0},this);this.netPlayers.set(r,t),this.spawn.add({object:t}),this.actors.add(t),this.auras.add(t)}const l=this.netPlayers.get(r);o.frame&&(o.frame.frame>this.args.frameId&&(this.args.frameId=o.frame.frame),o.frame.input&&(l.controller.replay(o.frame.input),l.readInput()),o.frame.args&&Object.assign(l.args,o.frame.args),l.noClip=l.args.dead)}),this.socket.publish("testing","This is the payload.")})}),this.socket.subscribe("close",()=>{console.log("socket closed!"),this.quit(2)})}nowPlayingClicked(t){this.args.audioComment&&(console.log(this.args.audioComment),"https://"===this.args.audioComment.substr(0,8)&&(this.pauseGame(),window.open(this.args.audioComment,"audio-credit")))}handleUncaughtException(t){console.error(t.error),ft.Analytic.report({eventCategory:"error",eventAction:`${t.error.message} @ ${t.filename}:${t.lineno}:${t.colno}`,eventLabel:t.error.stack}),nt.TraceDatabase.open("traces",1).then(e=>{const s=ot.Trace.from(t.error);delete s.id,console.log(JSON.stringify(s)),s.consume(t),console.log(JSON.stringify(s)),console.log(s,t),this.currentMap&&e.insert("traces",s).then(()=>{if(this.replay)return s.replay=this.replay.uuid,void e.update("traces",s);this.saveReplay("#FF0000").then(t=>{s.replay=t.uuid,e.update("traces",s)}).catch(()=>{})})})}get mouse(){return this.mouseState.position[0]=this.args.xMouseOffset+-this.args.x,this.mouseState.position[1]=this.args.yMouseOffset+-this.args.y,this.mouseState}}}),require.register("viewport/layer.html",function(t,e,s){s.exports='<div data-name = "[[name]]" class = "viewport-background" cv-each = "blocks:block:b" cv-ref = "background" data-layer = "[[layerId]]">[[block]]</div>\n'}),require.register("viewport/viewport.html",function(t,e,s){s.exports='<section class = "filters" cv-each = "effects:effect">[[effect]]</section>\n\n<div class = "viewport-frame [[initializing]] [[standalone]] [[secret]] [[level]] [[noIntro]] [[inputType]] [[ntsc]] [[windowFocused]]" data-theme = "[[theme]]" data-bg = "[[bg]]" data-agent = "[[agent]]" cv-ref = "frame" data-paused = "[[paused]]" data-smoothing = [[smoothing]] data-character = "[[selectedChar]]" data-loading-map = "[[loadingMap]]" cv-on = "mousedown:interact:c;keydown:interact:c;">\n\t<div class = "viewport [[standalone]] [[fullscreen]] displacement-[[displacement]] mouse-[[mouse]] [[theme]] [[hideNowPlaying]] [[hiddenNowPlaying]] [[invert]]" cv-ref = "viewport" tabindex="0" cv-on = "click;mousemove;mousedown;mouseup;">\n\n\t\t<svg height="32" width="32">\n\t\t<defs>\n\t\t\t<filter id="motionBlur" x="0%"\n y="0%" width="100%" height="100%">\n\t\t\t\t<feGaussianBlur\n\t\t\t\t\tin = "SourceGraphic"\n\t\t\t\t\tedgeMode = "duplicate"\n\t\t\t\t\tstdDeviation = "0,0"\n\t\t\t\t\tcv-ref = "blur"\n\t\t\t\t/>\n\t\t\t</filter>\n\t\t</defs>\n\t\t</svg>\n\n\t\t<svg height="100" width="100">\n\t\t<defs>\n\t\t\t<filter id="waterBlur">\n\t\t\t\t<feGaussianBlur in="SourceGraphic" stdDeviation="0.25,0" />\n\t\t\t</filter>\n\n\t\t\t<filter id="dilate">\n\t\t\t\t<feMorphology operator="dilate" radius="0.25" result = "expanded"/>\n\t\t\t\t<feMerge>\n\t\t\t\t\t<feMergeNode in="expanded" />\n\t\t\t\t\t<feMergeNode in="SourceGraphic" />\n\t\t\t\t</feMerge>\n\t\t\t</filter>\n\n\t\t\t<filter id = "waves"\n\t\t\t\tcolor-interpolation-filters="sRGB"\n\t\t\t\tx      ="0%"\n\t\t\t\ty      ="0%"\n\t\t\t\theight ="100%"\n\t\t\t\twidth  ="100%"\n\t\t\t>\n\t\t\t\t<feFlood\n\t\t\t\t\tflood-color="#408000"\n\t\t\t\t\tresult = "DisplacementGreen"\n\t\t\t\t></feFlood>\n\n\t\t\t\t<feImage\n\t\t\t\t\txlink:href="/effects/wave.png"\n\t\t\t\t\tresult="DisplacementSource"\n\t\t\t\t\theight="64"\n\t\t\t\t\twidth="64"\n\t\t\t\t></feImage>\n\n\t\t\t\t<feTile\n\t\t\t\t\tin="DisplacementSource"\n\t\t\t\t\tresult="DisplacementTile"\n\t\t\t\t></feTile>\n\n\t\t\t\t<feComposite\n\t\t\t\t\tin  = "DisplacementTile"\n\t\t\t\t\tin2 = "DisplacementGreen"\n\t\t\t\t\tresult ="DisplacementField"\n\t\t\t\t\toperator ="over"\n\t\t\t\t></feComposite>\n\n\t\t\t\t<feOffset\n\t\t\t\t\tin  = "DisplacementField"\n\t\t\t\t\tout = "DisplacementOffset"\n\t\t\t\t\tdx  = "0"\n\t\t\t\t>\n\t\t\t\t\t<animate\n\t\t\t\t\t\tattributeName="dy"\n\t\t\t\t\t\tvalues = "0;-64"\n\t\t\t\t\t\tdur="1500ms"\n\t\t\t\t\t\trepeatCount="indefinite" />\n\n\t\t\t\t</feOffset>\n\n\t\t\t\t<feDisplacementMap\n\t\t\t\t\tin="SourceGraphic"\n\t\t\t\t\tin2="DisplacementOffset"\n\t\t\t\t\tresult="Displaced"\n\t\t\t\t\txChannelSelector="R"\n\t\t\t\t\tyChannelSelector="G"\n\t\t\t\t\tscale="4"\n\t\t\t\t></feDisplacementMap>\n\n\t\t\t\t<feGaussianBlur\n\t\t\t\t\tin="Displaced"\n\t\t\t\t\tstdDeviation="0.35"\n\t\t\t\t></feGaussianBlur>\n\t\t\t</filter>\n\n\t\t\t<filter id = "ntsc"\n\t\t\t\tcolor-interpolation-filters="sRGB"\n\t\t\t\tx      = "0%"\n\t\t\t\ty      = "0%"\n\t\t\t\twidth  = "100%"\n\t\t\t\theight = "200%"\n\t\t\t>\n\t\t\t\t<feFlood\n\t\t\t\t\tflood-color="#808000"\n\t\t\t\t\tresult = "DisplacementGreen"\n\t\t\t\t></feFlood>\n\n\t\t\t\t<feImage\n\t\t\t\t\txlink:href="/effects/ntsc-static.png"\n\t\t\t\t\tresult ="DisplacementSource"\n\t\t\t\t\twidth  = "128"\n\t\t\t\t\theight = "128"\n\t\t\t\t></feImage>\n\n\t\t\t\t<feTile\n\t\t\t\t\tin="DisplacementSource"\n\t\t\t\t\tresult="DisplacementTile"\n\t\t\t\t></feTile>\n\n\t\t\t\t<feComposite\n\t\t\t\t\tin  = "DisplacementTile"\n\t\t\t\t\tin2 = "DisplacementGreen"\n\t\t\t\t\tresult ="DisplacementField"\n\t\t\t\t\toperator ="over"\n\t\t\t\t></feComposite>\n\n\t\t\t\t<feOffset\n\t\t\t\t\tin  = "DisplacementField"\n\t\t\t\t\tout = "DisplacementOffset"\n\t\t\t\t\tdx  = "0"\n\t\t\t\t\tdy  = "0"\n\t\t\t\t>\n\t\t\t\t\t<animate\n\t\t\t\t\t\tattributeName="dy"\n\t\t\t\t\t\tvalues = "-128;0"\n\t\t\t\t\t\tbegin="2000ms"\n\t\t\t\t\t\tdur="2000ms"\n\t\t\t\t\t\trepeatCount="8"\n\t\t\t\t\t></animate>\n\n\t\t\t\t</feOffset>\n\n\t\t\t\t<feDisplacementMap\n\t\t\t\t\tin="SourceGraphic"\n\t\t\t\t\tin2="DisplacementOffset"\n\t\t\t\t\tresult="Displaced"\n\t\t\t\t\txChannelSelector="R"\n\t\t\t\t\tyChannelSelector="G"\n\t\t\t\t\tscale = "0"\n\t\t\t\t>\n\t\t\t\t\t<animate\n\t\t\t\t\t\tattributeName="scale"\n\t\t\t\t\t\tvalues = "512;192;0"\n\t\t\t\t\t\tbegin="2000ms"\n\t\t\t\t\t\tdur="2000ms"\n\t\t\t\t\t\trepeatCount="1"\n\t\t\t\t\t></animate>\n\n\t\t\t\t</feDisplacementMap>\n\t\t\t</filter>\n\n\t\t</defs>\n\t\t</svg>\n\n\t\t<div class = "viewport-zoom">\n\n\t\t\t[[backdrop]]\n\n\t\t\t<div class = "backdrops" cv-ref ="backdrops"></div>\n\n\t\t\t<div class = "blurAngle" cv-ref = "blurAngle">\n\t\t\t<div class = "blurDistance" cv-ref = "blurDistance">\n\t\t\t<div class = "blurAngleCancel" cv-ref = "blurAngleCancel">\n\t\t\t\t<div\n\t\t\t\t\tcv-ref  = "background"\n\t\t\t\t\tclass   = "viewport-bg-layers"\n\t\t\t\t\tcv-each = "layers:layer"\n\t\t\t\t>[[layer]]</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class = "filters filters-background" cv-ref = "bgFilters"></div>\n\n\t\t\t<div cv-ref = "content" class = "viewport-content">\n\t\t\t\t<div cv-ref = "actors" class = "viewport-actors"></div>\n\t\t\t\t<div cv-ref = "particles" class = "viewport-particles"></div>\n \t\t\t</div>\n\n\t\t\t<div class = "blurAngle" cv-ref = "blurAngleFg">\n\t\t\t<div class = "blurDistance" cv-ref = "blurDistanceFg">\n \t\t\t<div class = "blurAngleCancel" cv-ref = "blurAngleCancelFg">\n\t\t\t\t<div\n\t\t\t\t\tcv-ref  = "foreground"\n\t\t\t\t\tclass   = "viewport-bg-layers"\n\t\t\t\t\tcv-each = "fgLayers:layer"\n\t\t\t\t>[[layer]]</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n \t\t</div>\n\n \t\t[[plot]]\n\n \t\t<div class = "viewport-overlay">\n \t\t\t<div class = "debug-spawn" cv-if = "debugEditMode">\n \t\t\t\t<div class = "debug-spawn" cv-ref = "spawnPreview"></div>\n \t\t\t\t<div class = "debug-spawn">[[debugObjectName]]</div>\n \t\t\t</div>\n\n\t\t\t<div class = "hud now-loading"></div>\n\n\t\t\t<div class = "hud hud-top-right hud-table combo-table">\n\t\t\t\t<span cv-if = "showCombo">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<span class = "combo-list" cv-each = "combo:pop:p">\n\t\t\t\t\t\t\t<div>[[pop.label]]</div>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class = "comboTopLine" cv-if = "combo">[[popBottomLine]]</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class = "comboTopLine" cv-if = "combo">[[popTopLine]]</span>\n\t\t\t\t</span>\n\t\t\t\t<span class = "comboFail">[[comboFail]]</span>\n\t\t\t\t<span class = "comboResult">[[comboResult]]</span>\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-top-right hud-table quick-form">[[quickForm]]</div>\n\n\t\t\t<div class = "hud hud-top-right hud-table"  cv-if = "debugOsd">\n\t\t\t\t<table>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan = "2">[[char]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelGround]]</td>\n\t\t\t\t\t\t<td>[[ground]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelCamera]]</td>\n\t\t\t\t\t\t<td>[[cameraMode]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelMode]]</td>\n\t\t\t\t\t\t<td>[[mode]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelX]]</td>\n\t\t\t\t\t\t<td>[[xPos]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelY]]</td>\n\t\t\t\t\t\t<td>[[yPos]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelLayer]]</td>\n\t\t\t\t\t\t<td>[[layer]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelGSpeed]]</td>\n\t\t\t\t\t\t<td>[[gSpeed]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelXSpeed]]</td>\n\t\t\t\t\t\t<td>[[xSpeed]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelYSpeed]]</td>\n\t\t\t\t\t\t<td>[[ySpeed]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelAirAngle]]</td>\n\t\t\t\t\t\t<td>[[airAngle]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelAngle]]</td>\n\t\t\t\t\t\t<td>[[angle]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelActors]]</td>\n\t\t\t\t\t\t<td>[[actorCount]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelRegions]]</td>\n\t\t\t\t\t\t<td>[[regionCount]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelFrame]]</td>\n\t\t\t\t\t\t<td>[[frame]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[labelIgnore]]</td>\n\t\t\t\t\t\t<td>[[ignore]]</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t</table>\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-top-right" cv-if = "showHud">\n\n\t\t\t\t<div class = "char-hud">\n\t\t\t\t\t[[prompt]] [[char]]\n\t\t\t\t\t<div class = "char-icon [[charName|hyphenate]]"></div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class = "emblem-hud" cv-each = "emblems:emblem:e">\n\t\t\t\t\t\t<img loading="lazy" src = "/custom/hud-emblem.png" class = "[[emblem.existing]]" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class = "collectible-hud" cv-each = "inventory:item">\n\t\t\t\t\t\t<span cv-if = "item.icon">\n\t\t\t\t\t\t\t<img loading="lazy" src = "[[item.icon]]" class = "inventory-icon" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class = "emerald-hud" cv-each = "emeralds:emerald:e">\n\t\t\t\t\t<img loading="lazy" src = "/Sonic/emerald-[[emerald]]-mini.png" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-bottom-right">\n\n\t\t\t\t<div cv-if = "showHud" class ="sheild-hud [[currentSheild]] [[hasElectric]] [[hasFire]] [[hasWater]] [[hasNormal]]">\n\t\t\t\t\t<div class = "sheild-icon sheild-electric"></div>\n\t\t\t\t\t<div class = "sheild-icon sheild-normal"></div>\n\t\t\t\t\t<div class = "sheild-icon sheild-fire"></div>\n\t\t\t\t\t<div class = "sheild-icon sheild-water"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<span class = "contents" cv-if = "showFps">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>[[labelFps]]</td>\n\t\t\t\t\t\t\t<td>[[fpsSprite]]</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-dark hud-bottom-left" cv-if = "showHud" data-extra = "[[audioComment]]" data-secret-icon = [[secretIcon]] cv-on = "click:nowPlayingClicked">\n\t\t\t\t[[nowPlaying]]\n\t\t\t\t[[trackName]]\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-top-left hud-table"  cv-if = "showHud">\n\t\t\t\t<table>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[scoreLabel]]</td><td>[[score]]</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[timerLabel]]</td><td>[[timer]]</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>[[ringLabel]]</td><td>[[rings]]</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\t\x3c!-- <div class = "demo-hud" cv-if = "demoIndicator">[[demoIndicator]]</div> --\x3e\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-dark hud-centered" cv-if = "actClear">\n\t\t\t\t<div class = "centered act-cleared">[[actClearLabel]]</div>\n\t\t\t\t[[tallyBoard]]\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-dark hud-centered" cv-if = "centerMessage">\n\t\t\t\t[[centerMessage]]\n\t\t\t</div>\n\n\t\t\t<div class = "hud hud-dark hud-centered-raised" cv-if = "dialog">\n\t\t\t\t<div class = "dialog-frame [[dialogClasses]]">\n\t\t\t\t\t<div class = "dialog-icon">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div cv-each = "dialogLines:line" class = "dialog-text">\n\t\t\t\t\t\t<span style = "--text-offset:[[line.offset]]">[[line]]</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class = "screen-effects" cv-each = "screenEffects:effect">\n\t\t\t\t[[effect]]\n\t\t\t</div>\n\n\t\t\t<section class = "pause-menu full" cv-if = "paused">[[pauseMenu]]</section>\n\n\t\t\t[[titlecard]]\n\n\t\t\t<div class = "topLine">\n\t\t\t\t<div class = "status-message">[[topLine]]</div>\n\t\t\t</div>\n\n\t\t\t<div class = "focus-me">\n\t\t\t\t<div class = "status-message">[[focusMe]]</div>\n\t\t\t</div>\n\n\t\t\t<div class = "status-message">[[status]]</div>\n\t\t\t<section class = "contents" cv-if = "networked">[[chatBox]]</section>\n\t\t\t\x3c!-- <div class = "filters filters-foreground" cv-ref = "fgFilters"></div> --\x3e\n\t\t\t<div class = "console [[showConsole]]" cv-ref = "subspace" tab-index = "0">[[subspace]]</div>\n\t\t\t<div class = "shade" data-fade = "[[fade]]"></div>\n\n\t\t</div>\n\n\t\t<div class = "quick-controls" cv-if = "shortcuts">\n\t\t\t[[muteSwitch]]\n\t\t\t<div class = "button" cv-on = "click:fullscreen()">\n\t\t\t\t<image src = "/ui/fullscreen.svg" />\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n</div>\n'}),require.register("zoneScripts/ChaoGarden.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChaoGarden=void 0;e("../actor/Spring"),e("../actor/OrbSmall"),e("../actor/WoodenCrate"),e("../behavior/SkidDust");var i=e("../actor/Chao");t.ChaoGarden=class{update(t,e){if(0===t){const t=e.getZoneState();if(t.chao)for(const s of t.chao){const t=new i.Chao;t.load(s),e.spawn.add({object:t})}}}}}),require.register("zoneScripts/InfiniteRuin.js",function(t,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InfiniteRuin=void 0;var i=e("../actor/Spring"),r=e("../actor/OrbSmall"),a=e("../actor/WoodenCrate"),n=e("../behavior/SkidDust");t.InfiniteRuin=class{update(t,e){if(!e.controlActor)return;if(e.controlActor.args.dead||e.controlActor.args.startled)return;t<30&&e.controlActor&&(e.controlActor.args.gSpeed=15);let s=120;if(t<600&&(s=150),t>1200&&(s=100),t>1800&&(s=90),t>120&&t%s==0&&e.controlActor){let s=Math.random();t<900&&(s=0),t<900&&(s*=.79),e.objectDb.has(a.WoodenCrate)&&e.objectDb.get(a.WoodenCrate).size&&(s=0),s>.5?this.spawnBox(e):this.spawnOrb(e)}}spawnOrb(t){let e;e=new r.OrbSmall;let s=Math.trunc(8*Math.random());switch(e.args.xSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,e.args.gSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,s){case 0:e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.friction=.75,e.args.bounce=.75;break;case 1:e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.friction=.7,e.args.bounce=.75;break;case 2:e.args.x=t.controlActor.args.x+400,e.args.y=928,e.args.decel=.05,e.args.bounce=0,e.args.gSpeed=18,e.args.xSpeed=18;break;case 3:e.args.x=t.controlActor.args.x+400,e.args.y=928,e.args.decel=.2,e.args.bounce=0,e.args.gSpeed=18,e.args.xSpeed=18;break;case 4:e.args.x=t.controlActor.args.x+400,e.args.y=880,e.args.friction=.9,e.args.decel=.15,e.args.bounce=.999;break;case 5:e.args.x=t.controlActor.args.x+400,e.args.y=904,e.args.friction=.8,e.args.decel=.15,e.args.bounce=.999;break;case 6:e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.friction=.75,e.args.bounce=.7;break;case 7:e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.friction=.7,e.args.bounce=.8}e.args.canHide=!0,t.spawn.add({object:e})}spawnBox(t){let e;e=new a.WoodenCrate,Math.trunc(8*Math.random()),e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.friction=.76,e.args.bounce=.65,e.args.contains="ring-monitor",e.alwaysSkidding=!0,e.dustFreq=5,e.behaviors.add(new n.SkidDust),e.args.xSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,e.args.gSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,t.spawn.add({object:e})}spawnSpring(t){let e;e=new i.Spring,Math.trunc(8*Math.random()),e.args.x=t.controlActor.args.x+320,e.args.y=608,e.args.decel=.03,e.args.power=10,e.args.width=32,e.args.height=16,e.args.angle=-Math.PI/2,e.args.groundAngle=0,e.args.static=!1,e.args.canHide=!0,e.alwaysSkidding=!0,e.float=0,e.dustFreq=5,e.behaviors.add(new n.SkidDust),e.args.xSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,e.args.gSpeed=t.controlActor.args.gSpeed||t.controlActor.args.xSpeed,t.spawn.add({object:e}),e.sleep,e.sleep=(()=>t.actors.remove(e))}}}),require.register("___globals___",function(t,e,s){})}(),require("___globals___");
